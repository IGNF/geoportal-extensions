/*!
 * @brief French Geoportal Extension for Leaflet
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * @copyright copyright (c) IGN 
 * @license CeCILL-B
 * @author IGN
 * @version 2.2.7
 * @date 18/11/2022
 *
 */
SearchEngine=function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=58)}([function(e,t){e.exports=L},function(e,t,o){"use strict";var n={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(e,t){if(0===Object.keys(arguments).length)return"Message indefined !";var o=Array.prototype.slice.call(arguments),n=o.shift(),r=o,i=this[n];try{i=Array.isArray(r)&&r.length>0?i.replace("%var%",r.join(" - ")):i.replace("%var%","%var% (not specified)")}catch(e){}return i}};t.a=n},function(e,t,o){"use strict";function n(e){if(!(this instanceof n))throw new TypeError("ErrorService constructor cannot be called as a function.");var t=e;"string"==typeof e||e instanceof String?(this.message=e,this.status=-1,this.type=n.TYPE_UNKERR):(this.message=t.message||"undefined!?",this.type=t.type,this.status=t.status||-1),this.name="ErrorService",this.stack=(new Error).stack}n.TYPE_SRVERR="SERVICE_ERROR",n.TYPE_USEERR="USAGE_ERROR",n.TYPE_UNKERR="UNKNOWN_ERROR",n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t.a=n},function(e,t,o){"use strict";var n=o(6),r={getLogger:function(e){"true".match(/true/)?n.disableAll():n.enableAll();var t=e||"default";return n.getLogger(t)}};t.a=r},function(e,t,o){"use strict";var n,r={generate:(n=Math.floor(Date.now()),function(){return n++}),name:function(e){var t=null,o=e.lastIndexOf("-");return t=-1===o?e:e.substring(0,o),t},index:function(e){var t=null,o=this.name(e),n=o.lastIndexOf("_");return-1!==n&&(t=o.substring(n+1)),t},uuid:function(e){var t=null,o=e.lastIndexOf("-");return-1!==o&&(t=parseInt(e.substring(o+1),10)),t}};t.a=r},function(e,t,o){"use strict";var n=o(6),r={getLogger:function(e){"true".match(/true/)?n.disableAll():n.enableAll();var t=e||"default";return n.getLogger(t)},disableAll:function(){var e=n.getLoggers();for(var t in e){if(Object.hasOwnProperty.call(e,t))e[t].disableAll()}},enableAll:function(){var e=n.getLoggers();for(var t in e){if(Object.hasOwnProperty.call(e,t))e[t].enableAll()}}};t.a=r},function(e,t,o){var n,r;!function(i,s){"use strict";void 0===(r="function"==typeof(n=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function n(e,t){var o=e[t];if("function"==typeof o.bind)return o.bind(e);try{return Function.prototype.bind.call(o,e)}catch(t){return function(){return Function.prototype.apply.apply(o,[e,arguments])}}}function r(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function i(o){return"debug"===o&&(o="log"),"undefined"!=typeof console&&("trace"===o&&t?r:void 0!==console[o]?n(console,o):void 0!==console.log?n(console,"log"):e)}function s(t,n){for(var r=0;r<o.length;r++){var i=o[r];this[i]=r<t?e:this.methodFactory(i,t,n)}this.log=this.debug}function a(e,t,o){return function(){"undefined"!=typeof console&&(s.call(this,t,o),this[e].apply(this,arguments))}}function c(e,t,o){return i(e)||a.apply(this,arguments)}function l(e,t,n){var r,i=this;t=null==t?"WARN":t;var a="loglevel";function l(){var e;if("undefined"!=typeof window&&a){try{e=window.localStorage[a]}catch(e){}if(void 0===e)try{var t=window.document.cookie,o=t.indexOf(encodeURIComponent(a)+"=");-1!==o&&(e=/^([^;]+)/.exec(t.slice(o))[1])}catch(e){}return void 0===i.levels[e]&&(e=void 0),e}}"string"==typeof e?a+=":"+e:"symbol"==typeof e&&(a=void 0),i.name=e,i.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},i.methodFactory=n||c,i.getLevel=function(){return r},i.setLevel=function(t,n){if("string"==typeof t&&void 0!==i.levels[t.toUpperCase()]&&(t=i.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=i.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(r=t,!1!==n&&function(e){var t=(o[e]||"silent").toUpperCase();if("undefined"!=typeof window&&a){try{return void(window.localStorage[a]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"="+t+";"}catch(e){}}}(t),s.call(i,t,e),"undefined"==typeof console&&t<i.levels.SILENT)return"No console available for logging"},i.setDefaultLevel=function(e){t=e,l()||i.setLevel(e,!1)},i.resetLevel=function(){i.setLevel(t,!1),function(){if("undefined"!=typeof window&&a){try{return void window.localStorage.removeItem(a)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},i.enableAll=function(e){i.setLevel(i.levels.TRACE,e)},i.disableAll=function(e){i.setLevel(i.levels.SILENT,e)};var u=l();null==u&&(u=t),i.setLevel(u,!1)}var u=new l,d={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,u.getLevel(),u.methodFactory)),t};var p="undefined"!=typeof window?window.log:void 0;return u.noConflict=function(){return"undefined"!=typeof window&&window.log===u&&(window.log=p),u},u.getLoggers=function(){return d},u.default=u,u})?n.call(t,o,t,e):n)||(e.exports=r)}()},function(e,t,o){"use strict";var n={normalyzeParameters:function(e){var t=null;if(e){var o=[];for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r||(r=""),o.push(n+"="+r)}t=o.join("&")}return t},normalyzeUrl:function(e,t,o){var n=e;if(e){var r=e.indexOf("?");-1===r&&(n+="?"),-1!==r&&r!==e.length-1&&(n+="&")}return t&&(n+="string"==typeof t?t:this.normalyzeParameters(t)),o&&(n=encodeURIComponent(n)),n},indent:function(e,t){return new Array((e||0)+1).join("\t")+t}};t.a=n},function(e,t,o){"use strict";(function(e){var n=o(5).a.getLogger("config"),r={configuration:null,isConfigLoaded:function(){var t="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==e?e:{};return!(!t.Gp||!t.Gp.Config||0===Object.keys(t.Gp.Config).length)&&(this.configuration=t.Gp.Config,!0)},getLayerId:function(e,t){var o=null;if(this.configuration){var r=this.configuration.layers;for(var i in r)if(r.hasOwnProperty(i)){var s=i.split("$");if(e===s[0]&&s[1]){var a=s[1].split(":");if(s[1].split(";")[1]===t){o=i;break}if(a[2]===t){o=i;break}}}}return o||n.error("ERROR layer id (layer name: "+e+" / service: "+t+") was not found !?"),o},getLayerParams:function(e,t,o){var r={};if(this.configuration){var i=this.getLayerId(e,t);if(i){var s=this.configuration.layers[i],a=s.apiKeys[0];if(o&&o!==a)return void n.error("ERROR different keys ("+o+" !== "+a+") !?");o=o||a,r.key=o,r.url=s.getServerUrl(o),r.version=s.getServiceParams().version,r.styles=s.getDefaultStyle(),r.format=s.getDefaultFormat(),r.projection=s.getDefaultProjection(),r.minScale=s.getMinScaleDenominator(),r.maxScale=s.getMaxScaleDenominator(),r.extent=s.getBBOX(),r.legends=s.getLegends(),r.metadata=s.getMetadata(),r.originators=s.getOriginators(),r.title=s.getTitle(),r.description=s.getDescription(),r.quicklookUrl=s.getQuicklookUrl(),s.wmtsOptions&&(r.tileMatrixSetLimits=s.wmtsOptions.tileMatrixSetLimits);var c=s.getTMSID();if(c){r.TMSLink=c;var l=this.configuration.getTMSConf(c);r.matrixOrigin=l.getTopLeftCorner(),r.nativeResolutions=l.nativeResolutions,r.matrixIds=l.matrixIds,r.tileMatrices=l.tileMatrices}}}return r},getServiceParams:function(e,t,o){var n={};if(this.configuration){var r=this.getLayerId(e,t);if(r){var i=this.configuration.layers[r],s=i.apiKeys[0];if(o){Array.isArray(o)||(o=[o]);for(var a=0;a<o.length;a++)if(o[a]===s){var c=a;break}if(void 0===c)return}var l=o[c]||s;n.key=l,n.url=i.getServerUrl(l),n.version=i.getServiceParams().version,n.extent=i.getBBOX(),n.title=i.getTitle(),n.description=i.getDescription()}}return n},getResolutions:function(){var e=[];return this.configuration&&(e=this.configuration.generalOptions.wgs84Resolutions),e},getTileMatrix:function(e){var t={};return this.configuration&&e&&(t=this.configuration.tileMatrixSets[e.toUpperCase()]),t},getGlobalConstraints:function(e){var t={};if(e){var o=this.configuration.layers[e];t.projection=o.getDefaultProjection(),t.minScale=o.getMinScaleDenominator(),t.maxScale=o.getMaxScaleDenominator(),t.extent=o.getBBOX()}return t}};t.a=r}).call(this,o(15))},function(e,t,o){"use strict";var n,r=o(3),i=o(7),s=o(1),a=o(18),c=o.n(a),l={call:function(e){var t=r.a.getLogger("XHR");if(t.trace("[XHR::call()]"),c.a.polyfill(),!e.url)throw new Error("missing parameter : url is not defined !");if(!e.method)throw new Error("missing parameter : method is not defined !");e.format||(e.format="text");var o={};switch(o.url=e.url,o.data=e.data?e.data:null,o.method=e.method,o.timeOut=e.timeOut||0,o.scope=e.scope||this,o.proxy=e.proxy||null,o.content=e.content||null,o.headers=e.headers||{referer:"http://localhost"},e.method){case"DELETE":case"GET":break;case"PUT":case"POST":o.content=e.content?e.content:"application/x-www-form-urlencoded",o.headers=e.headers?e.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(e.format){case"text":this.__call(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;case"json":this.__callJSON(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;case"xml":this.__callXML(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;default:throw new Error("This output Format is not yet supported !")}},__call:function(e){var t=r.a.getLogger("XHR");return t.trace("[XHR::__call()]"),new Promise((function(n,r){var s="POST"===e.method||"PUT"===e.method?1:0;e.data&&("object"==typeof e.data&&Object.keys(e.data).length||"string"==typeof e.data&&e.data.length)&&!s&&("Geocode"===e.scope.CLASSNAME||"ReverseGeocode"===e.scope.CLASSNAME?e.url=e.url+e.data:e.url=i.a.normalyzeUrl(e.url,e.data)),t.trace("URL = ",e.url);var a=null;if("undefined"==typeof window){var c=o(26),l={headers:{Referer:"https://localhost"}};return e.data&&"string"==typeof e.data&&s&&(l={method:e.method,body:e.data,headers:{"Content-Type":e.content,Referer:"https://localhost"}}),c(e.url,l).then((function(e){if(e.ok)n(e.text());else{var t="Errors Occured on Http Request (status : '"+e.statusText+"' | url : '"+e.url+"')",o=e.status;r({message:t,status:o})}})).catch((function(e){r({message:e,status:-1})}))}if(window.XMLHttpRequest){t.trace("XMLHttpRequest"),(a=new XMLHttpRequest).open(e.method,e.url,!0),a.overrideMimeType=e.content;var u=null;e.timeOut>0&&(t.trace("XHR - TimeOut actif !"),u=window.setTimeout((function(){r({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})}),e.timeOut)),s&&(t.trace("data = ",e.data),a.setRequestHeader("Content-type",e.content)),a.onerror=function(e){console.log(e),r(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(e){console.log(e),r(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onreadystatechange=function(e){if(4===a.readyState)if(200===a.status)window.clearTimeout(u),n(a.response);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"' | response : '"+e.target.response+"')",o=e.target.status;r({message:t,status:o})}};var d=e.data&&s?e.data:null;a.send(d)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");t.trace("XDomainRequest"),(a=new XDomainRequest).open(e.method,e.url),a.overrideMimeType=e.content,e.timeOut>0&&(a.timeout=e.timeout,t.trace("XHR - TimeOut actif !")),s&&a.setRequestHeader("Content-type",e.content),a.onerror=function(){r(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(){r(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onload=function(e){if(200===a.status)n(a.responseText);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"')",o=e.target.status;r({message:t,status:o})}};var p=e.data&&s?e.data:null;a.send(p)}}))},__callJSON:function(e){return this.__call(e).then(JSON.parse).catch((function(t){console.log("_callJSON failed on : ",e.url,t)}))},__callXML:function(e){return this.__call(e).then((function(e){var t;"undefined"==typeof window?t=(new(0,o(20).DOMParser)).parseFromString(e,"text/xml"):window.DOMParser?t=(new window.DOMParser).parseFromString(e,"text/xml"):((t=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t})).catch((function(t){console.log("__callXML failed on : ",e.url,t)}))}},u={uuid:(n=Math.floor(Date.now()),function(){return n++}),call:function(e){var t=r.a.getLogger("JSONP");if(t.trace("[JSONP::call ()]"),!e)throw t.error("missing parameter : options !"),new Error("missing parameter : options !");if(!e.url)throw t.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(e.timeOut||(t.info("setting 'options.timeOut' default value"),e.timeOut=0),!e.onResponse)throw t.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var o="string"==typeof e.callbackSuffix?e.callbackSuffix:this.uuid(),n=!1,i=!1,s=e.url.indexOf("callback=");if(-1!==s){n=!0;var a=e.url.indexOf("&",s);-1===a&&(a=e.url.length);var c=e.url.substring(s+9,a);c&&(i=!0,e.callbackName=c,t.info("setting 'options.callbackName' value ("+e.callbackName+") from 'options.url' parameter"))}if(!n){var l=e.url.indexOf("?");-1===l?e.url=e.url+"?callback=":l===e.url.length?e.url=e.url+"callback=":e.url=e.url+"&callback=",t.info("setting callback default key in 'options.url' : "+e.url)}var u=!!e.callbackName||i;if(i||(e.callbackName||(t.info("setting 'options.callbackName' default value"),e.callbackName="callback",(o||""===o)&&(e.callbackName+=o)),e.url=e.url.replace("callback=","callback="+e.callbackName),t.info("setting callback function name in 'options.url' : "+e.url)),e.onTimeOut||(t.info("setting 'options.onTimeOut' default value"),e.onTimeOut=function(){console.log("TimeOut while invoking url : "+e.url)}),!u){var d=this,p=null;e.timeOut>0&&(p=window.setTimeout((function(){window[e.callbackName]=function(){},e.onTimeOut(),d._deleteScript(o)}),e.timeOut)),window[e.callbackName]=function(t){window.clearTimeout(p),e.onResponse(t),d._deleteScript(o)}}this._createScript(o,e.url)},_createScript:function(e,t){var o,n=document.getElementById("results"+e);(o=document.createElement("script")).setAttribute("type","text/javascript"),o.setAttribute("src",t),o.setAttribute("charset","UTF-8"),o.setAttribute("id","results"+e),o.setAttribute("async","true");var r=document.documentElement||document.getElementsByTagName("head")[0];null===n?r.appendChild(o):r.replaceChild(o,n)},_deleteScript:function(e){var t=document.getElementById("results"+e);if(t){var o=t.parentNode||document.documentElement;if(!o)return;o.removeChild(t)}}},d={send:function(e){var t=e||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if("undefined"!=typeof window||"JSONP"!==e.protocol){if("XHR"===e.protocol||"json"===e.format?t.wrap=!1:"JSONP"===e.protocol&&"xml"===e.format&&(t.wrap=!0),t.callback=null,t.output=t.wrap?"json":null,t.wrap){var o={};o.output=t.output,o.callback=t.callback,delete o.callback,t.url=i.a.normalyzeUrl(e.url,o)}switch(t.protocol){case"XHR":"GET"===e.method&&e.nocache&&(t.url=i.a.normalyzeUrl(t.url,{t:(new Date).getTime()})),l.call(t);break;case"JSONP":t.data&&(t.url=i.a.normalyzeUrl(t.url,t.data)),u.call(t);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}},p=o(2),h=o(12),g=o(19);function f(e){if(!(this instanceof f))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR"));for(var t in this.logger=r.a.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(e){console.log("onSuccess - la reponse est la suivante : ",e)},onFailure:function(e){200!==e.status&&e.status?console.log("onFailure - Erreur (",e.status,") : ",e.message):console.log("onFailure : ",e.message)}},e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(s.a.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(e){console.log("onSuccess - la réponse brute du service est la suivante : ",e)}),!!(null===this.options.onSuccess||"function"!=typeof this.options.onSuccess))throw new Error(s.a.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){h.a.ssl=this.options.ssl;var o=h.a[this.CLASSNAME].url(this.options.apiKey);"string"==typeof o?this.options.serverUrl=o:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod="string"==typeof e.httpMethod?e.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(s.a.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof e.protocol?e.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","protocol"))}if("undefined"==typeof window&&"JSONP"===this.options.protocol)throw new Error(s.a.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=e.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}f.prototype={constructor:f,call:function(){this.logger.trace("CommonService::call ()");var e=this;function t(t){this.logger.trace("CommonService::onBuildRequest : ",t),this.callService.call(e,r,o)}function o(t){this.logger.trace("CommonService::onCallService : ",t),this.analyzeResponse.call(e,r,n)}function n(e){if(this.logger.trace("CommonService::onAnalyzeResponse : ",e),!e)return r.call(this,new p.a("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,e)}function r(e){this.logger.trace("CommonService::onError()");var t=e;t instanceof p.a||(t=new p.a(e.message)),this.options.onFailure.call(this,t)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(e,r,t)}).call(e)},buildRequest:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")},callService:function(e,t){var o=null,n=this.request,r=!(!this.options.proxyURL||"XHR"!==this.options.protocol);"Geocode"!==this.CLASSNAME&&"ReverseGeocode"!==this.CLASSNAME&&"AutoComplete"!==this.CLASSNAME&&(this.options.serverUrl=i.a.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":g.version},!1)),r&&("GET"===this.options.httpMethod&&(o=this.options.proxyURL+i.a.normalyzeUrl(this.options.serverUrl,this.request,!0),n=null),"POST"===this.options.httpMethod&&(o=this.options.proxyURL+i.a.normalyzeUrl(this.options.serverUrl,null,!0),n=this.request));var s=this,a={url:o||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"!==this.options.protocol,callbackSuffix:this.options.callbackSuffix,data:n,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(o){s.logger.trace("callService::onResponse()");var n=null;if("XHR"===s.options.protocol&&(s.logger.trace("Response XHR",o),n=o),"JSONP"===s.options.protocol){if(s.logger.trace("Response JSON",o),!o)return void e.call(s,new p.a("Le contenu de la reponse est vide !?"));if(o.http){if(200!==o.http.status)return void e.call(s,new p.a({status:o.http.status,message:o.http.error,type:p.a.TYPE_SRVERR}));n=o.xml,s.options.rawResponse&&(n=o)}else n=o}if("function"==typeof s.options.onBeforeParse){var r=s.options.onBeforeParse(n);"string"==typeof r&&(n=r)}s.response=n,t.call(s,n)},onFailure:function(t){s.logger.trace("callService::onFailure()"),t.type=p.a.TYPE_SRVERR,e.call(s,new p.a(t))},onTimeOut:function(){s.logger.trace("callService::onTimeOut()"),e.call(s,new p.a("TimeOut!"))}};d.send(a)},analyzeResponse:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")}};t.a=f},function(e,t,o){"use strict";var n=o(5),r=o(8);t.a={check:function(e){var t=n.a.getLogger("checkrightmanagement");if(e){var o=e.key,i=e.resources||[],s=e.services||[];if(0!==i.length){if(0!==s.length){var a={};if(!o){if(!r.a.isConfigLoaded())return void t.warn("WARNING : The 'apiKey' parameter is missing, and the contract key configuration has not been loaded, so impossible to check yours rights !");o=Object.keys(r.a.configuration.generalOptions.apiKeys),t.log(o)}if(r.a.isConfigLoaded()){for(var c=0;c<i.length;c++)for(var l=i[c],u=0;u<s.length;u++){var d=s[u],p=r.a.getServiceParams(l,d,o);p&&0!==Object.keys(p).length?(a[d]||(a[d]=[]),a[d].push(l)):t.warn("WARNING : The contract key configuration has no rights to load this geoportal resource ("+l+") for this service ("+d+") ")}return 0===Object.keys(a).length?void t.warn("WARNING : The contract key configuration has been loaded, and the 'apiKey' parameter has been set, but, there is a problem on the mapping between the contract and the key !"):(a.key=p.key,t.log("right management checked",a),a)}t.warn("WARNING : the contract key configuration has not been loaded, so be carefull !");for(var h={},g=0;g<s.length;g++){var f=s[g];h[f]=[];for(var m=0;m<i.length;m++){var v=i[m];h[f].push(v)}}return h.key=o,t.log("right management not checked",h),h}t.error("WARNING : no parameter 'services' specified !")}else t.error("WARNING : no parameter 'resources' specified !")}else t.error("WARNING : no parameter specified !")}}},function(e,t,o){"use strict";t.a={getGeocodedLocationFreeform:function(e){var t=e.placeAttributes;return t.label?t.label:"PositionOfInterest"===e.type?t.postcode+" "+t.toponym:"StreetAddress"===e.type?(t.housenumber?t.housenumber+" ":"")+t.street+" "+(t.postcode?t.postcode+", ":"")+t.city:"CadastralParcel"===e.type?t.id:"..."},getSuggestedLocationFreeform:function(e){if(e.fullText)return e.fullText;var t=[];return t.push(e.street||""),t.push(e.postalCode||""),t.push(e.commune||""),"PositionOfInterest"===e.type&&(t.push(e.poi||""),t.push(e.kind||"")),t.join(" - ")}}},function(e,t,o){"use strict";var n={ssl:!0,url:function(e,t){return(!1===n.ssl?"http://":"https://")+"wxs.ign.fr".concat("/",e,t)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(e){return{"elevation-json":n.url(e,this._key["elevation-json"]),"elevation-xml":n.url(e,this._key["elevation-xml"]),"profil-json":n.url(e,this._key["profil-json"]),"profil-xml":n.url(e,this._key["profil-xml"]),wps:n.url(e,this._key.wps)}}},ProcessIsoCurve:{_key:"/geoportail/isochrone/rest/1.0.0/isochrone",url:function(e){return n.url(e,this._key)}},AutoComplete:{_key:"/ols/apis/completion",url:function(e){return n.url(e,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(e){return n.url(e,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(e){var t="";if(Array.isArray(e)&&e.length>0){t=e[0];for(var o=1;o<e.length;o++)t+=","+e[o]}return{apiKey:n.url(e,this._key.apiKey),apiKeys:n.url(e[0],this._key.apiKeys).replace("%KEYS%",t),aggregate:n.url(e,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(e){return n.url(e,this._key)}},Route:{_key:"/geoportail/itineraire/rest/1.0.0/route",url:function(e){return n.url(e,this._key)}}};t.a=n},,function(e,t,o){"use strict";var n=o(0),r=o.n(n),i=o(5).a.getLogger("icondefault"),s=r.a.Icon.Default.extend({images:{retina:{shadow:"data:image/png;base64,...",color:{blue:"data:image/png;base64,...",orange:"data:image/png;base64,...",red:"data:image/png;base64,...",green:"data:image/png;base64,..."}},shadow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=",color:{blue:"data:image/png;base64,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",orange:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAASAAAAEgARslrPgAABghJREFUWMOdl1uInGcdxn/feWa+mflmJmZbqVqKigewKK5goHgRSEm8EC88F6tBFLfgZbzJnVdRYWExrVBoXazWlAYL0dVisLBYzEUUSbeNjZQmxGZ3NjO7c57v/P69mNnD7MzuzvrCA8PM+/+e93n+h/cb7c9PzXKE9RHAG36+BXRPP3390CDtT3MHklSA7wKngVOWbaOhA5AkEUqpKnAFePHMM9eX9yeZrMQAzgHni14ln826ZLLu2KY0TfD7XXq9NoHffxX48Zmnr6+MkSyNK6kAl4ql8qlisYxpWagoJA16gIxs1E0bI1cAoNNuslFb94Env/jM9csj+0SEXaiIyN+9cuVU5dhxdEmI23XSoAOoIckOVBISt+vE7Q0KRY8H3v+BbM7Nv7w0Nzs3QrLHopdL5crHyqUKSbdB6ndA1BRIiVs1Mo5NySsD/GJpbvbkjpKds50rFL2T5VKZpNdAkmjiAzXDHOye8FvS2cC2LWZmHjAELv1xbrYyIFGCKKmIkvMlr4iK+0gaDe0ZQHcyWIUyVqGMmDZWvoRVKGO63sg+UMSdGq6bo+R5x0XJuYFdGqDxLa9UzJumQRp0R3y3ChU002Zjc5Pbd+6wGem8e/sO6+vrBGGIVagMTdmJScMepZIHGj/4ww8/a5jDevl63s2h4nAgfbhM1yOMQt67V+WjZ87y+VNPYmXzANz7x19YufQzilFIySsTt+vbcSrsYTlZnEymEgTBCV2U5EXJiUzGJg1aI9I1w6DZbPHoE+f5+Jee2iYAeGj2cR479zyNjo+SFN12xqzLZRxEyWld4EOWbRmIApVuJ1E3LaIwRLkzPPzYl8caUURwZz7Iw1/4Cq1WG8POjBSBCvvYtonAJ3URqeiaNlYpuuXg+wHlRz41kQBAKUX5w5+m1/PHKk7SBF0DEfFMgUjJMGnaro7WFGig0nhfAhEhjQI0TRuL1wwNFSkEfF2Ee3GSjp0kDXq4WZv7b19HJeNEWySrN/5G3nUQlezpJ4MkTRHhni4i1ThOuipNByfakhsHmIZGRnV565WLYyoA1t68RuONq3j5DKnfHiXRdKIoRkTuGl/9zIMCfC7rGJ/I5vOocGsQCoiQz7vc/8+/WH37BrnKgzjFY7RWb/Pu8mVWLv2UmUoOxzYGJFtxmobhZFmrd0hS9SPtpbOPApx0s/ZfH3moRNyujU5aO4eRcWl2AjZbPn6YYFsGXt6h4mUxDX0sxioep9kJeG+9ffVrz994fKsZX+v60bVuPzzhFo6RdHY1VtRDEp9S4RilgjPyMBX2iXu90dIbFsFm20fgJwCm7BTEzzda/u/zrjVspl2JVoq4vc40yyrO0OqGdPvxa9/41Y3XYfQ+udLshO8EQYyZK0454idAKTYafUTkwrblu0Z9KjBfb/pouvl/EZhuma4f0e7H//zm4htXt0n23HaL9VZQS5IU3c4emUTTNOoNH9hRsVcJAr7As7VWgJHJDTp4SpiFMv0oodGLbwm8MkoyescjIgtrm4GvlEI37SOo0Kk1AkTkwhOLK+keEtiDmggv1FshRrYwFYGRLRJEKfV2fFeEF/dW3F67tjB/txamIoKm65N37IJu2dRaEQLz3/71m9E4ybhdiMgtEVna7EQY+Qoial/oTo4oTqk2opqIPDepd/QDzjh/vxmDOtgq3cqy3ogQuPidF97qTiaZrAQRWW776bVOkGIW3jfZJidHqoTVRtwVkYX9psCkxO/GwnojRhvMlvGE2zmqzRgRfnn2Nzdb+5McnNbL9a56x48FI+vtSbaDaPDfjSQSmD9onh1kFyKSishCtZmgW/ZY2a5txojI4vd+e7N6CMmBdiHC4lojrcWpoDsuIGimhYhwp5amIlzgkKUf1gMgXZBnq40Ew8kNBmGuxHozAeSl7//u37cPJTmUYoCLdzdVJMNcgLDWFoTDVUxrFyJURVisNhVGzqPWVvQCWRJhZSqS4Qv3NFhYaw10rbUENC4MansaJYO/DtPgZi+QK7W20OrLsih5XZRMSTJdTrZHzWpzkIut76az62hrueXzHPDqUYL+B8XVKUzuUimfAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDEyLTA4LTE4VDE0OjUwOjU2KzAxOjAwFlCkXwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxMi0wOC0xOFQxNDo1MDo1NiswMTowMGcNHOMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC",red:"data:image/png;base64,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",green:"data:image/png;base64,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"}},initialize:function(e,t){r.a.Util.extend(this.options,t);var o=null,n=this.images;switch(e){case"red":o=n.color.red;break;case"green":o=n.color.green;break;case"orange":o=n.color.orange;break;case"blue":o=n.color.blue;break;default:o=n.color.blue}this.options.iconUrl=o,this.options.shadowUrl=n.shadow,r.a.Browser.retina&&(this.options.iconRetinaUrl=o,this.options.shadowRetinaUrl=n.shadow)},_getIconUrl:function(e){return i.trace("OVERWRITTEN L.Icon.Default._getIconUrl("+e+")"),r.a.Icon.prototype._getIconUrl.call(this,e)}});t.a=s},function(e,t){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch(e){"object"==typeof window&&(o=window)}e.exports=o},function(e,t,o){},function(e,t,o){},function(e,t,o){(function(t,o){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var n;n=function(){"use strict";function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,i=void 0,s=void 0,a=function(e,t){g[r]=e,g[r+1]=t,2===(r+=2)&&(s?s(f):E())},c="undefined"!=typeof window?window:void 0,l=c||{},u=l.MutationObserver||l.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var e=setTimeout;return function(){return e(f,1)}}var g=new Array(1e3);function f(){for(var e=0;e<r;e+=2)(0,g[e])(g[e+1]),g[e]=void 0,g[e+1]=void 0;r=0}var m,v,y,A,E=void 0;function S(e,t){var o=this,n=new this.constructor(b);void 0===n[R]&&x(n);var r=o._state;if(r){var i=arguments[r-1];a((function(){return T(r,n,i,o._result)}))}else k(o,n,e,t);return n}function w(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(b);return C(t,e),t}d?E=function(){return t.nextTick(f)}:u?(v=0,y=new u(f),A=document.createTextNode(""),y.observe(A,{characterData:!0}),E=function(){A.data=v=++v%2}):p?((m=new MessageChannel).port1.onmessage=f,E=function(){return m.port2.postMessage(0)}):E=void 0===c?function(){try{var e=Function("return this")().require("vertx");return void 0!==(i=e.runOnLoop||e.runOnContext)?function(){i(f)}:h()}catch(e){return h()}}():h();var R=Math.random().toString(36).substring(2);function b(){}function _(t,o,n){o.constructor===t.constructor&&n===S&&o.constructor.resolve===w?function(e,t){1===t._state?O(e,t._result):2===t._state?L(e,t._result):k(t,void 0,(function(t){return C(e,t)}),(function(t){return L(e,t)}))}(t,o):void 0===n?O(t,o):e(n)?function(e,t,o){a((function(e){var n=!1,r=function(e,t,o,n){try{e.call(t,o,n)}catch(e){return e}}(o,t,(function(o){n||(n=!0,t!==o?C(e,o):O(e,o))}),(function(t){n||(n=!0,L(e,t))}),e._label);!n&&r&&(n=!0,L(e,r))}),e)}(t,o,n):O(t,o)}function C(e,t){if(e===t)L(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(n=t),null===n||"object"!==r&&"function"!==r)O(e,t);else{var o=void 0;try{o=t.then}catch(t){return void L(e,t)}_(e,t,o)}var n,r}function P(e){e._onerror&&e._onerror(e._result),I(e)}function O(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(I,e))}function L(e,t){void 0===e._state&&(e._state=2,e._result=t,a(P,e))}function k(e,t,o,n){var r=e._subscribers,i=r.length;e._onerror=null,r[i]=t,r[i+1]=o,r[i+2]=n,0===i&&e._state&&a(I,e)}function I(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var n=void 0,r=void 0,i=e._result,s=0;s<t.length;s+=3)n=t[s],r=t[s+o],n?T(o,n,r,i):r(i);e._subscribers.length=0}}function T(t,o,n,r){var i=e(n),s=void 0,a=void 0,c=!0;if(i){try{s=n(r)}catch(e){c=!1,a=e}if(o===s)return void L(o,new TypeError("A promises callback cannot return that same promise."))}else s=r;void 0!==o._state||(i&&c?C(o,s):!1===c?L(o,a):1===t?O(o,s):2===t&&L(o,s))}var G=0;function x(e){e[R]=G++,e._state=void 0,e._result=void 0,e._subscribers=[]}var N=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(b),this.promise[R]||x(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&O(this.promise,this._result))):L(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var o=this._instanceConstructor,n=o.resolve;if(n===w){var r=void 0,i=void 0,s=!1;try{r=e.then}catch(e){s=!0,i=e}if(r===S&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(o===M){var a=new o(b);s?L(a,i):_(a,e,r),this._willSettleAt(a,t)}else this._willSettleAt(new o((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,o){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?L(n,o):this._result[t]=o),0===this._remaining&&O(n,this._result)},e.prototype._willSettleAt=function(e,t){var o=this;k(e,void 0,(function(e){return o._settledAt(1,t,e)}),(function(e){return o._settledAt(2,t,e)}))},e}(),M=function(){function t(e){this[R]=G++,this._result=this._state=void 0,this._subscribers=[],b!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){C(e,t)}),(function(t){L(e,t)}))}catch(t){L(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var o=this.constructor;return e(t)?this.then((function(e){return o.resolve(t()).then((function(){return e}))}),(function(e){return o.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return M.prototype.then=S,M.all=function(e){return new N(this,e).promise},M.race=function(e){var t=this;return n(e)?new t((function(o,n){for(var r=e.length,i=0;i<r;i++)t.resolve(e[i]).then(o,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},M.resolve=w,M.reject=function(e){var t=new this(b);return L(t,e),t},M._setScheduler=function(e){s=e},M._setAsap=function(e){a=e},M._asap=a,M.polyfill=function(){var e=void 0;if(void 0!==o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=M},M.Promise=M,M},e.exports=n()}).call(this,o(25),o(15))},function(e){e.exports=JSON.parse('{"_from":"geoportal-access-lib@3.2.0","_id":"geoportal-access-lib@3.2.0","_inBundle":false,"_integrity":"sha512-914Yk0C3mnYI+X56Y40t4OJwBiZ1nEbW8D9Dse4WcS54Au8ZpkZ9Ep1efNYMxC5618zqn7r4VvzF58Xa+BqzEQ==","_location":"/geoportal-access-lib","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"geoportal-access-lib@3.2.0","name":"geoportal-access-lib","escapedName":"geoportal-access-lib","rawSpec":"3.2.0","saveSpec":null,"fetchSpec":"3.2.0"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/geoportal-access-lib/-/geoportal-access-lib-3.2.0.tgz","_shasum":"7a707b75743f01b5465cc72d1316f13f8b87df7a","_spec":"geoportal-access-lib@3.2.0","_where":"/home/JPBazonnais/Projets/API/geoportal-extensions","author":{"name":"IGNF"},"bugs":{"url":"https://github.com/IGNF/geoportal-access-lib/issues"},"bundleDependencies":false,"date":"04/10/2022","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","xmldom":"^0.1.27"},"deprecated":false,"description":"French Geoportal resources access library","devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"homepage":"https://github.com/IGNF/geoportal-access-lib#readme","keywords":["geoportail","webservice","javascript","es6"],"license":"CECILL-B","main":"dist/GpServices-src.js","module":"src/Gp.js","name":"geoportal-access-lib","nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"optionalDependencies":{},"peerDependencies":{},"repository":{"type":"git","url":"git+https://github.com/IGNF/geoportal-access-lib.git"},"scripts":{"build":"webpack --mode=none","build:dev":"webpack --mode=development","build:prod":"webpack --mode=production","clean":"echo \\"Warning: no yet implemented!\\" && exit 0","cover":"nyc --reporter=lcov --reporter=text npm run test","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open","eslint":"eslint src/","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","setup":"npm install","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js"},"version":"3.2.0"}')},function(e,t){e.exports=void 0},function(e,t,o){"use strict";var n=o(2),r=o(1);function i(){if(!(this instanceof i))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}i.prototype={constructor:i};var s=i;function a(){if(!(this instanceof a))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position=null,this.matchType=null,this.placeAttributes={},this.type=null,this.accuracy=null,this.CLASSNAME="GeocodedLocation"}a.prototype={constructor:a};var c=a;function l(){if(!(this instanceof l))throw new TypeError("GeocodeResponseParser constructor cannot be called as a function.")}function u(e,t){var o=new c;if(e.geometry&&"Point"===e.geometry.type&&(o.position={lon:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]}),e.properties){for(var n in e.properties)"_score"===n?o.accuracy=e.properties[n]:"_type"===n?"address"===e.properties[n]?o.type="StreetAddress":"poi"===e.properties[n]?o.type="PositionOfInterest":"parcel"===e.properties[n]&&(o.type="CadastralParcel"):o.placeAttributes[n]=e.properties[n];"address"===e.properties._type&&(o.matchType=void 0!==e.properties.number&&null!==e.properties.number?"street number":"street")}t.locations.push(o)}l.prototype={constructor:l,parse:function(e){var t=new s;const o=JSON.parse(e);if("FeatureCollection"===o.type)for(var i=0;i<o.features.length;++i)u(o.features[i],t);else{if("Feature"!==o.type){if("SERVICE_ERROR"===o.type)return{exceptionReport:o};var a=r.a.getMessage("SERVICE_RESPONSE_ANALYSE",o.type);throw new n.a({message:a,type:n.a.TYPE_UNKERR,status:200})}u(o,t)}return t}};var d=l,p={build:function(e){var t=null;if(e.response){if(e.rawResponse)t=e.response;else{try{if(!(t=(new d).parse(e.response)))throw new Error("L'analyse de la réponse du service !?")}catch(t){var o=t.message;return"string"==typeof e.response?o+="('"+e.response+"')":o+="('"+e.response.documentElement.innerHTML+"')",void e.onError.call(e.scope,new n.a({message:r.a.getMessage("SERVICE_RESPONSE_ANALYSE",o),type:n.a.TYPE_UNKERR,status:-1}))}if(t.exceptionReport)return void e.onError.call(e.scope,new n.a({message:r.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:n.a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,t)}else e.onError.call(e.scope,new n.a({message:r.a.getMessage("SERVICE_RESPONSE_EMPTY"),type:n.a.TYPE_SRVERR,status:-1}))}};t.a=p},function(e,t,o){"use strict";var n=o(3),r=o(1);function i(e){if(!(this instanceof i))throw new TypeError("GeocodeParamREST constructor cannot be called as a function.");if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur GeocodeParamREST ()]"),this.options=e||{},!this.options.geocodeMethod||"search"!==this.options.geocodeMethod&&"reverse"!==this.options.geocodeMethod)throw new Error("Error geocodeMethod not valid");this.geocodeMethod=this.options.geocodeMethod,this.query=void 0!==this.options?this.options.query:null,this.searchGeometry=this.options.searchGeometry||null,this.index=this.options.index||null,this.lon=this.options.position&&this.options.position.lon?this.options.position.lon:null,this.lat=this.options.position&&this.options.position.lat?this.options.position.lat:null,this.maxResp=this.options.maxResp||null,this.returnTrueGeometry=this.options.returnTrueGeometry||null,this.filters=this.options.filters||{}}i.CLASSNAME="GeocodeParamREST",i.prototype={constructor:i,getFilters:function(){var e={};for(var t in this.filters)this.filters.hasOwnProperty(t)&&(e[t]=this.filters[t]);return e},getIndex:function(){return void 0===this.index?null:"StreetAddress"===this.index?"address":"CadastralParcel"===this.index?"parcel":"PositionOfInterest"===this.index?"poi":"location"===this.index?"location":this.index},getSearchGeometry:function(){return JSON.stringify(this.searchGeometry)}},i.prototype.getParams=function(){var e=[];"search"===this.geocodeMethod&&e.push({k:"q",v:this.query}),this.index&&e.push({k:"index",v:this.getIndex()}),"reverse"===this.geocodeMethod&&e.push({k:"searchgeom",v:this.getSearchGeometry()}),this.lon&&this.lat&&(e.push({k:"lon",v:this.lon}),e.push({k:"lat",v:this.lat})),this.maxResp&&e.push({k:"limit",v:this.maxResp}),this.returnTrueGeometry&&e.push({k:"returntruegeometry",v:this.returnTrueGeometry});const t=this.getFilters();for(var o in t)e.push({k:o,v:t[o]});return e};var s=i;function a(e){if(this.logger=n.a.getLogger("GeocodeRequestREST"),this.logger.trace("[Constructeur GeocodeRequestREST ()]"),!(this instanceof a))throw new TypeError("GeocodeRequestREST constructor cannot be called as a function.");if(!e)throw new Error(r.a.getMessage("PARAM_EMPTY","options"));this.settings=e}a.prototype={requestString:null,constructor:a,processRequestString:function(){var e="";const t=new s(this.settings).getParams();for(var o=0;o<t.length;o++){var n=t[o];e&&(e+="&"),e+=n.k+"="+n.v}if(!this.settings.geocodeMethod||"search"!==this.settings.geocodeMethod&&"reverse"!==this.settings.geocodeMethod)throw new Error("Error geocodeMethod not valid");return this.requestString="?"+e,this.logger.trace(this.requestString),this.requestString}};var c=a,l={build:function(e){var t=n.a.getLogger("GeocodeRequestFactory");t.trace(["GeocodeRequestFactory::build()"]);var o=new c(e||{});if(!o.processRequestString())throw new Error("Error process request (rest) !");var r=o.requestString;return t.trace(r),r}};t.a=l},,,function(e,t){var o,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(o===setTimeout)return setTimeout(e,0);if((o===i||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(t){try{return o.call(null,e,0)}catch(t){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:i}catch(e){o=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,l=[],u=!1,d=-1;function p(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&h())}function h(){if(!u){var e=a(p);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];l.push(new g(e,t)),1!==l.length||u||a(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){e.exports=void 0},,function(e,t,o){"use strict";var n=o(9),r=o(3),i=o(1),s=o(2);function a(){if(!(this instanceof a))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}a.prototype={constructor:a};var c=a;function l(){if(!(this instanceof l))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}l.prototype={constructor:l};var u=l,d={build:function(e){var t=r.a.getLogger("AutoCompleteResponseFactory");t.trace(["AutoCompleteResponseFactory::build()"]);var o=null;if(e.response){if(e.rawResponse)t.trace("analyze response : raw"),o=e.response;else{var n=null;if(n="string"==typeof e.response?JSON.parse(e.response):e.response){if(n.error)return void e.onError.call(e.scope,new s.a({message:i.a.getMessage("SERVICE_RESPONSE_EXCEPTION",n.error.description),status:n.error.code,type:s.a.TYPE_SRVERR}));if(o=new c,!n.results||!Array.isArray(n.results))return void e.onError.call(e.scope,new s.a(i.a.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var a=null,l=0;l<n.results.length;l++){var d=n.results[l];a=new u,d&&("StreetAddress"===d.country?(a.street=d.street,a.type="StreetAddress"):"PositionOfInterest"===d.country&&(a.poi=d.street,a.kind=d.kind,a.type="PositionOfInterest"),a.position&&(a.position.x=d.x,a.position.y=d.y),a.commune=d.city,a.fullText=d.fulltext,a.postalCode=d.zipcode,a.classification=d.classification),o.suggestedLocations.push(a)}if(!o.suggestedLocations.length)return void e.onError.call(e.scope,new s.a(i.a.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!o)return void e.onError.call(e.scope,new s.a({message:i.a.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:s.a.TYPE_UNKERR,status:-1}));if(o.exceptionReport)return void e.onError.call(e.scope,new s.a({message:i.a.getMessage("SERVICE_RESPONSE_EXCEPTION",o.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,o)}else e.onError.call(e.scope,new s.a(i.a.getMessage("SERVICE_RESPONSE_EMPTY")))}},p=o(7);function h(e){if(!(this instanceof h))throw new TypeError(i.a.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));this.CLASSNAME="AutoComplete",this.logger=r.a.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]");var t=this.patchOptionConvertor(e);if(t.serverUrl=t.serverUrl||"https://wxs.ign.fr/calcul/geoportail/geocodage/rest/0.1/completion",n.a.apply(this,arguments),!t.text)throw new Error(i.a.getMessage("PARAM_MISSING","text"));this.options.text=t.text,t.type||(t.type=["StreetAddress,PositionOfInterest"]),this.options.type=t.type,this.options.territory=t.territory||"",this.options.maximumResponses=t.maximumResponses||10,"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}h.prototype=Object.create(n.a.prototype,{}),h.prototype.constructor=h,h.prototype.patchOptionConvertor=function(e){const t=e;return t.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),t.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),t.type||(t.type=t.filterOptions.type)),t.filterOptions.territory&&(this.logger.warn("The parameter 'filterOptions.territory' is deprecated"),t.terr||(t.terr=t.filterOptions.territory)),delete t.filterOptions),t},h.prototype.buildRequest=function(e,t){var o="";this.options.territory&&(o=this.options.territory);var n="";this.options.type&&(n=this.options.type.join(",")),this.request=p.a.normalyzeParameters({text:encodeURIComponent(this.options.text),type:n,terr:o,maximumResponses:this.options.maximumResponses}),this.request?t.call(this,this.request):e.call(this,new s.a(i.a.getMessage("SERVICE_REQUEST_BUILD")))},h.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};d.build(o)}else e.call(this,new s.a(i.a.getMessage("SERVICE_RESPONSE_EMPTY")))};t.a=h},,,,,,,,,,,,,,,,function(e,t,o){},,,,,,,function(e,t,o){},,,,,,,function(e,t,o){"use strict";o.r(t);var n=o(28),r=o(3),i=o(1),s=o(2),a=o(9),c=o(22),l=o(21);function u(e){if(!(this instanceof u))throw new TypeError(i.a.getMessage("CLASS_CONSTRUCTOR","Geocode"));this.CLASSNAME="Geocode",this.logger=r.a.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]");var t=this.patchOptionConvertor(e);if(t.serverUrl=t.serverUrl||"https://wxs.ign.fr/calcul/geoportail/geocodage/rest/0.1/search",a.a.apply(this,[t]),!t.hasOwnProperty("query"))throw new Error(i.a.getMessage("PARAM_MISSING","query"));if(this.options.query=t.query,t.index||(this.options.index=t.index="StreetAddress"),t.filters)for(var o=Object.keys(t.filters),n=0;n<o.length;n++){var s=o[n];(void 0===t.filters[s]||"object"==typeof t.filters[s]&&0===Object.keys(t.filters[s]).length||"string"==typeof t.filters[s]&&0===t.filters[s].length||Array.isArray(t.filters[s])&&0===t.filters[s].length)&&delete this.options.filters[s]}this.options.index=t.index||"StreetAddress",this.options.maximumResponses=t.maximumResponses||20}u.prototype=Object.create(a.a.prototype,{}),u.prototype.constructor=u,u.prototype.patchOptionConvertor=function(e){const t=e;return t.hasOwnProperty("location")&&(this.logger.warn("The parameter 'location' is deprecated"),t.query||(t.query=t.location),delete t.location),t.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),t.filters||(t.filters=t.filterOptions,t.filters.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),t.index||(Array.isArray(t.filters.type)&&t.filters.type.length>0?t.index=t.filters.type[0]:t.index=t.filters.type),delete t.filters.type),t.filters.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),delete t.filters.bbox)),delete t.filterOptions),t.position&&(t.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),t.position.lon||(t.position.lon=t.position.x),delete t.position.x),t.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),t.position.lat||(t.position.lat=t.position.y),delete t.position.y)),t.returnFreeForm&&(this.logger.warn("The parameter 'returnFreeForm' is deprecated"),delete t.returnFreeForm),t.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete t.srs),t},u.prototype.buildRequest=function(e,t){var o={httpMethod:this.options.httpMethod,geocodeMethod:"search",query:this.options.query,index:this.options.index,returnTrueGeometry:this.options.returnTrueGeometry,position:this.options.position,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=c.a.build(o),this.request?t.call(this,this.request):e.call(this,new s.a(i.a.getMessage("SERVICE_REQUEST_BUILD")))},u.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};l.a.build(o)}else e.call(this,new s.a(i.a.getMessage("SERVICE_RESPONSE_EMPTY")))};var d=u,p=o(0),h=o.n(p),g=(o(16),o(44),o(17),o(51),o(5)),f=o(10),m=o(4),v={advancedSearchFiltersByDefault:{PositionOfInterest:[{name:"category",title:"Type",value:["cimetière","aérodrome","réservoir","administratif","construction linéaire","construction ponctuelle","construction surfacique","cours d'eau","détail hydrographique","détail orographique","équipement de transport","plan d'eau","poste de transformation","terrain de sport","transport par câble","zone d'activité ou d'intérêt","zone d'habitation","lieu-dit non habité"]},{name:"postcode",title:"Code postal"},{name:"citycode",title:"Code INSEE"}],StreetAddress:[{name:"city",title:"Ville"},{name:"postcode",title:"Code postal"},{name:"citycode",title:"Code INSEE"}],CadastralParcel:[{name:"departmentcode",title:"Code département (INSEE)",description:"Code INSEE du département (ex: 01, 94)"},{name:"municipalitycode",title:"Code commune (INSEE)",description:"Code INSEE de la commune : 3 chiffres (ex: 067)"},{name:"city",title:"Nom commune",description:"Nom de la commune"},{name:"oldmunicipalitycode",title:"Commune absorbée",description:"Commune absorbée : 3 chiffres (ex: 000, 001)"},{name:"districtcode",title:"Arrondissement",description:"Arrondissement : 3 chiffres (ex: 004, 012)"},{name:"section",title:"Section",description:"Section Cadastrale : 2 caractères (chiffre et/ou lettre)"},{name:"number",title:"Numéro",description:"Numéro de la parcelle : 4 chiffres (ex: 0041, 0250)"},{name:"sheet",title:"Feuille",description:"Numéro de la feuille cadastrale"}]},zoomToResultsByDefault:function(e){var t=15,o=e.service,n=e.fields,r=e.type,i={1:11,2:12,3:13,4:14,5:15,6:16,7:17,8:17};return"SuggestedLocation"===o&&"PositionOfInterest"===r&&(t=i[n.classification]),"GeocodedLocation"===o&&"PositionOfInterest"===r&&(t=i[n.importance]||14),"StreetAddress"===r&&(t=17),"CadastralParcel"===r&&(t=17),t}},y=o(11),A=o(14),E={_addUID:function(e){return this._uid?e+"-"+this._uid:e},_createMainContainerElement:function(){var e=document.createElement("div");return e.id=this._addUID("GPsearchEngine"),e.className="GPwidget",e},_createShowSearchEngineElement:function(){var e=document.createElement("input");return e.id=this._addUID("GPshowSearchEngine"),e.type="checkbox",e},_createShowSearchEnginePictoElement:function(){var e=this,t=document.createElement("label");t.id=this._addUID("GPshowSearchEnginePicto"),t.className="GPshowAdvancedToolPicto",t.htmlFor=this._addUID("GPshowSearchEngine"),t.title="Afficher/masquer la recherche par lieux",t.addEventListener("click",(function(){document.getElementById(e._addUID("GPautoCompleteList")).style.display="none",document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none";var t=document.getElementById(e._addUID("GPshowAdvancedSearch"));t&&(t.style.display=null,document.getElementById(e._addUID("GPadvancedSearchPanel")).style.display="none");var o="#GPsearchInput-"+e._uid;document.querySelector(o+" input").disabled=!1,e.onShowSearchEngineClick()}));var o=document.createElement("span");return o.id=this._addUID("GPshowSearchEngineOpen"),o.className="GPshowAdvancedToolOpen",t.appendChild(o),t},_createSearchInputElement:function(e){var t=this,o=document.createElement("form");o.id=this._addUID("GPsearchInput"),o.addEventListener("submit",(function(e){return e.preventDefault(),document.getElementById(t._addUID("GPgeocodeResultsList")).style.display="block",document.getElementById(t._addUID("GPautoCompleteList")).style.display="none",t.onGeocodingSearchSubmit(e),!1}));var n=document.createElement("input");n.id=this._addUID("GPsearchInputText"),n.type="text",n.placeholder=e,n.autocomplete="off",n.addEventListener("keyup",(function(e){var o=e.which||e.keyCode;13!==o&&10!==o&&38!==o&&40!==o&&(document.getElementById(t._addUID("GPgeocodeResultsList")).style.display="none",n.value.length>2?document.getElementById(t._addUID("GPautoCompleteList")).style.display="block":document.getElementById(t._addUID("GPautoCompleteList")).style.display="none",t.onAutoCompleteSearchText(e))})),n.addEventListener("keydown",(function(e){var o=e.which||e.keyCode,n=document.getElementById(t._addUID("GPautocompleteResults"));if(n){var r=n.getElementsByClassName("GPautoCompleteProposal current"),i=n.getElementsByClassName("GPautoCompleteProposal"),s=i.length;if(s){var a=null;if(!r.length)return(a=i[0]).className="GPautoCompleteProposal current",a.style.color="#000000",void(a.style["background-color"]="#CEDBEF");a=r[0];var c=parseInt(m.a.index(a.id),10),l=c===s-1?i[0]:i[c+1],u=0===c?i[s-1]:i[c-1];switch(a.style["background-color"]="",a.style.color="",u.style["background-color"]="",u.style.color="",l.style["background-color"]="",l.style.color="",o){case 38:a.className="GPautoCompleteProposal",u.className="GPautoCompleteProposal current",u.style.color="#000000",u.style["background-color"]="#CEDBEF";break;case 40:a.className="GPautoCompleteProposal",l.className="GPautoCompleteProposal current",l.style.color="#000000",l.style["background-color"]="#CEDBEF";break;case 13:e.preventDefault(),a.click(e)}a.focus()}}})),o.appendChild(n);var r=document.createElement("div");return r.id=this._addUID("GPsearchInputReset"),r.addEventListener("click",(function(){document.getElementById(t._addUID("GPsearchInputText")).value="",document.getElementById(t._addUID("GPautoCompleteList")).style.display="none",document.getElementById(t._addUID("GPgeocodeResultsList")).style.display="none",t.onSearchResetClick()})),o.appendChild(r),o},_createShowAdvancedSearchElement:function(){var e=this,t=document.createElement("div");t.id=this._addUID("GPshowAdvancedSearch"),t.className="GPshowAdvancedToolPicto",t.title="Ouvrir la recherche avancée",t.addEventListener("click",(function(){var t="#GPsearchInput-"+e._uid;document.querySelector(t+" input").disabled=!0,document.getElementById(e._addUID("GPautoCompleteList")).style.display="none",document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none",document.getElementById(e._addUID("GPshowAdvancedSearch")).style.display="none",document.getElementById(e._addUID("GPadvancedSearchPanel")).style.display="inline-block"}));var o=document.createElement("span");return o.id=this._addUID("GPshowAdvancedSearchOpen"),o.className="GPshowAdvancedToolOpen",t.appendChild(o),t},_createAdvancedSearchPanelElement:function(){var e=document.createElement("div");return e.id=this._addUID("GPadvancedSearchPanel"),e.className="GPpanel",e.style.display="none",e},_createGeocodeResultsElement:function(){var e=document.createElement("div");return e.id=this._addUID("GPgeocodeResultsList"),e.className="GPpanel",e.style.display="none",e.appendChild(this._createGeocodeResultsHeaderElement()),e},_createAutoCompleteElement:function(){var e=document.createElement("div");return e.id=this._addUID("GPautoCompleteList"),e.className="GPautoCompleteList",e.style.display="none",e},_createAutoCompleteListElement:function(){var e=this,t=document.createElement("div");return t.id=this._addUID("GPautocompleteResults"),t.addEventListener?t.addEventListener("click",(function(t){e.onAutoCompletedResultsItemClick(t),document.getElementById(e._addUID("GPautoCompleteList")).style.display="none"}),!1):t.attachEvent&&t.attachEvent("onclick",(function(t){e.onAutoCompletedResultsItemClick(t),document.getElementById(e._addUID("GPautoCompleteList")).style.display="none"})),t},_createAutoCompletedLocationElement:function(e,t){var o=document.getElementById(this._addUID("GPautocompleteResults")),n=document.createElement("div");n.id=this._addUID("AutoCompletedLocation_"+t),n.className="GPautoCompleteProposal",n.innerHTML=y.a.getSuggestedLocationFreeform(e),n.addEventListener?n.addEventListener("click",(function(e){o.click(e)}),!1):n.attachEvent&&n.attachEvent("onclick",(function(e){o.click(e)})),o.appendChild(n)},_createAdvancedSearchPanelHeaderElement:function(){var e=this,t=document.createElement("div");t.className="GPpanelHeader";var o=document.createElement("div");o.className="GPpanelTitle",o.innerHTML="Recherche avancée",t.appendChild(o);var n=document.createElement("div");return n.id=this._addUID("GPadvancedSearchClose"),n.className="GPpanelClose",n.title="Fermer la recherche avancée",n.addEventListener?n.addEventListener("click",(function(){var t="#GPsearchInput-"+e._uid;document.querySelector(t+" input").disabled=!1,document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none",document.getElementById(e._addUID("GPshowAdvancedSearch")).style.display="inline-block",document.getElementById(e._addUID("GPadvancedSearchPanel")).style.display="none"}),!1):n.attachEvent&&n.attachEvent("onclick",(function(){var t="#GPsearchInput-"+e._uid;document.querySelector(t+" input").disabled=!1,document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none",document.getElementById(e._addUID("GPshowAdvancedSearch")).style.display="inline-block",document.getElementById(e._addUID("GPadvancedSearchPanel")).style.display="none"})),t.appendChild(n),t},_createAdvancedSearchPanelFormElement:function(e){var t=this,o=document.createElement("form");o.id=this._addUID("GPadvancedSearchForm"),o.addEventListener("submit",(function(e){e.preventDefault();for(var o=[],n="#GPadvancedSearchFilters-"+t._uid,r=document.querySelectorAll(n+" > div > div > input"),i=0;i<r.length;i++){var s=r[i];o.push({key:s.name,value:s.value})}return t.onGeocodingAdvancedSearchSubmit(e,o),document.getElementById(t._addUID("GPgeocodeResultsList")).style.display="block",!1}));var n=document.createElement("div");n.className="GPflexInput";var r=document.createElement("label");r.className="GPadvancedSearchCodeLabel",r.innerHTML="Recherche par",n.appendChild(r);var i=this._createAdvancedSearchFormCodeElement(e);return n.appendChild(i),o.appendChild(n),o},_createAdvancedSearchFormCodeElement:function(e){var t=this,o=document.createElement("select");o.id=this._addUID("GPadvancedSearchCode"),o.className="GPadvancedSearchCode",o.addEventListener("change",(function(e){t.onGeocodingAdvancedSearchCodeChange(e)}),!1),e||(e=[{id:"PositionOfInterest",title:"Lieux/toponymes"},{id:"StreetAddress",title:"Adresses"},{id:"CadastralParcel",title:"Parcelles cadastrales"}]);for(var n=0;n<e.length;n++){var r=document.createElement("option");r.value=e[n].id,r.text=e[n].title,o.appendChild(r)}return o},_createAdvancedSearchFormInputElement:function(){var e=document.createElement("input");return e.type="submit",e.id=this._addUID("GPadvancedSearchSubmit"),e.className="GPinputSubmit",e.value="Chercher",e},_createAdvancedSearchFormFiltersElement:function(){var e=document.createElement("div");return e.id=this._addUID("GPadvancedSearchFilters"),e},_createAdvancedSearchFiltersTableElement:function(e,t){var o=document.createElement("div");return o.id=this._addUID(e),t||(o.style.display="none"),o},_createAdvancedSearchFiltersAttributElement:function(e){var t=null,o=e.name,n=e.title,r=e.description,i=e.code,s=e.value,a=document.createElement("div");a.className="GPflexInput";var c=document.createElement("label");c.className="GPadvancedSearchFilterLabel",c.htmlFor=o,c.title=r||n,c.innerHTML=n,a.appendChild(c);var l=document.createElement("input");if(l.id=o,l.className="GPadvancedSearchFilterInput",l.type="text",l.name=o,s)if(Array.isArray(s)){var u=o+"_list";l.setAttribute("list",u);var d=document.createElement("datalist");d.id=u;for(var p=0;p<s.length;++p){var h=document.createElement("option");h.value=s[p],d.appendChild(h)}a.appendChild(d)}else l.value=s;return a.appendChild(l),(t=document.getElementById(this._addUID(i)))?t.appendChild(a):t=a,t},_createGeocodeResultsHeaderElement:function(){var e=this,t=document.createElement("div");t.className="GPpanelHeader";var o=document.createElement("div");o.className="GPpanelTitle",o.innerHTML="Résultats de la recherche",t.appendChild(o);var n=document.createElement("div");return n.id=this._addUID("GPgeocodeResultsClose"),n.className="GPpanelClose",n.title="Fermer la fenêtre de résultats",n.addEventListener?n.addEventListener("click",(function(){document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none"}),!1):n.attachEvent&&n.attachEvent("onclick",(function(){document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none"})),t.appendChild(n),t},_createGeocodeResultsListElement:function(){var e=this,t=document.createElement("div");return t.id=this._addUID("GPgeocodeResults"),t.addEventListener?t.addEventListener("click",(function(t){t.ctrlKey||(document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none"),e.onGeocodedResultsItemClick(t)}),!1):t.attachEvent&&t.attachEvent("onclick",(function(t){t.ctrlKey||(document.getElementById(e._addUID("GPgeocodeResultsList")).style.display="none"),e.onGeocodedResultsItemClick(t)})),t},_createGeocodedLocationElement:function(e,t){var o=document.getElementById(this._addUID("GPgeocodeResults")),n=document.createElement("div");n.id=this._addUID("GeocodedLocation_"+t),n.className="GPautoCompleteProposal",n.innerHTML="string"==typeof e?e:y.a.getGeocodedLocationFreeform(e),o.appendChild(n)}};function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var w={detectSupport:function(){var e=!0,t=window.navigator.userAgent.toLowerCase();return-1===t.indexOf("iphone")&&-1===t.indexOf("ipod")&&-1===t.indexOf("ipad")&&-1===t.indexOf("android")&&-1===t.indexOf("mobile")&&-1===t.indexOf("blackberry")&&-1===t.indexOf("tablet")&&-1===t.indexOf("phone")&&-1===t.indexOf("touch")||(e=!1),-1===t.indexOf("msie")&&-1===t.indexOf("trident")||(e=!0),e},assign:function(e,t){for(var o in e=e||{},t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e},mergeParams:function(e,t,o){if(e&&t)for(var n in void 0===o&&(o=!0),t)t.hasOwnProperty(n)&&("object"===S(t[n])?e.hasOwnProperty(n)?this.mergeParams(e[n],t[n],o):e[n]=t[n]:e.hasOwnProperty(n)?o&&(e[n]=t[n]):e[n]=t[n])}},R=g.a.getLogger("searchengine"),b=h.a.Control.extend({includes:E,options:{position:"topleft",collapsed:!0,displayInfo:!0,zoomTo:"",resources:[],placeholder:"Rechercher un lieu, une adresse",displayMarker:!0,markerStyle:"blue",displayAdvancedSearch:!0,advancedSearch:{},geocodeOptions:{},autocompleteOptions:{serviceOptions:{},triggerGeocode:!1,triggerDelay:1e3}},initialize:function(e){h.a.Util.setOptions(this,e),void 0===this.options.resources&&(this.options.resources={}),void 0!==this.options.resources.geocode&&""!==this.options.resources.geocode||(this.options.resources.geocode="location"),void 0!==this.options.resources.autocomplete&&0!==this.options.resources.autocomplete.length||(this.options.resources.autocomplete=["PositionOfInterest","StreetAddress"]),this._uid=m.a.generate(),this._showContainer=null,this._pictoContainer=null,this._inputContainer=null,this._suggestedContainer=null,this._suggestedLocations=[],this._geocodedContainer=null,this._geocodedLocations=[],this._filterContainer=null,this._currentGeocodingCode=null,this._currentGeocodingLocation=null,this._advancedSearchFilters={},this._advancedSearchCodes=[],this._marker=null,this._servicesRightManagement={},this._noRightManagement=!1,this._checkRightsManagement(),this._triggerHandler=null},onAdd:function(){this._initAdvancedSearchCodes(),this._initAdvancedSearchFilters();var e=this._initLayout();return h.a.DomEvent.disableClickPropagation(e).disableScrollPropagation(e),e},onRemove:function(e){this._clearSuggestedLocation(),this._clearGeocodedLocation(),null!=this._marker&&(e.removeLayer(this._marker),this._marker=null)},_checkRightsManagement:function(){var e=null,t=null;t=this.options.geocodeOptions.apiKey,(e=this.options.geocodeOptions.index?this.options.geocodeOptions.index:"")||(e=this.options.resources.geocodage),e||(e="location"),"location"===e?e=["StreetAddress","PositionOfInterest","CadastralParcel"]:Array.isArray(e)||(e=[e]);var o=f.a.check({key:t||this.options.apiKey,resources:e,services:["Geocode"]});t=this.options.autocompleteOptions.apiKey,(e=this.options.autocompleteOptions.type?this.options.autocompleteOptions.type:[])&&0!==e.length||(e=this.options.resources.autocomplete),e&&0!==e.length||(e=["StreetAddress","PositionOfInterest"]);var n=f.a.check({key:t||this.options.apiKey,resources:e,services:["AutoCompletion"]});o||n||(this._noRightManagement=!0),n&&(this._servicesRightManagement.AutoCompletion={},this._servicesRightManagement.AutoCompletion.resources=n.AutoCompletion,this._servicesRightManagement.AutoCompletion.key=n.key),o&&(this._servicesRightManagement.Geocode={},this._servicesRightManagement.Geocode.resources=o.Geocode,this._servicesRightManagement.Geocode.key=o.key)},_initLayout:function(){var e=this._createMainContainerElement(),t=this._showContainer=this._createShowSearchEngineElement();e.appendChild(t),this.options.collapsed||(t.checked="true");var o=this._pictoContainer=this._createShowSearchEnginePictoElement();e.appendChild(o);var n=this._createSearchInputElement(this.options.placeholder);if(e.appendChild(n),this.options.displayAdvancedSearch){var r=this._createShowAdvancedSearchElement();e.appendChild(r);var i=this._createAdvancedSearchPanelElement(),s=this._createAdvancedSearchPanelHeaderElement(),a=this._createAdvancedSearchPanelFormElement(this._advancedSearchCodes),c=this._filterContainer=this._createAdvancedSearchFormFiltersElement();this._setFilter(this._advancedSearchCodes[0].id);var l=this._createAdvancedSearchFormInputElement();a.appendChild(c),a.appendChild(l),i.appendChild(s),i.appendChild(a),e.appendChild(i)}var u=this._createAutoCompleteElement(),d=this._suggestedContainer=this._createAutoCompleteListElement();u.appendChild(d),e.appendChild(u);var p=this._createGeocodeResultsElement(),h=this._geocodedContainer=this._createGeocodeResultsListElement();return p.appendChild(h),e.appendChild(p),e},_initAdvancedSearchCodes:function(){var e=this.options.resources.geocode;"location"===e&&(e=["PositionOfInterest","StreetAddress","CadastralParcel"]),Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)switch(e[t]){case"PositionOfInterest":this._advancedSearchCodes.push({id:"PositionOfInterest",title:"Lieux/toponymes"});break;case"StreetAddress":this._advancedSearchCodes.push({id:"StreetAddress",title:"Adresses"});break;case"CadastralParcel":this._advancedSearchCodes.push({id:"CadastralParcel",title:"Parcelles cadastrales"})}0===this._advancedSearchCodes.length&&(this._advancedSearchCodes=[{id:"StreetAddress",title:"Adresses"},{id:"PositionOfInterest",title:"Lieux/toponymes"},{id:"CadastralParcel",title:"Cadastre"}]),R.log("advancedSearchCodes",this._advancedSearchCodes)},_initAdvancedSearchFilters:function(){this._advancedSearchFilters=v.advancedSearchFiltersByDefault;var e=this.options.advancedSearch;w.assign(this._advancedSearchFilters,e),R.log("advancedSearchFilters",this._advancedSearchFilters)},_setFilter:function(e){for(var t=this._filterContainer,o=!1,n=0;n<this._advancedSearchCodes.length;n++)if(this._advancedSearchCodes[n].id===e){o=!0;break}if(o){for(this._currentGeocodingCode=e;t.firstChild;)t.removeChild(t.firstChild);var r=this._advancedSearchFilters[e];if(r&&0!==r.length){for(var i=this._createAdvancedSearchFiltersTableElement(e,!0),s=0;s<r.length;s++){var a=this._createAdvancedSearchFiltersAttributElement(r[s]);i.appendChild(a)}return t.appendChild(i),t}}else for(;t.firstChild;)t.removeChild(t.firstChild)},_requestAutoComplete:function(e){if(e&&0!==Object.keys(e).length&&e.text)if(R.log(e),this._noRightManagement)R.log("no rights for all service !?");else if(this._servicesRightManagement.AutoCompletion){var t={};h.a.Util.extend(t,this.options.autocompleteOptions.serviceOptions),h.a.Util.extend(t,e);var o=this._servicesRightManagement.AutoCompletion.resources;if(o&&0!==Object.keys(o).length){h.a.Util.isArray(o)&&(t.type=o);var r=this._servicesRightManagement.AutoCompletion.key;h.a.Util.extend(t,{apiKey:t.apiKey||this.options.apiKey||r}),h.a.Util.extend(t,{ssl:this.options.ssl}),R.log(t),new n.a(t).call()}}else R.log("no rights for this service !?")},_fillAutoCompletedLocationListContainer:function(e){if(e&&0!==e.length){var t=this._suggestedContainer;if(t.childElementCount)for(;t.firstChild;)t.removeChild(t.firstChild);for(var o=0;o<e.length;o++)this._createAutoCompletedLocationElement(e[o],o)}},_requestGeocoding:function(e){if(e&&0!==Object.keys(e).length&&e.query)if(R.log(e),this._noRightManagement)R.log("no rights for all service !?");else if(this._servicesRightManagement.Geocode){var t={};h.a.Util.extend(t,this.options.geocodeOptions),h.a.Util.extend(t,e);var o=this.options.resources.geocode;o&&(t.index||(t.index=o));var n=this._servicesRightManagement.Geocode.key;h.a.Util.extend(t,{apiKey:t.apiKey||this.options.apiKey||n}),h.a.Util.extend(t,{ssl:this.options.ssl}),R.log(t),new d(t).call()}else R.log("no rights for this service !?")},_fillGeocodedLocationListContainer:function(e){if(e&&0!==e.length){var t=this._geocodedContainer;if(t.childElementCount)for(;t.firstChild;)t.removeChild(t.firstChild);for(var o=0;o<e.length;o++)R.log(e[o]),this._createGeocodedLocationElement(e[o],o);this._geocodedLocations=e}else this._clearGeocodedLocation()},_getGeocodeCoordinatesFromFullText:function(e,t){var o=y.a.getSuggestedLocationFreeform(e),n=this;this._requestGeocoding({query:o,onSuccess:function(e){R.log("request from Geocoding (coordinates null)",e),e.locations&&0!==e.locations.length&&e.locations[0].position&&n._suggestedLocations&&n._suggestedLocations[t]&&(n._suggestedLocations[t].position={lat:e.locations[0].position.y,lon:e.locations[0].position.x},n._locationsToBeDisplayed.unshift(n._suggestedLocations[t]),n._fillAutoCompletedLocationListContainer(n._locationsToBeDisplayed))},onFailure:function(){n._suggestedLocations&&n._suggestedLocations[t]&&n._createAutoCompletedLocationElement(n._suggestedLocations[t],t)}})},_setLabel:function(e){h.a.DomUtil.get("GPsearchInputText-"+this._uid).value=e||""},_setPosition:function(e,t){var o=this._map;o.setZoomAround(h.a.latLng(e),t,!0),o.panTo(h.a.latLng(e))},_getZoom:function(e){var t=this._map,o=this.options.zoomTo,n=null;if("function"==typeof o&&(R.trace("zoom function"),n=o.call(this,e)),"number"==typeof o&&(R.trace("zoom level"),n=o),"string"==typeof o)if("auto"===o)R.trace("zoom auto"),n=v.zoomToResultsByDefault(e);else{R.trace("zoom level parsing");var r=parseInt(o,10);isNaN(r)||(R.trace("zoom parsing"),n=r)}Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n&&""!==n&&Number.isInteger(n)||(R.trace("zoom not found, current zoom..."),n=t.getZoom());var i=t.getMinZoom(),s=t.getMaxZoom();return n<i&&(R.trace("zoom level min..."),n=i),n>s&&(R.trace("zoom level max..."),n=s),R.trace("zoom",n),n},_setMarker:function(e,t,o,n){var r=this._map;if(null!=this._marker&&(r.removeLayer(this._marker),this._marker=null),e){var i=null;"string"==typeof n?i=new A.a(n):n instanceof h.a.Icon?i=n:(i=new A.a("blue"),R.log("Utilisation du marker par défaut !"));var s={clickable:!0,zIndexOffset:1e3,icon:i};if(this._marker=h.a.marker(h.a.latLng(e),s),this._marker.addTo(r),o){var a=null;if("string"!=typeof t)if("GeocodedLocation"===t.service){a="<ul>";var c=t.location.placeAttributes;for(var l in c)c.hasOwnProperty(l)&&"trueGeometry"!==l&&"extraFields"!==l&&"houseNumberInfos"!==l&&"_count"!==l&&(a+="<li>",a+='<span class="gp-attname-others-span">'+l.toUpperCase()+" : </span>",a+=c[l],a+=" </li>");a+=" </ul>"}else a="SuggestedLocation"===t.service?y.a.getSuggestedLocationFreeform(t.location):"sans informations.";else a=t;this._marker.bindPopup(a)}}},_clearResults:function(){this._currentGeocodingLocation=null,this._clearSuggestedLocation(),this._clearGeocodedLocation(),this._setMarker()},_clearSuggestedLocation:function(){if(this._suggestedLocations=[],this._suggestedContainer)for(;this._suggestedContainer.firstChild;)this._suggestedContainer.removeChild(this._suggestedContainer.firstChild)},_clearGeocodedLocation:function(){if(this._geocodedLocations=[],this._geocodedContainer)for(;this._geocodedContainer.firstChild;)this._geocodedContainer.removeChild(this._geocodedContainer.firstChild)},onShowSearchEngineClick:function(){},onSearchResetClick:function(){this._clearResults()},onAutoCompleteSearchText:function(e){var t=e.target.value;if(t&&!(this._noRightManagement||(this._currentGeocodingLocation=t,t.length<3))){var o=this.options.autocompleteOptions.triggerGeocode,n=this.options.autocompleteOptions.triggerDelay,r=this;this._requestAutoComplete({text:t,onSuccess:function(e){if(R.log("request from AutoComplete",e),e){if(r._suggestedLocations=e.suggestedLocations,r._locationsToBeDisplayed=[],r._servicesRightManagement.Geocode&&r._servicesRightManagement.Geocode.key)for(var t=0;t<r._suggestedLocations.length;t++){var o=r._suggestedLocations[t];o.position&&0===o.position.x&&0===o.position.y&&o.fullText?r._getGeocodeCoordinatesFromFullText(o,t):r._locationsToBeDisplayed.push(o)}else r._locationsToBeDisplayed=r._suggestedLocations;r._fillAutoCompletedLocationListContainer(r._locationsToBeDisplayed),r._triggerHandler&&(clearTimeout(r._triggerHandler),r._triggerHandler=null,R.warn("Cancel a geocode request !"))}},onFailure:function(e){r._clearSuggestedLocation(),R.log(e.message),"No suggestion matching the search"===e.message&&o&&(r._triggerHandler&&(clearTimeout(r._triggerHandler),R.warn("Cancel the last geocode request !")),r._triggerHandler=setTimeout((function(){R.warn("Launch a geocode request (code postal) !"),r._requestGeocoding({query:t,onSuccess:function(e){if(R.log("request from Geocoding",e),e){r._locationsToBeDisplayed=[];for(var t=e.locations,o=0;o<t.length;o++){var n=t[o];n.fullText=y.a.getGeocodedLocationFreeform(n),n.position={x:n.position.lon,y:n.position.lat},r._locationsToBeDisplayed.push(n)}r._fillAutoCompletedLocationListContainer(t)}},onFailure:function(e){R.log(e.message)}})}),n))}})}},onAutoCompletedResultsItemClick:function(e){var t=m.a.index(e.target.id),o=e.target.innerHTML;if(R.log(t,o),R.log(this._locationsToBeDisplayed[t]),t){var n={lat:this._locationsToBeDisplayed[t].position.y,lon:this._locationsToBeDisplayed[t].position.x},r={service:"SuggestedLocation",location:this._locationsToBeDisplayed[t]},i=this._getZoom(r);this._setLabel(o),this._setPosition(n,i),this.options.displayMarker&&this._setMarker(n,r,this.options.displayInfo,this.options.markerStyle)}},onGeocodingSearchSubmit:function(e){R.log(e);var t=e.target[0].value;if(t&&!this._noRightManagement){this._currentGeocodingLocation=t;var o=this;this._requestGeocoding({query:t,onSuccess:function(e){if(R.log("request from Geocoding",e),e){var t=e.locations;o._fillGeocodedLocationListContainer(t)}},onFailure:function(e){o._clearGeocodedLocation(),R.log(e.message)}})}},onGeocodedResultsItemClick:function(e){var t=m.a.index(e.target.id),o=e.target.innerHTML;if(R.log(t,o),R.log(this._geocodedLocations[t]),t){var n=this._geocodedLocations[t].position,r={service:"GeocodedLocation",location:this._geocodedLocations[t]},i=this._getZoom(r);this._setLabel(o),this._setPosition(n,i),this.options.displayMarker&&this._setMarker(n,r,this.options.displayInfo,this.options.markerStyle)}},onGeocodingAdvancedSearchCodeChange:function(e){R.log(e);var t=e.target.selectedIndex,o=e.target.options[t].value;o&&this._setFilter(o)},onGeocodingAdvancedSearchSubmit:function(e,t){if(R.log(t),t&&0!==t.length){for(var o=this._currentGeocodingCode,n=h.a.DomUtil.get("GPsearchInputText-"+this._uid).value,r={},i=0;i<t.length;i++){var s=t[i];s.value&&(r[s.key]=s.value)}var a=this;this._requestGeocoding({query:n,index:o,filters:r,onSuccess:function(e){if(R.log(e),e){var t=e.locations;a._fillGeocodedLocationListContainer(t)}},onFailure:function(e){a._clearGeocodedLocation(),R.log(e.message)}})}},setText:function(e,t,o){this._showContainer.checked||this._pictoContainer.click(),h.a.Util.extend(this.options,o);var n=h.a.DomUtil.get("GPsearchInputText-"+this._uid);(n.value=e,t)?h.a.DomUtil.get("GPsearchInput-"+this._uid).dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})):n.dispatchEvent(new KeyboardEvent("keyup"))}});t.default=b;window.L&&(window.L.geoportalControl||(window.L.geoportalControl={}),window.L.geoportalControl.SearchEngine=b)}]).default;