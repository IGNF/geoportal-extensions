/*!
 * @brief French Geoportal Extension for Leaflet
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * @copyright copyright (c) IGN 
 * @license CeCILL-B
 * @author IGN
 * @version 2.2.7
 * @date 18/11/2022
 *
 */
Route=function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=56)}([function(e,t){e.exports=L},function(e,t,o){"use strict";var n={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(e,t){if(0===Object.keys(arguments).length)return"Message indefined !";var o=Array.prototype.slice.call(arguments),n=o.shift(),i=o,r=this[n];try{r=Array.isArray(i)&&i.length>0?r.replace("%var%",i.join(" - ")):r.replace("%var%","%var% (not specified)")}catch(e){}return r}};t.a=n},function(e,t,o){"use strict";function n(e){if(!(this instanceof n))throw new TypeError("ErrorService constructor cannot be called as a function.");var t=e;"string"==typeof e||e instanceof String?(this.message=e,this.status=-1,this.type=n.TYPE_UNKERR):(this.message=t.message||"undefined!?",this.type=t.type,this.status=t.status||-1),this.name="ErrorService",this.stack=(new Error).stack}n.TYPE_SRVERR="SERVICE_ERROR",n.TYPE_USEERR="USAGE_ERROR",n.TYPE_UNKERR="UNKNOWN_ERROR",n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t.a=n},function(e,t,o){"use strict";var n=o(6),i={getLogger:function(e){"true".match(/true/)?n.disableAll():n.enableAll();var t=e||"default";return n.getLogger(t)}};t.a=i},function(e,t,o){"use strict";var n,i={generate:(n=Math.floor(Date.now()),function(){return n++}),name:function(e){var t=null,o=e.lastIndexOf("-");return t=-1===o?e:e.substring(0,o),t},index:function(e){var t=null,o=this.name(e),n=o.lastIndexOf("_");return-1!==n&&(t=o.substring(n+1)),t},uuid:function(e){var t=null,o=e.lastIndexOf("-");return-1!==o&&(t=parseInt(e.substring(o+1),10)),t}};t.a=i},function(e,t,o){"use strict";var n=o(6),i={getLogger:function(e){"true".match(/true/)?n.disableAll():n.enableAll();var t=e||"default";return n.getLogger(t)},disableAll:function(){var e=n.getLoggers();for(var t in e){if(Object.hasOwnProperty.call(e,t))e[t].disableAll()}},enableAll:function(){var e=n.getLoggers();for(var t in e){if(Object.hasOwnProperty.call(e,t))e[t].enableAll()}}};t.a=i},function(e,t,o){var n,i;!function(r,s){"use strict";void 0===(i="function"==typeof(n=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function n(e,t){var o=e[t];if("function"==typeof o.bind)return o.bind(e);try{return Function.prototype.bind.call(o,e)}catch(t){return function(){return Function.prototype.apply.apply(o,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(o){return"debug"===o&&(o="log"),"undefined"!=typeof console&&("trace"===o&&t?i:void 0!==console[o]?n(console,o):void 0!==console.log?n(console,"log"):e)}function s(t,n){for(var i=0;i<o.length;i++){var r=o[i];this[r]=i<t?e:this.methodFactory(r,t,n)}this.log=this.debug}function a(e,t,o){return function(){"undefined"!=typeof console&&(s.call(this,t,o),this[e].apply(this,arguments))}}function l(e,t,o){return r(e)||a.apply(this,arguments)}function c(e,t,n){var i,r=this;t=null==t?"WARN":t;var a="loglevel";function c(){var e;if("undefined"!=typeof window&&a){try{e=window.localStorage[a]}catch(e){}if(void 0===e)try{var t=window.document.cookie,o=t.indexOf(encodeURIComponent(a)+"=");-1!==o&&(e=/^([^;]+)/.exec(t.slice(o))[1])}catch(e){}return void 0===r.levels[e]&&(e=void 0),e}}"string"==typeof e?a+=":"+e:"symbol"==typeof e&&(a=void 0),r.name=e,r.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},r.methodFactory=n||l,r.getLevel=function(){return i},r.setLevel=function(t,n){if("string"==typeof t&&void 0!==r.levels[t.toUpperCase()]&&(t=r.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=r.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(i=t,!1!==n&&function(e){var t=(o[e]||"silent").toUpperCase();if("undefined"!=typeof window&&a){try{return void(window.localStorage[a]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"="+t+";"}catch(e){}}}(t),s.call(r,t,e),"undefined"==typeof console&&t<r.levels.SILENT)return"No console available for logging"},r.setDefaultLevel=function(e){t=e,c()||r.setLevel(e,!1)},r.resetLevel=function(){r.setLevel(t,!1),function(){if("undefined"!=typeof window&&a){try{return void window.localStorage.removeItem(a)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},r.enableAll=function(e){r.setLevel(r.levels.TRACE,e)},r.disableAll=function(e){r.setLevel(r.levels.SILENT,e)};var u=c();null==u&&(u=t),r.setLevel(u,!1)}var u=new c,d={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new c(e,u.getLevel(),u.methodFactory)),t};var p="undefined"!=typeof window?window.log:void 0;return u.noConflict=function(){return"undefined"!=typeof window&&window.log===u&&(window.log=p),u},u.getLoggers=function(){return d},u.default=u,u})?n.call(t,o,t,e):n)||(e.exports=i)}()},function(e,t,o){"use strict";var n={normalyzeParameters:function(e){var t=null;if(e){var o=[];for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];i||(i=""),o.push(n+"="+i)}t=o.join("&")}return t},normalyzeUrl:function(e,t,o){var n=e;if(e){var i=e.indexOf("?");-1===i&&(n+="?"),-1!==i&&i!==e.length-1&&(n+="&")}return t&&(n+="string"==typeof t?t:this.normalyzeParameters(t)),o&&(n=encodeURIComponent(n)),n},indent:function(e,t){return new Array((e||0)+1).join("\t")+t}};t.a=n},function(e,t,o){"use strict";(function(e){var n=o(5).a.getLogger("config"),i={configuration:null,isConfigLoaded:function(){var t="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==e?e:{};return!(!t.Gp||!t.Gp.Config||0===Object.keys(t.Gp.Config).length)&&(this.configuration=t.Gp.Config,!0)},getLayerId:function(e,t){var o=null;if(this.configuration){var i=this.configuration.layers;for(var r in i)if(i.hasOwnProperty(r)){var s=r.split("$");if(e===s[0]&&s[1]){var a=s[1].split(":");if(s[1].split(";")[1]===t){o=r;break}if(a[2]===t){o=r;break}}}}return o||n.error("ERROR layer id (layer name: "+e+" / service: "+t+") was not found !?"),o},getLayerParams:function(e,t,o){var i={};if(this.configuration){var r=this.getLayerId(e,t);if(r){var s=this.configuration.layers[r],a=s.apiKeys[0];if(o&&o!==a)return void n.error("ERROR different keys ("+o+" !== "+a+") !?");o=o||a,i.key=o,i.url=s.getServerUrl(o),i.version=s.getServiceParams().version,i.styles=s.getDefaultStyle(),i.format=s.getDefaultFormat(),i.projection=s.getDefaultProjection(),i.minScale=s.getMinScaleDenominator(),i.maxScale=s.getMaxScaleDenominator(),i.extent=s.getBBOX(),i.legends=s.getLegends(),i.metadata=s.getMetadata(),i.originators=s.getOriginators(),i.title=s.getTitle(),i.description=s.getDescription(),i.quicklookUrl=s.getQuicklookUrl(),s.wmtsOptions&&(i.tileMatrixSetLimits=s.wmtsOptions.tileMatrixSetLimits);var l=s.getTMSID();if(l){i.TMSLink=l;var c=this.configuration.getTMSConf(l);i.matrixOrigin=c.getTopLeftCorner(),i.nativeResolutions=c.nativeResolutions,i.matrixIds=c.matrixIds,i.tileMatrices=c.tileMatrices}}}return i},getServiceParams:function(e,t,o){var n={};if(this.configuration){var i=this.getLayerId(e,t);if(i){var r=this.configuration.layers[i],s=r.apiKeys[0];if(o){Array.isArray(o)||(o=[o]);for(var a=0;a<o.length;a++)if(o[a]===s){var l=a;break}if(void 0===l)return}var c=o[l]||s;n.key=c,n.url=r.getServerUrl(c),n.version=r.getServiceParams().version,n.extent=r.getBBOX(),n.title=r.getTitle(),n.description=r.getDescription()}}return n},getResolutions:function(){var e=[];return this.configuration&&(e=this.configuration.generalOptions.wgs84Resolutions),e},getTileMatrix:function(e){var t={};return this.configuration&&e&&(t=this.configuration.tileMatrixSets[e.toUpperCase()]),t},getGlobalConstraints:function(e){var t={};if(e){var o=this.configuration.layers[e];t.projection=o.getDefaultProjection(),t.minScale=o.getMinScaleDenominator(),t.maxScale=o.getMaxScaleDenominator(),t.extent=o.getBBOX()}return t}};t.a=i}).call(this,o(15))},function(e,t,o){"use strict";var n,i=o(3),r=o(7),s=o(1),a=o(18),l=o.n(a),c={call:function(e){var t=i.a.getLogger("XHR");if(t.trace("[XHR::call()]"),l.a.polyfill(),!e.url)throw new Error("missing parameter : url is not defined !");if(!e.method)throw new Error("missing parameter : method is not defined !");e.format||(e.format="text");var o={};switch(o.url=e.url,o.data=e.data?e.data:null,o.method=e.method,o.timeOut=e.timeOut||0,o.scope=e.scope||this,o.proxy=e.proxy||null,o.content=e.content||null,o.headers=e.headers||{referer:"http://localhost"},e.method){case"DELETE":case"GET":break;case"PUT":case"POST":o.content=e.content?e.content:"application/x-www-form-urlencoded",o.headers=e.headers?e.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(e.format){case"text":this.__call(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;case"json":this.__callJSON(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;case"xml":this.__callXML(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;default:throw new Error("This output Format is not yet supported !")}},__call:function(e){var t=i.a.getLogger("XHR");return t.trace("[XHR::__call()]"),new Promise((function(n,i){var s="POST"===e.method||"PUT"===e.method?1:0;e.data&&("object"==typeof e.data&&Object.keys(e.data).length||"string"==typeof e.data&&e.data.length)&&!s&&("Geocode"===e.scope.CLASSNAME||"ReverseGeocode"===e.scope.CLASSNAME?e.url=e.url+e.data:e.url=r.a.normalyzeUrl(e.url,e.data)),t.trace("URL = ",e.url);var a=null;if("undefined"==typeof window){var l=o(26),c={headers:{Referer:"https://localhost"}};return e.data&&"string"==typeof e.data&&s&&(c={method:e.method,body:e.data,headers:{"Content-Type":e.content,Referer:"https://localhost"}}),l(e.url,c).then((function(e){if(e.ok)n(e.text());else{var t="Errors Occured on Http Request (status : '"+e.statusText+"' | url : '"+e.url+"')",o=e.status;i({message:t,status:o})}})).catch((function(e){i({message:e,status:-1})}))}if(window.XMLHttpRequest){t.trace("XMLHttpRequest"),(a=new XMLHttpRequest).open(e.method,e.url,!0),a.overrideMimeType=e.content;var u=null;e.timeOut>0&&(t.trace("XHR - TimeOut actif !"),u=window.setTimeout((function(){i({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})}),e.timeOut)),s&&(t.trace("data = ",e.data),a.setRequestHeader("Content-type",e.content)),a.onerror=function(e){console.log(e),i(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(e){console.log(e),i(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onreadystatechange=function(e){if(4===a.readyState)if(200===a.status)window.clearTimeout(u),n(a.response);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"' | response : '"+e.target.response+"')",o=e.target.status;i({message:t,status:o})}};var d=e.data&&s?e.data:null;a.send(d)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");t.trace("XDomainRequest"),(a=new XDomainRequest).open(e.method,e.url),a.overrideMimeType=e.content,e.timeOut>0&&(a.timeout=e.timeout,t.trace("XHR - TimeOut actif !")),s&&a.setRequestHeader("Content-type",e.content),a.onerror=function(){i(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(){i(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onload=function(e){if(200===a.status)n(a.responseText);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"')",o=e.target.status;i({message:t,status:o})}};var p=e.data&&s?e.data:null;a.send(p)}}))},__callJSON:function(e){return this.__call(e).then(JSON.parse).catch((function(t){console.log("_callJSON failed on : ",e.url,t)}))},__callXML:function(e){return this.__call(e).then((function(e){var t;"undefined"==typeof window?t=(new(0,o(20).DOMParser)).parseFromString(e,"text/xml"):window.DOMParser?t=(new window.DOMParser).parseFromString(e,"text/xml"):((t=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t})).catch((function(t){console.log("__callXML failed on : ",e.url,t)}))}},u={uuid:(n=Math.floor(Date.now()),function(){return n++}),call:function(e){var t=i.a.getLogger("JSONP");if(t.trace("[JSONP::call ()]"),!e)throw t.error("missing parameter : options !"),new Error("missing parameter : options !");if(!e.url)throw t.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(e.timeOut||(t.info("setting 'options.timeOut' default value"),e.timeOut=0),!e.onResponse)throw t.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var o="string"==typeof e.callbackSuffix?e.callbackSuffix:this.uuid(),n=!1,r=!1,s=e.url.indexOf("callback=");if(-1!==s){n=!0;var a=e.url.indexOf("&",s);-1===a&&(a=e.url.length);var l=e.url.substring(s+9,a);l&&(r=!0,e.callbackName=l,t.info("setting 'options.callbackName' value ("+e.callbackName+") from 'options.url' parameter"))}if(!n){var c=e.url.indexOf("?");-1===c?e.url=e.url+"?callback=":c===e.url.length?e.url=e.url+"callback=":e.url=e.url+"&callback=",t.info("setting callback default key in 'options.url' : "+e.url)}var u=!!e.callbackName||r;if(r||(e.callbackName||(t.info("setting 'options.callbackName' default value"),e.callbackName="callback",(o||""===o)&&(e.callbackName+=o)),e.url=e.url.replace("callback=","callback="+e.callbackName),t.info("setting callback function name in 'options.url' : "+e.url)),e.onTimeOut||(t.info("setting 'options.onTimeOut' default value"),e.onTimeOut=function(){console.log("TimeOut while invoking url : "+e.url)}),!u){var d=this,p=null;e.timeOut>0&&(p=window.setTimeout((function(){window[e.callbackName]=function(){},e.onTimeOut(),d._deleteScript(o)}),e.timeOut)),window[e.callbackName]=function(t){window.clearTimeout(p),e.onResponse(t),d._deleteScript(o)}}this._createScript(o,e.url)},_createScript:function(e,t){var o,n=document.getElementById("results"+e);(o=document.createElement("script")).setAttribute("type","text/javascript"),o.setAttribute("src",t),o.setAttribute("charset","UTF-8"),o.setAttribute("id","results"+e),o.setAttribute("async","true");var i=document.documentElement||document.getElementsByTagName("head")[0];null===n?i.appendChild(o):i.replaceChild(o,n)},_deleteScript:function(e){var t=document.getElementById("results"+e);if(t){var o=t.parentNode||document.documentElement;if(!o)return;o.removeChild(t)}}},d={send:function(e){var t=e||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if("undefined"!=typeof window||"JSONP"!==e.protocol){if("XHR"===e.protocol||"json"===e.format?t.wrap=!1:"JSONP"===e.protocol&&"xml"===e.format&&(t.wrap=!0),t.callback=null,t.output=t.wrap?"json":null,t.wrap){var o={};o.output=t.output,o.callback=t.callback,delete o.callback,t.url=r.a.normalyzeUrl(e.url,o)}switch(t.protocol){case"XHR":"GET"===e.method&&e.nocache&&(t.url=r.a.normalyzeUrl(t.url,{t:(new Date).getTime()})),c.call(t);break;case"JSONP":t.data&&(t.url=r.a.normalyzeUrl(t.url,t.data)),u.call(t);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}},p=o(2),h=o(12),m=o(19);function g(e){if(!(this instanceof g))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR"));for(var t in this.logger=i.a.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(e){console.log("onSuccess - la reponse est la suivante : ",e)},onFailure:function(e){200!==e.status&&e.status?console.log("onFailure - Erreur (",e.status,") : ",e.message):console.log("onFailure : ",e.message)}},e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(s.a.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(e){console.log("onSuccess - la réponse brute du service est la suivante : ",e)}),!!(null===this.options.onSuccess||"function"!=typeof this.options.onSuccess))throw new Error(s.a.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){h.a.ssl=this.options.ssl;var o=h.a[this.CLASSNAME].url(this.options.apiKey);"string"==typeof o?this.options.serverUrl=o:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod="string"==typeof e.httpMethod?e.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(s.a.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof e.protocol?e.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","protocol"))}if("undefined"==typeof window&&"JSONP"===this.options.protocol)throw new Error(s.a.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=e.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}g.prototype={constructor:g,call:function(){this.logger.trace("CommonService::call ()");var e=this;function t(t){this.logger.trace("CommonService::onBuildRequest : ",t),this.callService.call(e,i,o)}function o(t){this.logger.trace("CommonService::onCallService : ",t),this.analyzeResponse.call(e,i,n)}function n(e){if(this.logger.trace("CommonService::onAnalyzeResponse : ",e),!e)return i.call(this,new p.a("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,e)}function i(e){this.logger.trace("CommonService::onError()");var t=e;t instanceof p.a||(t=new p.a(e.message)),this.options.onFailure.call(this,t)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(e,i,t)}).call(e)},buildRequest:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")},callService:function(e,t){var o=null,n=this.request,i=!(!this.options.proxyURL||"XHR"!==this.options.protocol);"Geocode"!==this.CLASSNAME&&"ReverseGeocode"!==this.CLASSNAME&&"AutoComplete"!==this.CLASSNAME&&(this.options.serverUrl=r.a.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":m.version},!1)),i&&("GET"===this.options.httpMethod&&(o=this.options.proxyURL+r.a.normalyzeUrl(this.options.serverUrl,this.request,!0),n=null),"POST"===this.options.httpMethod&&(o=this.options.proxyURL+r.a.normalyzeUrl(this.options.serverUrl,null,!0),n=this.request));var s=this,a={url:o||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"!==this.options.protocol,callbackSuffix:this.options.callbackSuffix,data:n,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(o){s.logger.trace("callService::onResponse()");var n=null;if("XHR"===s.options.protocol&&(s.logger.trace("Response XHR",o),n=o),"JSONP"===s.options.protocol){if(s.logger.trace("Response JSON",o),!o)return void e.call(s,new p.a("Le contenu de la reponse est vide !?"));if(o.http){if(200!==o.http.status)return void e.call(s,new p.a({status:o.http.status,message:o.http.error,type:p.a.TYPE_SRVERR}));n=o.xml,s.options.rawResponse&&(n=o)}else n=o}if("function"==typeof s.options.onBeforeParse){var i=s.options.onBeforeParse(n);"string"==typeof i&&(n=i)}s.response=n,t.call(s,n)},onFailure:function(t){s.logger.trace("callService::onFailure()"),t.type=p.a.TYPE_SRVERR,e.call(s,new p.a(t))},onTimeOut:function(){s.logger.trace("callService::onTimeOut()"),e.call(s,new p.a("TimeOut!"))}};d.send(a)},analyzeResponse:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")}};t.a=g},function(e,t,o){"use strict";var n=o(5),i=o(8);t.a={check:function(e){var t=n.a.getLogger("checkrightmanagement");if(e){var o=e.key,r=e.resources||[],s=e.services||[];if(0!==r.length){if(0!==s.length){var a={};if(!o){if(!i.a.isConfigLoaded())return void t.warn("WARNING : The 'apiKey' parameter is missing, and the contract key configuration has not been loaded, so impossible to check yours rights !");o=Object.keys(i.a.configuration.generalOptions.apiKeys),t.log(o)}if(i.a.isConfigLoaded()){for(var l=0;l<r.length;l++)for(var c=r[l],u=0;u<s.length;u++){var d=s[u],p=i.a.getServiceParams(c,d,o);p&&0!==Object.keys(p).length?(a[d]||(a[d]=[]),a[d].push(c)):t.warn("WARNING : The contract key configuration has no rights to load this geoportal resource ("+c+") for this service ("+d+") ")}return 0===Object.keys(a).length?void t.warn("WARNING : The contract key configuration has been loaded, and the 'apiKey' parameter has been set, but, there is a problem on the mapping between the contract and the key !"):(a.key=p.key,t.log("right management checked",a),a)}t.warn("WARNING : the contract key configuration has not been loaded, so be carefull !");for(var h={},m=0;m<s.length;m++){var g=s[m];h[g]=[];for(var f=0;f<r.length;f++){var v=r[f];h[g].push(v)}}return h.key=o,t.log("right management not checked",h),h}t.error("WARNING : no parameter 'services' specified !")}else t.error("WARNING : no parameter 'resources' specified !")}else t.error("WARNING : no parameter specified !")}}},function(e,t,o){"use strict";t.a={getGeocodedLocationFreeform:function(e){var t=e.placeAttributes;return t.label?t.label:"PositionOfInterest"===e.type?t.postcode+" "+t.toponym:"StreetAddress"===e.type?(t.housenumber?t.housenumber+" ":"")+t.street+" "+(t.postcode?t.postcode+", ":"")+t.city:"CadastralParcel"===e.type?t.id:"..."},getSuggestedLocationFreeform:function(e){if(e.fullText)return e.fullText;var t=[];return t.push(e.street||""),t.push(e.postalCode||""),t.push(e.commune||""),"PositionOfInterest"===e.type&&(t.push(e.poi||""),t.push(e.kind||"")),t.join(" - ")}}},function(e,t,o){"use strict";var n={ssl:!0,url:function(e,t){return(!1===n.ssl?"http://":"https://")+"wxs.ign.fr".concat("/",e,t)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(e){return{"elevation-json":n.url(e,this._key["elevation-json"]),"elevation-xml":n.url(e,this._key["elevation-xml"]),"profil-json":n.url(e,this._key["profil-json"]),"profil-xml":n.url(e,this._key["profil-xml"]),wps:n.url(e,this._key.wps)}}},ProcessIsoCurve:{_key:"/geoportail/isochrone/rest/1.0.0/isochrone",url:function(e){return n.url(e,this._key)}},AutoComplete:{_key:"/ols/apis/completion",url:function(e){return n.url(e,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(e){return n.url(e,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(e){var t="";if(Array.isArray(e)&&e.length>0){t=e[0];for(var o=1;o<e.length;o++)t+=","+e[o]}return{apiKey:n.url(e,this._key.apiKey),apiKeys:n.url(e[0],this._key.apiKeys).replace("%KEYS%",t),aggregate:n.url(e,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(e){return n.url(e,this._key)}},Route:{_key:"/geoportail/itineraire/rest/1.0.0/route",url:function(e){return n.url(e,this._key)}}};t.a=n},function(e,t,o){"use strict";var n={NORTH:"N",SOUTH:"S",EAST:"E",WEST:"O",digitSecond:2,digitDecimal:5,digitRadian:8,roundToDecimal:function(e,t){var o=Math.pow(10,t);return Math.round(e*o)/o},decimalToRadian:function(e){return this.roundToDecimal(.017453292519943295*e,this.digitRadian)},decimalToGrade:function(e){return this.roundToDecimal(1.1111111111111112*e,this.digitRadian)},decimalToDMS:function(e,t,o){e<0&&(e*=-1);var n=Math.floor(e),i=60*(e-n),r=Math.floor(i),s=60*(i-r),a=this.roundToDecimal(s,this.digitSecond),l=n+"° "+r+"' "+a+'" ';return t&&(l+=t),o?{d:n,m:r,s:a,direction:t}:l},decimalLatToDMS:function(e,t){var o=e<0?this.SOUTH:this.NORTH;return this.decimalToDMS(e,o,t)},decimalLonToDMS:function(e,t){var o=e<0?this.WEST:this.EAST;return this.decimalToDMS(e,o,t)},DMSToDecimal:function(e,t,o,n){var i=e+t/60+o/3600;return i=n===this.SOUTH||n===this.WEST?-1*i:i,this.roundToDecimal(i,this.digitDecimal)}};t.a=n},function(e,t,o){"use strict";var n=o(0),i=o.n(n),r=o(5).a.getLogger("icondefault"),s=i.a.Icon.Default.extend({images:{retina:{shadow:"data:image/png;base64,...",color:{blue:"data:image/png;base64,...",orange:"data:image/png;base64,...",red:"data:image/png;base64,...",green:"data:image/png;base64,..."}},shadow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=",color:{blue:"data:image/png;base64,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",orange:"data:image/png;base64,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",red:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAASAAAAEgARslrPgAABe5JREFUWMOdlWuIXGcZx3/nPbe5ZWbO2c0a8VIEpSq0io2QBT8FUlIFEbzfokUUKfgxIuSbn+JtYTEQqFQCQmkxVIiNFhcLwZoVtrFNt40ESrPEJju7s/eZM+f+Pn6Y2XVnZ3Zn0/fwcA7veZ/ze5//87zPMf56fJIHGB8Far3n20D79Nz1kU7GXw6G+MD3gdPAKdtxMJQFQJZEaK0bwBXg2Sfmrl87AHJi2LwJnAXOVf3xSrFcoVAuDyzKs4yw3SLY2iTqBC8BP31ibnZ+AHJ1MBIfeK7qeaeqno9l2+g4IQ86ILpvoXIczCMVAFob66wuLYXAmc/PXb/cB3nxsRN7AdfrY2MPe+Pj6Cjufnyk6Aa2XyfshLQ21glarae+8OrsxZ3N7JHoj3Xff9jzx8jWN8hbbdB6tOU5aXOVguNQ98YAfnv1+OTJHYgAPTt7pFY76Xk+2fo6kiSg8wEzLLMr25B32eoqjm0x8b5jpsBzLx6f9LsQARF8Ec7Vq1V0J0CSuM9ZFVxsr47t1RHHxq7XsL06Vq06AEqby5RLReq12lERzvbkEkC+VatWKpapyNtt6JERwfY9DMdmdW2NOwsLrCmDdxYWWFpaIopjbN/rarLLJw8C6rUqID/682MnTEsQgK9XSiV0nHQ17g2rViWOI95tLPOxJ89w4sx3sCvdarr3txnmf/kbqnFE3auTrqzu+OkgwC4WcAuuH0XRpBKhIsJkwbHJN9f79TcVG5tbPHruZ3z8qR/vAAA+8PgpPvf737Eehug8Rbn2gHQl10WE00rgw7ZtmdtVspMH2yKJY/TEBA996YsDVSsilD/0QR76ypfZ3GphFgp9AN3p4FgmAp9UIuIrQw2UpXJdwijGe+SRoQAArTXepz9FEEbdfOzylyxHddfWLEESLbpblrtPtM4AQafJvgARIY8iDMMY8DcM6a5BQiUY99I8H9hJHgSUHZvluVfRaToA2obc/8c/qbg2kqV9/oapyPIcwbinRKSRZnlb53l3R9vhRjGWAYV2i7cuXByIAmBx9l+sz8xQK7jkW1v9EKVI0hQRuWt+9dj7Bfhs0VSfKFZK6CDoq/lKucTya69x/+Y8pWPHcMd8Nu8s8M7lF5j/xa+ZKBVwTdWFbPsZBmaxwGIrINP6J8bzj34G4GTZcf7+kXqFtNns77SlMma5xEaUsBbGhFmGY5rUXBu/6GIpNeBjHz3KRpTw7lZ75ms3bzxudQXg5XaSzLbjZLI8Nka2srLrYLWRqEPdH6Pu2n0f050OaRD0l54yQIS1MELg5wDbEIBfrYbRCxW3MvDfkEyTLi+NavjdKMYn2Ixi2mn28jdu3nil1yCFnl3ZiNO3ozjtNb5DtPihbV+z2okRkfPDWn0uMLUSxhim9Z4AlufRThK20uzGN9/498wOhN0HUfSllShuZnmOKhXZ826kGYbBSicG0ed3S7g7EgRCgaebYYxZLvW/GWGW79HJM9bT7LbAn/oh/8/Jtk0vRkmotUY5zqGlMpSi2cvFt+dfz/dEYrDHmoLxh5Uwxjxy5FAAs1olynJWUn1XMJ7dW3FKGHpN3Y2yXEQwTDVSKuU6NKMEQaa+++brySBkUC5E5LaIXF2LE0zfR7Te11SpRJLlNJK8KSLPDDs76oA9Ti3H+UipVLHIUpggcOF7b73RHg4ZHgkicm0r17OtLMc6Oj5cpnKJXAv3U90Wken9uoAaUZzTS1GGIQxPeLFEI04RuPjkrfnN9wq5vKJ5OxTBrNb2JNtFFPw3lURg6qB+dpBciEguItONOEO5zkDZLoYpInLpB7fmGwdDRp/nS4sZzVQEVS6DCIZjIyIspOQC5xkx1O6/4D7WRuTpRpRhlkrdRlirsxRnIPL8D//z5p2RkH0O497rwt2cRBBUwQWExVwQZGQUPchAWxlmDcG41Eg0Zq1GM9EEoq4KxvyhIA/QaacXs+5z736+O3+YSEamZMduBaKuNFNhU9Q1EV6RwzEOnZOdxnk/7eZie+aQcj3QuLaJegZ46UGc/gcUeTtzDg/o4wAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxMi0wOC0xOFQxNDo1MDo1NiswMTowMBZQpF8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTItMDgtMThUMTQ6NTA6NTYrMDE6MDBnDRzjAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==",green:"data:image/png;base64,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"}},initialize:function(e,t){i.a.Util.extend(this.options,t);var o=null,n=this.images;switch(e){case"red":o=n.color.red;break;case"green":o=n.color.green;break;case"orange":o=n.color.orange;break;case"blue":o=n.color.blue;break;default:o=n.color.blue}this.options.iconUrl=o,this.options.shadowUrl=n.shadow,i.a.Browser.retina&&(this.options.iconRetinaUrl=o,this.options.shadowRetinaUrl=n.shadow)},_getIconUrl:function(e){return r.trace("OVERWRITTEN L.Icon.Default._getIconUrl("+e+")"),i.a.Icon.prototype._getIconUrl.call(this,e)}});t.a=s},function(e,t){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch(e){"object"==typeof window&&(o=window)}e.exports=o},function(e,t,o){},function(e,t,o){},function(e,t,o){(function(t,o){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var n;n=function(){"use strict";function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,r=void 0,s=void 0,a=function(e,t){m[i]=e,m[i+1]=t,2===(i+=2)&&(s?s(g):_())},l="undefined"!=typeof window?window:void 0,c=l||{},u=c.MutationObserver||c.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var e=setTimeout;return function(){return e(g,1)}}var m=new Array(1e3);function g(){for(var e=0;e<i;e+=2)(0,m[e])(m[e+1]),m[e]=void 0,m[e+1]=void 0;i=0}var f,v,y,E,_=void 0;function P(e,t){var o=this,n=new this.constructor(A);void 0===n[C]&&L(n);var i=o._state;if(i){var r=arguments[i-1];a((function(){return x(i,n,r,o._result)}))}else G(o,n,e,t);return n}function R(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(A);return w(t,e),t}d?_=function(){return t.nextTick(g)}:u?(v=0,y=new u(g),E=document.createTextNode(""),y.observe(E,{characterData:!0}),_=function(){E.data=v=++v%2}):p?((f=new MessageChannel).port1.onmessage=g,_=function(){return f.port2.postMessage(0)}):_=void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(r=e.runOnLoop||e.runOnContext)?function(){r(g)}:h()}catch(e){return h()}}():h();var C=Math.random().toString(36).substring(2);function A(){}function I(t,o,n){o.constructor===t.constructor&&n===P&&o.constructor.resolve===R?function(e,t){1===t._state?S(e,t._result):2===t._state?O(e,t._result):G(t,void 0,(function(t){return w(e,t)}),(function(t){return O(e,t)}))}(t,o):void 0===n?S(t,o):e(n)?function(e,t,o){a((function(e){var n=!1,i=function(e,t,o,n){try{e.call(t,o,n)}catch(e){return e}}(o,t,(function(o){n||(n=!0,t!==o?w(e,o):S(e,o))}),(function(t){n||(n=!0,O(e,t))}),e._label);!n&&i&&(n=!0,O(e,i))}),e)}(t,o,n):S(t,o)}function w(e,t){if(e===t)O(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)S(e,t);else{var o=void 0;try{o=t.then}catch(t){return void O(e,t)}I(e,t,o)}var n,i}function b(e){e._onerror&&e._onerror(e._result),k(e)}function S(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(k,e))}function O(e,t){void 0===e._state&&(e._state=2,e._result=t,a(b,e))}function G(e,t,o,n){var i=e._subscribers,r=i.length;e._onerror=null,i[r]=t,i[r+1]=o,i[r+2]=n,0===r&&e._state&&a(k,e)}function k(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var n=void 0,i=void 0,r=e._result,s=0;s<t.length;s+=3)n=t[s],i=t[s+o],n?x(o,n,i,r):i(r);e._subscribers.length=0}}function x(t,o,n,i){var r=e(n),s=void 0,a=void 0,l=!0;if(r){try{s=n(i)}catch(e){l=!1,a=e}if(o===s)return void O(o,new TypeError("A promises callback cannot return that same promise."))}else s=i;void 0!==o._state||(r&&l?w(o,s):!1===l?O(o,a):1===t?S(o,s):2===t&&O(o,s))}var T=0;function L(e){e[C]=T++,e._state=void 0,e._result=void 0,e._subscribers=[]}var D=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(A),this.promise[C]||L(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&S(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var o=this._instanceConstructor,n=o.resolve;if(n===R){var i=void 0,r=void 0,s=!1;try{i=e.then}catch(e){s=!0,r=e}if(i===P&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(o===M){var a=new o(A);s?O(a,r):I(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new o((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,o){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?O(n,o):this._result[t]=o),0===this._remaining&&S(n,this._result)},e.prototype._willSettleAt=function(e,t){var o=this;G(e,void 0,(function(e){return o._settledAt(1,t,e)}),(function(e){return o._settledAt(2,t,e)}))},e}(),M=function(){function t(e){this[C]=T++,this._result=this._state=void 0,this._subscribers=[],A!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){w(e,t)}),(function(t){O(e,t)}))}catch(t){O(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var o=this.constructor;return e(t)?this.then((function(e){return o.resolve(t()).then((function(){return e}))}),(function(e){return o.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return M.prototype.then=P,M.all=function(e){return new D(this,e).promise},M.race=function(e){var t=this;return n(e)?new t((function(o,n){for(var i=e.length,r=0;r<i;r++)t.resolve(e[r]).then(o,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},M.resolve=R,M.reject=function(e){var t=new this(A);return O(t,e),t},M._setScheduler=function(e){s=e},M._setAsap=function(e){a=e},M._asap=a,M.polyfill=function(){var e=void 0;if(void 0!==o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=M},M.Promise=M,M},e.exports=n()}).call(this,o(25),o(15))},function(e){e.exports=JSON.parse('{"_from":"geoportal-access-lib@3.2.0","_id":"geoportal-access-lib@3.2.0","_inBundle":false,"_integrity":"sha512-914Yk0C3mnYI+X56Y40t4OJwBiZ1nEbW8D9Dse4WcS54Au8ZpkZ9Ep1efNYMxC5618zqn7r4VvzF58Xa+BqzEQ==","_location":"/geoportal-access-lib","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"geoportal-access-lib@3.2.0","name":"geoportal-access-lib","escapedName":"geoportal-access-lib","rawSpec":"3.2.0","saveSpec":null,"fetchSpec":"3.2.0"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/geoportal-access-lib/-/geoportal-access-lib-3.2.0.tgz","_shasum":"7a707b75743f01b5465cc72d1316f13f8b87df7a","_spec":"geoportal-access-lib@3.2.0","_where":"/home/JPBazonnais/Projets/API/geoportal-extensions","author":{"name":"IGNF"},"bugs":{"url":"https://github.com/IGNF/geoportal-access-lib/issues"},"bundleDependencies":false,"date":"04/10/2022","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","xmldom":"^0.1.27"},"deprecated":false,"description":"French Geoportal resources access library","devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"homepage":"https://github.com/IGNF/geoportal-access-lib#readme","keywords":["geoportail","webservice","javascript","es6"],"license":"CECILL-B","main":"dist/GpServices-src.js","module":"src/Gp.js","name":"geoportal-access-lib","nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"optionalDependencies":{},"peerDependencies":{},"repository":{"type":"git","url":"git+https://github.com/IGNF/geoportal-access-lib.git"},"scripts":{"build":"webpack --mode=none","build:dev":"webpack --mode=development","build:prod":"webpack --mode=production","clean":"echo \\"Warning: no yet implemented!\\" && exit 0","cover":"nyc --reporter=lcov --reporter=text npm run test","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open","eslint":"eslint src/","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","setup":"npm install","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js"},"version":"3.2.0"}')},function(e,t){e.exports=void 0},function(e,t,o){"use strict";var n=o(2),i=o(1);function r(){if(!(this instanceof r))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}r.prototype={constructor:r};var s=r;function a(){if(!(this instanceof a))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position=null,this.matchType=null,this.placeAttributes={},this.type=null,this.accuracy=null,this.CLASSNAME="GeocodedLocation"}a.prototype={constructor:a};var l=a;function c(){if(!(this instanceof c))throw new TypeError("GeocodeResponseParser constructor cannot be called as a function.")}function u(e,t){var o=new l;if(e.geometry&&"Point"===e.geometry.type&&(o.position={lon:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]}),e.properties){for(var n in e.properties)"_score"===n?o.accuracy=e.properties[n]:"_type"===n?"address"===e.properties[n]?o.type="StreetAddress":"poi"===e.properties[n]?o.type="PositionOfInterest":"parcel"===e.properties[n]&&(o.type="CadastralParcel"):o.placeAttributes[n]=e.properties[n];"address"===e.properties._type&&(o.matchType=void 0!==e.properties.number&&null!==e.properties.number?"street number":"street")}t.locations.push(o)}c.prototype={constructor:c,parse:function(e){var t=new s;const o=JSON.parse(e);if("FeatureCollection"===o.type)for(var r=0;r<o.features.length;++r)u(o.features[r],t);else{if("Feature"!==o.type){if("SERVICE_ERROR"===o.type)return{exceptionReport:o};var a=i.a.getMessage("SERVICE_RESPONSE_ANALYSE",o.type);throw new n.a({message:a,type:n.a.TYPE_UNKERR,status:200})}u(o,t)}return t}};var d=c,p={build:function(e){var t=null;if(e.response){if(e.rawResponse)t=e.response;else{try{if(!(t=(new d).parse(e.response)))throw new Error("L'analyse de la réponse du service !?")}catch(t){var o=t.message;return"string"==typeof e.response?o+="('"+e.response+"')":o+="('"+e.response.documentElement.innerHTML+"')",void e.onError.call(e.scope,new n.a({message:i.a.getMessage("SERVICE_RESPONSE_ANALYSE",o),type:n.a.TYPE_UNKERR,status:-1}))}if(t.exceptionReport)return void e.onError.call(e.scope,new n.a({message:i.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:n.a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,t)}else e.onError.call(e.scope,new n.a({message:i.a.getMessage("SERVICE_RESPONSE_EMPTY"),type:n.a.TYPE_SRVERR,status:-1}))}};t.a=p},function(e,t,o){"use strict";var n=o(3),i=o(1);function r(e){if(!(this instanceof r))throw new TypeError("GeocodeParamREST constructor cannot be called as a function.");if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur GeocodeParamREST ()]"),this.options=e||{},!this.options.geocodeMethod||"search"!==this.options.geocodeMethod&&"reverse"!==this.options.geocodeMethod)throw new Error("Error geocodeMethod not valid");this.geocodeMethod=this.options.geocodeMethod,this.query=void 0!==this.options?this.options.query:null,this.searchGeometry=this.options.searchGeometry||null,this.index=this.options.index||null,this.lon=this.options.position&&this.options.position.lon?this.options.position.lon:null,this.lat=this.options.position&&this.options.position.lat?this.options.position.lat:null,this.maxResp=this.options.maxResp||null,this.returnTrueGeometry=this.options.returnTrueGeometry||null,this.filters=this.options.filters||{}}r.CLASSNAME="GeocodeParamREST",r.prototype={constructor:r,getFilters:function(){var e={};for(var t in this.filters)this.filters.hasOwnProperty(t)&&(e[t]=this.filters[t]);return e},getIndex:function(){return void 0===this.index?null:"StreetAddress"===this.index?"address":"CadastralParcel"===this.index?"parcel":"PositionOfInterest"===this.index?"poi":"location"===this.index?"location":this.index},getSearchGeometry:function(){return JSON.stringify(this.searchGeometry)}},r.prototype.getParams=function(){var e=[];"search"===this.geocodeMethod&&e.push({k:"q",v:this.query}),this.index&&e.push({k:"index",v:this.getIndex()}),"reverse"===this.geocodeMethod&&e.push({k:"searchgeom",v:this.getSearchGeometry()}),this.lon&&this.lat&&(e.push({k:"lon",v:this.lon}),e.push({k:"lat",v:this.lat})),this.maxResp&&e.push({k:"limit",v:this.maxResp}),this.returnTrueGeometry&&e.push({k:"returntruegeometry",v:this.returnTrueGeometry});const t=this.getFilters();for(var o in t)e.push({k:o,v:t[o]});return e};var s=r;function a(e){if(this.logger=n.a.getLogger("GeocodeRequestREST"),this.logger.trace("[Constructeur GeocodeRequestREST ()]"),!(this instanceof a))throw new TypeError("GeocodeRequestREST constructor cannot be called as a function.");if(!e)throw new Error(i.a.getMessage("PARAM_EMPTY","options"));this.settings=e}a.prototype={requestString:null,constructor:a,processRequestString:function(){var e="";const t=new s(this.settings).getParams();for(var o=0;o<t.length;o++){var n=t[o];e&&(e+="&"),e+=n.k+"="+n.v}if(!this.settings.geocodeMethod||"search"!==this.settings.geocodeMethod&&"reverse"!==this.settings.geocodeMethod)throw new Error("Error geocodeMethod not valid");return this.requestString="?"+e,this.logger.trace(this.requestString),this.requestString}};var l=a,c={build:function(e){var t=n.a.getLogger("GeocodeRequestFactory");t.trace(["GeocodeRequestFactory::build()"]);var o=new l(e||{});if(!o.processRequestString())throw new Error("Error process request (rest) !");var i=o.requestString;return t.trace(i),i}};t.a=c},,function(e,t,o){"use strict";var n=o(28),i=o(27),r=o(0),s=o.n(r),a=(o(16),o(35),o(17),o(36),o(5)),l=o(10),c=o(4),u=o(11),d=a.a.getLogger("LocationSelectorDOM"),p={_addUID:function(e){return this._uid?e+"-"+this._uid:e},_createMainContainerElement:function(){var e=document.createElement("div");return e.className=this._addUID("GPlocationPoint"),e.className+=" GPwidget",e},_createLocationPointElement:function(e,t){var o=document.createElement("div");return o.id=this._addUID("GPlocationPoint_"+e),o.className=t?"GPflexInput GPlocationStageFlexInput":"GPflexInput GPlocationStageFlexInputHidden",o.style.cssText="",o},_createLocationPointLabelElement:function(e,t){var o=this,n=document.createElement("label");return n.id=this._addUID("GPlocationOriginLabel_"+e),n.htmlFor=this._addUID("GPlocationOrigin_"+e),n.innerHTML=t,n.addEventListener("click",(function(e){for(var t=c.a.index(this.id),n=document.getElementsByClassName(o._addUID("GPlocationPoint")),i=0;i<n.length;i++){var r=n[i].childNodes[0].id,s=c.a.index(r);document.getElementById(o._addUID("GPlocationPoint_"+s)).style.cssText=""}document.getElementById(o._addUID("GPlocationOriginCoords_"+t)).value="",document.getElementById(o._addUID("GPlocationOrigin_"+t)).value="",document.getElementById(o._addUID("GPlocationPoint_"+t)).style.cssText="",document.getElementById(o._addUID("GPlocationOriginPointer_"+t)).checked=!1,document.getElementById(o._addUID("GPlocationOrigin_"+t)).className="GPlocationOriginVisible",document.getElementById(o._addUID("GPlocationOriginCoords_"+t)).className="GPlocationOriginHidden",document.getElementById(o._addUID("GPlocationStageRemove_"+t))&&(document.getElementById(o._addUID("GPlocationStageRemove_"+t)).className="GPlocationStageRemove"),document.getElementById(o._addUID("GPlocationStageAdd"))&&(document.getElementById(o._addUID("GPlocationStageAdd")).className=""),o.onLocationClearPointClick(e)})),n},_createLocationAutoCompleteteInputElement:function(e){var t=this,o=document.createElement("input");return o.id=this._addUID("GPlocationOrigin_"+e),o.className="GPlocationOriginVisible",o.type="text",o.placeholder="Saisir une adresse",o.autocomplete="off",o.addEventListener("keyup",(function(e){var o=e.which||e.keyCode;if(13!==o&&10!==o&&38!==o&&40!==o){var n=c.a.index(this.id);document.getElementById(t._addUID("GPlocationOrigin_"+n)).value.length>2?document.getElementById(t._addUID("GPlocationAutoCompleteList_"+n)).style.display="block":document.getElementById(t._addUID("GPlocationAutoCompleteList_"+n)).style.display="none",t.onAutoCompleteSearchText(e)}})),o.addEventListener("keydown",(function(o){var n=o.which||o.keyCode,i=document.getElementById(t._addUID("GPlocationAutoCompleteList_"+e));if(i){var r=i.getElementsByClassName("GPautoCompleteProposal current"),s=i.getElementsByClassName("GPautoCompleteProposal"),a=s.length;if(a){var l=null;if(!r.length)return(l=s[0]).className="GPautoCompleteProposal current",l.style.color="#000000",void(l.style["background-color"]="#CEDBEF");l=r[0];var u=parseInt(c.a.index(l.id),10),p=u===a-1?s[0]:s[u+1],h=0===u?s[a-1]:s[u-1];switch(l.style["background-color"]="",l.style.color="",h.style["background-color"]="",h.style.color="",p.style["background-color"]="",p.style.color="",n){case 38:d.log("arrow up"),l.className="GPautoCompleteProposal",h.className="GPautoCompleteProposal current",h.style.color="#000000",h.style["background-color"]="#CEDBEF";break;case 40:d.log("arrow down"),l.className="GPautoCompleteProposal",p.className="GPautoCompleteProposal current",p.style.color="#000000",p.style["background-color"]="#CEDBEF";break;case 13:d.log("enter"),l.click(o)}l.focus()}}})),o},_createLocationCoordinateInputElement:function(e){var t=this,o=document.createElement("input");return o.id=this._addUID("GPlocationOriginCoords_"+e),o.className="GPlocationOriginHidden",o.type="text",o.disabled=!1,o.addEventListener("click",(function(){var e=c.a.index(this.id);document.getElementById(t._addUID("GPlocationOriginLabel_"+e)).click()})),o},_createLocationPointerShowInputElement:function(e){var t=document.createElement("input");return t.id=this._addUID("GPlocationOriginPointer_"+e),t.type="checkbox",t},_createLocationPointerInputElement:function(e){var t=this,o=document.createElement("label");return o.id=this._addUID("GPlocationOriginPointerImg_"+e),o.htmlFor=this._addUID("GPlocationOriginPointer_"+e),o.className="GPlocationOriginPointerImg",o.title="Pointer un lieu sur la carte",o.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();var o,n,i,r=c.a.index(this.id),s=document.getElementsByClassName(t._addUID("GPlocationPoint"));for(o=0;o<s.length;o++)n=s[o].childNodes[0].id,r!==(i=c.a.index(n))&&(document.getElementById(t._addUID("GPlocationOriginPointer_"+i)).checked=!1,"Pointer un lieu sur la carte"===document.getElementById(t._addUID("GPlocationOriginCoords_"+i)).value&&(document.getElementById(t._addUID("GPlocationOriginCoords_"+i)).value="",document.getElementById(t._addUID("GPlocationOrigin_"+i)).className="GPlocationOriginVisible",document.getElementById(t._addUID("GPlocationOriginCoords_"+i)).className="GPlocationOriginHidden"));if(document.getElementById(t._addUID("GPlocationOriginPointer_"+r)).checked){for(document.getElementById(t._addUID("GPlocationOriginCoords_"+r)).value="",o=0;o<s.length;o++)n=s[o].childNodes[0].id,i=c.a.index(n),document.getElementById(t._addUID("GPlocationPoint_"+i)).style.cssText="";document.getElementById(t._addUID("GPlocationStageRemove_"+r))&&(document.getElementById(t._addUID("GPlocationStageRemove_"+r)).className="GPlocationStageRemove"),document.getElementById(t._addUID("GPlocationStageAdd"))&&(document.getElementById(t._addUID("GPlocationStageAdd")).className=""),document.getElementById(t._addUID("GPlocationOriginPointer_"+r)).checked=!1,document.getElementById(t._addUID("GPlocationOrigin_"+r)).className="GPlocationOriginVisible",document.getElementById(t._addUID("GPlocationOriginCoords_"+r)).className="GPlocationOriginHidden"}else{for(document.getElementById(t._addUID("GPlocationOriginCoords_"+r)).value="Pointer un lieu sur la carte",o=0;o<s.length;o++)n=s[o].childNodes[0].id,r===(i=c.a.index(n))?document.getElementById(t._addUID("GPlocationPoint_"+i)).style.cssText="":document.getElementById(t._addUID("GPlocationPoint_"+i)).style.display="none";document.getElementById(t._addUID("GPlocationStageRemove_"+r))&&(document.getElementById(t._addUID("GPlocationStageRemove_"+r)).className="GPlocationOriginHidden"),document.getElementById(t._addUID("GPlocationStageAdd"))&&(document.getElementById(t._addUID("GPlocationStageAdd")).className="GPlocationOriginHidden"),document.getElementById(t._addUID("GPlocationOriginPointer_"+r)).checked=!0,document.getElementById(t._addUID("GPlocationOrigin_"+r)).className="GPlocationOriginHidden",document.getElementById(t._addUID("GPlocationOriginCoords_"+r)).className="GPlocationOriginVisible",document.getElementById(t._addUID("GPlocationOriginCoords_"+r)).disabled=!0}t.onActivateMapPointClick(e)})),o},_createLocationRemovePointElement:function(e){var t=this,o=document.createElement("div");return o.id=this._addUID("GPlocationStageRemove_"+e),o.className="GPlocationStageRemove",o.title="Supprimer l'étape",o.addEventListener("click",(function(o){var n=document.getElementsByClassName(t._addUID("GPlocationPoint")),i=n.length-1,r=n[0].childNodes[0].id,s=n[i].childNodes[0].id,a=c.a.index(r),l=c.a.index(s);if(e!==a&&e!==l){var u=c.a.index(this.id);document.getElementById(t._addUID("GPlocationPoint_"+u)).className="GPflexInput GPlocationStageFlexInputHidden",document.getElementById(t._addUID("GPlocationOrigin_"+u)).value="",document.getElementById(t._addUID("GPlocationOrigin_"+u)).className="GPlocationOriginVisible",document.getElementById(t._addUID("GPlocationOriginCoords_"+u)).value="",document.getElementById(t._addUID("GPlocationOriginCoords_"+u)).className="GPlocationOriginHidden",document.getElementById(t._addUID("GPlocationStageAdd")).style.display="",t.onLocationRemovePointClick(o)}})),o},_createLocationAddPointElement:function(){var e=this,t=document.createElement("div");return t.id=this._addUID("GPlocationStageAdd"),t.title="Ajouter une étape",t.addEventListener("click",(function(t){for(var o=1,n=0,i=document.getElementsByClassName(e._addUID("GPlocationPoint")),r=1;r<i.length-1;r++){var s=i[r].childNodes[0].id,a=c.a.index(s);document.getElementById(e._addUID("GPlocationPoint_"+a))&&("GPflexInput GPlocationStageFlexInputHidden"===document.getElementById(e._addUID("GPlocationPoint_"+a)).className?1===o&&(o=a):n++)}o<i.length&&(document.getElementById(e._addUID("GPlocationPoint_"+o)).className="GPflexInput GPlocationStageFlexInput"),4===n&&(document.getElementById(e._addUID("GPlocationStageAdd")).style.display="none"),e.onLocationAddPointClick(t)})),t},_createLocationAutoCompleteResultElement:function(e){var t=this,o=document.createElement("div");return o.id=this._addUID("GPlocationAutoCompleteList_"+e),o.className="GPadvancedAutoCompleteList",o.addEventListener?o.addEventListener("click",(function(o){t.onAutoCompletedResultsItemClick(o),document.getElementById(t._addUID("GPlocationAutoCompleteList_"+e)).style.display="none"}),!1):o.attachEvent&&o.attachEvent("onclick",(function(o){t.onAutoCompletedResultsItemClick(o),document.getElementById(t._addUID("GPlocationAutoCompleteList_"+e)).style.display="none"})),o},_createLocationAutoCompletedLocationElement:function(e,t,o){var n=document.getElementById(this._addUID("GPlocationAutoCompleteList_"+e)),i=document.createElement("div");i.id=this._addUID("AutoCompletedLocation_"+o),i.className="GPautoCompleteProposal",i.innerHTML=u.a.getSuggestedLocationFreeform(t),n.appendChild(i)},GPdisplayCoordinate:function(e){for(var t=document.getElementsByClassName(this._addUID("GPlocationPoint")),o=0;o<t.length;o++){var n=t[o].childNodes[0].id,i=c.a.index(n);if(document.getElementById(this._addUID("GPlocationOriginPointer_"+i)).checked){document.getElementById(this._addUID("GPlocationOriginCoords_"+i)).value=e,document.getElementById(this._addUID("GPlocationOriginCoords_"+i)).disabled=!1;for(var r=0;r<t.length;r++){n=t[r].childNodes[0].id;var s=c.a.index(n);document.getElementById(this._addUID("GPlocationPoint_"+s)).style.cssText="",document.getElementById(this._addUID("GPlocationStageRemove_"+s))&&(document.getElementById(this._addUID("GPlocationStageRemove_"+s)).className="GPlocationStageRemove")}return document.getElementById(this._addUID("GPlocationOriginPointer_"+i)).checked=!1,void(document.getElementById(this._addUID("GPlocationStageAdd"))&&(document.getElementById(this._addUID("GPlocationStageAdd")).className=""))}}}},h=o(13),m=o(14),g=a.a.getLogger("locationselector"),f=s.a.Control.extend({includes:p,options:{position:"topleft",tag:{id:0,unique:null,label:">",color:"blue",display:!0,addOption:!1,removeOption:!1},disableReverse:!1,displayInfo:!0,autocompleteOptions:{},reverseGeocodeOptions:{}},initialize:function(e){s.a.Util.setOptions(this,e),this._uid=this.options.tag.unique||null,this._activeDragAndDrop=!1,this._pressedKeyOnDragAndDrop=!1,this._map=null,this._inputsContainer=null,this._inputLabelContainer=null,this._inputAutoCompleteContainer=null,this._inputShowPointerContainer=null,this._inputCoordinateContainer=null,this._coordinate=null,this._suggestedContainer=null,this._suggestedLocations=[],this._currentLocation=null,this._marker=null,this._resources={},this._noRightManagement=!1,this._checkRightsManagement(),this._container=this._uid?this._initLayout():null},onAdd:function(){this._uid=c.a.generate();var e=this._initLayout();return s.a.DomEvent.disableClickPropagation(e).disableScrollPropagation(e),e},onRemove:function(){},getCoordinate:function(){return this._coordinate},setCoordinate:function(e){this._displayResultOfCoordinate(e)},setMap:function(e){this._map||(this._map=e)},clear:function(){this._setCursor(),this._setMarker(),this._clearResults(),this._inputLabelContainer.click()},dragging:function(e){this._marker&&(e?this._marker.dragging.enable():this._marker.dragging.disable())},_initLayout:function(){var e=this.options.tag.id,t=this._createMainContainerElement(),o=this._inputsContainer=this._createLocationPointElement(e,this.options.tag.display);t.appendChild(o);var n=this._inputLabelContainer=this._createLocationPointLabelElement(e,this.options.tag.label);o.appendChild(n);var i=this._inputAutoCompleteContainer=this._createLocationAutoCompleteteInputElement(e);o.appendChild(i);var r=this._inputCoordinateContainer=this._createLocationCoordinateInputElement(e);o.appendChild(r);var s=this._inputShowPointerContainer=this._createLocationPointerShowInputElement(e);o.appendChild(s);var a=this._createLocationPointerInputElement(e);if(o.appendChild(a),this.options.tag.addOption){var l=this._createLocationAddPointElement();o.appendChild(l)}if(this.options.tag.removeOption){var c=this._createLocationRemovePointElement(e);o.appendChild(c)}var u=this._suggestedContainer=this._createLocationAutoCompleteResultElement(e);return t.appendChild(u),t},_checkRightsManagement:function(){var e=null,t=null;t=this.options.reverseGeocodeOptions.apiKey,(e=this.options.reverseGeocodeOptions.index?this.options.reverseGeocodeOptions.index:"")||(e="StreetAddress"),"location"===e?e=["StreetAddress","PositionOfInterest","CadastralParcel"]:Array.isArray(e)||(e=[e]);var o=l.a.check({key:t||this.options.apiKey,resources:e,services:["ReverseGeocode"]});t=this.options.autocompleteOptions.apiKey,(e=this.options.autocompleteOptions.type?this.options.autocompleteOptions.type:[])&&0!==e.length||(e=["StreetAddress","PositionOfInterest"]);var n=l.a.check({key:t||this.options.apiKey,resources:e,services:["AutoCompletion"]});o||n||(this._noRightManagement=!0),n&&(this._resources.AutoCompletion={},this._resources.AutoCompletion.resources=n.AutoCompletion,this._resources.AutoCompletion.key=n.key),o&&(this._resources.ReverseGeocode={},this._resources.ReverseGeocode.resources=o.ReverseGeocode,this._resources.ReverseGeocode.key=o.key)},_setLabel:function(e){this._inputAutoCompleteContainer.value=e||""},_setCoordinate:function(e){this._coordinate=e;var t;t=h.a.roundToDecimal(e.lat,4);var o=h.a.roundToDecimal(e.lng,4)+" , "+t;this.GPdisplayCoordinate(o)},_setPosition:function(e){g.log("_setPosition()",e),this._map.panTo(s.a.latLng(e))},_setMarker:function(e,t,o){if(g.log("_setMarker()",e,t,o),!this._activeDragAndDrop){var n=this._map;if(null!=this._marker&&(this._marker.off("mousedown",this.onMouseDownMarker,this),this._marker.off("dragstart",this.onStartDragMarker,this),this._marker.off("drag",this.onDragMarker,this),this._marker.off("dragend",this.onEndDragMarker,this),n.removeLayer(this._marker),this._marker=null),e){var i={icon:new m.a(this.options.tag.color),draggable:!0,clickable:!0,zIndexOffset:1e3};if(this._marker=s.a.marker(s.a.latLng(e),i),this._marker.on("mousedown",this.onMouseDownMarker,this),this._marker.on("dragstart",this.onStartDragMarker,this),this._marker.on("drag",this.onDragMarker,this),this._marker.on("dragend",this.onEndDragMarker,this),this._marker.addTo(n),o){var r=null;r="string"!=typeof t?"GeocodedLocation"===t.service?u.a.getGeocodedLocationFreeform(t.location):"SuggestedLocation"===t.service?u.a.getSuggestedLocationFreeform(t.location):"sans informations.":t,this._marker.bindPopup(r)}}}},_setCursor:function(e){var t=this._map.getContainer();t.style.cursor=e||null},_clearResults:function(){this._currentLocation=null,this._coordinate=null,this._clearSuggestedLocation()},_clearSuggestedLocation:function(){if(this._suggestedLocations=[],this._suggestedContainer)for(;this._suggestedContainer.firstChild;)this._suggestedContainer.removeChild(this._suggestedContainer.firstChild)},_requestAutoComplete:function(e){if(g.log("_requestAutoComplete()",e),e&&0!==Object.keys(e).length&&e.text)if(g.log(e),this._noRightManagement)g.log("no rights for all service !?");else if(this._resources.AutoCompletion){var t=this._resources.AutoCompletion.resources;if(t&&0!==Object.keys(t).length){var o=this._resources.AutoCompletion.key,i={};s.a.Util.extend(i,this.options.autocompleteOptions),s.a.Util.extend(i,e),s.a.Util.extend(i,{apiKey:i.apiKey||this.options.apiKey||o}),g.log(i),new n.a(i).call()}}else g.log("no rights for this service !?")},_fillAutoCompletedLocationListContainer:function(e){if(g.log("_fillAutoCompletedLocationListContainer()",e),e&&0!==e.length){var t=this._suggestedContainer;if(t.childElementCount)for(;t.firstChild;)t.removeChild(t.firstChild);for(var o=0;o<e.length;o++)this._createLocationAutoCompletedLocationElement(this.options.tag.id,e[o],o);this._suggestedLocations=e}},_requestReverseGeocode:function(e){if(g.log("_requestReverseGeocode()",e),e&&0!==Object.keys(e).length&&e.searchGeometry&&0!==Object.keys(e.searchGeometry).length)if(this._noRightManagement)g.log("no rights for all service !?");else if(this._resources.ReverseGeocode){var t=this._resources.ReverseGeocode.resources;if(t&&0!==Object.keys(t).length){var o=this._resources.ReverseGeocode.key,n={};s.a.Util.extend(n,this.options.reverseGeocodeOptions),s.a.Util.extend(n,e),s.a.Util.extend(n,{returnFreeForm:!0,index:"StreetAddress"}),s.a.Util.extend(n,{apiKey:n.apiKey||this.options.apiKey||o}),g.log(n),new i.a(n).call()}}else g.log("no rights for this service !?")},_displayResultOfCoordinate:function(e){this._setCoordinate(e),this._setMarker(e,null,!1),g.log(this.getCoordinate()),this.onActivateMapPointClick()},_displayResultOfLabel:function(e){var t=u.a.getGeocodedLocationFreeform(e);this._setCoordinate({lat:e.position.lat,lng:e.position.lon}),this._setLabel(t);var o={service:"GeocodedLocation",location:e};this._setMarker(e.position,o,!0),this._inputShowPointerContainer.checked=!1,this._inputAutoCompleteContainer.className="GPlocationOriginVisible",this._inputCoordinateContainer.className="GPlocationOriginHidden",this.onActivateMapPointClick()},onAutoCompleteSearchText:function(e){g.log("onAutoCompleteSearchText()",e);var t=e.target.value;if(t)if(this._noRightManagement)g.log("no rights for this service !?");else if(this._currentLocation=t,!(t.length<3)){var o=this;this._requestAutoComplete({text:t,maximumResponses:5,onSuccess:function(e){if(g.log(e),e){var t=e.suggestedLocations;o._fillAutoCompletedLocationListContainer(t)}},onFailure:function(e){o._clearSuggestedLocation(),g.log(e.message)}})}},onAutoCompletedResultsItemClick:function(e){g.log("onAutoCompletedResultsItemClick()",e);var t=c.a.index(e.target.id);if(g.log(t),g.log(this._suggestedLocations[t]),t){var o={lon:this._suggestedLocations[t].position.x,lat:this._suggestedLocations[t].position.y},n={service:"SuggestedLocation",location:this._suggestedLocations[t]},i=u.a.getSuggestedLocationFreeform(this._suggestedLocations[t]);this._setLabel(i),this._setPosition(o),this._setMarker(o,n,this.options.displayInfo),this._coordinate=o}},onActivateMapPointClick:function(e){g.trace("onActivateMapPointClick()",e);var t=this._map;this._inputShowPointerContainer.checked?this._activeDragAndDrop||(t.on("click",this.onMouseMapClick,this),this._setCursor("crosshair"),this._setMarker(),this._clearResults()):this._activeDragAndDrop||(t.off("click",this.onMouseMapClick,this),this._setCursor())},onLocationClearPointClick:function(e){g.log("onLocationClearPointClick",e),this._setCursor(),this._setMarker(),this._clearResults(),this._inputAutoCompleteContainer.focus()},onLocationRemovePointClick:function(e){g.log("onLocationRemovePointClick",e),this._setCursor(),this._setMarker(),this._clearResults()},onLocationAddPointClick:function(e){g.log("onLocationAddPointClick",e)},onMouseMapClick:function(e){g.log("onMouseMapClick",e);var t=e.latlng;if(this.options.disableReverse||this._noRightManagement)this._displayResultOfCoordinate(t);else{var o=this;this._requestReverseGeocode({searchGeometry:{type:"Circle",coordinates:[t.lng,t.lat],radius:50},maximumResponses:1,onSuccess:function(e){if(g.log(e),0!==e.locations.length){var n=e.locations[0];o._displayResultOfLabel(n)}else o._displayResultOfCoordinate(t)},onFailure:function(e){g.log(e.message),o._displayResultOfCoordinate(t)}})}},onStartDragMarker:function(){this._marker&&(this._activeDragAndDrop=!0,this._inputShowPointerContainer.checked=!0,this._inputAutoCompleteContainer.className="GPlocationOriginHidden",this._inputCoordinateContainer.className="GPlocationOriginVisible",this._marker.unbindPopup(),this._setLabel(),this._clearResults())},onDragMarker:function(){if(this._marker){this._activeDragAndDrop=!1,this._inputShowPointerContainer.checked=!0;var e=this._marker.getLatLng();this._setCoordinate(e)}},onEndDragMarker:function(){if(this._marker){this._inputShowPointerContainer.checked=!0;var e=this._marker.getLatLng();this._pressedKeyOnDragAndDrop?this._setCoordinate(e):(g.log("No key pressed, so autocomplete solution !"),this.onMouseMapClick({latlng:e})),this._activeDragAndDrop=!1,this._pressedKeyOnDragAndDrop=!1}},onMouseDownMarker:function(e){this._marker&&(this._pressedKeyOnDragAndDrop=e.originalEvent.ctrlKey)}});t.a=f},function(e,t){var o,n,i=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(o===setTimeout)return setTimeout(e,0);if((o===r||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(t){try{return o.call(null,e,0)}catch(t){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:r}catch(e){o=r}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,c=[],u=!1,d=-1;function p(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&h())}function h(){if(!u){var e=a(p);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];c.push(new m(e,t)),1!==c.length||u||a(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){e.exports=void 0},function(e,t,o){"use strict";var n=o(3),i=o(1),r=o(2),s=o(9),a=o(22),l=o(21);function c(e){if(!(this instanceof c))throw new TypeError(i.a.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));this.CLASSNAME="ReverseGeocode",this.logger=n.a.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]");var t=this.patchOptionConvertor(e);if(t.serverUrl=t.serverUrl||"https://wxs.ign.fr/calcul/geoportail/geocodage/rest/0.1/reverse",s.a.apply(this,[t]),!t.searchGeometry)throw new Error(i.a.getMessage("PARAM_MISSING","searchGeometry"));if(this.options.searchGeometry=t.searchGeometry,t.index||(this.options.index=t.index="StreetAddress"),t.filters)for(var o=Object.keys(t.filters),r=0;r<o.length;r++){var a=o[r];(void 0===t.filters[a]||"object"==typeof t.filters[a]&&0===Object.keys(t.filters[a]).length||"string"==typeof t.filters[a]&&0===t.filters[a].length||Array.isArray(t.filters[a])&&0===t.filters[a].length)&&delete this.options.filters[a]}this.options.position=t.position,this.options.index=t.index||"StreetAddress",this.options.maximumResponses=t.maximumResponses||20}c.prototype=Object.create(s.a.prototype,{}),c.prototype.constructor=c,c.prototype.patchOptionConvertor=function(e){var t=e;return t.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),t.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),t.index||(Array.isArray(t.filterOptions.type)&&t.filterOptions.type.length>0?t.index=t.filterOptions.type[0]:t.index=t.filterOptions.type),delete t.filterOptions.type),t.filterOptions.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),t.searchGeometry||(t.searchGeometry=this.bbox2Json(t.filterOptions.bbox)),delete t.filterOptions.bbox),t.filterOptions.circle&&(this.logger.warn("The parameter 'filterOptions.circle' is deprecated"),t.searchGeometry||(t.searchGeometry=this.circle2Json(t.filterOptions.circle)),delete t.filterOptions.circle),t.filterOptions.polygon&&(this.logger.warn("The parameter 'filterOptions.polygon' is deprecated"),t.searchGeometry||(t.searchGeometry=this.polygon2Json(t.filterOptions.polygon)),delete t.filterOptions.polygon),!t.filters&&Object.keys(t.filterOptions).length>0&&(t.filters=t.filterOptions),delete t.filterOptions),t.position&&(t.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),t.position.lon||(t.position.lon=t.position.x),delete t.position.x),t.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),t.position.lat||(t.position.lat=t.position.y),delete t.position.y)),t.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete t.srs),t},c.prototype.buildRequest=function(e,t){var o={httpMethod:this.options.httpMethod,geocodeMethod:"reverse",searchGeometry:this.options.searchGeometry,index:this.options.index,position:this.options.position,returnTrueGeometry:this.options.returnTrueGeometry,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=a.a.build(o),this.request?t.call(this,this.request):e.call(this,new r.a(i.a.getMessage("SERVICE_REQUEST_BUILD")))},c.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};l.a.build(o)}else e.call(this,new r.a(i.a.getMessage("SERVICE_RESPONSE_EMPTY")))},c.prototype.bbox2Json=function(e){return{type:"Polygon",coordinates:[[[e.left,e.top],[e.right,e.top],[e.right,e.bottom],[e.left,e.bottom],[e.left,e.top]]]}},c.prototype.circle2Json=function(e){return{type:"Circle",radius:e.radius,coordinates:[e.x,e.y]}},c.prototype.polygon2Json=function(e){for(var t={type:"Polygon",coordinates:[[]]},o=0;o<e.length;++o)t.coordinates[0].push([e[o].x,e[o].y]);return t},c.geoEPSG=["EPSG:4326"],t.a=c},function(e,t,o){"use strict";var n=o(9),i=o(3),r=o(1),s=o(2);function a(){if(!(this instanceof a))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}a.prototype={constructor:a};var l=a;function c(){if(!(this instanceof c))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}c.prototype={constructor:c};var u=c,d={build:function(e){var t=i.a.getLogger("AutoCompleteResponseFactory");t.trace(["AutoCompleteResponseFactory::build()"]);var o=null;if(e.response){if(e.rawResponse)t.trace("analyze response : raw"),o=e.response;else{var n=null;if(n="string"==typeof e.response?JSON.parse(e.response):e.response){if(n.error)return void e.onError.call(e.scope,new s.a({message:r.a.getMessage("SERVICE_RESPONSE_EXCEPTION",n.error.description),status:n.error.code,type:s.a.TYPE_SRVERR}));if(o=new l,!n.results||!Array.isArray(n.results))return void e.onError.call(e.scope,new s.a(r.a.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var a=null,c=0;c<n.results.length;c++){var d=n.results[c];a=new u,d&&("StreetAddress"===d.country?(a.street=d.street,a.type="StreetAddress"):"PositionOfInterest"===d.country&&(a.poi=d.street,a.kind=d.kind,a.type="PositionOfInterest"),a.position&&(a.position.x=d.x,a.position.y=d.y),a.commune=d.city,a.fullText=d.fulltext,a.postalCode=d.zipcode,a.classification=d.classification),o.suggestedLocations.push(a)}if(!o.suggestedLocations.length)return void e.onError.call(e.scope,new s.a(r.a.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!o)return void e.onError.call(e.scope,new s.a({message:r.a.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:s.a.TYPE_UNKERR,status:-1}));if(o.exceptionReport)return void e.onError.call(e.scope,new s.a({message:r.a.getMessage("SERVICE_RESPONSE_EXCEPTION",o.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,o)}else e.onError.call(e.scope,new s.a(r.a.getMessage("SERVICE_RESPONSE_EMPTY")))}},p=o(7);function h(e){if(!(this instanceof h))throw new TypeError(r.a.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));this.CLASSNAME="AutoComplete",this.logger=i.a.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]");var t=this.patchOptionConvertor(e);if(t.serverUrl=t.serverUrl||"https://wxs.ign.fr/calcul/geoportail/geocodage/rest/0.1/completion",n.a.apply(this,arguments),!t.text)throw new Error(r.a.getMessage("PARAM_MISSING","text"));this.options.text=t.text,t.type||(t.type=["StreetAddress,PositionOfInterest"]),this.options.type=t.type,this.options.territory=t.territory||"",this.options.maximumResponses=t.maximumResponses||10,"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}h.prototype=Object.create(n.a.prototype,{}),h.prototype.constructor=h,h.prototype.patchOptionConvertor=function(e){const t=e;return t.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),t.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),t.type||(t.type=t.filterOptions.type)),t.filterOptions.territory&&(this.logger.warn("The parameter 'filterOptions.territory' is deprecated"),t.terr||(t.terr=t.filterOptions.territory)),delete t.filterOptions),t},h.prototype.buildRequest=function(e,t){var o="";this.options.territory&&(o=this.options.territory);var n="";this.options.type&&(n=this.options.type.join(",")),this.request=p.a.normalyzeParameters({text:encodeURIComponent(this.options.text),type:n,terr:o,maximumResponses:this.options.maximumResponses}),this.request?t.call(this,this.request):e.call(this,new s.a(r.a.getMessage("SERVICE_REQUEST_BUILD")))},h.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};d.build(o)}else e.call(this,new s.a(r.a.getMessage("SERVICE_RESPONSE_EMPTY")))};t.a=h},,,,,,,function(e,t,o){},function(e,t,o){},,,,,,,function(e,t,o){},,,,,,,function(e,t,o){},,,,,,function(e,t,o){"use strict";o.r(t);var n=o(3),i=o(1),r=o(2),s=o(9),a=o(12);function l(e){if(!(this instanceof l))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=n.a.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=e||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}l.CLASSNAME="RouteParamREST",l.prototype={constructor:l,getIntermediates:function(){var e=[];if(0!==this.intermediates.length)for(var t=0;t<this.intermediates.length;t++){var o=this.intermediates[t];e.push(o.x+","+o.y)}return e.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return"m"===this.distanceUnit?"meter":"km"===this.distanceUnit?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var e=[];if(0!==this.constraints.length)for(var t=0;t<this.constraints.length;t++)e.push(JSON.stringify(this.constraints[t]));return e.join("|")}},l.prototype.getParams=function(){var e=[];return e.push({k:"resource",v:this.resource}),e.push({k:"start",v:this.start}),e.push({k:"end",v:this.end}),e.push({k:"geometryFormat",v:"geojson"}),this.optimization&&e.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&e.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&e.push({k:"profile",v:this.getProfile()}),this.constraints&&e.push({k:"constraints",v:this.getConstraints()}),this.crs&&e.push({k:"crs",v:this.crs}),this.distanceUnit&&e.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&e.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&e.push({k:"waysAttributes",v:this.getWaysAttributes()}),e};var c=l;function u(e){if(this.logger=n.a.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof u))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!e)throw new Error(i.a.getMessage("PARAM_EMPTY","options"));this.settings=e}u.prototype={requestString:null,constructor:u,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var e=new c(this.settings).getParams(),t="",o=0;o<e.length;o++){var n=e[o];t&&(t+="&"),t+=n.k+"="+n.v}return this.logger.trace(t),this.requestString=t,this.requestString}};var d=u,p={build:function(e){n.a.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var t=e||{},o=!(null===e.onError||"function"!=typeof e.onError),i=null,s=new d(t);if(!s.processRequestString()){if(i="Error process request (rest) !",o)return void e.onError.call(e.scope,new r.a(i));throw new Error(i)}return s.requestString}};function h(){if(!(this instanceof h))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}h.prototype={constructor:h};var m=h;function g(){if(!(this instanceof g))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}g.prototype={constructor:g};var f=g,v={build:function(e){var t=n.a.getLogger("RouteResponseFactory");t.trace("RouteResponseFactory::build()");var o=null;if(e.response){if(e.rawResponse)t.trace("analyze response : raw"),o=e.response;else{var s;if(t.trace("analyze response : json"),s="string"==typeof e.response?JSON.parse(e.response):e.response){if(s.message)return void e.onError.call(e.scope,new r.a(i.a.getMessage("SERVICE_RESPONSE_EXCEPTION",s.message)));var a=[],l=[],c=[];if((o=new m).hasOwnProperty("totalTime")&&(o.totalTime=parseFloat(s.duration)),o.hasOwnProperty("totalDistance")&&(o.totalDistance=parseFloat(s.distance)),o.hasOwnProperty("bbox")&&(o.bbox.left=parseFloat(s.bbox[0]),o.bbox.bottom=parseFloat(s.bbox[1]),o.bbox.right=parseFloat(s.bbox[2]),o.bbox.top=parseFloat(s.bbox[3])),o.hasOwnProperty("routeGeometry")&&!e.geometryInInstructions&&(o.routeGeometry=s.geometry),o.hasOwnProperty("routeInstructions")&&e.geometryInInstructions){var u,d=s.portions;if(Array.isArray(d)&&d.length)for(u=0;u<d.length;u++)a.push(d[u]);if(a.length)for(u=0;u<a.length;u++)l.push(a[u].steps);if(l.length)for(u=0;u<l.length;u++)c=c.concat(l[u]);c.forEach((function(e){switch(o.routeInstructions.push(new f),o.routeInstructions[o.routeInstructions.length-1].duration=e.duration,o.routeInstructions[o.routeInstructions.length-1].distance=e.distance,o.routeInstructions[o.routeInstructions.length-1].code="",o.routeInstructions[o.routeInstructions.length-1].instruction="",o.routeInstructions[o.routeInstructions.length-1].geometry=e.geometry,"Valeur non renseignée"===e.name&&(e.name=""),e.instruction.type){case"turn":o.routeInstructions[o.routeInstructions.length-1].instruction+="Tourner";break;case"new name":o.routeInstructions[o.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":o.routeInstructions[o.routeInstructions.length-1].instruction+="Départ";break;case"arrive":o.routeInstructions[o.routeInstructions.length-1].instruction+="Arrivée";break;case"merge":o.routeInstructions[o.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":case"on ramp":o.routeInstructions[o.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":o.routeInstructions[o.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":o.routeInstructions[o.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":o.routeInstructions[o.routeInstructions.length-1].instruction+="À la fin de la route, prendre";break;case"use lane":o.routeInstructions[o.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":o.routeInstructions[o.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":case"rotary":o.routeInstructions[o.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":o.routeInstructions[o.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":o.routeInstructions[o.routeInstructions.length-1].instruction+="";break;default:o.routeInstructions[o.routeInstructions.length-1].instruction+="?"+e.instruction.type+"?"}if(e.instruction.modifier)switch(e.instruction.modifier){case"uturn":o.routeInstructions[o.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":o.routeInstructions[o.routeInstructions.length-1].instruction+=" complètement à droite";break;case"right":o.routeInstructions[o.routeInstructions.length-1].instruction+=" à droite";break;case"slight right":o.routeInstructions[o.routeInstructions.length-1].instruction+=" légèrement à droite";break;case"straight":o.routeInstructions[o.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":o.routeInstructions[o.routeInstructions.length-1].instruction+=" lègèrement à gauche";break;case"left":o.routeInstructions[o.routeInstructions.length-1].instruction+=" à gauche";break;case"sharp left":o.routeInstructions[o.routeInstructions.length-1].instruction+=" complètement à gauche";break;default:o.routeInstructions[o.routeInstructions.length-1].instruction+=" ?"+e.instruction.modifier+"?"}e.instruction.exit&&(o.routeInstructions[o.routeInstructions.length-1].instruction+=e.instruction.exit+"e sortie"),e.attributes.name&&((e.attributes.name.nom_1_droite||e.attributes.name.toponyme)&&(o.routeInstructions[o.routeInstructions.length-1].instruction+=" sur"),e.attributes.name.nom_1_droite&&(o.routeInstructions[o.routeInstructions.length-1].instruction+=" "+e.attributes.name.nom_1_droite),e.attributes.name.toponyme&&(o.routeInstructions[o.routeInstructions.length-1].instruction+=" "+e.attributes.name.toponyme))}))}}if(!o)return void e.onError.call(e.scope,new r.a(i.a.getMessage("SERVICE_RESPONSE_ANALYSE","json")));if(o.exceptionReport)return void e.onError.call(e.scope,new r.a(i.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}e.onSuccess.call(e.scope,o)}else e.onError.call(e.scope,new r.a(i.a.getMessage("SERVICE_RESPONSE_EMPTY")))}};function y(e){if(!(this instanceof y))throw new TypeError(i.a.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",s.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!e.startPoint)throw new Error(i.a.getMessage("PARAM_MISSING","startPoint"));if(null===e.startPoint.x)throw new Error(i.a.getMessage("PARAM_MISSING","startPoint.x"));if(null===e.startPoint.y)throw new Error(i.a.getMessage("PARAM_MISSING","startPoint.y"));if(!e.endPoint)throw new Error(i.a.getMessage("PARAM_MISSING","endPoint"));if(null===e.endPoint.x)throw new Error(i.a.getMessage("PARAM_MISSING","endPoint.x"));if(null===e.endPoint.y)throw new Error(i.a.getMessage("PARAM_MISSING","endPoint.y"));if(e.outputFormat&&"json"!==e.outputFormat&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=e.resource||"bdtopo-osrm",this.options.startPoint=e.startPoint,this.options.endPoint=e.endPoint,this.options.viaPoints=e.viaPoints||[],this.options.routePreference=e.routePreference||"fastest",e.graph?("Voiture"===e.graph&&(this.options.graph="car"),"Pieton"===e.graph&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],e.constraints){if(!Array.isArray(e.constraints))throw new Error(i.a.getMessage("PARAM_TYPE","constraints"));for(var t=0;t<e.constraints.length;t++)this.options.constraints.push(e.constraints[t])}var o={},r={},l={};if(e.exclusions&&0!==e.exclusions.length){this.logger.warn("options.exclusions is DEPRECATED !!");for(var c=0;c<e.exclusions.length;c++)"string"==typeof e.exclusions[c]&&(e.exclusions[c]=e.exclusions[c].toLowerCase(),"toll"===e.exclusions[c]&&(l.constraintType="banned",l.key="wayType",l.operator="=",l.value="autoroute",this.options.constraints.push(l)),"tunnel"===e.exclusions[c]&&(o.constraintType="banned",o.key="wayType",o.operator="=",o.value="tunnel",this.options.constraints.push(o)),"bridge"===e.exclusions[c]&&(r.constraintType="banned",r.key="wayType",r.operator="=",r.value="pont",this.options.constraints.push(r)))}if(this.options.geometryInInstructions=e.geometryInInstructions||!1,this.options.provideBbox=e.provideBbox||!0,this.options.distanceUnit=e.distanceUnit||"m",this.options.timeUnit=e.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=e.srs||"EPSG:4326",this.options.waysAttributes=e.waysAttributes||[],!this.options.serverUrl){var u=a.a.Route.url(this.options.apiKey);if(!u)throw new Error("Url by default not found !");this.options.serverUrl=u,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}y.prototype=Object.create(s.a.prototype,{}),y.prototype.constructor=y,y.prototype.buildRequest=function(e,t){var o={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=p.build(o),this.request?t.call(this,this.request):e.call(this,new r.a(i.a.getMessage("SERVICE_REQUEST_BUILD")))},y.prototype.analyzeResponse=function(e,t){if(this.response){var o={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this,geometryInInstructions:this.options.geometryInInstructions};v.build(o)}else e.call(this,new r.a(i.a.getMessage("SERVICE_RESPONSE_EMPTY")))};var E=y,_=o(0),P=o.n(_),R=(o(16),o(43),o(17),o(50),o(5)),C=o(10),A=o(4),I=o(24),w=o(11),b=R.a.getLogger("RouteDOM"),S={_addUID:function(e){return this._uid?e+"-"+this._uid:e},_createMainContainerElement:function(){var e=document.createElement("div");return e.id=this._addUID("GProute"),e.className="GPwidget",e},_createShowRouteElement:function(){var e=document.createElement("input");return e.id=this._addUID("GPshowRoute"),e.type="checkbox",e},_createShowRoutePictoElement:function(){var e=this,t=document.createElement("label");t.id=this._addUID("GPshowRoutePicto"),t.className="GPshowAdvancedToolPicto",t.htmlFor=this._addUID("GPshowRoute"),t.title="Ouvrir le calcul d'itinéraire",t.addEventListener?t.addEventListener("click",(function(t){e.onShowRoutePanelClick(t)})):t.attachEvent&&t.attachEvent("onclick",(function(t){e.onShowRoutePanelClick(t)}));var o=document.createElement("span");return o.id=this._addUID("GPshowRouteOpen"),o.className="GPshowAdvancedToolOpen",t.appendChild(o),t},_createRoutePanelElement:function(){var e=document.createElement("div");return e.id=this._addUID("GProutePanel"),e.className="GPpanel",e},_createRoutePanelHeaderElement:function(){var e=this,t=document.createElement("div");t.className="GPpanelHeader";var o=document.createElement("div");o.className="GPpanelTitle",o.innerHTML="Calcul d'itinéraire",t.appendChild(o);var n=document.createElement("div");return n.id=this._addUID("GProutePanelClose"),n.className="GPpanelClose",n.title="Masquer le panneau",n.addEventListener?n.addEventListener("click",(function(){document.getElementById(e._addUID("GPshowRoutePicto")).click()}),!1):n.attachEvent&&n.attachEvent("onclick",(function(){document.getElementById(e._addUID("GPshowRoutePicto")).click()})),t.appendChild(n),t},_createRoutePanelFormElement:function(){var e=this,t=document.createElement("form");return t.id=this._addUID("GProuteForm"),t.setAttribute("onkeypress","return event.keyCode != 13;"),t.addEventListener("submit",(function(t){b.log(t),t.preventDefault();var o,n=document.getElementsByClassName(e._addUID("GPlocationPoint")),i=n[0].childNodes[0].id,r=n[n.length-1].childNodes[0].id,s=A.a.index(i),a=A.a.index(r);if(""===document.getElementById(e._addUID("GPlocationOrigin_"+s)).value&&""===document.getElementById(e._addUID("GPlocationOriginCoords_"+s)).value||""===document.getElementById(e._addUID("GPlocationOrigin_"+a)).value&&""===document.getElementById(e._addUID("GPlocationOriginCoords_"+a)).value)return!1;document.getElementById(e._addUID("GProuteResultsStages")).innerHTML="";for(var l=0;l<n.length;l++){var c=n[l].childNodes[0].id;if(o=A.a.index(c),"GPflexInput GPlocationStageFlexInput"===document.getElementById(e._addUID("GPlocationPoint_"+o)).className){var u=document.createElement("div");u.className="GProuteResultsStages";var d=document.createElement("div");d.className="GProuteResultStageLabel",d.innerHTML=document.getElementById(e._addUID("GPlocationOriginLabel_"+o)).innerHTML+" :",u.appendChild(d);var p=document.createElement("div");p.className="GProuteResultStageValue";var h=document.getElementById(e._addUID("GPlocationOriginCoords_"+o)),m=h.value,g="GPlocationOriginVisible"===h.className;p.innerHTML=null!==m&&""!==m&&g?m:document.getElementById(e._addUID("GPlocationOrigin_"+o)).value,u.appendChild(p),""!==p.innerHTML&&document.getElementById(e._addUID("GProuteResultsStages")).appendChild(u)}}var f=null;if(document.getElementById(e._addUID("GProuteComputationSelect"))){var v=document.getElementById(e._addUID("GProuteResultsComputationSelect"));v.selectedIndex=document.getElementById(e._addUID("GProuteComputationSelect")).selectedIndex,f=v.options[v.selectedIndex].value}var y=null;document.getElementById(e._addUID("GProuteTransportCar"))&&document.getElementById(e._addUID("GProuteTransportCar")).checked&&(y=document.getElementById(e._addUID("GProuteTransportCar")).value),document.getElementById(e._addUID("GProuteTransportPedestrian"))&&document.getElementById(e._addUID("GProuteTransportPedestrian")).checked&&(y=document.getElementById(e._addUID("GProuteTransportPedestrian")).value);for(var E=[],_=document.getElementsByClassName("GProuteExclusionsOption"),P=0;P<_.length;P++){o=_[P].htmlFor;var R=document.getElementById(o);R.checked||E.push(R.value)}return e.onRouteComputationSubmit({computation:f,transport:y,exclusions:E}),!1})),t},_createRoutePanelResultsElement:function(){var e=document.createElement("div");e.id=this._addUID("GProuteResultsPanel"),e.className="GProuteComponentHidden",e.appendChild(this._createRouteResultsStagesElement()),e.appendChild(this._createRouteResultsElement());var t=document.createElement("div");t.className="GPfakeBorder GPfakeBorderLeft",e.appendChild(t),e.appendChild(this._createRouteShowResultsDetailsElement());var o=document.createElement("label");o.htmlFor=this._addUID("GProuteResultsShowDetails"),o.innerHTML="Afficher le détail",e.appendChild(o);var n=document.createElement("label");n.htmlFor=this._addUID("GProuteResultsShowDetails"),n.innerHTML="Masquer le détail",e.appendChild(n);var i=document.createElement("div");return i.className="GPfakeBorder",e.appendChild(i),e.appendChild(this._createRouteResultsDetailsElement()),e},_createRouteWaitingElement:function(){var e=document.createElement("div");e.id=this._addUID("GProuteCalcWaitingContainer"),e.className="GProuteCalcWaitingContainerHidden";var t=document.createElement("p");return t.className="GProuteCalcWaiting",t.innerHTML="Calcul en cours...",e.appendChild(t),e},_createRouteResultsStagesElement:function(){var e=document.createElement("div");return e.id=this._addUID("GProuteResultsStages"),e},_createRouteResultsElement:function(){var e=this,t=document.createElement("div");t.id=this._addUID("GProuteResults");var o=document.createElement("div");o.id=this._addUID("GProuteResultsValues"),t.appendChild(o);var n=document.createElement("div");n.id=this._addUID("GProuteResultsMode");var i=document.createElement("select");i.id=this._addUID("GProuteResultsComputationSelect"),i.className="GPinputSelect",i.addEventListener("change",(function(t){e.onRouteModeComputationChangeAndRun(t)}));for(var r=[{code:"fastest",label:"Plus rapide"},{code:"shortest",label:"Plus court"}],s=0;s<r.length;s++){var a=document.createElement("option");a.value=r[s].code,a.text=r[s].label,i.appendChild(a)}n.appendChild(i),t.appendChild(n);var l=document.createElement("div");return l.id=this._addUID("GProuteResultsNew"),l.title="Modifier le calcul",l.addEventListener("click",(function(t){document.getElementById(e._addUID("GProuteResultsPanel")).className="GProuteComponentHidden",document.getElementById(e._addUID("GProuteForm")).className="",e.onShowRouteResultsNewClick(t)})),t.appendChild(l),t},_addRouteResultsValuesElement:function(e,t,o){var n=document.getElementById(this._addUID("GProuteResultsValues"));if(n.childElementCount)for(;n.firstChild;)n.removeChild(n.firstChild);var i=document.createElement("div");i.className="GProuteResultsValue";var r=document.createElement("label");r.className="GProuteResultsValueLabel",r.innerHTML="Distance :",i.appendChild(r);var s=0;if(parseInt(e/1e3,10)){var a=Math.round(e);s=(a/=1e3)+" km"}else s=Math.round(e)+" m";var l=document.createElement("div");l.id=this._addUID("GProuteResultsValueDist"),l.innerHTML=s,i.appendChild(l),n.appendChild(i);var c=document.createElement("div");c.className="GProuteResultsValue";var u=document.createElement("label");u.className="GProuteResultsValueLabel",u.innerHTML="Durée :",c.appendChild(u);var d=document.createElement("div");return d.id=this._addUID("GProuteResultsValueDist"),d.innerHTML=o(t),c.appendChild(d),n.appendChild(c),n},_createRouteShowResultsDetailsElement:function(){var e=document.createElement("input");return e.id=this._addUID("GProuteResultsShowDetails"),e.type="checkbox",e},_createRouteResultsDetailsElement:function(){var e=document.createElement("div");return e.id=this._addUID("GProuteResultsDetails"),e},_addRouteResultsDetailsElement:function(e,t){var o=this,n=document.getElementById(this._addUID("GProuteResultsDetails"));if(n.childElementCount)for(;n.firstChild;)n.removeChild(n.firstChild);for(var i=0,r=0,s=0;s<e.length;s++){var a=s+1,l=e[s],c=document.createElement("div");c.className="GProuteResultsDetailsNumber",c.innerHTML=a+".",n.appendChild(c),r+=parseFloat(l.duration),i+=parseFloat(l.distance);var u=0;if(parseInt(i/1e3,10)){var d=Math.round(i);u=(d/=1e3)+" km"}else u=Math.round(i)+" m";var p=document.createElement("div");p.className="GProuteResultsDetailsInstruction",p.id=this._addUID("GProuteResultsDetailsInstruction_"+a),p.title="distance : "+u+" / temps : "+t(r),p.innerHTML=l.instruction,p.addEventListener("mouseover",(function(e){o.onRouteResultsDetailsMouseOver(e)})),p.addEventListener("mouseout",(function(e){o.onRouteResultsDetailsMouseOut(e)})),p.addEventListener("click",(function(e){"function"==typeof o.onRouteResultsDetailsClick&&o.onRouteResultsDetailsClick(e)})),n.appendChild(p)}return n},_createRoutePanelFormPointElement:function(e,t,o){var n=this,i=document.createElement("div");i.id="GProutePoint"+e,i.className=o?"GPflexInput GProuteStageFlexInput":"GPflexInput GProuteStageFlexInputHidden";var r=document.createElement("label");r.id="GProuteOriginLabel"+e,r.htmlFor="GProuteOrigin"+e,r.innerHTML=t,r.addEventListener("click",(function(){var e=this.id.charAt(this.id.length-1);document.getElementById("GProuteOriginCoords"+e).value="";for(var t=1;t<8;t++)document.getElementById("GProutePoint"+t).style.display="flex";document.getElementById("GProuteForm").className="",document.getElementById("GProuteOriginPointer"+e).checked=!1,document.getElementById("GProuteOrigin"+e).className="GProuteOriginVisible",document.getElementById("GProuteOriginCoords"+e).className="GProuteOriginHidden"})),i.appendChild(r);var s=document.createElement("input");s.id="GProuteOrigin"+e,s.className="GProuteOriginVisible",s.type="text",s.placeholder="Saisir une adresse",s.addEventListener("keyup",(function(e){var t=e.which||e.keyCode;if(13!==t&&10!==t){var o=this.id.charAt(this.id.length-1);document.getElementById("GProuteOrigin"+o).value.length>2?document.getElementById("GProuteAutoCompleteList"+o).style.display="block":document.getElementById("GProuteAutoCompleteList"+o).style.display="none",n.onAutoCompleteSearchText(e)}})),s.addEventListener("blur",(function(){var e=this.id.charAt(this.id.length-1);document.getElementById("GProuteAutoCompleteList"+e).style.display="none"})),i.appendChild(s);var a=document.createElement("input");a.id="GProuteOriginCoords"+e,a.className="GProuteOriginHidden",a.type="text",a.disabled=!0,i.appendChild(a);var l=document.createElement("input");l.id="GProuteOriginPointer"+e,l.type="checkbox",i.appendChild(l);var c=document.createElement("label");return c.id="GProuteOriginPointerImg"+e,c.htmlFor="GProuteOriginPointer"+e,c.className="GProuteOriginPointerImg",c.title="Pointer un lieu sur la carte",c.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();var t,o=this.id.charAt(this.id.length-1);for(t=1;t<8;t++)o!==t&&(document.getElementById("GProuteOriginPointer"+t).checked=!1,"Pointer un lieu sur la carte"===document.getElementById("GProuteOriginCoords"+t).value&&(document.getElementById("GProuteOriginCoords"+t).value="",document.getElementById("GProuteOrigin"+t).className="GProuteOriginVisible",document.getElementById("GProuteOriginCoords"+t).className="GProuteOriginHidden"));if(document.getElementById("GProuteOriginPointer"+o).checked){for(document.getElementById("GProuteOriginCoords"+o).value="",t=1;t<8;t++)document.getElementById("GProutePoint"+t).style.display="flex";document.getElementById("GProuteForm").className="",document.getElementById("GProuteOriginPointer"+o).checked=!1,document.getElementById("GProuteOrigin"+o).className="GProuteOriginVisible",document.getElementById("GProuteOriginCoords"+o).className="GProuteOriginHidden"}else{for(document.getElementById("GProuteOriginCoords"+o).value="Pointer un lieu sur la carte",t=1;t<8;t++)document.getElementById("GProutePoint"+t).style.display=o===t?"flex":"none";document.getElementById("GProuteForm").className="GProuteFormMini",document.getElementById("GProuteOriginPointer"+o).checked=!0,document.getElementById("GProuteOrigin"+o).className="GProuteOriginHidden",document.getElementById("GProuteOriginCoords"+o).className="GProuteOriginVisible"}n.onRouteMapPointClick(e)})),i.appendChild(c),i},_createRoutePanelFormRemoveStageElement:function(e){var t=this,o=document.createElement("div");return o.id="GProuteStageRemove"+e,o.className="GProuteStageRemove",o.title="Supprimer l'étape",1!==e&&7!==e&&o.addEventListener("click",(function(e){var o=this.id.charAt(this.id.length-1);document.getElementById("GProutePoint"+o).className="GPflexInput GProuteStageFlexInputHidden",document.getElementById("GProuteOrigin"+o).value="",document.getElementById("GProuteOrigin"+o).className="GProuteOriginVisible",document.getElementById("GProuteOriginCoords"+o).value="",document.getElementById("GProuteOriginCoords"+o).className="GProuteOriginHidden",document.getElementById("GProuteStageAdd").style.display="",t.onRouteRemovePointClick(e)})),o},_createRoutePanelFormAddStageElement:function(){var e=this,t=document.createElement("div");return t.id="GProuteStageAdd",t.title="Ajouter une étape",t.addEventListener("click",(function(t){for(var o=1,n=0,i=2;i<7;i++)"GPflexInput GProuteStageFlexInputHidden"===document.getElementById("GProutePoint"+i).className?1===o&&(o=i):n++;o<7&&(document.getElementById("GProutePoint"+o).className="GPflexInput GProuteStageFlexInput"),4===n&&(document.getElementById("GProuteStageAdd").style.display="none"),e.onRouteAddPointClick(t)})),t},_createRoutePanelFormAutoCompleteListElement:function(e){var t=this,o=document.createElement("div");return o.id="GProuteAutoCompleteList"+e,o.className="GPadvancedAutoCompleteList",o.addEventListener?o.addEventListener("click",(function(o){t.onAutoCompletedResultsItemClick(o),document.getElementById("GProuteAutoCompleteList"+e).style.display="none"}),!1):o.attachEvent&&o.attachEvent("onclick",(function(o){t.onAutoCompletedResultsItemClick(o),document.getElementById("GProuteAutoCompleteList"+e).style.display="none"})),o},_createRouteAutoCompletedLocationElement:function(e,t,o){var n=document.getElementById("GProuteAutoCompleteList"+t),i=document.createElement("div");i.id="AutoCompletedLocation"+o,i.className="GPautoCompleteProposal",i.innerHTML=w.a.getSuggestedLocationFreeform(e),n.appendChild(i)},_createRoutePanelFormModeChoiceElement:function(){var e=document.createElement("div");return e.id=this._addUID("GProuteModeChoice"),e},_createRoutePanelFormModeChoiceTransportElement:function(e){var t=this,o=document.createElement("div");o.id=this._addUID("GProuteTransportChoice");var n=document.createElement("span");n.className="GProuteModeLabel",n.innerHTML="Mode de transport",o.appendChild(n);for(var i=0;i<e.length;i++){var r=e[i];if("Voiture"===r){var s=document.createElement("input");s.id=this._addUID("GProuteTransportCar"),s.type="radio",s.name="GProuteTransport",s.value="Voiture",0===i&&(s.checked=!0),s.addEventListener?s.addEventListener("change",(function(e){t.onRouteModeTransportChange(e)})):s.attachEvent&&s.attachEvent("onchange",(function(e){t.onRouteModeTransportChange(e)})),o.appendChild(s);var a=document.createElement("label");a.className="GProuteTransportImg",a.htmlFor=this._addUID("GProuteTransportCar"),a.title="Voiture",o.appendChild(a)}if("Pieton"===r){var l=document.createElement("input");l.id=this._addUID("GProuteTransportPedestrian"),l.type="radio",l.name="GProuteTransport",l.value="Pieton",0===i&&(l.checked=!0),l.addEventListener?l.addEventListener("change",(function(e){t.onRouteModeTransportChange(e)})):l.attachEvent&&l.attachEvent("onchange",(function(e){t.onRouteModeTransportChange(e)})),o.appendChild(l);var c=document.createElement("label");c.className="GProuteTransportImg",c.htmlFor=this._addUID("GProuteTransportPedestrian"),c.title="Piéton",o.appendChild(c)}}return o},_createRoutePanelFormModeChoiceComputeElement:function(){var e=this,t=document.createElement("div");t.id=this._addUID("GProuteComputationChoice");var o=document.createElement("label");o.htmlFor=this._addUID("GProuteComputationSelect"),o.innerHTML="Mode de calcul";var n=document.createElement("span");n.className="GProuteModeLabel",n.appendChild(o),t.appendChild(n);var i=document.createElement("select");i.id=this._addUID("GProuteComputationSelect"),i.className="GPinputSelect",i.addEventListener("change",(function(t){e.onRouteModeComputationChange(t)}));for(var r=[{code:"fastest",label:"Plus rapide"},{code:"shortest",label:"Plus court"}],s=0;s<r.length;s++){var a=document.createElement("option");a.value=r[s].code,a.text=r[s].label,i.appendChild(a)}return t.appendChild(i),t},_createShowRouteExclusionsElement:function(){var e=document.createElement("input");return e.id=this._addUID("GPshowRouteExclusions"),e.type="checkbox",e},_createShowRouteExclusionsPictoElement:function(){var e=this,t=document.createElement("label");return t.id=this._addUID("GPshowRouteExclusionsPicto"),t.className="GPshowMoreOptionsImage GPshowMoreOptions GPshowRouteExclusionsPicto",t.htmlFor=this._addUID("GPshowRouteExclusions"),t.title="Exclusions",t.addEventListener?t.addEventListener("click",(function(t){e.onShowRouteExclusionsClick(t)})):t.attachEvent&&t.attachEvent("onclick",(function(t){e.onShowRouteExclusionsClick(t)})),t},_createRoutePanelFormExclusionsElement:function(){var e=document.createElement("div");e.id=this._addUID("GProuteExclusions");var t=document.createElement("span");return t.className="GProuteExclusionsLabel",t.innerHTML="Passages autorisés",e.appendChild(t),e},_createRoutePanelFormExclusionOptionsElement:function(e){var t=this,o=document.createElement("div");for(var n in o.className="GProuteExclusionsOptions",e)if(e.hasOwnProperty(n)){var i=e[n];switch(n){case"toll":var r=document.createElement("input");r.id=this._addUID("GProuteExclusionsToll"),r.type="checkbox",r.value="Toll",r.checked=!i,r.addEventListener?r.addEventListener("change",(function(e){t.onRouteExclusionsChange(e)})):r.attachEvent&&r.attachEvent("onchange",(function(e){t.onRouteExclusionsChange(e)})),o.appendChild(r);var s=document.createElement("label");s.className="GProuteExclusionsOption",s.htmlFor=this._addUID("GProuteExclusionsToll"),s.innerHTML="Péages",o.appendChild(s);break;case"tunnel":var a=document.createElement("input");a.id=this._addUID("GProuteExclusionsTunnel"),a.type="checkbox",a.value="Tunnel",a.checked=!i,a.addEventListener?a.addEventListener("change",(function(e){t.onRouteExclusionsChange(e)})):a.attachEvent&&a.attachEvent("onchange",(function(e){t.onRouteExclusionsChange(e)})),o.appendChild(a);var l=document.createElement("label");l.className="GProuteExclusionsOption",l.htmlFor=this._addUID("GProuteExclusionsTunnel"),l.innerHTML="Tunnels",o.appendChild(l);break;case"bridge":var c=document.createElement("input");c.id=this._addUID("GProuteExclusionsBridge"),c.type="checkbox",c.value="Bridge",c.checked=!i,c.addEventListener?c.addEventListener("change",(function(e){t.onRouteExclusionsChange(e)})):c.attachEvent&&c.attachEvent("onchange",(function(e){t.onRouteExclusionsChange(e)})),o.appendChild(c);var u=document.createElement("label");u.className="GProuteExclusionsOption",u.htmlFor=this._addUID("GProuteExclusionsBridge"),u.innerHTML="Ponts",o.appendChild(u)}}return o},_createRouteSubmitFormElement:function(){var e=document.createElement("input");return e.id=this._addUID("GProuteSubmit"),e.className="GPinputSubmit",e.type="submit",e.value="Calculer",e},_createRouteFormResetElement:function(){var e=this,t=document.createElement("div");return t.id=this._addUID("GProuteReset"),t.title="Réinitialiser les paramètres",t.addEventListener("click",(function(t){e.onRouteResetClick(t)})),t}},O=R.a.getLogger("route(plus)"),G=P.a.Control.extend({includes:S,options:{position:"topleft",collapsed:!0,graphs:["Voiture","Pieton"],exclusions:{toll:!1,tunnel:!1,bridge:!1},disableReverse:!1,routeOptions:{},autocompleteOptions:{}},initialize:function(e){P.a.Util.setOptions(this,e),this._uid=A.a.generate(),this._initTransport(),this._initExclusions(),this._initComputation(),this._showRouteContainer=null,this._pictoRouteContainer=null,this._waitingContainer=null,this._formRouteContainer=null,this._resultsRouteContainer=null,this._isDesktop=this._detectSupport(),this._currentPoints=[],this._currentTransport=null,this._currentComputation=null,this._currentExclusions=[],this._geojsonRoute=null,this._geojsonSections=null,this._waiting=!1,this._timer=null,this._currentRouteInformations=null,this._resources={},this._noRightManagement=!1,this._checkRightsManagement()},onAdd:function(e){var t=this._container=this._initLayout(e);return P.a.DomEvent.disableClickPropagation(t).disableScrollPropagation(t),t},onRemove:function(){},_initTransport:function(){this._currentTransport="Voiture";var e=this.options.graphs;e&&0!==e.length||(this.options.graphs=["Voiture","Pieton"]),P.a.Util.isArray(e)&&e.length&&("Voiture"!==e[0]&&"Pieton"!==e[0]||(this._currentTransport=e[0]));var t=this.options.routeOptions;t.graph&&(this._currentTransport=t.graph)},_initComputation:function(){this._currentComputation="fastest";var e=this.options.routeOptions;e.routePreference&&(this._currentComputation=e.routePreference)},_initExclusions:function(){this._currentExclusions=[];var e=this.options.exclusions;if(e&&0!==Object.keys(e).length||(this.options.exclusions={toll:!1,tunnel:!1,bridge:!1}),e&&Object.keys(e).length)for(var t in e)e.hasOwnProperty(t)&&e.k&&this._currentExclusions.push(t);var o=this.options.routeOptions;P.a.Util.isArray(o.exclusions)&&(this._currentExclusions=o.exclusions)},_checkRightsManagement:function(){var e=null,t=[],o=null;o=this.options.routeOptions.apiKey,(t=(e=this.options.routeOptions.filterOptions)?e.type:[])&&0!==t.length||(t=["Voiture","Pieton"]);var n=C.a.check({key:o||this.options.apiKey,resources:t,services:["Itineraire"]});o=this.options.autocompleteOptions.apiKey,(t=(e=this.options.autocompleteOptions.filterOptions)?e.type:[])&&0!==t.length||(t=["StreetAddress","PositionOfInterest"]);var i=C.a.check({key:o||this.options.apiKey,resources:t,services:["AutoCompletion"]});n||i||(this._noRightManagement=!0),i&&(this._resources.AutoCompletion={},this._resources.AutoCompletion.resources=i.AutoCompletion,this._resources.AutoCompletion.key=i.key),n&&(this._resources.Itineraire={},this._resources.Itineraire.resources=n.Itineraire,this._resources.Itineraire.key=n.key)},_detectSupport:function(){var e=!0,t=window.navigator.userAgent.toLowerCase();return-1===t.indexOf("iphone")&&-1===t.indexOf("ipod")&&-1===t.indexOf("ipad")&&-1===t.indexOf("android")&&-1===t.indexOf("mobile")&&-1===t.indexOf("blackberry")&&-1===t.indexOf("tablet")&&-1===t.indexOf("phone")&&-1===t.indexOf("touch")||(e=!1),-1===t.indexOf("msie")&&-1===t.indexOf("trident")||(e=!0),e},_initLayout:function(e){var t=this._createMainContainerElement(),o=this._showRouteContainer=this._createShowRouteElement();t.appendChild(o),this.options.collapsed||(o.checked=!0);var n=this._pictoRouteContainer=this._createShowRoutePictoElement();t.appendChild(n);var i=this._createRoutePanelElement(),r=this._createRoutePanelHeaderElement();i.appendChild(r);for(var s=this._formRouteContainer=this._createRoutePanelFormElement(),a=this._createRoutePanelFormPointsElement(e),l=0;l<a.length;l++)s.appendChild(a[l]);var c=this._createRoutePanelFormModeChoiceElement();c.appendChild(this._createRoutePanelFormModeChoiceTransportElement(this.options.graphs)),c.appendChild(this._createRoutePanelFormModeChoiceComputeElement()),s.appendChild(c),s.appendChild(this._createShowRouteExclusionsElement()),s.appendChild(this._createShowRouteExclusionsPictoElement());var u=this._createRoutePanelFormExclusionsElement();u.appendChild(this._createRoutePanelFormExclusionOptionsElement(this.options.exclusions)),s.appendChild(u);var d=this._createRouteSubmitFormElement();s.appendChild(d),i.appendChild(s);var p=this._resultsRouteContainer=this._createRoutePanelResultsElement();i.appendChild(p);var h=this._waitingContainer=this._createRouteWaitingElement();return i.appendChild(h),t.appendChild(i),t},_createRoutePanelFormPointsElement:function(e){var t=[],o=1,n=new I.a({apiKey:this.options.apiKey||null,tag:{id:o,unique:this._uid,label:"Départ",color:"blue",display:!0},disableReverse:this.options.disableReverse,autocompleteOptions:this.options.autocompleteOptions||null});n.setMap(e);var i=this.options.routeOptions;for(i.startPoint&&(n._inputAutoCompleteContainer.value=i.startPoint.x+" , "+i.startPoint.y,n.setCoordinate({lng:i.startPoint.x,lat:i.startPoint.y})),t.push(n.getContainer()),this._currentPoints.push(n),o=2;o<7;o++){var r=new I.a({apiKey:this.options.apiKey||null,tag:{id:o,unique:this._uid,label:"Etape",color:"green",display:!1,removeOption:!0},disableReverse:this.options.disableReverse,autocompleteOptions:this.options.autocompleteOptions||null});r.setMap(e),t.push(r.getContainer()),this._currentPoints.push(r)}var s=new I.a({apiKey:this.options.apiKey||null,tag:{id:o,unique:this._uid,label:"Arrivée",color:"red",display:!0,addOption:!0,removeOption:!1},disableReverse:this.options.disableReverse,autocompleteOptions:this.options.autocompleteOptions||null});return s.setMap(e),i.endPoint&&(s._inputAutoCompleteContainer.value=i.endPoint.x+" , "+i.endPoint.y,s.setCoordinate({lng:i.endPoint.x,lat:i.endPoint.y})),t.push(s.getContainer()),this._currentPoints.push(s),t},onShowRoutePanelClick:function(e){O.log("onShowRoutePanelClick",e),this._geojsonSections||this._clear()},onRouteModeComputationChange:function(e){O.log("onRouteModeComputationChange",e);var t=e.target.selectedIndex,o=e.target.options[t].value;o&&(O.log(o),this._currentComputation=o)},onRouteModeComputationChangeAndRun:function(e){O.log("onRouteModeComputationChangeAndRun",e),this.onRouteModeComputationChange(e),this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry(),this.onRouteComputationSubmit({computation:this._currentComputation,transport:this._currentTransport,exclusions:this._currentExclusions})},onRouteModeTransportChange:function(e){O.log("onRouteModeTransportChange",e);var t=e.target.value;t&&(O.log(t),this._currentTransport=t)},onShowRouteExclusionsClick:function(e){O.log("onShowRouteExclusionsClick",e)},onRouteExclusionsChange:function(e){O.log("onRouteExclusionsChange",e);var t=e.target.value,o=e.target.checked;if(t){O.log(t,o);for(var n=!1,i=null,r=0;r<this._currentExclusions.length;r++)this._currentExclusions[r]===t&&(i=r,n=!0);!n&&o&&this._currentExclusions.push(t),n&&!o&&(this._currentExclusions[i]=null)}},onRouteComputationSubmit:function(e){O.log("onRouteComputationSubmit",e);var t,o,n=this._currentPoints;if(n[0].getCoordinate){var i=n[0].getCoordinate();t={x:i.lon||i.lng,y:i.lat}}if(n[0].dragging(!1),O.log("start",t),n[n.length-1]&&n[n.length-1].getCoordinate){var r=n[n.length-1].getCoordinate();o={x:r.lon||r.lng,y:r.lat}}n[n.length-1].dragging(!1),O.log("end",o);for(var s=[],a=1;a<n.length-1;a++)if(n[a]&&n[a].getCoordinate){var l=n[a].getCoordinate();if(l){var c={x:l.lon||l.lng,y:l.lat};O.log("step",c),s.push(c)}}if(!this._noRightManagement){this._currentTransport=e.transport,this._currentComputation=e.computation,this._currentExclusions=e.exclusions,void 0===this.options.routeOptions.geometryInInstructions&&(this.options.routeOptions.geometryInInstructions=!0),this._displayWaitingContainer();var u=this;this._requestRouting({startPoint:t,endPoint:o,viaPoints:s,graph:this._currentTransport,routePreference:this._currentComputation,exclusions:this._currentExclusions,geometryInInstructions:this.options.routeOptions.geometryInInstructions,distanceUnit:"m",onSuccess:function(e){O.log(e),e&&(u._fillRouteResultsDetails(e),u.options.routeOptions.onSuccess&&u.options.routeOptions.onSuccess(e))},onFailure:function(e){u._hideWaitingContainer(),u._clearRouteResultsDetails(),O.log(e.message)}})}},onShowRouteResultsNewClick:function(e){O.log("onShowRouteResultsNewClick",e);for(var t=this._currentPoints,o=0;o<t.length;o++)t[o].dragging(!0);this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry()},onRouteResultsDetailsMouseOver:function(e){O.log("onRouteResultsDetailsMouseOver",e);var t=A.a.index(e.target.id);this._isDesktop&&this._geojsonSections&&this._geojsonSections.eachLayer((function(e){e.feature.id===parseInt(t,10)&&e.setStyle({weight:10,color:"#0F9DE8",opacity:.5})}))},onRouteResultsDetailsMouseOut:function(e){O.log("onRouteResultsDetailsMouseOut",e);var t=A.a.index(e.target.id);this._isDesktop&&this._geojsonSections&&this._geojsonSections.eachLayer((function(e){e.feature.id===parseInt(t,10)&&e.setStyle({color:"#ED7F10",weight:5,opacity:.75})}))},onRouteResultsDetailsClick:function(e){O.log("onRouteResultsDetailsClick",e);var t=A.a.index(e.target.id),o=this;if(!this._isDesktop&&this._geojsonSections){var n=e.target.title,i=e.target.innerHTML;this._geojsonSections.eachLayer((function(o){o.feature.id===parseInt(t,10)&&(e.target.innerHTML=n,o.setStyle({weight:10,color:"#0F9DE8",opacity:.5}))})),clearTimeout(1e3),setTimeout((function(){o._geojsonSections.eachLayer((function(o){o.feature.id===parseInt(t,10)&&(e.target.innerHTML=i,o.setStyle({color:"#ED7F10",weight:5,opacity:.75}))}))}),1e3)}},_requestRouting:function(e){if(e&&0!==Object.keys(e).length&&e.startPoint&&e.endPoint)if(O.log(e),this._noRightManagement)O.log("no rights for all service !?");else if(this._resources.Itineraire){var t=this._resources.Itineraire.resources;if(t&&0!==Object.keys(t).length){var o=this._resources.Itineraire.key,n={};P.a.Util.extend(n,this.options.routeOptions),P.a.Util.extend(n,e);for(var i=!1,r=0;r<t.length;r++)t[r]===n.graph&&(i=!0);if(i)P.a.Util.extend(n,{apiKey:this.options.routeOptions.apiKey||this.options.apiKey||o}),P.a.Util.extend(n,{ssl:this.options.ssl}),O.log(n),new E(n).call();else O.log("no rights for this service !?")}}else O.log("no rights for this service !?")},_fillRouteResultsDetails:function(e){var t=e.totalDistance,o=e.totalTime,n=this._simplifiedInstructions(e.routeInstructions);n&&this._fillRouteResultsDetailsContainer(t,o,n);var i=e.routeGeometry;if(i&&this._fillRouteResultsDetailsGeometry(i),this.options.routeOptions.geometryInInstructions){var r=n&&Array.isArray(n)&&0!==n[0].geometry.length;n&&r&&this._fillRouteResultsDetailsFeatureGeometry(n)}var s=e.bbox;if(s){var a=this._map,l=P.a.latLngBounds([s.bottom,s.left],[s.top,s.right]);a.fitBounds(l,{padding:[1,1]})}this._currentRouteInformations=e,this._formRouteContainer.className="GProuteComponentHidden",this._hideWaitingContainer(),this._resultsRouteContainer.className=""},_fillRouteResultsDetailsContainer:function(e,t,o){this._resultsRouteValuesContainer=this._addRouteResultsValuesElement(e,t,this._convertSecondsToTime),this._resultsRouteDetailsContainer=this._addRouteResultsDetailsElement(o,this._convertSecondsToTime)},_fillRouteResultsDetailsGeometry:function(e){this._clearRouteResultsGeometry();var t=this._map;this._geojsonRoute=P.a.geoJson(e,{style:{color:"#ED7F10",weight:5,opacity:.75}}).addTo(t)},_fillRouteResultsDetailsFeatureGeometry:function(e){this._clearRouteResultsFeatureGeometry();for(var t=this._map,o={type:"FeatureCollection",features:[]},n=0;n<e.length;n++){var i=e[n],r=n+1;o.features.push({id:r,type:"Feature",geometry:i.geometry,properties:{popupContent:"("+r+") distance : "+this._convertDistance(i.distance)+" / temps : "+this._convertSecondsToTime(i.duration)}})}var s=this;function a(e){var t=e.target;s._geojsonSections.resetStyle(t);var o=P.a.DomUtil.get("GProuteResultsDetailsInstruction_"+t.feature.id+"-"+s._uid);P.a.DomUtil.removeClass(o,"GProuteResultsDetailsHighlight")}function l(e){var t=e.target;O.log(t),t.setStyle({weight:10,color:"#0F9DE8",opacity:.5});var o=P.a.DomUtil.get("GProuteResultsDetailsInstruction_"+t.feature.id+"-"+s._uid);P.a.DomUtil.addClass(o,"GProuteResultsDetailsHighlight")}this._geojsonSections=P.a.geoJson(o,{style:{color:"#ED7F10",weight:5,opacity:.75},onEachFeature:function(e,t){t.on({mouseover:l,mouseout:a}),t.bindPopup(e.properties.popupContent)}}).addTo(t)},_clear:function(){this._currentTransport=null,this._currentExclusions=[],this._currentComputation=null,this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry();for(var e=0;e<this._currentPoints.length;e++)this._currentPoints[e].clear()},_clearRouteResultsDetails:function(){if(this._currentRouteInformations=null,this._resultsRouteDetailsContainer){var e=this._resultsRouteDetailsContainer;if(e.childElementCount)for(;e.firstChild;)e.removeChild(e.firstChild)}if(this._resultsRouteValuesContainer){var t=this._resultsRouteValuesContainer;if(t.childElementCount)for(;t.firstChild;)t.removeChild(t.firstChild)}},_clearRouteResultsGeometry:function(){var e=this._map;null!=this._geojsonRoute&&(e.removeLayer(this._geojsonRoute),this._geojsonRoute=null)},_clearRouteResultsFeatureGeometry:function(){var e=this._map;null!=this._geojsonSections&&(e.removeLayer(this._geojsonSections),this._geojsonSections=null)},_displayWaitingContainer:function(){this._waitingContainer.className="GProuteCalcWaitingContainerVisible",this._waiting=!0,this._timer&&(clearTimeout(this._timer),this._timer=null);var e=this;this._timer=setTimeout((function(){!0===e._waiting?e._hideWaitingContainer():e._timer&&clearTimeout(e._timer)}),16e3)},_hideWaitingContainer:function(){this._waiting&&(this._waitingContainer.className="GProuteCalcWaitingContainerHidden",this._waiting=!1,clearTimeout(this._timer),this._timer=null)},_simplifiedInstructions:function(e){var t=[],o=e[0];1===e.length&&t.push(o);for(var n=1;n<e.length;n++){var i=e[n];if(i.instruction===o.instruction){o.distance=(parseFloat(i.distance)+parseFloat(o.distance)).toString(),o.duration=(parseFloat(i.duration)+parseFloat(o.duration)).toString();for(var r=1;r<i.geometry.coordinates.length;r++)o.geometry.coordinates.push(i.geometry.coordinates[r]);n===e.length-1&&(t.push(o),o=null)}else t.push(o),o=i,n===e.length-1&&(t.push(i),o=null)}return O.log(t),t},_convertSecondsToTime:function(e){e=Math.round(e);var t=Math.floor(e/3600);t||(t="00");var o=e%3600,n=Math.floor(o/60);n||(n="00");var i=o%60,r=Math.ceil(i);return r||(r="00"),t+"h "+n+"m "+r+"s"},_convertDistance:function(e){var t=parseInt(e/1e3,10);return t?t+" km":parseInt(e,10)+" m"},compute:function(e,t){if(this._showRouteContainer.checked||this._pictoRouteContainer.click(),this._map){var o={computation:"fastest",transport:"Voiture",exclusions:[]};P.a.Util.extend(o,t);var n=this._currentPoints;n[0].setCoordinate(e[0]),P.a.DomUtil.get("GPlocationOrigin_1-"+this._uid).value=e[0].lng+" , "+e[0].lat;var i=e.length-1;n[6].setCoordinate(e[i]),P.a.DomUtil.get("GPlocationOrigin_7-"+this._uid).value=e[i].lng+" , "+e[i].lat;for(var r=1;r<e.length-1;r++){n[r].setCoordinate(e[r]),P.a.DomUtil.get("GPlocationOrigin_"+r+"-"+this._uid).value=e[r].lng+" , "+e[r].lat}"Voiture"===o.transport?P.a.DomUtil.get("GProuteTransportCar-"+this._uid).checked=!0:P.a.DomUtil.get("GProuteTransportPedestrian-"+this._uid).checked=!0,P.a.DomUtil.get("GProuteComputationSelect-"+this._uid).selectedIndex="fastest"===o.computation?0:1,this.onRouteComputationSubmit(o)}}});t.default=G;window.L&&(window.L.geoportalControl||(window.L.geoportalControl={}),window.L.geoportalControl.Route=G)}]).default;