/*!
 * @brief French Geoportal Extension for Leaflet
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * @copyright copyright (c) IGN 
 * @license CeCILL-B
 * @author IGN
 * @version 2.2.7
 * @date 18/11/2022
 *
 */
ElevationPath=function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=61)}([function(t,e){t.exports=L},function(t,e,i){"use strict";var o={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(t,e){if(0===Object.keys(arguments).length)return"Message indefined !";var i=Array.prototype.slice.call(arguments),o=i.shift(),n=i,r=this[o];try{r=Array.isArray(n)&&n.length>0?r.replace("%var%",n.join(" - ")):r.replace("%var%","%var% (not specified)")}catch(t){}return r}};e.a=o},function(t,e,i){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("ErrorService constructor cannot be called as a function.");var e=t;"string"==typeof t||t instanceof String?(this.message=t,this.status=-1,this.type=o.TYPE_UNKERR):(this.message=e.message||"undefined!?",this.type=e.type,this.status=e.status||-1),this.name="ErrorService",this.stack=(new Error).stack}o.TYPE_SRVERR="SERVICE_ERROR",o.TYPE_USEERR="USAGE_ERROR",o.TYPE_UNKERR="UNKNOWN_ERROR",o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),e.a=o},function(t,e,i){"use strict";var o=i(6),n={getLogger:function(t){"true".match(/true/)?o.disableAll():o.enableAll();var e=t||"default";return o.getLogger(e)}};e.a=n},function(t,e,i){"use strict";var o,n={generate:(o=Math.floor(Date.now()),function(){return o++}),name:function(t){var e=null,i=t.lastIndexOf("-");return e=-1===i?t:t.substring(0,i),e},index:function(t){var e=null,i=this.name(t),o=i.lastIndexOf("_");return-1!==o&&(e=i.substring(o+1)),e},uuid:function(t){var e=null,i=t.lastIndexOf("-");return-1!==i&&(e=parseInt(t.substring(i+1),10)),e}};e.a=n},function(t,e,i){"use strict";var o=i(6),n={getLogger:function(t){"true".match(/true/)?o.disableAll():o.enableAll();var e=t||"default";return o.getLogger(e)},disableAll:function(){var t=o.getLoggers();for(var e in t){if(Object.hasOwnProperty.call(t,e))t[e].disableAll()}},enableAll:function(){var t=o.getLoggers();for(var e in t){if(Object.hasOwnProperty.call(t,e))t[e].enableAll()}}};e.a=n},function(t,e,i){var o,n;!function(r,a){"use strict";void 0===(n="function"==typeof(o=function(){var t=function(){},e="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function o(t,e){var i=t[e];if("function"==typeof i.bind)return i.bind(t);try{return Function.prototype.bind.call(i,t)}catch(e){return function(){return Function.prototype.apply.apply(i,[t,arguments])}}}function n(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(i){return"debug"===i&&(i="log"),"undefined"!=typeof console&&("trace"===i&&e?n:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):t)}function a(e,o){for(var n=0;n<i.length;n++){var r=i[n];this[r]=n<e?t:this.methodFactory(r,e,o)}this.log=this.debug}function s(t,e,i){return function(){"undefined"!=typeof console&&(a.call(this,e,i),this[t].apply(this,arguments))}}function l(t,e,i){return r(t)||s.apply(this,arguments)}function c(t,e,o){var n,r=this;e=null==e?"WARN":e;var s="loglevel";function c(){var t;if("undefined"!=typeof window&&s){try{t=window.localStorage[s]}catch(t){}if(void 0===t)try{var e=window.document.cookie,i=e.indexOf(encodeURIComponent(s)+"=");-1!==i&&(t=/^([^;]+)/.exec(e.slice(i))[1])}catch(t){}return void 0===r.levels[t]&&(t=void 0),t}}"string"==typeof t?s+=":"+t:"symbol"==typeof t&&(s=void 0),r.name=t,r.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},r.methodFactory=o||l,r.getLevel=function(){return n},r.setLevel=function(e,o){if("string"==typeof e&&void 0!==r.levels[e.toUpperCase()]&&(e=r.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=r.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(n=e,!1!==o&&function(t){var e=(i[t]||"silent").toUpperCase();if("undefined"!=typeof window&&s){try{return void(window.localStorage[s]=e)}catch(t){}try{window.document.cookie=encodeURIComponent(s)+"="+e+";"}catch(t){}}}(e),a.call(r,e,t),"undefined"==typeof console&&e<r.levels.SILENT)return"No console available for logging"},r.setDefaultLevel=function(t){e=t,c()||r.setLevel(t,!1)},r.resetLevel=function(){r.setLevel(e,!1),function(){if("undefined"!=typeof window&&s){try{return void window.localStorage.removeItem(s)}catch(t){}try{window.document.cookie=encodeURIComponent(s)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(t){}}}()},r.enableAll=function(t){r.setLevel(r.levels.TRACE,t)},r.disableAll=function(t){r.setLevel(r.levels.SILENT,t)};var h=c();null==h&&(h=e),r.setLevel(h,!1)}var h=new c,d={};h.getLogger=function(t){if("symbol"!=typeof t&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=d[t];return e||(e=d[t]=new c(t,h.getLevel(),h.methodFactory)),e};var u="undefined"!=typeof window?window.log:void 0;return h.noConflict=function(){return"undefined"!=typeof window&&window.log===h&&(window.log=u),h},h.getLoggers=function(){return d},h.default=h,h})?o.call(e,i,e,t):o)||(t.exports=n)}()},function(t,e,i){"use strict";var o={normalyzeParameters:function(t){var e=null;if(t){var i=[];for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];n||(n=""),i.push(o+"="+n)}e=i.join("&")}return e},normalyzeUrl:function(t,e,i){var o=t;if(t){var n=t.indexOf("?");-1===n&&(o+="?"),-1!==n&&n!==t.length-1&&(o+="&")}return e&&(o+="string"==typeof e?e:this.normalyzeParameters(e)),i&&(o=encodeURIComponent(o)),o},indent:function(t,e){return new Array((t||0)+1).join("\t")+e}};e.a=o},function(t,e,i){"use strict";(function(t){var o=i(5).a.getLogger("config"),n={configuration:null,isConfigLoaded:function(){var e="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==t?t:{};return!(!e.Gp||!e.Gp.Config||0===Object.keys(e.Gp.Config).length)&&(this.configuration=e.Gp.Config,!0)},getLayerId:function(t,e){var i=null;if(this.configuration){var n=this.configuration.layers;for(var r in n)if(n.hasOwnProperty(r)){var a=r.split("$");if(t===a[0]&&a[1]){var s=a[1].split(":");if(a[1].split(";")[1]===e){i=r;break}if(s[2]===e){i=r;break}}}}return i||o.error("ERROR layer id (layer name: "+t+" / service: "+e+") was not found !?"),i},getLayerParams:function(t,e,i){var n={};if(this.configuration){var r=this.getLayerId(t,e);if(r){var a=this.configuration.layers[r],s=a.apiKeys[0];if(i&&i!==s)return void o.error("ERROR different keys ("+i+" !== "+s+") !?");i=i||s,n.key=i,n.url=a.getServerUrl(i),n.version=a.getServiceParams().version,n.styles=a.getDefaultStyle(),n.format=a.getDefaultFormat(),n.projection=a.getDefaultProjection(),n.minScale=a.getMinScaleDenominator(),n.maxScale=a.getMaxScaleDenominator(),n.extent=a.getBBOX(),n.legends=a.getLegends(),n.metadata=a.getMetadata(),n.originators=a.getOriginators(),n.title=a.getTitle(),n.description=a.getDescription(),n.quicklookUrl=a.getQuicklookUrl(),a.wmtsOptions&&(n.tileMatrixSetLimits=a.wmtsOptions.tileMatrixSetLimits);var l=a.getTMSID();if(l){n.TMSLink=l;var c=this.configuration.getTMSConf(l);n.matrixOrigin=c.getTopLeftCorner(),n.nativeResolutions=c.nativeResolutions,n.matrixIds=c.matrixIds,n.tileMatrices=c.tileMatrices}}}return n},getServiceParams:function(t,e,i){var o={};if(this.configuration){var n=this.getLayerId(t,e);if(n){var r=this.configuration.layers[n],a=r.apiKeys[0];if(i){Array.isArray(i)||(i=[i]);for(var s=0;s<i.length;s++)if(i[s]===a){var l=s;break}if(void 0===l)return}var c=i[l]||a;o.key=c,o.url=r.getServerUrl(c),o.version=r.getServiceParams().version,o.extent=r.getBBOX(),o.title=r.getTitle(),o.description=r.getDescription()}}return o},getResolutions:function(){var t=[];return this.configuration&&(t=this.configuration.generalOptions.wgs84Resolutions),t},getTileMatrix:function(t){var e={};return this.configuration&&t&&(e=this.configuration.tileMatrixSets[t.toUpperCase()]),e},getGlobalConstraints:function(t){var e={};if(t){var i=this.configuration.layers[t];e.projection=i.getDefaultProjection(),e.minScale=i.getMinScaleDenominator(),e.maxScale=i.getMaxScaleDenominator(),e.extent=i.getBBOX()}return e}};e.a=n}).call(this,i(15))},function(t,e,i){"use strict";var o,n=i(3),r=i(7),a=i(1),s=i(18),l=i.n(s),c={call:function(t){var e=n.a.getLogger("XHR");if(e.trace("[XHR::call()]"),l.a.polyfill(),!t.url)throw new Error("missing parameter : url is not defined !");if(!t.method)throw new Error("missing parameter : method is not defined !");t.format||(t.format="text");var i={};switch(i.url=t.url,i.data=t.data?t.data:null,i.method=t.method,i.timeOut=t.timeOut||0,i.scope=t.scope||this,i.proxy=t.proxy||null,i.content=t.content||null,i.headers=t.headers||{referer:"http://localhost"},t.method){case"DELETE":case"GET":break;case"PUT":case"POST":i.content=t.content?t.content:"application/x-www-form-urlencoded",i.headers=t.headers?t.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(t.format){case"text":this.__call(i).then((function(i){e.trace(i),t.onResponse.call(this,i)})).catch((function(e){t.onFailure.call(this,e)}));break;case"json":this.__callJSON(i).then((function(i){e.trace(i),t.onResponse.call(this,i)})).catch((function(e){t.onFailure.call(this,e)}));break;case"xml":this.__callXML(i).then((function(i){e.trace(i),t.onResponse.call(this,i)})).catch((function(e){t.onFailure.call(this,e)}));break;default:throw new Error("This output Format is not yet supported !")}},__call:function(t){var e=n.a.getLogger("XHR");return e.trace("[XHR::__call()]"),new Promise((function(o,n){var a="POST"===t.method||"PUT"===t.method?1:0;t.data&&("object"==typeof t.data&&Object.keys(t.data).length||"string"==typeof t.data&&t.data.length)&&!a&&("Geocode"===t.scope.CLASSNAME||"ReverseGeocode"===t.scope.CLASSNAME?t.url=t.url+t.data:t.url=r.a.normalyzeUrl(t.url,t.data)),e.trace("URL = ",t.url);var s=null;if("undefined"==typeof window){var l=i(26),c={headers:{Referer:"https://localhost"}};return t.data&&"string"==typeof t.data&&a&&(c={method:t.method,body:t.data,headers:{"Content-Type":t.content,Referer:"https://localhost"}}),l(t.url,c).then((function(t){if(t.ok)o(t.text());else{var e="Errors Occured on Http Request (status : '"+t.statusText+"' | url : '"+t.url+"')",i=t.status;n({message:e,status:i})}})).catch((function(t){n({message:t,status:-1})}))}if(window.XMLHttpRequest){e.trace("XMLHttpRequest"),(s=new XMLHttpRequest).open(t.method,t.url,!0),s.overrideMimeType=t.content;var h=null;t.timeOut>0&&(e.trace("XHR - TimeOut actif !"),h=window.setTimeout((function(){n({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})}),t.timeOut)),a&&(e.trace("data = ",t.data),s.setRequestHeader("Content-type",t.content)),s.onerror=function(t){console.log(t),n(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},s.ontimeout=function(t){console.log(t),n(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},s.onreadystatechange=function(t){if(4===s.readyState)if(200===s.status)window.clearTimeout(h),o(s.response);else{var e="Errors Occured on Http Request (status : '"+t.target.statusText+"' | url : '"+t.target.responseURL+"' | response : '"+t.target.response+"')",i=t.target.status;n({message:e,status:i})}};var d=t.data&&a?t.data:null;s.send(d)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");e.trace("XDomainRequest"),(s=new XDomainRequest).open(t.method,t.url),s.overrideMimeType=t.content,t.timeOut>0&&(s.timeout=t.timeout,e.trace("XHR - TimeOut actif !")),a&&s.setRequestHeader("Content-type",t.content),s.onerror=function(){n(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},s.ontimeout=function(){n(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},s.onload=function(t){if(200===s.status)o(s.responseText);else{var e="Errors Occured on Http Request (status : '"+t.target.statusText+"' | url : '"+t.target.responseURL+"')",i=t.target.status;n({message:e,status:i})}};var u=t.data&&a?t.data:null;s.send(u)}}))},__callJSON:function(t){return this.__call(t).then(JSON.parse).catch((function(e){console.log("_callJSON failed on : ",t.url,e)}))},__callXML:function(t){return this.__call(t).then((function(t){var e;"undefined"==typeof window?e=(new(0,i(20).DOMParser)).parseFromString(t,"text/xml"):window.DOMParser?e=(new window.DOMParser).parseFromString(t,"text/xml"):((e=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(t));return e})).catch((function(e){console.log("__callXML failed on : ",t.url,e)}))}},h={uuid:(o=Math.floor(Date.now()),function(){return o++}),call:function(t){var e=n.a.getLogger("JSONP");if(e.trace("[JSONP::call ()]"),!t)throw e.error("missing parameter : options !"),new Error("missing parameter : options !");if(!t.url)throw e.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(t.timeOut||(e.info("setting 'options.timeOut' default value"),t.timeOut=0),!t.onResponse)throw e.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var i="string"==typeof t.callbackSuffix?t.callbackSuffix:this.uuid(),o=!1,r=!1,a=t.url.indexOf("callback=");if(-1!==a){o=!0;var s=t.url.indexOf("&",a);-1===s&&(s=t.url.length);var l=t.url.substring(a+9,s);l&&(r=!0,t.callbackName=l,e.info("setting 'options.callbackName' value ("+t.callbackName+") from 'options.url' parameter"))}if(!o){var c=t.url.indexOf("?");-1===c?t.url=t.url+"?callback=":c===t.url.length?t.url=t.url+"callback=":t.url=t.url+"&callback=",e.info("setting callback default key in 'options.url' : "+t.url)}var h=!!t.callbackName||r;if(r||(t.callbackName||(e.info("setting 'options.callbackName' default value"),t.callbackName="callback",(i||""===i)&&(t.callbackName+=i)),t.url=t.url.replace("callback=","callback="+t.callbackName),e.info("setting callback function name in 'options.url' : "+t.url)),t.onTimeOut||(e.info("setting 'options.onTimeOut' default value"),t.onTimeOut=function(){console.log("TimeOut while invoking url : "+t.url)}),!h){var d=this,u=null;t.timeOut>0&&(u=window.setTimeout((function(){window[t.callbackName]=function(){},t.onTimeOut(),d._deleteScript(i)}),t.timeOut)),window[t.callbackName]=function(e){window.clearTimeout(u),t.onResponse(e),d._deleteScript(i)}}this._createScript(i,t.url)},_createScript:function(t,e){var i,o=document.getElementById("results"+t);(i=document.createElement("script")).setAttribute("type","text/javascript"),i.setAttribute("src",e),i.setAttribute("charset","UTF-8"),i.setAttribute("id","results"+t),i.setAttribute("async","true");var n=document.documentElement||document.getElementsByTagName("head")[0];null===o?n.appendChild(i):n.replaceChild(i,o)},_deleteScript:function(t){var e=document.getElementById("results"+t);if(e){var i=e.parentNode||document.documentElement;if(!i)return;i.removeChild(e)}}},d={send:function(t){var e=t||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if("undefined"!=typeof window||"JSONP"!==t.protocol){if("XHR"===t.protocol||"json"===t.format?e.wrap=!1:"JSONP"===t.protocol&&"xml"===t.format&&(e.wrap=!0),e.callback=null,e.output=e.wrap?"json":null,e.wrap){var i={};i.output=e.output,i.callback=e.callback,delete i.callback,e.url=r.a.normalyzeUrl(t.url,i)}switch(e.protocol){case"XHR":"GET"===t.method&&t.nocache&&(e.url=r.a.normalyzeUrl(e.url,{t:(new Date).getTime()})),c.call(e);break;case"JSONP":e.data&&(e.url=r.a.normalyzeUrl(e.url,e.data)),h.call(e);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}},u=i(2),p=i(12),f=i(19);function _(t){if(!(this instanceof _))throw new TypeError(a.a.getMessage("CLASS_CONSTRUCTOR"));for(var e in this.logger=n.a.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(t){console.log("onSuccess - la reponse est la suivante : ",t)},onFailure:function(t){200!==t.status&&t.status?console.log("onFailure - Erreur (",t.status,") : ",t.message):console.log("onFailure : ",t.message)}},t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(a.a.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(t){console.log("onSuccess - la réponse brute du service est la suivante : ",t)}),!!(null===this.options.onSuccess||"function"!=typeof this.options.onSuccess))throw new Error(a.a.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){p.a.ssl=this.options.ssl;var i=p.a[this.CLASSNAME].url(this.options.apiKey);"string"==typeof i?this.options.serverUrl=i:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod="string"==typeof t.httpMethod?t.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(a.a.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(a.a.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof t.protocol?t.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(a.a.getMessage("PARAM_UNKNOWN","protocol"))}if("undefined"==typeof window&&"JSONP"===this.options.protocol)throw new Error(a.a.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=t.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}_.prototype={constructor:_,call:function(){this.logger.trace("CommonService::call ()");var t=this;function e(e){this.logger.trace("CommonService::onBuildRequest : ",e),this.callService.call(t,n,i)}function i(e){this.logger.trace("CommonService::onCallService : ",e),this.analyzeResponse.call(t,n,o)}function o(t){if(this.logger.trace("CommonService::onAnalyzeResponse : ",t),!t)return n.call(this,new u.a("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,t)}function n(t){this.logger.trace("CommonService::onError()");var e=t;e instanceof u.a||(e=new u.a(t.message)),this.options.onFailure.call(this,e)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(t,n,e)}).call(t)},buildRequest:function(t,e){this.logger.error("overwritten method !"),t&&t.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")},callService:function(t,e){var i=null,o=this.request,n=!(!this.options.proxyURL||"XHR"!==this.options.protocol);"Geocode"!==this.CLASSNAME&&"ReverseGeocode"!==this.CLASSNAME&&"AutoComplete"!==this.CLASSNAME&&(this.options.serverUrl=r.a.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":f.version},!1)),n&&("GET"===this.options.httpMethod&&(i=this.options.proxyURL+r.a.normalyzeUrl(this.options.serverUrl,this.request,!0),o=null),"POST"===this.options.httpMethod&&(i=this.options.proxyURL+r.a.normalyzeUrl(this.options.serverUrl,null,!0),o=this.request));var a=this,s={url:i||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"!==this.options.protocol,callbackSuffix:this.options.callbackSuffix,data:o,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(i){a.logger.trace("callService::onResponse()");var o=null;if("XHR"===a.options.protocol&&(a.logger.trace("Response XHR",i),o=i),"JSONP"===a.options.protocol){if(a.logger.trace("Response JSON",i),!i)return void t.call(a,new u.a("Le contenu de la reponse est vide !?"));if(i.http){if(200!==i.http.status)return void t.call(a,new u.a({status:i.http.status,message:i.http.error,type:u.a.TYPE_SRVERR}));o=i.xml,a.options.rawResponse&&(o=i)}else o=i}if("function"==typeof a.options.onBeforeParse){var n=a.options.onBeforeParse(o);"string"==typeof n&&(o=n)}a.response=o,e.call(a,o)},onFailure:function(e){a.logger.trace("callService::onFailure()"),e.type=u.a.TYPE_SRVERR,t.call(a,new u.a(e))},onTimeOut:function(){a.logger.trace("callService::onTimeOut()"),t.call(a,new u.a("TimeOut!"))}};d.send(s)},analyzeResponse:function(t,e){this.logger.error("overwritten method !"),t&&t.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")}};e.a=_},function(t,e,i){"use strict";var o=i(5),n=i(8);e.a={check:function(t){var e=o.a.getLogger("checkrightmanagement");if(t){var i=t.key,r=t.resources||[],a=t.services||[];if(0!==r.length){if(0!==a.length){var s={};if(!i){if(!n.a.isConfigLoaded())return void e.warn("WARNING : The 'apiKey' parameter is missing, and the contract key configuration has not been loaded, so impossible to check yours rights !");i=Object.keys(n.a.configuration.generalOptions.apiKeys),e.log(i)}if(n.a.isConfigLoaded()){for(var l=0;l<r.length;l++)for(var c=r[l],h=0;h<a.length;h++){var d=a[h],u=n.a.getServiceParams(c,d,i);u&&0!==Object.keys(u).length?(s[d]||(s[d]=[]),s[d].push(c)):e.warn("WARNING : The contract key configuration has no rights to load this geoportal resource ("+c+") for this service ("+d+") ")}return 0===Object.keys(s).length?void e.warn("WARNING : The contract key configuration has been loaded, and the 'apiKey' parameter has been set, but, there is a problem on the mapping between the contract and the key !"):(s.key=u.key,e.log("right management checked",s),s)}e.warn("WARNING : the contract key configuration has not been loaded, so be carefull !");for(var p={},f=0;f<a.length;f++){var _=a[f];p[_]=[];for(var g=0;g<r.length;g++){var m=r[g];p[_].push(m)}}return p.key=i,e.log("right management not checked",p),p}e.error("WARNING : no parameter 'services' specified !")}else e.error("WARNING : no parameter 'resources' specified !")}else e.error("WARNING : no parameter specified !")}}},,function(t,e,i){"use strict";var o={ssl:!0,url:function(t,e){return(!1===o.ssl?"http://":"https://")+"wxs.ign.fr".concat("/",t,e)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(t){return{"elevation-json":o.url(t,this._key["elevation-json"]),"elevation-xml":o.url(t,this._key["elevation-xml"]),"profil-json":o.url(t,this._key["profil-json"]),"profil-xml":o.url(t,this._key["profil-xml"]),wps:o.url(t,this._key.wps)}}},ProcessIsoCurve:{_key:"/geoportail/isochrone/rest/1.0.0/isochrone",url:function(t){return o.url(t,this._key)}},AutoComplete:{_key:"/ols/apis/completion",url:function(t){return o.url(t,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(t){return o.url(t,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(t){var e="";if(Array.isArray(t)&&t.length>0){e=t[0];for(var i=1;i<t.length;i++)e+=","+t[i]}return{apiKey:o.url(t,this._key.apiKey),apiKeys:o.url(t[0],this._key.apiKeys).replace("%KEYS%",e),aggregate:o.url(t,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(t){return o.url(t,this._key)}},Route:{_key:"/geoportail/itineraire/rest/1.0.0/route",url:function(t){return o.url(t,this._key)}}};e.a=o},function(t,e,i){"use strict";var o={NORTH:"N",SOUTH:"S",EAST:"E",WEST:"O",digitSecond:2,digitDecimal:5,digitRadian:8,roundToDecimal:function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},decimalToRadian:function(t){return this.roundToDecimal(.017453292519943295*t,this.digitRadian)},decimalToGrade:function(t){return this.roundToDecimal(1.1111111111111112*t,this.digitRadian)},decimalToDMS:function(t,e,i){t<0&&(t*=-1);var o=Math.floor(t),n=60*(t-o),r=Math.floor(n),a=60*(n-r),s=this.roundToDecimal(a,this.digitSecond),l=o+"° "+r+"' "+s+'" ';return e&&(l+=e),i?{d:o,m:r,s:s,direction:e}:l},decimalLatToDMS:function(t,e){var i=t<0?this.SOUTH:this.NORTH;return this.decimalToDMS(t,i,e)},decimalLonToDMS:function(t,e){var i=t<0?this.WEST:this.EAST;return this.decimalToDMS(t,i,e)},DMSToDecimal:function(t,e,i,o){var n=t+e/60+i/3600;return n=o===this.SOUTH||o===this.WEST?-1*n:n,this.roundToDecimal(n,this.digitDecimal)}};e.a=o},function(t,e,i){"use strict";var o=i(0),n=i.n(o),r=i(5).a.getLogger("icondefault"),a=n.a.Icon.Default.extend({images:{retina:{shadow:"data:image/png;base64,...",color:{blue:"data:image/png;base64,...",orange:"data:image/png;base64,...",red:"data:image/png;base64,...",green:"data:image/png;base64,..."}},shadow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=",color:{blue:"data:image/png;base64,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",orange:"data:image/png;base64,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",red:"data:image/png;base64,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",green:"data:image/png;base64,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"}},initialize:function(t,e){n.a.Util.extend(this.options,e);var i=null,o=this.images;switch(t){case"red":i=o.color.red;break;case"green":i=o.color.green;break;case"orange":i=o.color.orange;break;case"blue":i=o.color.blue;break;default:i=o.color.blue}this.options.iconUrl=i,this.options.shadowUrl=o.shadow,n.a.Browser.retina&&(this.options.iconRetinaUrl=i,this.options.shadowRetinaUrl=o.shadow)},_getIconUrl:function(t){return r.trace("OVERWRITTEN L.Icon.Default._getIconUrl("+t+")"),n.a.Icon.prototype._getIconUrl.call(this,t)}});e.a=a},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){},function(t,e,i){},function(t,e,i){(function(e,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var o;o=function(){"use strict";function t(t){return"function"==typeof t}var o=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,r=void 0,a=void 0,s=function(t,e){f[n]=t,f[n+1]=e,2===(n+=2)&&(a?a(_):w())},l="undefined"!=typeof window?window:void 0,c=l||{},h=c.MutationObserver||c.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var t=setTimeout;return function(){return t(_,1)}}var f=new Array(1e3);function _(){for(var t=0;t<n;t+=2)(0,f[t])(f[t+1]),f[t]=void 0,f[t+1]=void 0;n=0}var g,m,v,L,w=void 0;function y(t,e){var i=this,o=new this.constructor(A);void 0===o[b]&&O(o);var n=i._state;if(n){var r=arguments[n-1];s((function(){return x(n,o,r,i._result)}))}else C(i,o,t,e);return o}function E(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(A);return M(e,t),e}d?w=function(){return e.nextTick(_)}:h?(m=0,v=new h(_),L=document.createTextNode(""),v.observe(L,{characterData:!0}),w=function(){L.data=m=++m%2}):u?((g=new MessageChannel).port1.onmessage=_,w=function(){return g.port2.postMessage(0)}):w=void 0===l?function(){try{var t=Function("return this")().require("vertx");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(_)}:p()}catch(t){return p()}}():p();var b=Math.random().toString(36).substring(2);function A(){}function k(e,i,o){i.constructor===e.constructor&&o===y&&i.constructor.resolve===E?function(t,e){1===e._state?S(t,e._result):2===e._state?T(t,e._result):C(e,void 0,(function(e){return M(t,e)}),(function(e){return T(t,e)}))}(e,i):void 0===o?S(e,i):t(o)?function(t,e,i){s((function(t){var o=!1,n=function(t,e,i,o){try{t.call(e,i,o)}catch(t){return t}}(i,e,(function(i){o||(o=!0,e!==i?M(t,i):S(t,i))}),(function(e){o||(o=!0,T(t,e))}),t._label);!o&&n&&(o=!0,T(t,n))}),t)}(e,i,o):S(e,i)}function M(t,e){if(t===e)T(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var i=void 0;try{i=e.then}catch(e){return void T(t,e)}k(t,e,i)}else S(t,e)}function P(t){t._onerror&&t._onerror(t._result),D(t)}function S(t,e){void 0===t._state&&(t._result=e,t._state=1,0!==t._subscribers.length&&s(D,t))}function T(t,e){void 0===t._state&&(t._state=2,t._result=e,s(P,t))}function C(t,e,i,o){var n=t._subscribers,r=n.length;t._onerror=null,n[r]=e,n[r+1]=i,n[r+2]=o,0===r&&t._state&&s(D,t)}function D(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var o=void 0,n=void 0,r=t._result,a=0;a<e.length;a+=3)o=e[a],n=e[a+i],o?x(i,o,n,r):n(r);t._subscribers.length=0}}function x(e,i,o,n){var r=t(o),a=void 0,s=void 0,l=!0;if(r){try{a=o(n)}catch(t){l=!1,s=t}if(i===a)return void T(i,new TypeError("A promises callback cannot return that same promise."))}else a=n;void 0!==i._state||(r&&l?M(i,a):!1===l?T(i,s):1===e?S(i,a):2===e&&T(i,a))}var R=0;function O(t){t[b]=R++,t._state=void 0,t._result=void 0,t._subscribers=[]}var I=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(A),this.promise[b]||O(this.promise),o(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&S(this.promise,this._result))):T(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;void 0===this._state&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,o=i.resolve;if(o===E){var n=void 0,r=void 0,a=!1;try{n=t.then}catch(t){a=!0,r=t}if(n===y&&void 0!==t._state)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(i===N){var s=new i(A);a?T(s,r):k(s,t,n),this._willSettleAt(s,e)}else this._willSettleAt(new i((function(e){return e(t)})),e)}else this._willSettleAt(o(t),e)},t.prototype._settledAt=function(t,e,i){var o=this.promise;void 0===o._state&&(this._remaining--,2===t?T(o,i):this._result[e]=i),0===this._remaining&&S(o,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;C(t,void 0,(function(t){return i._settledAt(1,e,t)}),(function(t){return i._settledAt(2,e,t)}))},t}(),N=function(){function e(t){this[b]=R++,this._result=this._state=void 0,this._subscribers=[],A!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){M(t,e)}),(function(e){T(t,e)}))}catch(e){T(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this.constructor;return t(e)?this.then((function(t){return i.resolve(e()).then((function(){return t}))}),(function(t){return i.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return N.prototype.then=y,N.all=function(t){return new I(this,t).promise},N.race=function(t){var e=this;return o(t)?new e((function(i,o){for(var n=t.length,r=0;r<n;r++)e.resolve(t[r]).then(i,o)})):new e((function(t,e){return e(new TypeError("You must pass an array to race."))}))},N.resolve=E,N.reject=function(t){var e=new this(A);return T(e,t),e},N._setScheduler=function(t){a=t},N._setAsap=function(t){s=t},N._asap=s,N.polyfill=function(){var t=void 0;if(void 0!==i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var o=null;try{o=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===o&&!e.cast)return}t.Promise=N},N.Promise=N,N},t.exports=o()}).call(this,i(25),i(15))},function(t){t.exports=JSON.parse('{"_from":"geoportal-access-lib@3.2.0","_id":"geoportal-access-lib@3.2.0","_inBundle":false,"_integrity":"sha512-914Yk0C3mnYI+X56Y40t4OJwBiZ1nEbW8D9Dse4WcS54Au8ZpkZ9Ep1efNYMxC5618zqn7r4VvzF58Xa+BqzEQ==","_location":"/geoportal-access-lib","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"geoportal-access-lib@3.2.0","name":"geoportal-access-lib","escapedName":"geoportal-access-lib","rawSpec":"3.2.0","saveSpec":null,"fetchSpec":"3.2.0"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/geoportal-access-lib/-/geoportal-access-lib-3.2.0.tgz","_shasum":"7a707b75743f01b5465cc72d1316f13f8b87df7a","_spec":"geoportal-access-lib@3.2.0","_where":"/home/JPBazonnais/Projets/API/geoportal-extensions","author":{"name":"IGNF"},"bugs":{"url":"https://github.com/IGNF/geoportal-access-lib/issues"},"bundleDependencies":false,"date":"04/10/2022","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","xmldom":"^0.1.27"},"deprecated":false,"description":"French Geoportal resources access library","devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"homepage":"https://github.com/IGNF/geoportal-access-lib#readme","keywords":["geoportail","webservice","javascript","es6"],"license":"CECILL-B","main":"dist/GpServices-src.js","module":"src/Gp.js","name":"geoportal-access-lib","nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"optionalDependencies":{},"peerDependencies":{},"repository":{"type":"git","url":"git+https://github.com/IGNF/geoportal-access-lib.git"},"scripts":{"build":"webpack --mode=none","build:dev":"webpack --mode=development","build:prod":"webpack --mode=production","clean":"echo \\"Warning: no yet implemented!\\" && exit 0","cover":"nyc --reporter=lcov --reporter=text npm run test","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open","eslint":"eslint src/","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","setup":"npm install","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js"},"version":"3.2.0"}')},function(t,e){t.exports=void 0},,,,,function(t,e){var i,o,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(t){o=a}}();var l,c=[],h=!1,d=-1;function u(){h&&l&&(h=!1,l.length?c=l.concat(c):d=-1,c.length&&p())}function p(){if(!h){var t=s(u);h=!0;for(var e=c.length;e;){for(l=c,c=[];++d<e;)l&&l[d].run();d=-1,e=c.length}l=null,h=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function _(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||h||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=_,n.addListener=_,n.once=_,n.off=_,n.removeListener=_,n.removeAllListeners=_,n.emit=_,n.prependListener=_,n.prependOnceListener=_,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){t.exports=void 0},,,,,,function(t,e,i){"use strict";var o=i(3),n=i(1),r=i(2),a=i(9),s=i(12);function l(t){if(!(this instanceof l))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=o.a.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=t||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}l.CLASSNAME="AltiRequest",l.prototype={constructor:l,setPositions:function(t){for(var e=[],i=0;i<t.length;i++){var o=t[i];o.lon&&o.lat&&e.push(o)}this.positions=e},getPositions:function(t){if(!t)return this.positions;var e=this.positions.length-1;return t>e||t<e?(this.logger.warn("index out of range !"),this.positions):this.positions[t]},addPositions:function(t){for(var e=0;e<t.length;e++){var i=t[e];i.lon&&i.lat&&this.positions.push(t[e])}},getLon:function(){for(var t=[],e=0;e<this.positions.length;e++)t.push(this.positions[e].lon);return this.logger.trace(t),t.join(this.delimiter)},getLat:function(){for(var t=[],e=0;e<this.positions.length;e++)t.push(this.positions[e].lat);return this.logger.trace(t),t.join(this.delimiter)}},l.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"delimiter",v:this.delimiter}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"format",v:this.format}),t};var c=l;function h(t){if(!(this instanceof h))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",c.apply(this,arguments),this.logger=o.a.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}h.prototype=Object.create(c.prototype,{zonly:{get:function(){return this._zonly},set:function(t){this._zonly=t}}}),h.prototype.constructor=h,h.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"zonly",v:this.zonly}),t.push({k:"format",v:this.format}),t};var d=h;function u(t){if(!(this instanceof u))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",c.apply(this,arguments),this.logger=o.a.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}u.prototype=Object.create(c.prototype,{sampling:{get:function(){return this._sampling},set:function(t){this._sampling=t}}}),u.prototype.constructor=u,u.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"sampling",v:this.sampling}),t.push({k:"format",v:this.format}),t};var p=u;function f(t){if(this.logger=o.a.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof f))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=t||{},!this.options)throw new Error(n.a.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(n.a.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new d(this.options.param);break;case"Profil":this.DataObject=new p(this.options.param);break;default:throw new Error(n.a.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}f.prototype={requestString:null,constructor:f,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:"lon=__LON__\nlat=__LAT__\nindent=__INDENT__\ncrs='__CRS__'\n",input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var t="";return"POST"===this.method?t=this.template.post.value:"GET"===this.method&&(t=this.template.get.value),t=(t=(t=(t=t.replace(/__LON__/g,this.DataObject.getLon())).replace(/__LAT__/g,this.DataObject.getLat())).replace(/__INDENT__/g,this.DataObject.indent)).replace(/__CRS__/g,this.DataObject.crs),t+=this.__addDataInputs(),this.logger.trace("traduction tmpl",t),this.requestString=t,this.requestString},__addDataInputs:function(){var t;if(this.logger.trace("AltiRequestREST::addDataInput ()"),"POST"===this.method)t=this.template.post;else{if("GET"!==this.method)throw new Error("No other HTTP method supported by the service !");t=this.template.get}if("AltiElevationRequest"===this.DataObject.CLASSNAME)return t.input.point.replace(/__ZONLY__/g,this.DataObject.zonly);if("AltiProfilRequest"===this.DataObject.CLASSNAME)return t.input.profil.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};var _=f;function g(t){if(this.logger=o.a.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof g))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=t||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}g.prototype={requestString:null,constructor:g,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=\x3c!-- __DATAINPUTS__ --\x3e",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs>\x3c!-- __DATAINPUTS__ --\x3e</wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var t="";if("POST"===this.method)t=this.template.post.value;else{if("GET"!==this.method)return this.logger.error("No other method supported by the service !"),!1;t=this.template.get.value}return t=(t=(t=(t=(t=t.replace(/__SERVICE__/g,this.paramservice)).replace(/__VERSION__/g,this.paramversion)).replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput)).replace(/__IDENTIFIER__/g,this.paramidentifier)).replace(/__REQUEST__/g,this.paramrequest),"POST"===this.method&&(t=(t=t.replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(t=t.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=t,this.logger.trace("traduction tmpl",t),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var t,e="GET"===this.method?this.template.get.input:this.template.post.input,i="GET"===this.method?";":"",o="",n=this,r=this.DataObject.getData(),a=0;a<r.length;a++)t=a,i&&(i=t===r.length-1?"":";"),o=o.concat(n.__addDataInput(e,r[t].k,r[t].v),i);return o},__addDataInput:function(t,e,i){var o=t;return o=(o=o.replace(/__KEY__/g,e)).replace(/__DATA__/g,i)},setMethod:function(t){"GET"===t||"POST"===t?this.method=t:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var m=g,v={build:function(t){if(o.a.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!t)throw new Error(n.a.getMessage("PARAM_EMPTY","options"));if(!t.type)throw new Error(n.a.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var e=null;switch(t.type){case"Elevation":t.wps.identifier="gs:WPSElevation",e=new d(t.param);break;case"Profil":t.wps.identifier="gs:WPSLineElevation",e=new p(t.param);break;default:throw new Error(n.a.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var i={data:e,method:t.method,param:t.wps},r=new m(i);if(!r.processRequestString())throw new Error("Enable to process request !");return r.requestString}},L={build:function(t){o.a.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var e=null,i={type:t.sampling?"Profil":"Elevation",method:t.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};i.param.positions=t.positions,i.param.format=t.outputFormat,i.param.sampling=t.sampling,i.param.zonly=t.zonly;var n=!(null===t.onError||"function"!=typeof t.onError),a=!(null===t.onSuccess||"function"!=typeof t.onSuccess),s=null;switch(t.api){case"REST":var l=new _(i);if(!l.processRequestString()){if(s="Error in process request (rest) !",n)return void t.onError.call(t.scope,new r.a(s));throw new Error(s)}e=l.requestString;break;case"WPS":if(i.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(e=v.build(i))){if(s="Error in process request (wps) !",n)return void t.onError.call(t.scope,new r.a(s));throw new Error(s)}break;default:if(s="Type of API is not supported by service (REST or WPS) !",n)return void t.onError.call(t.scope,new r.a(s));throw new Error(s)}return a&&t.onSuccess.call(t.scope,e),e}};function w(t){if(!(this instanceof w))throw new TypeError("XML constructor cannot be called as a function.");this.logger=o.a.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,t&&(t.xmlString&&"string"==typeof t.xmlString&&(this.xmlString=t.xmlString,this.xmlDoc=y(t.xmlString)),t.reader&&this.setReader(t.reader))}function y(t){if("undefined"==typeof window)return(new(0,i(20).DOMParser)).parseFromString(t,"text/xml");var e,o,n="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){(o=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,o.loadXML(t);var r=o.parseError;if(r.errorCode)throw r.line&&r.linepos&&(n+="( ligne "+r.line+", colonne "+r.linepos),r.reason&&(n+=":  "+r.reason+")"),new Error(n);return o}if(window.DOMParser){e=new window.DOMParser;try{o=e.parseFromString(t,"text/xml")}catch(t){throw"SyntaxError"===t.message?new Error(n):new Error("Erreur lors du parsing de la réponse du service : "+t.message)}if(o.getElementsByTagName("parsererror").length>0)for(var a=o.getElementsByTagName("parsererror"),s=0;s<a.length;s++){var l=a[s].innerHTML;if(-1===l.indexOf("Huge input lookup"))throw n+="("+l+")",new Error(n)}else if(!o.documentElement)throw new Error(n);return o}throw new Error("Incompatible DOM Parser pour ce navigateur !")}w.prototype={constructor:w,getXMLString:function(){return this.xmlString},setXMLString:function(t){t&&"string"==typeof t&&(this.xmlString=t,this.xmlDoc=y(t))},getReader:function(){return this.reader},setReader:function(t){t&&t.read&&"function"==typeof t.read&&(this.reader=t)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(t){this.xmlDoc=t},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=y(this.xmlString)),this.xmlDoc){var t,e=function(t){var e;9===t.nodeType?e=t.documentElement:1===t.nodeType&&(e=t);return e}(this.xmlDoc);return e?(this.reader&&this.reader.read?t=this.reader.read(e):(t={})[e.nodeName]=function t(e){var i={};if(e.attributes.length>0){var o=function(t){if(t.attributes.length>0){for(var e={},i=t.attributes,o=0;o<i.length;o++){var n=i[o];e[n.nodeName]=n.nodeValue}return e}}(e);i.attributes=o}if(e.hasChildNodes())for(var n,r={},a=e.childNodes,s=0;s<a.length;s++)if(3===(n=a[s]).nodeType)i.textContent=n.nodeValue;else if(1===n.nodeType)if(r=t(n),i[n.nodeName]){if(!Array.isArray(i[n.nodeName])){var l=i[n.nodeName];i[n.nodeName]=[],i[n.nodeName].push(l)}i[n.nodeName].push(r)}else i[n.nodeName]=r;return i}(e),t):{}}}};var E=w;function b(){if(!(this instanceof b))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}b.prototype={constructor:b};var A=b;function k(){if(!(this instanceof k))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}k.prototype={constructor:k};var M=k,P={};P.READERS={elevations:function(t){var e=new A;if(t.hasChildNodes())for(var i,o,n=t.childNodes,r=0;r<n.length;r++)i=n[r],P.READERS[i.nodeName]&&(o=P.READERS[i.nodeName](i),e.elevations.push(o));return e},elevation:function(t){var e=new M;if(t.hasChildNodes())for(var i,o=t.childNodes,n=0;n<o.length;n++)i=o[n],P.READERS[i.nodeName]&&P.READERS[i.nodeName](i,e);return e},lat:function(t,e){var i=t.firstChild;if(!i||3!==i.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");e.lat=parseFloat(i.nodeValue)},lon:function(t,e){var i=t.firstChild;if(!i||3!==i.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");e.lon=parseFloat(i.nodeValue)},z:function(t,e){var i=t.firstChild;if(!i||3!==i.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!e)return(e=new M).z=parseFloat(i.nodeValue),e;e.z=parseFloat(i.nodeValue)},acc:function(t,e){var i=t.firstChild;if(!i||3!==i.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");e.acc=parseFloat(i.nodeValue)},exceptionreport:function(t){var e={};if(t.hasChildNodes())for(var i,o=t.childNodes,n=0;n<o.length;n++)"Exception"===(i=o[n]).nodeName&&(e.exceptionReport=P.READERS.exception(i));return e},exception:function(t){var e={},i=t.getAttribute("exceptionCode");i&&(e.exceptionCode=i);var o=t.firstChild;return o&&3===o.nodeType&&(e.exception=o.nodeValue),e},error:function(t){var e={error:{}};if(t.hasChildNodes())for(var i,o=t.childNodes,n=0;n<o.length;n++){var r;1===(i=o[n]).nodeType&&"code"===i.nodeName&&(r=i.firstChild)&&3===r.nodeType&&(e.error.code=r.nodeValue),1===i.nodeType&&"description"===i.nodeName&&(r=i.firstChild)&&3===r.nodeType&&(e.error.description=r.nodeValue)}return e}},P.read=function(t){if("elevations"===t.nodeName)return P.READERS.elevations(t);if("ExceptionReport"===t.nodeName)return P.READERS.exceptionreport(t);if("error"===t.nodeName)return P.READERS.error(t);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var S=P,T={build:function(t){var e=o.a.getLogger("AltiResponseFactory");e.trace(["AltiResponseFactory::build()"]);var i=null;if(t.response){if(t.rawResponse)e.trace("analyze response : raw"),i=t.response;else{switch(t.outputFormat){case"xml":e.trace("analyze response : xml");try{var a=new E({reader:S});if("string"==typeof t.response?a.setXMLString(t.response):a.setXMLDoc(t.response),!(i=a.parse()))throw new Error(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(e){var s=e.message;return void t.onError.call(t.scope,new r.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",s),status:200,type:r.a.TYPE_SRVERR}))}break;case"json":e.trace("analyze response : json"),e.trace("analyze response : ",typeof t.response);var l=null;if((l="string"==typeof t.response?JSON.parse(t.response):t.response)&&l.error)return void t.onError.call(t.scope,new r.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",l.error.description),status:200,type:r.a.TYPE_SRVERR}));if(l){var c,h=l.elevations,d=new A;if(Array.isArray(h)&&h.length)for(var u=0;u<h.length;u++)c=new M,"object"==typeof h[u]?(h[u].lon&&(c.lon=h[u].lon),h[u].lat&&(c.lat=h[u].lat),h[u].z&&(c.z=h[u].z),h[u].acc&&(c.acc=h[u].acc)):"number"==typeof h[u]&&(c.z=h[u]),Array.isArray(d.elevations)&&d.elevations.push(c);i=d}if(!i)return void t.onError.call(t.scope,new r.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:r.a.TYPE_UNKERR,status:-1}));break;default:return void t.onError.call(t.scope,new r.a({message:n.a.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:r.a.TYPE_UNKERR,status:-1}))}if(i.exceptionReport)return void t.onError.call(t.scope,new r.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",i.exceptionReport),type:r.a.TYPE_SRVERR,status:200}));if(i.error){var p=i.error.description;return void t.onError.call(t.scope,new r.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",p),type:r.a.TYPE_SRVERR,status:200}))}}t.onSuccess.call(t.scope,i)}else t.onError.call(t.scope,new r.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")))}};function C(t){if(!(this instanceof C))throw new TypeError(n.a.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",a.a.apply(this,arguments),this.logger=o.a.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!t.positions)throw new Error(n.a.getMessage("PARAM_MISSING","positions"));if(0===t.positions.length)throw new Error(n.a.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=t.positions,this.options.outputFormat="string"==typeof t.outputFormat?t.outputFormat.toLowerCase():"xml",this.options.sampling=t.sampling||null,this.options.api="string"==typeof t.api?t.api.toUpperCase():"REST","REST"===this.options.api&&(this.options.httpMethod="GET"),this.options.zonly=t.zonly||!1,!this.options.serverUrl){var e=s.a.Alti.url(this.options.apiKey),i=null;switch(this.options.api){case"WPS":i=e.wps;break;case"REST":var r=(t.sampling?"profil":"elevation")+"-"+this.options.outputFormat;i=e[r];break;default:throw new Error(n.a.getMessage("PARAM_UNKNOWN","api"))}if(!i)throw new Error("Url by default not found !");this.options.serverUrl=i,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var l=this.options.serverUrl.lastIndexOf(".");if(-1!==l){var c=this.options.serverUrl.substring(l+1);if(c&&c.length<5)switch(this.logger.trace("Server Extension URL : "+c),c.toLowerCase()){case"json":case"xml":this.options.outputFormat=c.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}C.prototype=Object.create(a.a.prototype,{}),C.prototype.constructor=C,C.prototype.buildRequest=function(t,e){var i={httpMethod:this.options.httpMethod,onSuccess:function(t){this.request=t,e.call(this,this.request)},onError:t,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};L.build(i)},C.prototype.analyzeResponse=function(t,e){if(this.response){var i={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};T.build(i)}else t.call(this,new r.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")))};e.a=C},,function(t,e,i){},,,function(t,e){!function(t,e,i){var o;L.drawVersion="1.0.4",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e);var i=L.version.split(".");1===parseInt(i[0],10)&&parseInt(i[1],10)>=2?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire(L.Draw.Event.CREATED,{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(t,e){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=e.getLatLngs(),o=i.splice(-1,1)[0];this._poly.setLatLngs(i),this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(o,!1)}},addVertex:function(t){this._markers.length>=2&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0))},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var t=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),e=this._poly.newLatLngIntersects(t[t.length-1]);!this.options.allowIntersection&&e||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(t),this._clickHandled=!0,this._disableNewMarkers();var e=t.originalEvent,i=e.clientX,o=e.clientY;this._startPoint.call(this,i,o)}},_startPoint:function(t,e){this._mouseDownOrigin=L.point(t,e)},_onMouseUp:function(t){var e=t.originalEvent,i=e.clientX,o=e.clientY;this._endPoint.call(this,i,o,t),this._clickHandled=null},_endPoint:function(e,i,o){if(this._mouseDownOrigin){var n=L.point(e,i).distanceTo(this._mouseDownOrigin),r=this._calculateFinishDistance(o.latlng);this.options.maxPoints>1&&this.options.maxPoints==this._markers.length+1?(this.addVertex(o.latlng),this._finishShape()):r<10&&L.Browser.touch?this._finishShape():Math.abs(n)<9*(t.devicePixelRatio||1)&&this.addVertex(o.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(t){var e,i,o=t.originalEvent;!o.touches||!o.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(e=o.touches[0].clientX,i=o.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,e,i),this._endPoint.call(this,e,i,t),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(t){var e;if(this._markers.length>0){var i;if(this.type===L.Draw.Polyline.TYPE)i=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;i=this._markers[0]}var o=this._map.latLngToContainerPoint(i.getLatLng()),n=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),r=this._map.latLngToContainerPoint(n.getLatLng());e=o.distanceTo(r)}else e=1/0;return e},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers?this._markers.length:0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,o,n,r=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),a=this.options.guidelineDistance,s=this.options.maxGuideLineLength,l=r>s?r-s:a;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));l<r;l+=this.options.guidelineDistance)i=l/r,o={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},(n=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer)).style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(n,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,i=this.options.showLength;return 0===this._markers.length?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=i?this._getMeasurementString():"",t=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var i,o,n=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=n-(e?2:1),o=L.GeometryUtil.isVersion07x()?t.distanceTo(this._markers[i].getLatLng())*(this.options.factor||1):this._map.distance(t,this._markers[i].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=o*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=L.GeometryUtil.isVersion07x()?i&&e&&e.distanceTo?this._measurementRunningTotal+e.distanceTo(i)*(this.options.factor||1):this._measurementRunningTotal||0:i&&e?this._measurementRunningTotal+this._map.distance(e,i)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout(function(){this._disableMarkers=!1}.bind(this),50)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?(t=L.drawLocal.draw.handlers.polygon.tooltip.cont,e=this._getMeasurementString()):(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area,e="";return t||this.options.showLength?(this.options.showLength&&(e=L.Draw.Polyline.prototype._getMeasurementString.call(this)),t&&(e+="<br>"+L.GeometryUtil.readableArea(t,this.options.metric,this.options.precision)),e):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),e.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(e,"mouseup",this._onMouseUp,this),L.DomEvent.off(e,"touchend",this._onMouseUp,this),e.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(e,"mouseup",this._onMouseUp,this).on(e,"touchend",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(t){this._shape||this._isCurrentlyTwoClickDrawing?this._isCurrentlyTwoClickDrawing&&!function(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}(t.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this):this._isCurrentlyTwoClickDrawing=!0},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o=L.Draw.SimpleShape.prototype._getTooltipText.call(this),n=this._shape,r=this.options.showArea;return n&&(t=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=r?L.GeometryUtil.readableArea(e,this.options.metric):""),{text:o.text,subtext:i}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=this._createMarker(e),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(t){return new L.Marker(t,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(t){this._onMouseMove(t),this._onClick()},_fireCreatedEvent:function(){var t=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},_fireCreatedEvent:function(){var t=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)},_createMarker:function(t){return new L.CircleMarker(t,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){if(L.GeometryUtil.isVersion07x())var e=this._startLatLng.distanceTo(t);else e=this._map.distance(this._startLatLng,t);this._shape?this._shape.setRadius(e):(this._shape=new L.Circle(this._startLatLng,e,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,o=this.options.showRadius,n=this.options.metric;if(this._tooltip.updatePosition(i),this._isDrawing){this._drawShape(i),e=this._shape.getRadius().toFixed(1);var r="";o&&(r=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(e,n,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:r})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(t,e){this._marker=t,L.setOptions(this,e)},addHooks:function(){var t=this._marker;t.dragging.enable(),t.on("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},removeHooks:function(){var t=this._marker;t.dragging.disable(),t.off("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},_onDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_toggleMarkerHighlight:function(){var t=this._marker._icon;t&&(t.style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display="")},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,o=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=o+"px"}}),L.Marker.addInitHook((function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())})),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(t){this.latlngs=[t._latlngs],t._holes&&(this.latlngs=this.latlngs.concat(t._holes)),this._poly=t,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(t){for(var e=0;e<this._verticesHandlers.length;e++)t(this._verticesHandlers[e])},addHooks:function(){this._initHandlers(),this._eachVertexHandler((function(t){t.addHooks()}))},removeHooks:function(){this._eachVertexHandler((function(t){t.removeHooks()}))},updateMarkers:function(){this._eachVertexHandler((function(t){t.updateMarkers()}))},_initHandlers:function(){this._verticesHandlers=[];for(var t=0;t<this.latlngs.length;t++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[t],this._poly.options.poly))},_updateLatLngs:function(t){this.latlngs=[t.layer._latlngs],t.layer._holes&&(this.latlngs=this.latlngs.concat(t.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(t,e,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=t,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this._latlngs=e,L.setOptions(this,i)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var t=this._poly,e=t._path;t instanceof L.Polygon||(t.options.fill=!1,t.options.editing&&(t.options.editing.fill=!1)),e&&t.options.editing&&t.options.editing.className&&(t.options.original.className&&t.options.original.className.split(" ").forEach((function(t){L.DomUtil.removeClass(e,t)})),t.options.editing.className.split(" ").forEach((function(t){L.DomUtil.addClass(e,t)}))),t.setStyle(t.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._poly,e=t._path;e&&t.options.editing&&t.options.editing.className&&(t.options.editing.className.split(" ").forEach((function(t){L.DomUtil.removeClass(e,t)})),t.options.original.className&&t.options.original.className.split(" ").forEach((function(t){L.DomUtil.addClass(e,t)}))),t.setStyle(t.options.original),t._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,o,n,r,a=this._defaultShape();for(t=0,i=a.length;t<i;t++)(o=this._createMarker(a[t],t)).on("click",this._onMarkerClick,this),o.on("contextmenu",this._onContextMenu,this),this._markers.push(o);for(t=0,e=i-1;t<i;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(n=this._markers[e],r=this._markers[t],this._createMiddleMarker(n,r),this._updatePrevNext(n,r))},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(i),i},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var t=this._defaultShape(),e=[].splice.apply(t,arguments);return this._poly._convertLatLngs(t,!0),this._poly.redraw(),e},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(t){var e=t.target,i=this._poly,o=L.LatLngUtil.cloneLatLng(e._origLatLng);if(L.extend(e._origLatLng,e._latlng),i.options.poly){var n=i._map._editTooltip;if(!i.options.poly.allowIntersection&&i.intersects()){L.extend(e._origLatLng,o),e.setLatLng(o);var r=i.options.color;i.setStyle({color:this.options.drawError.color}),n&&n.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout((function(){i.setStyle({color:r}),n&&n.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})}),1e3)}}e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var a=this._poly.getLatLngs();this._poly._convertLatLngs(a,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._defaultShape().length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(t){var e=t.target;this._poly;this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:e,layers:this._markerGroup,poly:this._poly}),L.DomEvent.stopPropagation},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e),o=t.target;L.extend(o._origLatLng,i),o._middleLeft&&o._middleLeft.setLatLng(this._getMiddleLatLng(o._prev,o)),o._middleRight&&o._middleRight.setLatLng(this._getMiddleLatLng(o,o._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(t,e){this._markerGroup.eachLayer((function(i){i._index>t&&(i._index+=e)}))},_createMiddleMarker:function(t,e){var i,o,n,r=this._getMiddleLatLng(t,e),a=this._createMarker(r);a.setOpacity(.6),t._middleRight=e._middleLeft=a,o=function(){a.off("touchmove",o,this);var n=e._index;a._index=n,a.off("click",i,this).on("click",this._onMarkerClick,this),r.lat=a.getLatLng().lat,r.lng=a.getLatLng().lng,this._spliceLatLngs(n,0,r),this._markers.splice(n,0,a),a.setOpacity(1),this._updateIndexes(n,1),e._index++,this._updatePrevNext(t,a),this._updatePrevNext(a,e),this._poly.fire("editstart")},n=function(){a.off("dragstart",o,this),a.off("dragend",n,this),a.off("touchmove",o,this),this._createMiddleMarker(t,a),this._createMiddleMarker(a,e)},i=function(){o.call(this),n.call(this),this._fireEdit()},a.on("click",i,this).on("dragstart",o,this).on("dragend",n,this).on("touchmove",o,this),this._markerGroup.addLayer(a)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,o=i.project(t.getLatLng()),n=i.project(e.getLatLng());return i.unproject(o._add(n)._divideBy(2))}}),L.Polyline.addInitHook((function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",(function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()})),this.on("remove",(function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})))})),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(t,e){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){var t=this._shape;this._shape._map&&(this._map=this._shape._map,t.setStyle(t.options.editing),t._map&&(this._map=t._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var t=this._shape;if(t.setStyle(t.options.original),t._map){this._unbindMarker(this._moveMarker);for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._unbindMarker(this._resizeMarkers[e]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(t){t.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(t){t.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(t){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t),"function"==typeof this._getCorners){var e=this._getCorners(),i=t.target,o=i._cornerIndex;i.setOpacity(0),this._oppositeCorner=e[(o+2)%4],this._toggleCornerMarkers(0,o)}this._shape.fire("editstart")},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e);return t.target===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),!1},_onTouchEnd:function(t){t.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;e<i;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),i=t.target._cornerIndex;this._oppositeCorner=e[(i+2)%4],this._toggleCornerMarkers(0,i)},_onMarkerDragEnd:function(t){var e,i=t.target;i===this._moveMarker&&(e=this._shape.getBounds().getCenter(),i.setLatLng(e)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),o=this._shape.getBounds().getCenter(),n=[],r=0,a=i.length;r<a;r++)e=[i[r].lat-o.lat,i[r].lng-o.lng],n.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(n),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var t=this._shape.getBounds();return[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook((function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())})),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(t){if(this._resizeMarkers.length){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e)}this._shape.setLatLng(t),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook((function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",(function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()})),this.on("remove",(function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))})),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_resize:function(t){var e=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=e.distanceTo(t):radius=this._map.distance(e,t),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook((function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())})),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(t,e){var i={};if(void 0!==t.touches){if(!t.touches.length)return;i=t.touches[0]}else{if("touch"!==t.pointerType)return;if(i=t,!this._filterClick(t))return}var o=this._map.mouseEventToContainerPoint(i),n=this._map.mouseEventToLayerPoint(i),r=this._map.layerPointToLatLng(n);this._map.fire(e,{latlng:r,layerPoint:n,containerPoint:o,pageX:i.pageX,pageY:i.pageY,originalEvent:t})},_filterClick:function(t){var e=t.timeStamp||t.originalEvent.timeStamp,i=L.DomEvent._lastClick&&e-L.DomEvent._lastClick;return i&&i>100&&i<500||t.target._simulatedClick&&!t._simulated?(L.DomEvent.stop(t),!1):(L.DomEvent._lastClick=e,!0)},_onTouchStart:function(t){if(this._map._loaded){this._touchEvent(t,"touchstart")}},_onTouchEnd:function(t){if(this._map._loaded){this._touchEvent(t,"touchend")}},_onTouchCancel:function(t){if(this._map._loaded){var e="touchcancel";this._detectIE()&&(e="pointercancel"),this._touchEvent(t,e)}},_onTouchLeave:function(t){if(this._map._loaded){this._touchEvent(t,"touchleave")}},_onTouchMove:function(t){if(this._map._loaded){this._touchEvent(t,"touchmove")}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);if(e.indexOf("Trident/")>0){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?e.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):e.concat(["touchcancel"]),L.DomUtil.addClass(t,"leaflet-clickable"),L.DomEvent.on(t,"click",this._onMouseClick,this),L.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)L.DomEvent.on(t,e[i],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);if(e.indexOf("Trident/")>0){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,o=t.length;i<o;i++)Array.isArray(t[i])?e.push(L.LatLngUtil.cloneLatLngs(t[i])):e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},o={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,o=t.length,n=0,r=Math.PI/180;if(o>2){for(var a=0;a<o;a++)e=t[a],n+=((i=t[(a+1)%o]).lng-e.lng)*r*(2+Math.sin(e.lat*r)+Math.sin(i.lat*r));n=6378137*n*6378137/2}return Math.abs(n)},formattedNumber:function(t,e){var i=parseFloat(t).toFixed(e),o=L.drawLocal.format&&L.drawLocal.format.numeric,n=o&&o.delimiters,r=n&&n.thousands,a=n&&n.decimal;if(r||a){var s=i.split(".");i=r?s[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+r):s[0],a=a||".",s.length>1&&(i=i+a+s[1])}return i},readableArea:function(t,e,i){var n,r;return i=L.Util.extend({},o,i),e?(r=["ha","m"],type=typeof e,"string"===type?r=[e]:"boolean"!==type&&(r=e),n=t>=1e6&&-1!==r.indexOf("km")?L.GeometryUtil.formattedNumber(1e-6*t,i.km)+" km²":t>=1e4&&-1!==r.indexOf("ha")?L.GeometryUtil.formattedNumber(1e-4*t,i.ha)+" ha":L.GeometryUtil.formattedNumber(t,i.m)+" m²"):n=(t/=.836127)>=3097600?L.GeometryUtil.formattedNumber(t/3097600,i.mi)+" mi²":t>=4840?L.GeometryUtil.formattedNumber(t/4840,i.ac)+" acres":L.GeometryUtil.formattedNumber(t,i.yd)+" yd²",n},readableDistance:function(t,e,i,n,r){var a;switch(r=L.Util.extend({},o,r),e?"string"==typeof e?e:"metric":i?"feet":n?"nauticalMile":"yards"){case"metric":a=t>1e3?L.GeometryUtil.formattedNumber(t/1e3,r.km)+" km":L.GeometryUtil.formattedNumber(t,r.m)+" m";break;case"feet":t*=3.28083,a=L.GeometryUtil.formattedNumber(t,r.ft)+" ft";break;case"nauticalMile":t*=.53996,a=L.GeometryUtil.formattedNumber(t/1e3,r.nm)+" nm";break;case"yards":default:a=(t*=1.09361)>1760?L.GeometryUtil.formattedNumber(t/1760,r.mi)+" miles":L.GeometryUtil.formattedNumber(t,r.yd)+" yd"}return a},isVersion07x:function(){var t=L.version.split(".");return 0===parseInt(t[0],10)&&7===parseInt(t[1],10)}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,o){return this._checkCounterclockwise(t,i,o)!==this._checkCounterclockwise(e,i,o)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,o)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,o=this._getProjectedPoints(),n=o?o.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=n-1;t>=3;t--)if(e=o[t-1],i=o[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(t),e)},newPointIntersects:function(t,e){var i=this._getProjectedPoints(),o=i?i.length:0,n=i?i[o-1]:null,r=o-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(n,t,r,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._getProjectedPoints(),i=e?e.length:0;return!e||(i+=t||0)<=3},_lineSegmentsIntersectsRange:function(t,e,i,o){var n,r,a=this._getProjectedPoints();o=o||0;for(var s=i;s>o;s--)if(n=a[s-1],r=a[s],L.LineUtil.segmentsIntersect(t,e,n,r))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var t=[],e=this._defaultShape(),i=0;i<e.length;i++)t.push(this._map.latLngToLayerPoint(e[i]));return t}}),L.Polygon.include({intersects:function(){var t,e,i,o,n=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(t=n.length,e=n[0],i=n[t-1],o=t-2,this._lineSegmentsIntersectsRange(i,e,o,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");var e;L.Control.prototype.initialize.call(this,t),this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),o=!1;for(var n in this._toolbars)this._toolbars.hasOwnProperty(n)&&(e=this._toolbars[n].addToolbar(t))&&(o||(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],"leaflet-draw-toolbar-top"),o=!0),i.appendChild(e));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook((function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))})),L.Toolbar=L.Class.extend({initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null;var e=L.version.split(".");1===parseInt(e[0],10)&&parseInt(e[1],10)>=2?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),o=0,n=this._toolbarClass||"",r=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<r.length;e++)r[e].enabled&&this._initModeHandler(r[e].handler,this._toolbarContainer,o++,n,r[e].title);if(o)return this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;e<i;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,o,n){var r=t.type;this._modes[r]={},this._modes[r].handler=t,this._modes[r].button=this._createButton({type:r,title:n,className:o+"-"+r,container:e,callback:this._modes[r].handler.enable,context:this._modes[r].handler}),this._modes[r].buttonIndex=i,this._modes[r].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!t.MSStream},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container),i=L.DomUtil.create("span","sr-only",t.container);e.href="#",e.appendChild(i),t.title&&(e.title=t.title,i.innerHTML=t.title),t.text&&(e.innerHTML=t.text,i.innerHTML=t.text);var o=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"touchstart",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,o,t.callback,t.context),e},_disposeButton:function(t,e){var i=this._detectIOS()?"touchstart":"click";L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"touchstart",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,i,e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,o,n,r=this._actionsContainer,a=this.getActions(t),s=a.length;for(i=0,o=this._actionButtons.length;i<o;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];r.firstChild;)r.removeChild(r.firstChild);for(var l=0;l<s;l++)"enabled"in a[l]&&!a[l].enabled||(e=L.DomUtil.create("li","",r),n=this._createButton({title:a[l].title,text:a[l].text,container:e,callback:a[l].callback,context:a[l].context}),this._actionButtons.push({button:n,callback:a[l].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._visible=!1,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",t.text||t.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden"),this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(this._visible&&(i.style.visibility="inherit"),L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(t,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(t){return[{enabled:t.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:t.completeShape,context:t},{enabled:t.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:t.deleteLastVertex,context:t},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){for(var e in L.setOptions(this,t),this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(t){t.edit&&(void 0===t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),t.poly&&(t.poly=L.extend({},this.options.poly,t.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(t){var e=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return t.removeAllLayers&&e.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),e},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var t,e=0!==this.options.featureGroup.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,e?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",e?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,e?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",e?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var i=L.version.split(".");1===parseInt(i[0],10)&&parseInt(i[1],10)>=2?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),t._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer((function(t){this._revertLayer(t)}),this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer((function(e){e.edited&&(t.addLayer(e),e.edited=!1)})),this._map.fire(L.Draw.Event.EDITED,{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:(t instanceof L.Marker||t instanceof L.CircleMarker)&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):(t instanceof L.Marker||t instanceof L.CircleMarker)&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}))},_enableLayerEdit:function(t){var e,i,o=t.layer||t.target||t;this._backupLayer(o),this.options.poly&&(i=L.Util.extend({},this.options.poly),o.options.poly=i),this.options.selectedPathOptions&&((e=L.Util.extend({},this.options.selectedPathOptions)).maintainColor&&(e.color=o.options.color,e.fillColor=o.options.fillColor),o.options.original=L.extend({},o.options),o.options.editing=e),o instanceof L.Marker?(o.editing&&o.editing.enable(),o.dragging.enable(),o.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):o.editing.enable()},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,e.editing&&e.editing.disable(),delete e.options.editing,delete e.options.original,this._selectedPathOptions&&(e instanceof L.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof L.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):e.editing.disable()},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_onMarkerDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_onTouchMove:function(t){var e=t.originalEvent.changedTouches[0],i=this._map.mouseEventToLayerPoint(e),o=this._map.layerPointToLatLng(i);t.target.setLatLng(o)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var i=L.version.split(".");1===parseInt(i[0],10)&&parseInt(i[1],10)>=2?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer((function(t){this._deletableLayers.addLayer(t),t.fire("revert-deleted",{layer:t})}),this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer((function(t){this._removeLayer({layer:t})}),this),this.save()},_enableLayerDelete:function(t){(t.layer||t.target||t).on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e),e.fire("deleted")},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length}})}(window,document)},function(t,e,i){},,,,,,,function(t,e,i){},,,,,,,,,,,,,,,,function(t,e,i){"use strict";i.r(e);var o=i(32),n=i(0),r=i.n(n),a=(i(37),i(34),i(16),i(38),i(17),i(45),i(5)),s=i(10),l=i(4),c=i(13),h=i(14),d={_addUID:function(t){return this._uid?t+"-"+this._uid:t},_createMainContainerElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPelevationPath"),t.className="GPwidget",t},_createShowElevationPathElement:function(){var t=document.createElement("input");return t.id=this._addUID("GPshowElevationPath"),t.type="checkbox",t},_createShowElevationPathPictoElement:function(){var t=this,e=document.createElement("label");e.id=this._addUID("GPshowElevationPathPicto"),e.className="GPshowAdvancedToolPicto",e.htmlFor=this._addUID("GPshowElevationPath"),e.title="Calculer un profil",e.addEventListener?e.addEventListener("click",(function(e){t.onShowElevationPathClick(e)})):e.attachEvent&&e.attachEvent("onclick",(function(e){t.onShowElevationPathClick(e)}));var i=document.createElement("span");return i.id=this._addUID("GPshowElevationPathOpen"),i.className="GPshowAdvancedToolOpen",e.appendChild(i),e},_createElevationPathPanelElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPelevationPathPanel"),t.className="GPpanel",t},_createElevationPathPanelHeaderElement:function(){var t=this,e=document.createElement("div");e.className="GPpanelHeader";var i=document.createElement("div");i.id=this._addUID("GPelevationPathPanelInfo"),i.className="GPpanelInfo",i.title="Informations",i.addEventListener?i.addEventListener("click",(function(){t.onOpenElevationPathInfoClick()})):i.attachEvent&&i.attachEvent("onclick",(function(){t.onOpenElevationPathInfoClick()})),e.appendChild(i);var o=document.createElement("div");o.className="GPpanelTitle",o.innerHTML="Profil Altimétrique",e.appendChild(o);var n=document.createElement("div");n.id=this._addUID("GPelevationPathPanelReduce"),n.className="GPpanelReduce",n.title="Masquer le panneau",n.addEventListener?n.addEventListener("click",(function(){"function"==typeof t.onReduceElevationPathPanelClick&&(document.getElementById(t._addUID("GPshowElevationPath")).checked=!1,t.onReduceElevationPathPanelClick())}),!1):n.attachEvent&&n.attachEvent("onclick",(function(){"function"==typeof t.onReduceElevationPathPanelClick&&(document.getElementById(t._addUID("GPshowElevationPath")).checked=!1,t.onReduceElevationPathPanelClick())})),e.appendChild(n);var r=document.createElement("div");return r.id=this._addUID("GPelevationPathPanelClose"),r.className="GPpanelClose",r.title="Fermer le panneau",r.addEventListener?r.addEventListener("click",(function(){document.getElementById(t._addUID("GPshowElevationPathPicto")).click()}),!1):r.attachEvent&&r.attachEvent("onclick",(function(){document.getElementById(t._addUID("GPshowElevationPathPicto")).click()})),e.appendChild(r),e},_createElevationPathPanelProfilElement:function(){var t=document.createElement("div");return t.id="GPelevationPathProfil",t},_createElevationPathWaitingElement:function(){var t=document.createElement("div");t.id=this._addUID("GPelevationPathCalcWaitingContainer"),t.className="GPelevationPathCalcWaitingContainerHidden";var e=document.createElement("p");return e.className="GPelevationPathCalcWaiting",e.innerHTML="Calcul en cours...",t.appendChild(e),t},_createElevationPathInformationsElement:function(){var t=document.createElement("div");t.id=this._addUID("GPelevationPathInformationsContainer"),t.className="GPelevationPathInformationsContainerHidden";var e=document.createElement("p");return e.className="GPelevationPathInformations",e.innerHTML="Aucune information...",t.appendChild(e),t},_addElevationPathInformationsItem:function(t){var e=document.getElementById(this._addUID("GPelevationPathInformationsContainer"));if(e){var i=document.createElement("p");i.className="GPelevationPathInformations",i.innerHTML=t,e.appendChild(i)}return e}},u={_getCssProperty:function(t,e){return window.getComputedStyle(t,null).getPropertyValue(e)},_getTextWidth:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=this.canvas||(this.canvas=document.createElement("canvas")),n=o.getContext("2d");n.font=null===i?"".concat(this._getCssProperty(e,"font-weight")," ").concat(this._getCssProperty(e,"font-size")," ").concat(this._getCssProperty(e,"font-family")):i;var r=n.measureText(t);return r.width},_dataZToSvgY:function(t,e,i,o){return e-(t-i)*o-.5},_dataDistToSvgX:function(t,e,i,o){return e-i+t*o},_svgXToDataDist:function(t,e,i,o){return(t+i-e)/o},_arrayBisect:function(t,e){var i;if(0===t.length)return 0;for(i=0;i<t.length;i++)if(e<t[i].dist)return i;return i-1},displayProfileByDefault:function(t,e,i,o){var n=i;if(e&&t){for(;e.firstChild;)e.removeChild(e.firstChild);var r=25,a=15,s=10,l=10,c=n.options.displayProfileOptions,h=t.points,d=JSON.parse(JSON.stringify(h));d.sort((function(t,e){return t.z-e.z}));var u=d[0].z,p=d[d.length-1].z,f=t.distance,_="m",g=document.createElement("div");g.id="profileElevationByDefault",e.appendChild(g);var m=e.clientHeight-r-s,v=e.clientWidth-l-a,L=this._getTextWidth(Math.round(p).toLocaleString()+",88",e,"400 10 Verdana"),w=this._getTextWidth(Math.round(f).toLocaleString()+",5",e),y=m-17-15,E=v-17-L,b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.id="profileElevationByDefaultSvg",b.setAttribute("style","display: block; margin: auto; overflow: visible; position: absolute; left: 10px;"),b.setAttribute("viewBox","0 0 ".concat(e.clientWidth," ").concat(e.clientHeight)),b.setAttribute("width","100%"),b.setAttribute("height","100%");var A,k=Math.floor(y/15);A=p===u?.1:Math.pow(10,Math.ceil(Math.log((p-u)/k)/Math.log(10)))/2;var M=Math.floor(u/A)*A,P=Math.ceil(p/A)*A;P===p&&(P+=A),M=Math.round(100*M)/100,P=Math.round(100*P)/100;var S=Math.round((P-M)/A);S+1>k&&(A=Math.pow(10,Math.ceil(Math.log((p-u)/k)/Math.log(10))),M=Math.floor(u/A)*A,(P=Math.ceil(p/A)*A)===p&&(P+=A),M=Math.round(100*M)/100,P=Math.round(100*P)/100,S=Math.floor((P-M)/A)),S=Math.max(Math.round(S),1);var T=document.createElementNS("http://www.w3.org/2000/svg","g");T.setAttribute("class","profile-z-vertical");var C,D,x,R,O,I,N=document.createElementNS("http://www.w3.org/2000/svg","g"),U=y/S,G=y/(P-M);G=p===u?y/.2:y/(P-M);for(var z=0;z<=S;z++)(C=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("class","profile-z-graduation"),C.setAttribute("font-family","Verdana"),C.setAttribute("font-size","10px"),C.setAttribute("fill","#5E5E5E"),C.textContent=(Math.round(100*(M+z*A))/100).toLocaleString(),D=y-z*U,C.setAttribute("transform","translate(".concat(17+L-8,", ").concat(D+5,")")),C.setAttribute("text-anchor","end"),T.appendChild(C),x=Math.round(D)-.5,R=document.createElementNS("http://www.w3.org/2000/svg","g"),(O=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("cs","100,100"),O.setAttribute("stroke-width","1"),0!==z?O.setAttribute("stroke-opacity","0.2"):O.setAttribute("stroke-opacity","1"),O.setAttribute("stroke","#000000"),O.setAttribute("fill","none"),O.setAttribute("d","M".concat(17+L,",").concat(x," L").concat(E+17+L,",").concat(x)),(I=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("cs","100,100"),I.setAttribute("stroke-width","1"),I.setAttribute("stroke-opacity","1"),I.setAttribute("stroke","#000000"),I.setAttribute("fill","none"),I.setAttribute("d","M".concat(17+L,",").concat(x," L").concat(17+L+5,",").concat(x)),I.setAttribute("transform","translate(-5, 0)"),R.appendChild(I),R.appendChild(O),N.appendChild(R);var F=document.createElementNS("http://www.w3.org/2000/svg","text");F.setAttribute("class","profile-z-legend"),F.setAttribute("font-family","Verdana"),F.setAttribute("font-size","11px"),F.setAttribute("fill","#5E5E5E"),F.textContent="Altitude (m)",F.setAttribute("transform","translate(".concat(9,", ").concat(Math.round(y/2),") rotate(-90)")),F.setAttribute("text-anchor","middle"),T.appendChild(F),b.appendChild(T),b.appendChild(N),f>2e3&&(f/=1e3,_="km");var H=Math.floor(E/w),Y=Math.pow(10,Math.ceil(Math.log(f/H)/Math.log(10)))/2,B=f,j=Math.floor(B/Y);j>H?(Y=Math.pow(10,Math.ceil(Math.log(f/H)/Math.log(10))),j=Math.floor(B/Y)):j<1&&(Y=Math.pow(10,Math.ceil(Math.log(f/H)/Math.log(10))-1),j=Math.floor(B/Y));var V=Y*(j=Math.max(j,1)),X=document.createElementNS("http://www.w3.org/2000/svg","g");X.setAttribute("class","profile-x-vertical");for(var q,W,Z,K,J,Q,$=document.createElementNS("http://www.w3.org/2000/svg","g"),tt=E/B,et=(B-V)*tt,it=Math.round((E-et)/j),ot=0;ot<=j+1;ot++)(q=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("class","profile-x-graduation"),q.setAttribute("font-family","Verdana"),q.setAttribute("font-size","10px"),q.setAttribute("fill","#5E5E5E"),ot!==j+1&&(q.textContent=(Math.round(100*ot*Y)/100).toLocaleString()),W=17+L+ot*it,ot===j+1&&(W=17+L+E),q.setAttribute("transform","translate(".concat(W,", ").concat(y+15+5,")")),q.setAttribute("text-anchor","middle"),X.appendChild(q),Z=W-.5,K=document.createElementNS("http://www.w3.org/2000/svg","g"),(J=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("cs","100,100"),J.setAttribute("stroke-width","1"),0!==ot?J.setAttribute("stroke-opacity","0.2"):J.setAttribute("stroke-opacity","1"),J.setAttribute("stroke","#000000"),J.setAttribute("fill","none"),J.setAttribute("d","M".concat(Z,",").concat(y," L").concat(Z,",0")),(Q=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("cs","100,100"),Q.setAttribute("stroke-width","1"),Q.setAttribute("stroke-opacity","1"),Q.setAttribute("stroke","#000000"),Q.setAttribute("fill","none"),Q.setAttribute("d","M".concat(Z,",").concat(y," L").concat(Z,",").concat(y-5)),Q.setAttribute("transform","translate(0, 5)"),K.appendChild(Q),K.appendChild(J),$.appendChild(K);var nt=document.createElementNS("http://www.w3.org/2000/svg","text");nt.setAttribute("class","profile-x-legend"),nt.setAttribute("font-family","Verdana"),nt.setAttribute("font-size","11px"),nt.setAttribute("fill","#5E5E5E"),nt.textContent="Distance (".concat(_,")"),nt.setAttribute("transform","translate(".concat(17+L+E/2,", ").concat(y+15+17+3,")")),nt.setAttribute("text-anchor","middle"),X.appendChild(nt),b.appendChild(X),b.appendChild($);var rt=document.createElementNS("http://www.w3.org/2000/svg","g"),at=1;"km"===_&&(at=1e3);for(var st=this._dataDistToSvgX(h[0].dist/at,v,E,tt),lt=this._dataZToSvgY(h[0].z,y,M,G),ct="M".concat(st,",").concat(lt),ht=1;ht<h.length;ht++)st=this._dataDistToSvgX(h[ht].dist/at,v,E,tt),lt=this._dataZToSvgY(h[ht].z,y,M,G),ct+=" L".concat(st,",").concat(lt);var dt=document.createElementNS("http://www.w3.org/2000/svg","path");dt.setAttribute("cs","100,100"),dt.setAttribute("stroke-width","1"),dt.setAttribute("stroke-opacity","1"),dt.setAttribute("stroke","#0B6BA7"),dt.setAttribute("fill","none"),dt.setAttribute("d",ct),ct+=" L".concat(st,",").concat(y),ct+=" L".concat(v-E,",").concat(y);var ut=document.createElementNS("http://www.w3.org/2000/svg","path");ut.setAttribute("cs","100,100"),ut.setAttribute("stroke-width","1"),ut.setAttribute("stroke-opacity","0"),ut.setAttribute("stroke","#000000"),ut.setAttribute("fill","#00B798"),ut.setAttribute("fill-opacity","0.4"),ut.setAttribute("d",ct),rt.appendChild(dt),rt.appendChild(ut),b.appendChild(rt);var pt=document.createElementNS("http://www.w3.org/2000/svg","g"),ft=document.createElementNS("http://www.w3.org/2000/svg","rect");ft.setAttribute("width",E),ft.setAttribute("height",y),ft.setAttribute("transform","translate(".concat(v-E,",0)")),ft.setAttribute("visibility","hidden"),ft.setAttribute("pointer-events","all");var _t=JSON.parse(JSON.stringify(h));_t.sort((function(t,e){return t.dist-e.dist}));var gt=document.createElementNS("http://www.w3.org/2000/svg","line");gt.setAttribute("id","focusLineX"),gt.setAttribute("class","focusLine-default"),gt.setAttribute("fill","none"),gt.setAttribute("stroke","#F90"),gt.setAttribute("stroke-width","0.5px"),gt.setAttribute("visibility","hidden");var mt=document.createElementNS("http://www.w3.org/2000/svg","line");mt.setAttribute("id","focusLineY"),mt.setAttribute("class","focusLine-default"),mt.setAttribute("fill","none"),mt.setAttribute("stroke","#F90"),mt.setAttribute("stroke-width","0.5px"),mt.setAttribute("visibility","hidden");var vt=document.createElementNS("http://www.w3.org/2000/svg","circle");vt.setAttribute("id","focusCircle"),vt.setAttribute("r",4),vt.setAttribute("class","circle-default focusCircle-default"),vt.setAttribute("fill","#F90"),vt.setAttribute("visibility","hidden"),pt.appendChild(vt),pt.appendChild(gt),pt.appendChild(mt);var Lt=document.createElementNS("http://www.w3.org/2000/svg","text"),wt=document.createElementNS("http://www.w3.org/2000/svg","tspan"),yt=document.createElementNS("http://www.w3.org/2000/svg","tspan"),Et=document.createElementNS("http://www.w3.org/2000/svg","tspan");Lt.setAttribute("style","text-align:center; max-width:220px; font-size:10px; color:#000000; font-family:Verdana; z-index:50;"),Lt.style.pointerEvents="none",Lt.style.position="fixed",Lt.setAttribute("class","tooltipInit"),Lt.setAttribute("text-anchor","middle"),g.appendChild(Lt),wt.setAttribute("class","altiPathValue"),wt.setAttribute("x","0"),wt.setAttribute("dy","-.7em"),yt.setAttribute("class","altiPathValue"),yt.setAttribute("x","0"),yt.setAttribute("dy","1em"),Et.setAttribute("class","altiPathCoords"),Et.setAttribute("x","0"),Et.setAttribute("dy","1em"),Lt.appendChild(wt),c.currentSlope&&Lt.appendChild(yt),Lt.appendChild(Et);var bt=document.createElementNS("http://www.w3.org/2000/svg","g");pt.appendChild(bt);var At=document.createElementNS("http://www.w3.org/2000/svg","path");At.setAttribute("cs","100,100"),At.setAttribute("fill","#FFFFFF"),At.setAttribute("stroke","#CCCCCC"),At.setAttribute("fill-opacity","0.8"),At.setAttribute("stroke-width","1"),At.setAttribute("stroke-opacity","1");var kt=document.createElementNS("http://www.w3.org/2000/svg","path");return kt.setAttribute("cs","100,100"),kt.setAttribute("fill","#FFFFFF"),kt.setAttribute("stroke","#000000"),kt.setAttribute("fill-opacity","0"),kt.setAttribute("stroke-width","1"),kt.setAttribute("stroke-opacity","0.4"),kt.setAttribute("transform","translate(1,1)"),bt.appendChild(kt),bt.appendChild(At),bt.appendChild(Lt),bt.setAttribute("class","tooltipInit"),bt.style.pointerEvents="none",ft.addEventListener("pointerover",(function(){gt.setAttribute("visibility","visible"),mt.setAttribute("visibility","visible"),vt.setAttribute("visibility","visible"),o.__createProfileMarker(n,h[0]),Lt.setAttribute("class","tooltipFadeIn"),bt.setAttribute("class","tooltipFadeIn")})),ft.addEventListener("pointerout",(function(){gt.setAttribute("visibility","hidden"),mt.setAttribute("visibility","hidden"),vt.setAttribute("visibility","hidden"),o.__removeProfileMarker(n),Lt.setAttribute("class","tooltipFadeOut"),bt.setAttribute("class","tooltipFadeOut")})),ft.addEventListener("pointermove",function(t){var e=b.createSVGPoint();e.x=t.clientX,e.y=t.clientY;var i=e.matrixTransform(b.getScreenCTM().inverse()),r=this._svgXToDataDist(i.x,v,E,tt)*at,a=Math.max(1,this._arrayBisect(_t,r)),s=h[a-1],l=h[a],c=s;r-s.dist>l.dist-r&&(c=l);var d=this._dataDistToSvgX(c.dist/at,v,E,tt),u=this._dataZToSvgY(c.z,y,M,G);vt.setAttribute("cx",d),vt.setAttribute("cy",u),gt.setAttribute("x1",d),gt.setAttribute("y1",y),gt.setAttribute("x2",d),gt.setAttribute("y2",0),mt.setAttribute("x1",17+L),mt.setAttribute("y1",u),mt.setAttribute("x2",E+17+L),mt.setAttribute("y2",u),o.__updateProfileMarker(n,c);var p="Altitude : ".concat(c.z.toLocaleString()," m"),_="Pente : ".concat(c.slope," %"),g="(lat : ".concat(c.lat.toLocaleString()," / lon : ").concat(c.lon.toLocaleString(),")");wt.innerHTML=p,yt.innerHTML=_,Et.innerHTML=g;var m,w=Math.max(this._getTextWidth(g,Et),this._getTextWidth(p,wt));c.dist>f*at/2?(m="M -0.5 -0.5 l -6 6 l 0 16 l -".concat(w+10," 0 l 0 -44 l ").concat(w+10," 0 l 0 16 l 6 6"),Lt.setAttribute("transform","translate(".concat(-(w/2+12),",0)"))):c.dist<=f*at/2&&(m="M -0.5 -0.5 l 6 6 l 0 16 l ".concat(w+10," 0 l 0 -44 l -").concat(w+10," 0 l 0 16 l -6 6"),Lt.setAttribute("transform","translate(".concat(w/2+12,",0)"))),At.setAttribute("d",m),kt.setAttribute("d",m),bt.setAttribute("transform","translate(".concat(d,",").concat(u,")")),bt.style.transform="translate(".concat(d,"px,").concat(u,"px)")}.bind(this)),pt.appendChild(ft),b.appendChild(pt),g.appendChild(b),e}},displayProfileRaw:function(t,e,i,o){if(e){for(;e.firstChild;)e.removeChild(e.firstChild);var n=t&&t.points?t.points:{},r=document.createElement("textarea");return r.id="profilElevationResults",r.rows=10,r.cols=50,r.style.width="100%",r.innerHTML=JSON.stringify(n,void 0,4),r.addEventListener("mouseover",(function(t){o.__customRawProfileMouseOverEvent(i,t)})),e.appendChild(r),e}},displayProfileLibD3:function(t,e,i,o){var n=i;if(e&&t){for(;e.firstChild;)e.removeChild(e.firstChild);var r=t.points;if(t.distance>2e3){t.unit="km";for(var a=0;a<r.length;a++)r[a].dist/=1e3}var s=n.options.displayProfileOptions,l=20,c=20,h=30,d=40,u=e.clientWidth-d-c,p=e.clientHeight-l-h,f=d3.scale.linear().range([0,u]),_=d3.scale.linear().range([p,0]),g=d3.svg.axis().scale(f).orient("bottom").ticks(5),m=d3.svg.axis().scale(_).orient("left").ticks(5),v=d3.svg.line().interpolate("basis").x((function(t){return f(t.dist)})).y((function(t){return _(t.z)})),L=d3.svg.area().interpolate("basis").x((function(t){return f(t.dist)})).y0(p).y1((function(t){return _(t.z)})),w=d3.select(e).append("svg").attr("width",u+d+c).attr("height",p+l+h).append("g").attr("transform","translate("+d+","+l+")"),y=d3.extent(r,(function(t){return t.dist}));f.domain(y);var E=[0,d3.max(r,(function(t){return t.z}))];_.domain(E),w.append("path").datum(r).attr("class","area-d3").attr("d",L),w.append("g").attr("class","x axis-d3").attr("transform","translate(0,"+p+")").call(g).append("text").attr("y",-15).attr("dy",".71em").attr("x",u).text("Distance ("+t.unit+")"),w.append("g").attr("class","y axis-d3").call(m).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").text("Altitude (m)"),w.append("g").attr("class","grid-d3 vertical").attr("transform","translate(0,"+p+")").call(g.orient("bottom").tickSize(-p,0,0).tickFormat("")),w.append("g").attr("class","grid-d3 horizontal").call(m.orient("left").tickSize(-u,0,0).tickFormat("")),w.append("path").datum(r).attr("class","line-d3").attr("d",v),w.selectAll("circle").data(r).enter().append("circle").attr("cx",(function(t){return f(t.dist)})).attr("cy",(function(t){return _(t.z)})).attr("r",0).attr("class","circle-d3");var b=w.append("g").style("display","none");b.append("line").attr("id","focusLineX").attr("class","focusLine-d3"),b.append("line").attr("id","focusLineY").attr("class","focusLine-d3"),b.append("circle").attr("id","focusCircle").attr("r",4).attr("class","circle-d3 focusCircle-d3");var A=d3.select(e).append("div").attr("class","tooltip-d3").style("opacity",0),k=d3.bisector((function(t){return t.dist})).left;return w.append("rect").attr("class","overlay-d3").attr("width",u).attr("height",p).on("mouseover",(function(){b.style("display",null),o.__createProfileMarker(n,r[0])})).on("mouseout",(function(){b.style("display","none"),o.__removeProfileMarker(n),A.transition().duration(500).style("opacity",0)})).on("mousemove",(function(){var t=d3.mouse(this),e=f.invert(t[0]),i=Math.max(1,k(r,e)),a=r[i-1],l=r[i],c=e-a[0]>l[0]-e?l:a,h=f(c.dist),d=_(c.z);b.select("#focusCircle").attr("cx",h).attr("cy",d),b.select("#focusLineX").attr("x1",h).attr("y1",_(E[0])).attr("x2",h).attr("y2",_(E[1])),b.select("#focusLineY").attr("x1",f(y[0])).attr("y1",d).attr("x2",f(y[1])).attr("y2",d),o.__updateProfileMarker(n,c),A.transition().duration(200).style("opacity",.9);var u="";u+=" Altitude : "+c.z+" m",s.currentSlope&&(u+="<br/> Pente : "+c.slope+" %"),u+="<br/> (Lat : "+c.lat+"/ Lon : "+c.lon+")",A.html(u).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")})),w}},displayProfileLibAmCharts:function(t,e,i,o){var n=i;if(e&&t){var r=t.points,a="<span class='altiPathValue'>[[title]] : [[value]]m</span><br/>";if(n.options.displayProfileOptions.currentSlope&&(a+="<span class='altiPathValue'>Pente : [[slope]] %</span><br/>"),a+="<span class='altiPathCoords'>(Lat: [[lat]] / Lon:[[lon]])</span>",AmCharts.addInitHandler((function(){})),t.distance>2e3){t.unit="km";for(var s=0;s<r.length;s++)r[s].dist/=1e3}for(var l=0;l<r.length;l++){var c=r[l].dist,h=100;c>100?h=1:c>10&&(h=10),c=Math.round(c*h)/h,r[l].dist=c}var d={type:"serial",pathToImages:"http://cdn.amcharts.com/lib/3/images/",categoryField:"dist",autoMarginOffset:0,marginRight:10,marginTop:10,startDuration:0,color:"#5E5E5E",fontSize:8,theme:"light",thousandsSeparator:"",numberFormatter:{precision:-1,decimalSeparator:",",thousandsSeparator:" "},categoryAxis:{color:"#5E5E5E",gridPosition:"start",minHorizontalGap:40,tickPosition:"start",title:"Distance ("+t.unit+")",titleColor:"#5E5E5E",labelOffset:0,startOnAxis:!0},chartCursor:{animationDuration:0,bulletsEnabled:!0,bulletSize:10,categoryBalloonEnabled:!1,cursorColor:"#F90",graphBulletAlpha:1,graphBulletSize:1,zoomable:!1},trendLines:[],graphs:[{balloonColor:"#CCCCCC",balloonText:a,bullet:"round",bulletAlpha:0,bulletBorderColor:"#FFF",bulletBorderThickness:2,bulletColor:"#F90",bulletSize:6,hidden:!1,id:"AmGraph-1",fillAlphas:.4,fillColors:"#C77A04",lineAlpha:1,lineColor:"#C77A04",lineThickness:1,title:"Altitude",valueField:"z"}],guides:[],valueAxes:[{id:"ValueAxis-1",minVerticalGap:20,title:"Altitude (m)"}],balloon:{borderColor:"#CCCCCC",borderThickness:1,fillColor:"#FFFFFF",showBullet:!0},titles:[],allLabels:[],dataProvider:r},u=AmCharts.makeChart(e,d);return u.addListener("changed",(function(t){var e=t.chart.dataProvider[t.index];o.__updateProfileMarker(n,e)})),u}}},p=a.a.getLogger("ElevationPath"),f=r.a.Control.extend({includes:d,options:{position:"topleft",active:!1,elevationPathOptions:{},stylesOptions:{},displayProfileOptions:{greaterSlope:!0,meanSlope:!0,ascendingElevation:!0,descendingElevation:!0,currentSlope:!0,apply:null,target:null}},initialize:function(t){r.a.Util.setOptions(this,t),this._uid=l.a.generate(),this._initDisplayProfileOptions(),this._showContainer=null,this._pictoContainer=null,this._panelContainer=null,this._profilContainer=null,this._waitingContainer=null,this._infoContainer=null,this._timerHdlr=null,this._reducePanel=!1,this._featuresLayer=null,this._lastIdLayer=0,this._currentIdLayer=0,this._currentFeature=null,this._profile=null,this._marker=null,this._geometry=null,this._distance=0,this._data={},this._noRightManagement=!1,this._checkRightsManagement()},onAdd:function(t){var e=this._container=this._initLayout();return t&&this.options.active&&(null===this._profile&&(this._panelContainer.style.display="none"),this._activateMapInteraction(t)),r.a.DomEvent.disableClickPropagation(e).disableScrollPropagation(e),e},onRemove:function(){},_checkRightsManagement:function(){var t=s.a.check({key:this.options.apiKey,resources:["SERVICE_CALCUL_ALTIMETRIQUE_RSC"],services:["ElevationLine"]});t||(this._noRightManagement=!0),this.options.apiKey||(this.options.apiKey=t.key)},_initDisplayProfileOptions:function(){var t=this.options.displayProfileOptions,e=t.apply;t.apply="function"==typeof e?e:f.DISPLAY_PROFILE_BY_DEFAULT;var i=t.target;t.target=void 0!==i?i:null;var o=Object.getPrototypeOf(this.options);void 0===t.meanSlope&&(t.meanSlope=o.displayProfileOptions.meanSlope),void 0===t.greaterSlope&&(t.greaterSlope=o.displayProfileOptions.greaterSlope),void 0===t.ascendingElevation&&(t.ascendingElevation=o.displayProfileOptions.ascendingElevation),void 0===t.descendingElevation&&(t.descendingElevation=o.displayProfileOptions.descendingElevation),void 0===t.currentSlope&&(t.currentSlope=o.displayProfileOptions.currentSlope)},_initLayout:function(){var t=this._createMainContainerElement(),e=this._showContainer=this._createShowElevationPathElement();t.appendChild(e),this.options.active&&(this._showContainer.checked=!0);var i=this._pictoContainer=this._createShowElevationPathPictoElement();t.appendChild(i);var o=this._panelContainer=this._createElevationPathPanelElement(),n=this._createElevationPathPanelHeaderElement();o.appendChild(n);var r=this._profilContainer=this._createElevationPathPanelProfilElement();o.appendChild(r);var a=this._waitingContainer=this._createElevationPathWaitingElement();o.appendChild(a);var s=this._infoContainer=this._createElevationPathInformationsElement();return o.appendChild(s),t.appendChild(o),t},onShowElevationPathClick:function(t){p.trace(t);var e=this._map;this._reducePanel?null!==this._profile&&(null===this.options.displayProfileOptions.target&&(this._pictoContainer.style.display="none"),this._panelContainer.style.display="block"):this._showContainer.checked?(this._pictoContainer.style.display="block",this._panelContainer.style.display="none",this._removeMapInteraction(e),this._clear()):(null===this._profile&&(this._panelContainer.style.display="none"),this._activateMapInteraction(e)),this._reducePanel=!1},onReduceElevationPathPanelClick:function(){this._reducePanel=!0,this._pictoContainer.style.display="block",this._panelContainer.style.display="none"},onOpenElevationPathInfoClick:function(){var t=this.options.displayProfileOptions.meanSlope,e=this.options.displayProfileOptions.greaterSlope,i=this.options.displayProfileOptions.ascendingElevation,o=this.options.displayProfileOptions.descendingElevation,n=this._infoContainer;if(n.childElementCount)for(;n.firstChild;)n.removeChild(n.firstChild);i&&this._addElevationPathInformationsItem("Dénivelé positif : "+this._data.ascendingElevation.toLocaleString()+" m"),o&&this._addElevationPathInformationsItem("Dénivelé négatif : "+this._data.descendingElevation.toLocaleString()+" m"),t&&this._addElevationPathInformationsItem("Pente moyenne : "+this._data.meanSlope.toLocaleString()+" %"),e&&this._addElevationPathInformationsItem("Plus forte pente : "+this._data.greaterSlope.toLocaleString()+" %"),"GPelevationPathInformationsContainerVisible"===n.className?(clearTimeout(this._timerHdlr),n.className="GPelevationPathInformationsContainerHidden"):n.className="GPelevationPathInformationsContainerVisible",this._timerHdlr=setTimeout((function(){n.className="GPelevationPathInformationsContainerHidden"}),4e3)},_activateMapInteraction:function(t){if(p.info("_activateMapInteraction()"),null===this._featuresLayer){this._featuresLayer=new r.a.FeatureGroup,t.addLayer(this._featuresLayer);var e=this;t.on("contextmenu",(function(){})),t.on("draw:created",(function(t){p.trace("draw:created"),e._currentIdLayer=r.a.Util.stamp(t.layer),e._getFeatureGeometry(t.layer),e._addFeatureLayer(t.layer)})),t.on("draw:drawstart",(function(){p.trace("draw:drawstart"),e._removeFeatureLayer(e._lastIdLayer),e._lastIdLayer=e._currentIdLayer})),t.on("draw:drawstop",(function(){p.trace("draw:drawstop"),void 0===e.options.elevationPathOptions.onSuccess&&null===e.options.displayProfileOptions.target&&(e._pictoContainer.style.display="none",e._panelContainer.style.display="block"),e._altiRequest()}))}this._activatePolyLineInteraction(t)},_removeMapInteraction:function(t){t&&(null!==this._featuresLayer&&(t.off("draw:created"),t.off("draw:drawstart"),t.off("draw:drawstop"),t.removeLayer(this._featuresLayer),this._featuresLayer=null),this._lastIdLayer=this._currentIdLayer=0,this._currentFeature&&this._currentFeature.disable())},_activatePolyLineInteraction:function(t){this._currentFeature&&this._currentFeature.disable();var e=this.options.stylesOptions||{},i=0!==Object.keys(e).length?e:{stroke:!0,color:"#C77A04",weight:4,opacity:.5,fill:!1};this._currentFeature=new r.a.Draw.Polyline(t,{shapeOptions:i}),this._currentFeature.enable()},_getFeatureGeometry:function(t){p.log(t.getLatLngs()),null!==this._geometry&&(this._geometry=null),this._geometry=[],this._distance=0;for(var e=t.getLatLngs(),i=0;i<e.length;i++){var o=e[i],n=e[i+1];this._geometry.push({lon:o.lng,lat:o.lat}),n&&(this._distance+=o.distanceTo(n))}p.log("Geometry",this._geometry),p.log("Distance",this._distance)},_addFeatureLayer:function(t){this._featuresLayer&&this._featuresLayer.addLayer(t)},_removeFeatureLayer:function(t){this._featuresLayer&&0!==t&&(t?this._featuresLayer.removeLayer(t):this._featuresLayer.clearLayers())},_altiRequest:function(){if(p.log("_altiRequest"),this._geometry){if(!this._noRightManagement){var t={};r.a.Util.extend(t,this.options.elevationPathOptions),r.a.Util.extend(t,{apiKey:t.apiKey||this.options.apiKey}),r.a.Util.extend(t,{ssl:this.options.ssl});var e=t.sampling;if(!e){var i=this._currentFeature._measurementRunningTotal;p.trace("length",i);var n=Math.floor(i)/5;e=n>=200?200:Math.floor(n)}var a=this;r.a.Util.extend(t,{sampling:e,onSuccess:this.options.elevationPathOptions.onSuccess||function(t){p.log(t),t&&(null!==a.options.displayProfileOptions.target&&(a._pictoContainer.style.display="block",a._panelContainer.style.display="block"),a._displayProfil(t.elevations),a._waitingContainer.className="GPelevationPathCalcWaitingContainerHidden",a._waiting=!1)},onFailure:this.options.elevationPathOptions.onFailure||function(t){p.log(t.message),a._pictoContainer.style.display="block",a._panelContainer.style.display="none",a._waitingContainer.className="GPelevationPathCalcWaitingContainerHidden",a._waiting=!1,a._clear()}});var s=this._geometry;r.a.Util.extend(t,{positions:s}),p.log(t),this._waitingContainer.className="GPelevationPathCalcWaitingContainerVisible",new o.a(t).call()}}else p.log("missing position")},_computeElevationMeasure:function(t){var e=function(t,e){var i=c.a.decimalToRadian(t[1]),o=c.a.decimalToRadian(e[1]),n=(o-i)/2,r=c.a.decimalToRadian(e[0]-t[0])/2,a=Math.sin(n)*Math.sin(n)+Math.sin(r)*Math.sin(r)*Math.cos(i)*Math.cos(o);return 12756274*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},i=t,o=this._geometry,n=0,r=0,a=o[1];i[0].dist=0,i[0].slope=0,i[0].lat=Math.round(1e4*i[0].lat)/1e4,i[0].lon=Math.round(1e4*i[0].lon)/1e4;for(var s=0,l=0,h=0,d=0,u=0,f=0,_=[],g=1;g<i.length;g++){var m=[i[g].lon,i[g].lat],v=r+e(m,[o[n].lon,o[n].lat]),L=v-u;m[0].toFixed(8)===a.lon.toFixed(8)&&m[1].toFixed(8)===a.lat.toFixed(8)&&(n++,r=v,g!==i.length-1&&(a=o[n+1]));var w=i[g].z,y=i[g-1].z;w<0&&(w=0),y<0&&(y=0);var E=w-y;E<0?(s+=L,d+=E):E>0&&(l+=L,h+=E),u=v,i[g].dist=v,_.push(v),f+=E?Math.abs(Math.round(E/L*100)):0,i[g].slope=E?Math.abs(Math.round(E/L*100)):0;var b=i[g].slope;i[g].color=b>15&&b<30?"#005b4c":b>30&&b<45?"#00362d":b>45?"#00120f":"#00B798",i[g].lat=Math.round(1e4*i[g].lat)/1e4,i[g].lon=Math.round(1e4*i[g].lon)/1e4}p.trace("List Distances",_);for(var A=i[0].z,k=i[0].z,M=i[0].slope,P=0;P<i.length;P++){var S=i[P];S.z<-100&&(S.z=0),S.z>k&&(k=S.z),S.z<A&&(A=S.z),S.slope>M&&(M=S.slope)}return{greaterSlope:M,meanSlope:Math.round(f/i.length),distancePlus:l,distanceMinus:s,ascendingElevation:h,descendingElevation:d,altMin:A.toLocaleString(),altMax:k.toLocaleString(),distance:this._distance,unit:"m",points:i}},_displayProfil:function(t){this._map.off("contextmenu"),this._data&&(this._data={});var e=this._data=this._computeElevationMeasure(t),i=this.options.displayProfileOptions.target;i&&i.appendChild(this._panelContainer),i=this._profilContainer;var o=this.options.displayProfileOptions,n=o.apply;"undefined"!=typeof AmCharts&&"undefined"!=typeof d3&&p.trace("Aucune lib. n'est presente !"),n.call(this,e,i,this);var a=r.a.DomUtil.get("GPelevationPathPanelInfo-"+this._uid);(o.greaterSlope||o.meanSlope||o.ascendingElevation||o.descendingElevation)&&(a.style.display="block")},_clear:function(){if(this._geometry=null,this._profile=null,this._profilContainer)for(;this._profilContainer.firstChild;)this._profilContainer.removeChild(this._profilContainer.firstChild);var t=this._map;this._marker&&(t.removeLayer(this._marker),this._marker=null)}});f.__createProfileMarker=function(t,e){p.log("__createProfileMarker");var i=t,o=i._map;i._marker=r.a.marker(r.a.latLng(e),{icon:new h.a("orange"),draggable:!1,clickable:!1,zIndexOffset:1e3}),i._marker.addTo(o)},f.__updateProfileMarker=function(t,e){p.log("__updateProfileMarker");var i=t,o=i._map;i._marker?(i._marker.setLatLng(r.a.latLng(e)),i._marker.update()):(i._marker=r.a.marker(r.a.latLng(e),{icon:new h.a("orange"),draggable:!1,clickable:!1,zIndexOffset:1e3}),i._marker.addTo(o))},f.__removeProfileMarker=function(t){p.log("__removeProfileMarker");var e=t,i=e._map;e._marker&&(i.removeLayer(e._marker),e._marker=null)},f.__customRawProfileOperation=function(){p.log("__customRawProfileOperation")},f.__customRawProfileMouseOverEvent=function(t,e){p.log("__customRawProfileMouseOverEvent",t,e)},f.DISPLAY_PROFILE_BY_DEFAULT=function(t,e,i){p.trace("ElevationPath.DISPLAY_PROFILE_BY_DEFAULT");var o=u.displayProfileByDefault(t,e,i,f);o&&(this._profile=o)},f.DISPLAY_PROFILE_RAW=function(t,e,i){p.trace("ElevationPath.DISPLAY_PROFILE_RAW");var o=u.displayProfileRaw(t,e,i,f);o&&(this._profile=o)},f.DISPLAY_PROFILE_LIB_D3=function(t,e,i){if(p.trace("ElevationPath.DISPLAY_PROFILE_LIB_D3"),"undefined"!=typeof d3){var o=u.displayProfileLibD3(t,e,i,f);o&&(this._profile=o)}else p.log("Lib. D3 is not loaded !")},f.DISPLAY_PROFILE_LIB_AMCHARTS=function(t,e,i){if(p.trace("ElevationPath.DISPLAY_PROFILE_LIB_AMCHARTS"),"undefined"!=typeof AmCharts){var o=u.displayProfileLibAmCharts(t,e,i,f);o&&(this._profile=o)}else p.log("Lib. AmCharts is not loaded !")};e.default=f;window.L&&(window.L.geoportalControl||(window.L.geoportalControl={}),window.L.geoportalControl.ElevationPath=f)}]).default;