/*!
 * @brief French Geoportal Extension for Itowns
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * @copyright copyright (c) IGN 
 * @license CeCILL-B
 * @author IGN
 * @version 2.3.6
 * @date 04/03/2022
 *
 */
/*!
 * Sortable -- JavaScript library for reorderable drag-and-drop lists on modern
 * browsers and touch devices. No jQuery required. Supports Meteor, AngularJS,
 * React, Polymer, Vue, Knockout and any CSS library, e.g. Bootstrap.
 *
 * Released under MIT LICENSE
 *
 * Copyright Lebedev Konstantin <ibnRubaXa@gmail.com>
 * https://github.com/SortableJS/Sortable
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * @version 1.14.0
 */
/*!
 * @overview  es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4
 */
/*!
 * @overview   Proj4js - Javascript reprojection library.
 *
 * @authors
 * - Mike Adair madairATdmsolutions.ca
 * - Richard Greenwood richATgreenwoodmap.com
 * - Didier Richard didier.richardATign.fr
 * - Stephen Irons stephen.ironsATclear.net.nz
 * - Olivier Terral oterralATgmail.com
 * - Calvin Metcalf cmetcalfATappgeo.com
 *
 * @copyright Copyright (c) 2014, Mike Adair, Richard Greenwood, Didier Richard, Stephen Irons, Olivier Terral and Calvin Metcalf
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/proj4js/proj4js/master/LICENSE.md
 * @version   2.7.5
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("itowns"),require("xmldom"),require("node-fetch")):"function"==typeof define&&define.amd?define("Gp",["itowns","require","require"],e):"object"==typeof exports?exports.Gp=e(require("itowns"),require("xmldom"),require("node-fetch")):t.Gp=e(t.itowns,t[void 0],t[void 0])}(this,(function(t,e,n){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=37)}([function(e,n){e.exports=t},function(t,e,n){"use strict";var i=n(4),r={getLogger:function(t){"true".match(/true/)?i.disableAll():i.enableAll();var e=t||"default";return i.getLogger(e)},disableAll:function(){var t=i.getLoggers();for(var e in t){if(Object.hasOwnProperty.call(t,e))t[e].disableAll()}},enableAll:function(){var t=i.getLoggers();for(var e in t){if(Object.hasOwnProperty.call(t,e))t[e].enableAll()}}};e.a=r},function(t,e,n){"use strict";(function(t){var i=n(1).a.getLogger("config"),r={configuration:null,isConfigLoaded:function(){var e="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==t?t:{};return!(!e.Gp||!e.Gp.Config||0===Object.keys(e.Gp.Config).length)&&(this.configuration=e.Gp.Config,!0)},getLayerId:function(t,e){var n=null;if(this.configuration){var r=this.configuration.layers;for(var s in r)if(r.hasOwnProperty(s)){var o=s.split("$");if(t===o[0]&&o[1]){var a=o[1].split(":");if(o[1].split(";")[1]===e){n=s;break}if(a[2]===e){n=s;break}}}}return n||i.error("ERROR layer id (layer name: "+t+" / service: "+e+") was not found !?"),n},getLayerParams:function(t,e,n){var r={};if(this.configuration){var s=this.getLayerId(t,e);if(s){var o=this.configuration.layers[s],a=o.apiKeys[0];if(n&&n!==a)return void i.error("ERROR different keys ("+n+" !== "+a+") !?");n=n||a,r.key=n,r.url=o.getServerUrl(n),r.version=o.getServiceParams().version,r.styles=o.getDefaultStyle(),r.format=o.getDefaultFormat(),r.projection=o.getDefaultProjection(),r.minScale=o.getMinScaleDenominator(),r.maxScale=o.getMaxScaleDenominator(),r.extent=o.getBBOX(),r.legends=o.getLegends(),r.metadata=o.getMetadata(),r.originators=o.getOriginators(),r.title=o.getTitle(),r.description=o.getDescription(),r.quicklookUrl=o.getQuicklookUrl(),o.wmtsOptions&&(r.tileMatrixSetLimits=o.wmtsOptions.tileMatrixSetLimits);var l=o.getTMSID();if(l){r.TMSLink=l;var c=this.configuration.getTMSConf(l);r.matrixOrigin=c.getTopLeftCorner(),r.nativeResolutions=c.nativeResolutions,r.matrixIds=c.matrixIds,r.tileMatrices=c.tileMatrices}}}return r},getServiceParams:function(t,e,n){var i={};if(this.configuration){var r=this.getLayerId(t,e);if(r){var s=this.configuration.layers[r],o=s.apiKeys[0];if(n){Array.isArray(n)||(n=[n]);for(var a=0;a<n.length;a++)if(n[a]===o){var l=a;break}if(void 0===l)return}var c=n[l]||o;i.key=c,i.url=s.getServerUrl(c),i.version=s.getServiceParams().version,i.extent=s.getBBOX(),i.title=s.getTitle(),i.description=s.getDescription()}}return i},getResolutions:function(){var t=[];return this.configuration&&(t=this.configuration.generalOptions.wgs84Resolutions),t},getTileMatrix:function(t){var e={};return this.configuration&&t&&(e=this.configuration.tileMatrixSets[t.toUpperCase()]),e},getGlobalConstraints:function(t){var e={};if(t){var n=this.configuration.layers[t];e.projection=n.getDefaultProjection(),e.minScale=n.getMinScaleDenominator(),e.maxScale=n.getMaxScaleDenominator(),e.extent=n.getBBOX()}return e}};e.a=r}).call(this,n(6))},function(t){t.exports=JSON.parse('{"name":"geoportal-extensions","description":"French Geoportal Extensions for OpenLayers, Leaflet and iTowns libraries","version":"2.6.10","date":"04/03/2022","leafletExtName":"French Geoportal Extension for Leaflet","leafletExtVersion":"2.2.2","olExtName":"French Geoportal Extension for OpenLayers","olExtVersion":"3.2.9","itownsExtName":"French Geoportal Extension for Itowns","itownsExtVersion":"2.3.6","main":"dist/leaflet/GpPluginLeaflet.js, dist/openlayers/GpPluginOpenLayers.js, dist/itowns/GpPluginItowns.js","module":"src/Leaflet/index.js, src/OpenLayers/index.js, src/Itowns/index.js","directories":{},"scripts":{"setup":"npm install","clean":"echo \\"Warning: target not yet implemented!\\" && exit 0","eslint":"eslint src/","test":"npm run test:serve","test:serve":"cd test && webpack-dev-server --hot --config webpack.test.serve.js","sample":"npm run sample:serve","sample:serve":"npm run sample:ol:serve","sample:itowns:serve":"webpack-dev-server --config build/webpack/webpack.config.itowns --mode=development --https --open-page samples/index-itowns-map.html --content-base . --output-public-path \'/dist/itowns/\' --port 9001 --open","sample:leaflet:serve":"webpack-dev-server --config build/webpack/webpack.config.leaflet --mode=development --https --open-page samples/index-leaflet-map.html --content-base . --output-public-path \'/dist/leaflet/\' --port 9001 --open","sample:ol:serve":"webpack-dev-server --config build/webpack/webpack.config.openlayers --mode=development --https --open-page samples/index-openlayers-map.html --content-base . --output-public-path \'/dist/openlayers/\' --port 9001 --open","doc":"npm run doc:serve","doc:serve":"npm run doc:ol:serve","doc:itowns:serve":"webpack-dev-server --hot  --config build/webpack/webpack.config.itowns --content-base jsdoc/itowns --port 9001 --open","doc:leaflet:serve":"webpack-dev-server --hot  --config build/webpack/webpack.config.leaflet --content-base jsdoc/leaflet --port 9001 --open","doc:ol:serve":"webpack-dev-server --hot  --config build/webpack/webpack.config.openlayers --content-base jsdoc/openlayers --port 9001 --open","build:dev":"npm-run-all --print-label --print-name build:*:dev","build:prod":"npm-run-all --print-label --print-name build:*:prod","build:src":"npm-run-all --print-label --print-name build:*:src","build":"npm-run-all --print-label --print-name build:*:*","build:itowns":"npm-run-all --print-label --print-name build:itowns:*","build:itowns:dev":"webpack --config build/webpack/webpack.config.itowns --mode=development","build:itowns:prod":"webpack --config build/webpack/webpack.config.itowns --mode=production","build:itowns:src":"webpack --config build/webpack/webpack.config.itowns --mode=none","build:ol":"npm-run-all --print-label --print-name build:ol:*","build:ol:dev":"webpack --config build/webpack/webpack.config.openlayers --mode=development","build:ol:prod":"webpack --config build/webpack/webpack.config.openlayers --mode=production","build:ol:src":"webpack --config build/webpack/webpack.config.openlayers --mode=none","build:leaflet":"npm-run-all --print-label --print-name build:leaflet:*","build:leaflet:dev":"webpack --config build/webpack/webpack.config.leaflet --mode=development","build:leaflet:prod":"webpack --config build/webpack/webpack.config.leaflet --mode=production","build:leaflet:src":"webpack --config build/webpack/webpack.config.leaflet --mode=none"},"repository":{"type":"git","url":"https://github.com/IGNF/geoportal-extensions.git"},"author":"IGNF","keywords":["geoportail","javascript","OpenLayers","Leaflet","Itowns","3D"],"license":"CECILL-B","bugs":{"url":"https://github.com/IGNF/geoportal-extensions/issues"},"homepage":"https://github.com/IGNF/geoportal-extensions#readme","dependencies":{"@mapbox/mapbox-gl-style-spec":"13.20.1","eventbusjs":"0.2.0","geoportal-access-lib":"3.0.5","itowns":"2.37.0","leaflet":"1.7.1","leaflet-draw":"1.0.4","loglevel":"^1.6.7","markdown-toc":"^1.2.0","ol":"6.9.0","ol-mapbox-style":"6.7.0","proj4":"2.7.5","proj4leaflet":"1.0.2","sortablejs":"1.14.0","three":"0.135.0","whatwg-fetch":"3.0.0"},"devDependencies":{"@babel/core":"^7.4.4","@babel/plugin-transform-template-literals":"^7.7.4","@babel/preset-env":"^7.4.4","babel-loader":"^8.0.5","chai":"^4.2.0","chalk":"^4.0.0","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.0.3","core-js":"^3.6.4","css-loader":"^3.4.2","eslint":"^6.8.0","eslint-config-standard":"^14.1.1","eslint-loader":"^4.0.0","eslint-plugin-import":"^2.17.2","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.1.1","eslint-plugin-standard":"^4.0.0","exports-loader":"^0.7.0","expose-loader":"^0.7.5","fs-extra":"^9.0.0","handlebars":"^4.7.5","handlebars-layouts":"^3.1.4","html-webpack-plugin":"^4.0.4","jsdoc-webpack-plugin":"^0.3.0","mini-css-extract-plugin":"^0.9.0","mocha":"^7.1.1","mocha-loader":"^5.0.0","npm-run-all":"^4.1.5","optimize-css-assets-webpack-plugin":"^5.0.1","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","requirejs":"^2.3.6","responsive-loader":"^1.2.0","speed-measure-webpack-plugin":"^1.3.0","string-template":"^1.0.0","style-loader":"^1.1.3","terser-webpack-plugin":"^2.0.0","url-loader":"^4.0.0","webpack":"^4.30.0","webpack-cli":"^3.3.1","webpack-dev-server":"^3.3.1","webpack-node-externals":"^1.7.2"}}')},function(t,e,n){var i,r;!function(s,o){"use strict";void 0===(r="function"==typeof(i=function(){var t=function(){},e="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function i(t,e){var n=t[e];if("function"==typeof n.bind)return n.bind(t);try{return Function.prototype.bind.call(n,t)}catch(e){return function(){return Function.prototype.apply.apply(n,[t,arguments])}}}function r(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(n){return"debug"===n&&(n="log"),"undefined"!=typeof console&&("trace"===n&&e?r:void 0!==console[n]?i(console,n):void 0!==console.log?i(console,"log"):t)}function o(e,i){for(var r=0;r<n.length;r++){var s=n[r];this[s]=r<e?t:this.methodFactory(s,e,i)}this.log=this.debug}function a(t,e,n){return function(){"undefined"!=typeof console&&(o.call(this,e,n),this[t].apply(this,arguments))}}function l(t,e,n){return s(t)||a.apply(this,arguments)}function c(t,e,i){var r,s=this;e=null==e?"WARN":e;var a="loglevel";function c(){var t;if("undefined"!=typeof window&&a){try{t=window.localStorage[a]}catch(t){}if(void 0===t)try{var e=window.document.cookie,n=e.indexOf(encodeURIComponent(a)+"=");-1!==n&&(t=/^([^;]+)/.exec(e.slice(n))[1])}catch(t){}return void 0===s.levels[t]&&(t=void 0),t}}"string"==typeof t?a+=":"+t:"symbol"==typeof t&&(a=void 0),s.name=t,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=i||l,s.getLevel=function(){return r},s.setLevel=function(e,i){if("string"==typeof e&&void 0!==s.levels[e.toUpperCase()]&&(e=s.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(r=e,!1!==i&&function(t){var e=(n[t]||"silent").toUpperCase();if("undefined"!=typeof window&&a){try{return void(window.localStorage[a]=e)}catch(t){}try{window.document.cookie=encodeURIComponent(a)+"="+e+";"}catch(t){}}}(e),o.call(s,e,t),"undefined"==typeof console&&e<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(t){e=t,c()||s.setLevel(t,!1)},s.resetLevel=function(){s.setLevel(e,!1),function(){if("undefined"!=typeof window&&a){try{return void window.localStorage.removeItem(a)}catch(t){}try{window.document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(t){}}}()},s.enableAll=function(t){s.setLevel(s.levels.TRACE,t)},s.disableAll=function(t){s.setLevel(s.levels.SILENT,t)};var h=c();null==h&&(h=e),s.setLevel(h,!1)}var h=new c,u={};h.getLogger=function(t){if("symbol"!=typeof t&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=u[t];return e||(e=u[t]=new c(t,h.getLevel(),h.methodFactory)),e};var d="undefined"!=typeof window?window.log:void 0;return h.noConflict=function(){return"undefined"!=typeof window&&window.log===h&&(window.log=d),h},h.getLoggers=function(){return u},h.default=h,h})?i.call(e,n,e,t):i)||(t.exports=r)}()},function(t){t.exports=JSON.parse('{"_from":"geoportal-access-lib@3.0.5","_id":"geoportal-access-lib@3.0.5","_inBundle":false,"_integrity":"sha512-ruj6iXD7XStS1YuwSoTUYyQEsdP5BMLTiz7kS7hLwiB0g42SF4+ALH3aLHpthQOpXcNJb5XsCfS7P8K1BKZOZg==","_location":"/geoportal-access-lib","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"geoportal-access-lib@3.0.5","name":"geoportal-access-lib","escapedName":"geoportal-access-lib","rawSpec":"3.0.5","saveSpec":null,"fetchSpec":"3.0.5"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/geoportal-access-lib/-/geoportal-access-lib-3.0.5.tgz","_shasum":"2cde6e6ea689765c25f455fe1109d678a3b5ab2d","_spec":"geoportal-access-lib@3.0.5","_where":"/home/runner/work/geoportal-extensions/geoportal-extensions","author":{"name":"IGNF"},"bugs":{"url":"https://github.com/IGNF/geoportal-access-lib/issues"},"bundleDependencies":false,"date":"03/12/2021","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","xmldom":"^0.1.27"},"deprecated":false,"description":"French Geoportal resources access library","devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"homepage":"https://github.com/IGNF/geoportal-access-lib#readme","keywords":["geoportail","webservice","javascript","es6"],"license":"CECILL-B","main":"dist/GpServices-src.js","module":"src/Gp.js","name":"geoportal-access-lib","nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"optionalDependencies":{},"peerDependencies":{},"repository":{"type":"git","url":"git+https://github.com/IGNF/geoportal-access-lib.git"},"scripts":{"build":"webpack --mode=none","build:dev":"webpack --mode=development","build:prod":"webpack --mode=production","clean":"echo \\"Warning: no yet implemented!\\" && exit 0","cover":"nyc --reporter=lcov --reporter=text npm run test","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open","eslint":"eslint src/","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","setup":"npm install","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js"},"version":"3.0.5"}')},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,n){t.exports=e},function(t,e,n){(function(e){t.exports=e.proj4=n(34)}).call(this,n(6))},function(t,e,n){(function(e,n){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var i;i=function(){"use strict";function t(t){return"function"==typeof t}var i=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,s=void 0,o=void 0,a=function(t,e){f[r]=t,f[r+1]=e,2===(r+=2)&&(o?o(m):x())},l="undefined"!=typeof window?window:void 0,c=l||{},h=c.MutationObserver||c.WebKitMutationObserver,u="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var t=setTimeout;return function(){return t(m,1)}}var f=new Array(1e3);function m(){for(var t=0;t<r;t+=2)(0,f[t])(f[t+1]),f[t]=void 0,f[t+1]=void 0;r=0}var g,v,y,_,x=void 0;function b(t,e){var n=this,i=new this.constructor(E);void 0===i[w]&&D(i);var r=n._state;if(r){var s=arguments[r-1];a((function(){return I(r,i,s,n._result)}))}else P(n,i,t,e);return i}function M(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(E);return T(e,t),e}u?x=function(){return e.nextTick(m)}:h?(v=0,y=new h(m),_=document.createTextNode(""),y.observe(_,{characterData:!0}),x=function(){_.data=v=++v%2}):d?((g=new MessageChannel).port1.onmessage=m,x=function(){return g.port2.postMessage(0)}):x=void 0===l?function(){try{var t=Function("return this")().require("vertx");return void 0!==(s=t.runOnLoop||t.runOnContext)?function(){s(m)}:p()}catch(t){return p()}}():p();var w=Math.random().toString(36).substring(2);function E(){}function S(e,n,i){n.constructor===e.constructor&&i===b&&n.constructor.resolve===M?function(t,e){1===e._state?A(t,e._result):2===e._state?C(t,e._result):P(e,void 0,(function(e){return T(t,e)}),(function(e){return C(t,e)}))}(e,n):void 0===i?A(e,n):t(i)?function(t,e,n){a((function(t){var i=!1,r=function(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}(n,e,(function(n){i||(i=!0,e!==n?T(t,n):A(t,n))}),(function(e){i||(i=!0,C(t,e))}),t._label);!i&&r&&(i=!0,C(t,r))}),t)}(e,n,i):A(e,n)}function T(t,e){if(t===e)C(t,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(i=e),null===i||"object"!==r&&"function"!==r)A(t,e);else{var n=void 0;try{n=e.then}catch(e){return void C(t,e)}S(t,e,n)}var i,r}function R(t){t._onerror&&t._onerror(t._result),L(t)}function A(t,e){void 0===t._state&&(t._result=e,t._state=1,0!==t._subscribers.length&&a(L,t))}function C(t,e){void 0===t._state&&(t._state=2,t._result=e,a(R,t))}function P(t,e,n,i){var r=t._subscribers,s=r.length;t._onerror=null,r[s]=e,r[s+1]=n,r[s+2]=i,0===s&&t._state&&a(L,t)}function L(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,s=t._result,o=0;o<e.length;o+=3)i=e[o],r=e[o+n],i?I(n,i,r,s):r(s);t._subscribers.length=0}}function I(e,n,i,r){var s=t(i),o=void 0,a=void 0,l=!0;if(s){try{o=i(r)}catch(t){l=!1,a=t}if(n===o)return void C(n,new TypeError("A promises callback cannot return that same promise."))}else o=r;void 0!==n._state||(s&&l?T(n,o):!1===l?C(n,a):1===e?A(n,o):2===e&&C(n,o))}var N=0;function D(t){t[w]=N++,t._state=void 0,t._result=void 0,t._subscribers=[]}var O=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(E),this.promise[w]||D(this.promise),i(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&A(this.promise,this._result))):C(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;void 0===this._state&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===M){var r=void 0,s=void 0,o=!1;try{r=t.then}catch(t){o=!0,s=t}if(r===b&&void 0!==t._state)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===G){var a=new n(E);o?C(a,s):S(a,t,r),this._willSettleAt(a,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(i(t),e)},t.prototype._settledAt=function(t,e,n){var i=this.promise;void 0===i._state&&(this._remaining--,2===t?C(i,n):this._result[e]=n),0===this._remaining&&A(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;P(t,void 0,(function(t){return n._settledAt(1,e,t)}),(function(t){return n._settledAt(2,e,t)}))},t}(),G=function(){function e(t){this[w]=N++,this._result=this._state=void 0,this._subscribers=[],E!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){T(t,e)}),(function(e){C(t,e)}))}catch(e){C(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return G.prototype.then=b,G.all=function(t){return new O(this,t).promise},G.race=function(t){var e=this;return i(t)?new e((function(n,i){for(var r=t.length,s=0;s<r;s++)e.resolve(t[s]).then(n,i)})):new e((function(t,e){return e(new TypeError("You must pass an array to race."))}))},G.resolve=M,G.reject=function(t){var e=new this(E);return C(e,t),e},G._setScheduler=function(t){o=t},G._setAsap=function(t){a=t},G._asap=a,G.polyfill=function(){var t=void 0;if(void 0!==n)t=n;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=G},G.Promise=G,G},t.exports=i()}).call(this,n(35),n(6))},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){t.exports=function(){"use strict";var t=484813681109536e-20,e=Math.PI/2,n=.017453292519943295,i=57.29577951308232,r=Math.PI/4,s=2*Math.PI,o=3.14159265359,a={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},l={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},c=/[\s_\-\/\(\)]/g;function h(t,e){if(t[e])return t[e];for(var n,i=Object.keys(t),r=e.toLowerCase().replace(c,""),s=-1;++s<i.length;)if((n=i[s]).toLowerCase().replace(c,"")===r)return t[n]}var u=function(t){var e,i,r,s={},o=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var n=e.split("=");return n.push(!0),t[n[0].toLowerCase()]=n[1],t}),{}),c={proj:"projName",datum:"datumCode",rf:function(t){s.rf=parseFloat(t)},lat_0:function(t){s.lat0=t*n},lat_1:function(t){s.lat1=t*n},lat_2:function(t){s.lat2=t*n},lat_ts:function(t){s.lat_ts=t*n},lon_0:function(t){s.long0=t*n},lon_1:function(t){s.long1=t*n},lon_2:function(t){s.long2=t*n},alpha:function(t){s.alpha=parseFloat(t)*n},gamma:function(t){s.rectified_grid_angle=parseFloat(t)},lonc:function(t){s.longc=t*n},x_0:function(t){s.x0=parseFloat(t)},y_0:function(t){s.y0=parseFloat(t)},k_0:function(t){s.k0=parseFloat(t)},k:function(t){s.k0=parseFloat(t)},a:function(t){s.a=parseFloat(t)},b:function(t){s.b=parseFloat(t)},r_a:function(){s.R_A=!0},zone:function(t){s.zone=parseInt(t,10)},south:function(){s.utmSouth=!0},towgs84:function(t){s.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){s.to_meter=parseFloat(t)},units:function(t){s.units=t;var e=h(l,t);e&&(s.to_meter=e.to_meter)},from_greenwich:function(t){s.from_greenwich=t*n},pm:function(t){var e=h(a,t);s.from_greenwich=(e||parseFloat(t))*n},nadgrids:function(t){"@null"===t?s.datumCode="none":s.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(s.axis=t)},approx:function(){s.approx=!0}};for(e in o)i=o[e],e in c?"function"==typeof(r=c[e])?r(i):s[r]=i:s[e]=i;return"string"==typeof s.datumCode&&"WGS84"!==s.datumCode&&(s.datumCode=s.datumCode.toLowerCase()),s},d=/\s/,p=/[A-Za-z]/,f=/[A-Za-z84]/,m=/[,\]]/,g=/[\d\.E\-\+]/;function v(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function y(t,e,n){Array.isArray(e)&&(n.unshift(e),e=null);var i=e?{}:t,r=n.reduce((function(t,e){return _(e,t),t}),i);e&&(t[e]=r)}function _(t,e){if(Array.isArray(t)){var n=t.shift();if("PARAMETER"===n&&(n=t.shift()),1===t.length)return Array.isArray(t[0])?(e[n]={},void _(t[0],e[n])):void(e[n]=t[0]);if(t.length)if("TOWGS84"!==n){if("AXIS"===n)return n in e||(e[n]=[]),void e[n].push(t);var i;switch(Array.isArray(n)||(e[n]={}),n){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[n]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&_(t[2],e[n]));case"SPHEROID":case"ELLIPSOID":return e[n]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&_(t[3],e[n]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void y(e,n,t);default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return _(t,e[n]);return y(e,n,t)}}else e[n]=t;else e[n]=!0}else e[t]=!0}function x(t){return.017453292519943295*t}v.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;d.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},v.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(m.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},v.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},v.prototype.number=function(t){if(!g.test(t)){if(m.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},v.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},v.prototype.keyword=function(t){if(f.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=1)}if(!m.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},v.prototype.neutral=function(t){if(p.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(g.test(t))return this.word=t,void(this.state=3);if(!m.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},v.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var b=function(t){var e=new v(t).output(),n=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",n]);var r={};return _(e,r),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",n=0,i=t.AXIS.length;n<i;++n){var r=[t.AXIS[n][0].toLowerCase(),t.AXIS[n][1].toLowerCase()];-1!==r[0].indexOf("north")||("y"===r[0]||"lat"===r[0])&&"north"===r[1]?e+="n":-1!==r[0].indexOf("south")||("y"===r[0]||"lat"===r[0])&&"south"===r[1]?e+="s":-1!==r[0].indexOf("east")||("x"===r[0]||"lon"===r[0])&&"east"===r[1]?e+="e":-1===r[0].indexOf("west")&&("x"!==r[0]&&"lon"!==r[0]||"west"!==r[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var s=t.GEOGCS;function o(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(s=t),s&&(s.DATUM?t.datumCode=s.DATUM.name.toLowerCase():t.datumCode=s.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(t.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=s.DATUM.SPHEROID.a,t.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(t.datum_params=s.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",x],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",x],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",x],["lat0","latitude_of_origin",x],["lat0","standard_parallel_1",x],["lat1","standard_parallel_1",x],["lat2","standard_parallel_2",x],["azimuth","Azimuth"],["alpha","azimuth",x],["srsCode","name"]].forEach((function(e){return function(t,e){var n=e[0],i=e[1];!(n in t)&&i in t&&(t[n]=t[i],3===e.length&&(t[n]=e[2](t[n])))}(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=x(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(r),r};function M(t){var e=this;if(2===arguments.length){var n=arguments[1];"string"==typeof n?"+"===n.charAt(0)?M[t]=u(arguments[1]):M[t]=b(arguments[1]):M[t]=n}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?M.apply(e,t):M(t)}));if("string"==typeof t){if(t in M)return M[t]}else"EPSG"in t?M["EPSG:"+t.EPSG]=t:"ESRI"in t?M["ESRI:"+t.ESRI]=t:"IAU2000"in t?M["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(M);var w=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],E=["3857","900913","3785","102113"];function S(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in M}(t))return M[t];if(function(t){return w.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=b(t);if(function(t){var e=h(t,"authority");if(e){var n=h(e,"epsg");return n&&E.indexOf(n)>-1}}(e))return M["EPSG:3857"];var n=function(t){var e=h(t,"extension");if(e)return h(e,"proj4")}(e);return n?u(n):e}return function(t){return"+"===t[0]}(t)?u(t):void 0}var T=function(t,e){var n,i;if(t=t||{},!e)return t;for(i in e)void 0!==(n=e[i])&&(t[i]=n);return t},R=function(t,e,n){var i=t*e;return n/Math.sqrt(1-i*i)},A=function(t){return t<0?-1:1},C=function(t){return Math.abs(t)<=o?t:t-A(t)*s},P=function(t,n,i){var r=t*i,s=.5*t;return r=Math.pow((1-r)/(1+r),s),Math.tan(.5*(e-n))/r},L=function(t,n){for(var i,r,s=.5*t,o=e-2*Math.atan(n),a=0;a<=15;a++)if(i=t*Math.sin(o),o+=r=e-2*Math.atan(n*Math.pow((1-i)/(1+i),s))-o,Math.abs(r)<=1e-10)return o;return-9999};function I(t){return t}var N=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=R(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var n,s,o=t.x,a=t.y;if(a*i>90&&a*i<-90&&o*i>180&&o*i<-180)return null;if(Math.abs(Math.abs(a)-e)<=1e-10)return null;if(this.sphere)n=this.x0+this.a*this.k0*C(o-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(r+.5*a));else{var l=Math.sin(a),c=P(this.e,a,l);n=this.x0+this.a*this.k0*C(o-this.long0),s=this.y0-this.a*this.k0*Math.log(c)}return t.x=n,t.y=s,t},inverse:function(t){var n,i,r=t.x-this.x0,s=t.y-this.y0;if(this.sphere)i=e-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var o=Math.exp(-s/(this.a*this.k0));if(-9999===(i=L(this.e,o)))return null}return n=C(this.long0+r/(this.a*this.k0)),t.x=n,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:I,inverse:I,names:["longlat","identity"]}],D={},O=[];function G(t,e){var n=O.length;return t.names?(O[n]=t,t.names.forEach((function(t){D[t.toLowerCase()]=n})),this):(console.log(e),!0)}var k={start:function(){N.forEach(G)},add:G,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==D[e]&&O[D[e]]?O[D[e]]:void 0}},U={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},F=U.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};U.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var B={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},z={};function V(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:z[t]||null,isNull:!1}}function H(t){return t/3600*Math.PI/180}function W(t,e,n){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,n)))}function j(t){return t.map((function(t){return[H(t.longitudeShift),H(t.latitudeShift)]}))}function q(t,e,n){return{name:W(t,e+8,e+16).trim(),parent:W(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,n),upperLatitude:t.getFloat64(e+88,n),lowerLongitude:t.getFloat64(e+104,n),upperLongitude:t.getFloat64(e+120,n),latitudeInterval:t.getFloat64(e+136,n),longitudeInterval:t.getFloat64(e+152,n),gridNodeCount:t.getInt32(e+168,n)}}function X(t,e,n,i){for(var r=e+176,s=[],o=0;o<n.gridNodeCount;o++){var a={latitudeShift:t.getFloat32(r+16*o,i),longitudeShift:t.getFloat32(r+16*o+4,i),latitudeAccuracy:t.getFloat32(r+16*o+8,i),longitudeAccuracy:t.getFloat32(r+16*o+12,i)};s.push(a)}return s}function Y(e,n){if(!(this instanceof Y))return new Y(e);n=n||function(t){if(t)throw t};var i=S(e);if("object"==typeof i){var r=Y.projections.get(i.projName);if(r){if(i.datumCode&&"none"!==i.datumCode){var s=h(B,i.datumCode);s&&(i.datum_params=i.datum_params||(s.towgs84?s.towgs84.split(","):null),i.ellps=s.ellipse,i.datumName=s.datumName?s.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var o,a,l,c,u,d,p,f=function(t,e,n,i,r){if(!t){var s=h(U,i);s||(s=F),t=s.a,e=s.b,n=s.rf}return n&&!e&&(e=(1-1/n)*t),(0===n||Math.abs(t-e)<1e-10)&&(r=!0,e=t),{a:t,b:e,rf:n,sphere:r}}(i.a,i.b,i.rf,i.ellps,i.sphere),m=(o=f.a,a=f.b,f.rf,l=i.R_A,d=((c=o*o)-(u=a*a))/c,p=0,l?(c=(o*=1-d*(.16666666666666666+d*(.04722222222222222+.022156084656084655*d)))*o,d=0):p=Math.sqrt(d),{es:d,e:p,ep2:(c-u)/u}),g=function(t){return void 0===t?null:t.split(",").map(V)}(i.nadgrids),v=i.datum||function(e,n,i,r,s,o,a){var l={};return l.datum_type=void 0===e||"none"===e?5:4,n&&(l.datum_params=n.map(parseFloat),0===l.datum_params[0]&&0===l.datum_params[1]&&0===l.datum_params[2]||(l.datum_type=1),l.datum_params.length>3&&(0===l.datum_params[3]&&0===l.datum_params[4]&&0===l.datum_params[5]&&0===l.datum_params[6]||(l.datum_type=2,l.datum_params[3]*=t,l.datum_params[4]*=t,l.datum_params[5]*=t,l.datum_params[6]=l.datum_params[6]/1e6+1))),a&&(l.datum_type=3,l.grids=a),l.a=i,l.b=r,l.es=s,l.ep2=o,l}(i.datumCode,i.datum_params,f.a,f.b,m.es,m.ep2,g);T(this,i),T(this,r),this.a=f.a,this.b=f.b,this.rf=f.rf,this.sphere=f.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=v,this.init(),n(null,this)}else n(e)}else n(e)}function J(t,n,i){var r,s,o,a,l=t.x,c=t.y,h=t.z?t.z:0;if(c<-e&&c>-1.001*e)c=-e;else if(c>e&&c<1.001*e)c=e;else{if(c<-e)return{x:-1/0,y:-1/0,z:t.z};if(c>e)return{x:1/0,y:1/0,z:t.z}}return l>Math.PI&&(l-=2*Math.PI),s=Math.sin(c),a=Math.cos(c),o=s*s,{x:((r=i/Math.sqrt(1-n*o))+h)*a*Math.cos(l),y:(r+h)*a*Math.sin(l),z:(r*(1-n)+h)*s}}function Z(t,e,n,i){var r,s,o,a,l,c,h,u,d,p,f,m,g,v,y,_=t.x,x=t.y,b=t.z?t.z:0;if(r=Math.sqrt(_*_+x*x),s=Math.sqrt(_*_+x*x+b*b),r/n<1e-12){if(v=0,s/n<1e-12)return y=-i,{x:t.x,y:t.y,z:t.z}}else v=Math.atan2(x,_);o=b/s,u=(a=r/s)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*a*a)),d=o*l,g=0;do{g++,c=e*(h=n/Math.sqrt(1-e*d*d))/(h+(y=r*u+b*d-h*(1-e*d*d))),m=(f=o*(l=1/Math.sqrt(1-c*(2-c)*a*a)))*u-(p=a*(1-c)*l)*d,u=p,d=f}while(m*m>1e-24&&g<30);return{x:v,y:Math.atan(f/Math.abs(p)),z:y}}function K(t){return 1===t||2===t}Y.projections=k,Y.projections.start();var Q=function(t,e,n){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(1===t.datum_type?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:2!==t.datum_type||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return n;if(5===t.datum_type||5===e.datum_type)return n;var i=t.a,r=t.es;if(3===t.datum_type){if(0!==$(t,!1,n))return;i=6378137,r=.0066943799901413165}var s=e.a,o=e.b,a=e.es;return 3===e.datum_type&&(s=6378137,o=6356752.314,a=.0066943799901413165),r!==a||i!==s||K(t.datum_type)||K(e.datum_type)?(n=J(n,r,i),K(t.datum_type)&&(n=function(t,e,n){if(1===e)return{x:t.x+n[0],y:t.y+n[1],z:t.z+n[2]};if(2===e){var i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6];return{x:c*(t.x-l*t.y+a*t.z)+i,y:c*(l*t.x+t.y-o*t.z)+r,z:c*(-a*t.x+o*t.y+t.z)+s}}}(n,t.datum_type,t.datum_params)),K(e.datum_type)&&(n=function(t,e,n){if(1===e)return{x:t.x-n[0],y:t.y-n[1],z:t.z-n[2]};if(2===e){var i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],h=(t.x-i)/c,u=(t.y-r)/c,d=(t.z-s)/c;return{x:h+l*u-a*d,y:-l*h+u+o*d,z:a*h-o*u+d}}}(n,e.datum_type,e.datum_params)),n=Z(n,a,s,o),3!==e.datum_type||0===$(e,!0,n)?n:void 0):n};function $(t,e,n){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var r={x:-n.x,y:n.y},s={x:Number.NaN,y:Number.NaN},o=[],a=0;a<t.grids.length;a++){var l=t.grids[a];if(o.push(l.name),l.isNull){s=r;break}if(null!==l.grid){var c=l.grid.subgrids[0],h=(Math.abs(c.del[1])+Math.abs(c.del[0]))/1e4,u=c.ll[0]-h,d=c.ll[1]-h,p=c.ll[0]+(c.lim[0]-1)*c.del[0]+h,f=c.ll[1]+(c.lim[1]-1)*c.del[1]+h;if(!(d>r.y||u>r.x||f<r.y||p<r.x||(s=tt(r,e,c),isNaN(s.x))))break}else if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*i+" "+r.y*i+" tried: '"+o+"'"),-1):(n.x=-s.x,n.y=s.y,0)}function tt(t,e,n){var i={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return i;var r={x:t.x,y:t.y};r.x-=n.ll[0],r.y-=n.ll[1],r.x=C(r.x-Math.PI)+Math.PI;var s=et(r,n);if(e){if(isNaN(s.x))return i;s.x=r.x-s.x,s.y=r.y-s.y;var o,a,l=9;do{if(a=et(s,n),isNaN(a.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}o={x:r.x-(a.x+s.x),y:r.y-(a.y+s.y)},s.x+=o.x,s.y+=o.y}while(l--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=C(s.x+n.ll[0]),i.y=s.y+n.ll[1]}else isNaN(s.x)||(i.x=t.x+s.x,i.y=t.y+s.y);return i}function et(t,e){var n,i={x:t.x/e.del[0],y:t.y/e.del[1]},r=Math.floor(i.x),s=Math.floor(i.y),o=i.x-1*r,a=i.y-1*s,l={x:Number.NaN,y:Number.NaN};if(r<0||r>=e.lim[0])return l;if(s<0||s>=e.lim[1])return l;n=s*e.lim[0]+r;var c=e.cvs[n][0],h=e.cvs[n][1];n++;var u=e.cvs[n][0],d=e.cvs[n][1];n+=e.lim[0];var p=e.cvs[n][0],f=e.cvs[n][1];n--;var m=e.cvs[n][0],g=e.cvs[n][1],v=o*a,y=o*(1-a),_=(1-o)*(1-a),x=(1-o)*a;return l.x=_*c+y*u+x*m+v*p,l.y=_*h+y*d+x*g+v*f,l}var nt=function(t,e,n){var i,r,s,o=n.x,a=n.y,l=n.z||0,c={};for(s=0;s<3;s++)if(!e||2!==s||void 0!==n.z)switch(0===s?(i=o,r=-1!=="ew".indexOf(t.axis[s])?"x":"y"):1===s?(i=a,r=-1!=="ns".indexOf(t.axis[s])?"y":"x"):(i=l,r="z"),t.axis[s]){case"e":c[r]=i;break;case"w":c[r]=-i;break;case"n":c[r]=i;break;case"s":c[r]=-i;break;case"u":void 0!==n[r]&&(c.z=i);break;case"d":void 0!==n[r]&&(c.z=-i);break;default:return null}return c},it=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e};function rt(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function st(t,e,r,s){var o;if(Array.isArray(r)&&(r=it(r)),function(t){rt(t.x),rt(t.y)}(r),t.datum&&e.datum&&function(t,e){return(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode||(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode}(t,e)&&(r=st(t,o=new Y("WGS84"),r,s),t=o),s&&"enu"!==t.axis&&(r=nt(t,!1,r)),"longlat"===t.projName)r={x:r.x*n,y:r.y*n,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),!(r=t.inverse(r)))return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=Q(t.datum,e.datum,r))return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*i,y:r.y*i,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),s&&"enu"!==e.axis?nt(e,!0,r):r}var ot=Y("WGS84");function at(t,e,n,i){var r,s,o;return Array.isArray(n)?(r=st(t,e,n,i)||{x:NaN,y:NaN},n.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof r.z?[r.x,r.y,r.z].concat(n.splice(3)):[r.x,r.y,n[2]].concat(n.splice(3)):[r.x,r.y].concat(n.splice(2)):[r.x,r.y]):(s=st(t,e,n,i),2===(o=Object.keys(n)).length||o.forEach((function(i){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===i||"y"===i||"z"===i)return}else if("x"===i||"y"===i)return;s[i]=n[i]})),s)}function lt(t){return t instanceof Y?t:t.oProj?t.oProj:Y(t)}function ct(t,e,n){t=lt(t);var i,r=!1;return void 0===e?(e=t,t=ot,r=!0):(void 0!==e.x||Array.isArray(e))&&(n=e,e=t,t=ot,r=!0),e=lt(e),n?at(t,e,n):(i={forward:function(n,i){return at(t,e,n,i)},inverse:function(n,i){return at(e,t,n,i)}},r&&(i.oProj=e),i)}var ht=65,ut=73,dt=79,pt={forward:ft,inverse:function(t){var e=yt(xt(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:mt};function ft(t,e){return e=e||5,function(t,e){var n,i,r,s,o,a,l,c,h,u,d,p,f,m,g="00000"+t.easting,v="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(h=t.easting,u=t.northing,d=t.zoneNumber,p=_t(d),f=Math.floor(h/1e5),m=Math.floor(u/1e5)%20,n=f,i=m,s="AJSAJS".charCodeAt(r=p-1),o="AFAFAF".charCodeAt(r),c=!1,(a=s+n-1)>90&&(a=a-90+ht-1,c=!0),(a===ut||s<ut&&a>ut||(a>ut||s<ut)&&c)&&a++,(a===dt||s<dt&&a>dt||(a>dt||s<dt)&&c)&&++a===ut&&a++,a>90&&(a=a-90+ht-1),(l=o+i)>86?(l=l-86+ht-1,c=!0):c=!1,(l===ut||o<ut&&l>ut||(l>ut||o<ut)&&c)&&l++,(l===dt||o<dt&&l>dt||(l>dt||o<dt)&&c)&&++l===ut&&l++,l>86&&(l=l-86+ht-1),String.fromCharCode(a)+String.fromCharCode(l))+g.substr(g.length-5,e)+v.substr(v.length-5,e)}(function(t){var e,n,i,r,s,o,a,l=t.lat,c=t.lon,h=6378137,u=gt(l),d=gt(c);a=Math.floor((c+180)/6)+1,180===c&&(a=60),l>=56&&l<64&&c>=3&&c<12&&(a=32),l>=72&&l<84&&(c>=0&&c<9?a=31:c>=9&&c<21?a=33:c>=21&&c<33?a=35:c>=33&&c<42&&(a=37)),o=gt(6*(a-1)-180+3),e=h/Math.sqrt(1-.00669438*Math.sin(u)*Math.sin(u)),n=Math.tan(u)*Math.tan(u),i=.006739496752268451*Math.cos(u)*Math.cos(u),r=Math.cos(u)*(d-o),s=h*(.9983242984503243*u-.002514607064228144*Math.sin(2*u)+2639046602129982e-21*Math.sin(4*u)-3.418046101696858e-9*Math.sin(6*u));var p,f,m=.9996*e*(r+(1-n+i)*r*r*r/6+(5-18*n+n*n+72*i-.39089081163157013)*r*r*r*r*r/120)+5e5,g=.9996*(s+e*Math.tan(u)*(r*r/2+(5-n+9*i+4*i*i)*r*r*r*r/24+(61-58*n+n*n+600*i-2.2240339282485886)*r*r*r*r*r*r/720));return l<0&&(g+=1e7),{northing:Math.round(g),easting:Math.round(m),zoneNumber:a,zoneLetter:(p=l,f="Z",84>=p&&p>=72?f="X":72>p&&p>=64?f="W":64>p&&p>=56?f="V":56>p&&p>=48?f="U":48>p&&p>=40?f="T":40>p&&p>=32?f="S":32>p&&p>=24?f="R":24>p&&p>=16?f="Q":16>p&&p>=8?f="P":8>p&&p>=0?f="N":0>p&&p>=-8?f="M":-8>p&&p>=-16?f="L":-16>p&&p>=-24?f="K":-24>p&&p>=-32?f="J":-32>p&&p>=-40?f="H":-40>p&&p>=-48?f="G":-48>p&&p>=-56?f="F":-56>p&&p>=-64?f="E":-64>p&&p>=-72?f="D":-72>p&&p>=-80&&(f="C"),f)}}({lat:t[1],lon:t[0]}),e)}function mt(t){var e=yt(xt(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function gt(t){return t*(Math.PI/180)}function vt(t){return t/Math.PI*180}function yt(t){var e=t.northing,n=t.easting,i=t.zoneLetter,r=t.zoneNumber;if(r<0||r>60)return null;var s,o,a,l,c,h,u,d,p=6378137,f=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=n-5e5,g=e;i<"N"&&(g-=1e7),h=6*(r-1)-180+3,d=(u=g/.9996/6367449.145945056)+(3*f/2-27*f*f*f/32)*Math.sin(2*u)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*u)+151*f*f*f/96*Math.sin(6*u),s=p/Math.sqrt(1-.00669438*Math.sin(d)*Math.sin(d)),o=Math.tan(d)*Math.tan(d),a=.006739496752268451*Math.cos(d)*Math.cos(d),l=.99330562*p/Math.pow(1-.00669438*Math.sin(d)*Math.sin(d),1.5),c=m/(.9996*s);var v=d-s*Math.tan(d)/l*(c*c/2-(5+3*o+10*a-4*a*a-.06065547077041606)*c*c*c*c/24+(61+90*o+298*a+45*o*o-1.6983531815716497-3*a*a)*c*c*c*c*c*c/720);v=vt(v);var y,_=(c-(1+2*o+a)*c*c*c/6+(5-2*a+28*o-3*a*a+.05391597401814761+24*o*o)*c*c*c*c*c/120)/Math.cos(d);if(_=h+vt(_),t.accuracy){var x=yt({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});y={top:x.lat,right:x.lon,bottom:v,left:_}}else y={lat:v,lon:_};return y}function _t(t){var e=t%6;return 0===e&&(e=6),e}function xt(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,n=t.length,i=null,r="",s=0;!/[A-Z]/.test(e=t.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+t;r+=e,s++}var o=parseInt(r,10);if(0===s||s+3>n)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(s++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+t;i=t.substring(s,s+=2);for(var l=_t(o),c=function(t,e){for(var n="AJSAJS".charCodeAt(e-1),i=1e5,r=!1;n!==t.charCodeAt(0);){if(++n===ut&&n++,n===dt&&n++,n>90){if(r)throw"Bad character: "+t;n=ht,r=!0}i+=1e5}return i}(i.charAt(0),l),h=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var n="AFAFAF".charCodeAt(e-1),i=0,r=!1;n!==t.charCodeAt(0);){if(++n===ut&&n++,n===dt&&n++,n>86){if(r)throw"Bad character: "+t;n=ht,r=!0}i+=1e5}return i}(i.charAt(1),l);h<bt(a);)h+=2e6;var u=n-s;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,p,f,m=u/2,g=0,v=0;return m>0&&(d=1e5/Math.pow(10,m),p=t.substring(s,s+m),g=parseFloat(p)*d,f=t.substring(s+m),v=parseFloat(f)*d),{easting:g+c,northing:v+h,zoneLetter:a,zoneNumber:o,accuracy:d}}function bt(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Mt(t,e,n){if(!(this instanceof Mt))return new Mt(t,e,n);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var i=t.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=t,this.y=e,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Mt.fromMGRS=function(t){return new Mt(mt(t))},Mt.prototype.toMGRS=function(t){return ft([this.x,this.y],t)};var wt=.01068115234375,Et=function(t){var e=[];e[0]=1-t*(.25+t*(.046875+t*(.01953125+t*wt))),e[1]=t*(.75-t*(.046875+t*(.01953125+t*wt)));var n=t*t;return e[2]=n*(.46875-t*(.013020833333333334+.007120768229166667*t)),n*=t,e[3]=n*(.3645833333333333-.005696614583333333*t),e[4]=n*t*.3076171875,e},St=function(t,e,n,i){return n*=e,e*=e,i[0]*t-n*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))},Tt=function(t,e,n){for(var i=1/(1-e),r=t,s=20;s;--s){var o=Math.sin(r),a=1-e*o*o;if(r-=a=(St(r,o,Math.cos(r),n)-t)*(a*Math.sqrt(a))*i,Math.abs(a)<1e-10)return r}return r},Rt={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Et(this.es),this.ml0=St(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,n,i,r=t.x,s=t.y,o=C(r-this.long0),a=Math.sin(s),l=Math.cos(s);if(this.es){var c=l*o,h=Math.pow(c,2),u=this.ep2*Math.pow(l,2),d=Math.pow(u,2),p=Math.abs(l)>1e-10?Math.tan(s):0,f=Math.pow(p,2),m=Math.pow(f,2);e=1-this.es*Math.pow(a,2),c/=Math.sqrt(e);var g=St(s,a,l,this.en);n=this.a*(this.k0*c*(1+h/6*(1-f+u+h/20*(5-18*f+m+14*u-58*f*u+h/42*(61+179*m-m*f-479*f)))))+this.x0,i=this.a*(this.k0*(g-this.ml0+a*o*c/2*(1+h/12*(5-f+9*u+4*d+h/30*(61+m-58*f+270*u-330*f*u+h/56*(1385+543*m-m*f-3111*f))))))+this.y0}else{var v=l*Math.sin(o);if(Math.abs(Math.abs(v)-1)<1e-10)return 93;if(n=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,i=l*Math.cos(o)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(i))>=1){if(v-1>1e-10)return 93;i=0}else i=Math.acos(i);s<0&&(i=-i),i=this.a*this.k0*(i-this.lat0)+this.y0}return t.x=n,t.y=i,t},inverse:function(t){var n,i,r,s,o=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(n=this.ml0+a/this.k0,i=Tt(n,this.es,this.en),Math.abs(i)<e){var l=Math.sin(i),c=Math.cos(i),h=Math.abs(c)>1e-10?Math.tan(i):0,u=this.ep2*Math.pow(c,2),d=Math.pow(u,2),p=Math.pow(h,2),f=Math.pow(p,2);n=1-this.es*Math.pow(l,2);var m=o*Math.sqrt(n)/this.k0,g=Math.pow(m,2);r=i-(n*=h)*g/(1-this.es)*.5*(1-g/12*(5+3*p-9*u*p+u-4*d-g/30*(61+90*p-252*u*p+45*f+46*u-g/56*(1385+3633*p+4095*f+1574*f*p)))),s=C(this.long0+m*(1-g/6*(1+2*p+u-g/20*(5+28*p+24*f+8*u*p+6*u-g/42*(61+662*p+1320*f+720*f*p))))/c)}else r=e*A(a),s=0;else{var v=Math.exp(o/this.k0),y=.5*(v-1/v),_=this.lat0+a/this.k0,x=Math.cos(_);n=Math.sqrt((1-Math.pow(x,2))/(1+Math.pow(y,2))),r=Math.asin(n),a<0&&(r=-r),s=0===y&&0===x?0:C(Math.atan2(y,x)+this.long0)}return t.x=s,t.y=r,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]},At=function(t){var e=Math.exp(t);return e=(e-1/e)/2},Ct=function(t,e){t=Math.abs(t),e=Math.abs(e);var n=Math.max(t,e),i=Math.min(t,e)/(n||1);return n*Math.sqrt(1+Math.pow(i,2))},Pt=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,n=e-1;return 0===n?t:t*Math.log(e)/n}(e*(1+e/(Ct(1,e)+1))),t<0?-e:e},Lt=function(t,e){for(var n,i=2*Math.cos(2*e),r=t.length-1,s=t[r],o=0;--r>=0;)n=i*s-o+t[r],o=s,s=n;return e+n*Math.sin(2*e)},It=function(t,e,n){for(var i,r,s=Math.sin(e),o=Math.cos(e),a=At(n),l=function(t){var e=Math.exp(t);return e=(e+1/e)/2}(n),c=2*o*l,h=-2*s*a,u=t.length-1,d=t[u],p=0,f=0,m=0;--u>=0;)i=f,r=p,d=c*(f=d)-i-h*(p=m)+t[u],m=h*f-r+c*p;return[(c=s*l)*d-(h=o*a)*m,c*m+h*d]},Nt={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Rt.init.apply(this),this.forward=Rt.forward,this.inverse=Rt.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),n=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),n*=e,this.cgb[1]=n*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=n*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),n*=e,this.cgb[2]=n*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=n*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),n*=e,this.cgb[3]=n*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=n*(1237/630+e*(e*(-24832/14175)-2.4)),n*=e,this.cgb[4]=n*(4174/315+e*(-144838/6237)),this.cbg[4]=n*(-734/315+e*(109598/31185)),n*=e,this.cgb[5]=n*(601676/22275),this.cbg[5]=n*(444337/155925),n=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+n*(1/4+n*(1/64+n/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=n*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=n*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),n*=e,this.utg[2]=n*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=n*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),n*=e,this.utg[3]=n*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=n*(49561/161280+e*(-179/168+e*(6601661/7257600))),n*=e,this.utg[4]=n*(-4583/161280+e*(108847/3991680)),this.gtu[4]=n*(34729/80640+e*(-3418889/1995840)),n*=e,this.utg[5]=n*(-20648693/638668800),this.gtu[5]=.6650675310896665*n;var i=Lt(this.cbg,this.lat0);this.Zb=-this.Qn*(i+function(t,e){for(var n,i=2*Math.cos(e),r=t.length-1,s=t[r],o=0;--r>=0;)n=i*s-o+t[r],o=s,s=n;return Math.sin(e)*n}(this.gtu,2*i))},forward:function(t){var e=C(t.x-this.long0),n=t.y;n=Lt(this.cbg,n);var i=Math.sin(n),r=Math.cos(n),s=Math.sin(e),o=Math.cos(e);n=Math.atan2(i,o*r),e=Math.atan2(s*r,Ct(i,r*o)),e=Pt(Math.tan(e));var a,l,c=It(this.gtu,2*n,2*e);return n+=c[0],e+=c[1],Math.abs(e)<=2.623395162778?(a=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*n+this.Zb)+this.y0):(a=1/0,l=1/0),t.x=a,t.y=l,t},inverse:function(t){var e,n,i=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);if(r=(r-this.Zb)/this.Qn,i/=this.Qn,Math.abs(i)<=2.623395162778){var s=It(this.utg,2*r,2*i);r+=s[0],i+=s[1],i=Math.atan(At(i));var o=Math.sin(r),a=Math.cos(r),l=Math.sin(i),c=Math.cos(i);r=Math.atan2(o*c,Ct(l,c*a)),i=Math.atan2(l,c*a),e=C(i+this.long0),n=Lt(this.cgb,r)}else e=1/0,n=1/0;return t.x=e,t.y=n,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]},Dt={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(C(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*n,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Nt.init.apply(this),this.forward=Nt.forward,this.inverse=Nt.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},Ot=function(t,e){return Math.pow((1-t)/(1+t),e)},Gt={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+r)/(Math.pow(Math.tan(.5*this.lat0+r),this.C)*Ot(this.e*t,this.ratexp))},forward:function(t){var n=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+r),this.C)*Ot(this.e*Math.sin(i),this.ratexp))-e,t.x=this.C*n,t},inverse:function(t){for(var n=t.x/this.C,i=t.y,s=Math.pow(Math.tan(.5*i+r)/this.K,1/this.C),o=20;o>0&&(i=2*Math.atan(s*Ot(this.e*Math.sin(t.y),-.5*this.e))-e,!(Math.abs(i-t.y)<1e-14));--o)t.y=i;return o?(t.x=n,t.y=i,t):null},names:["gauss"]},kt={init:function(){Gt.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,n,i,r;return t.x=C(t.x-this.long0),Gt.forward.apply(this,[t]),e=Math.sin(t.y),n=Math.cos(t.y),i=Math.cos(t.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*n*i),t.x=r*n*Math.sin(t.x),t.y=r*(this.cosc0*e-this.sinc0*n*i),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,n,i,r,s;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,s=Math.sqrt(t.x*t.x+t.y*t.y)){var o=2*Math.atan2(s,this.R2);e=Math.sin(o),n=Math.cos(o),r=Math.asin(n*this.sinc0+t.y*e*this.cosc0/s),i=Math.atan2(t.x*e,s*this.cosc0*n-t.y*this.sinc0*e)}else r=this.phic0,i=0;return t.x=i,t.y=r,Gt.inverse.apply(this,[t]),t.x=C(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},Ut={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*(1+A(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=1e-10&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*this.cons*R(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/P(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=R(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-e,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var n,i,r,s,o,a,l=t.x,c=t.y,h=Math.sin(c),u=Math.cos(c),d=C(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=1e-10&&Math.abs(c+this.lat0)<=1e-10?(t.x=NaN,t.y=NaN,t):this.sphere?(n=2*this.k0/(1+this.sinlat0*h+this.coslat0*u*Math.cos(d)),t.x=this.a*n*u*Math.sin(d)+this.x0,t.y=this.a*n*(this.coslat0*h-this.sinlat0*u*Math.cos(d))+this.y0,t):(i=2*Math.atan(this.ssfn_(c,h,this.e))-e,s=Math.cos(i),r=Math.sin(i),Math.abs(this.coslat0)<=1e-10?(o=P(this.e,c*this.con,this.con*h),a=2*this.a*this.k0*o/this.cons,t.x=this.x0+a*Math.sin(l-this.long0),t.y=this.y0-this.con*a*Math.cos(l-this.long0),t):(Math.abs(this.sinlat0)<1e-10?(n=2*this.a*this.k0/(1+s*Math.cos(d)),t.y=n*r):(n=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*s*Math.cos(d))),t.y=n*(this.cosX0*r-this.sinX0*s*Math.cos(d))+this.y0),t.x=n*s*Math.sin(d)+this.x0,t))},inverse:function(t){var n,i,r,s,o;t.x-=this.x0,t.y-=this.y0;var a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var l=2*Math.atan(a/(2*this.a*this.k0));return n=this.long0,i=this.lat0,a<=1e-10?(t.x=n,t.y=i,t):(i=Math.asin(Math.cos(l)*this.sinlat0+t.y*Math.sin(l)*this.coslat0/a),n=Math.abs(this.coslat0)<1e-10?this.lat0>0?C(this.long0+Math.atan2(t.x,-1*t.y)):C(this.long0+Math.atan2(t.x,t.y)):C(this.long0+Math.atan2(t.x*Math.sin(l),a*this.coslat0*Math.cos(l)-t.y*this.sinlat0*Math.sin(l))),t.x=n,t.y=i,t)}if(Math.abs(this.coslat0)<=1e-10){if(a<=1e-10)return i=this.lat0,n=this.long0,t.x=n,t.y=i,t;t.x*=this.con,t.y*=this.con,r=a*this.cons/(2*this.a*this.k0),i=this.con*L(this.e,r),n=this.con*C(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),n=this.long0,a<=1e-10?o=this.X0:(o=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/a),n=C(this.long0+Math.atan2(t.x*Math.sin(s),a*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),i=-1*L(this.e,Math.tan(.5*(e+o)));return t.x=n,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,n,i){return n*=i,Math.tan(.5*(e+t))*Math.pow((1-n)/(1+n),.5*i)}},Ft={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),n=this.a,i=1/this.rf,r=2*i-Math.pow(i,2),s=this.e=Math.sqrt(r);this.R=this.k0*n*Math.sqrt(1-r)/(1-r*Math.pow(e,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+s*e)/(1-s*e));this.K=o-this.alpha*a+this.alpha*s/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(e+n)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),s=this.alpha*(t.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(s))),a=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(s));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*o+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,n=t.y-this.y0,i=e/this.R,r=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),o=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),a=this.lambda0+o/this.alpha,l=0,c=s,h=-1e3,u=0;Math.abs(c-h)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),h=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=a,t.y=c,t},names:["somerc"]},Bt={init:function(){var t,i,o,a,l,c,h,u,d,p,f,m,g,v=0,y=0,_=0,x=0,b=0,M=0,w=0;this.no_off=(g="object"==typeof(m=this).PROJECTION?Object.keys(m.PROJECTION)[0]:m.PROJECTION,"no_uoff"in m||"no_off"in m||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(g)),this.no_rot="no_rot"in this;var E=!1;"alpha"in this&&(E=!0);var S=!1;if("rectified_grid_angle"in this&&(S=!0),E&&(w=this.alpha),S&&(v=this.rectified_grid_angle*n),E||S)y=this.longc;else if(_=this.long1,b=this.lat1,x=this.long2,M=this.lat2,Math.abs(b-M)<=1e-7||(t=Math.abs(b))<=1e-7||Math.abs(t-e)<=1e-7||Math.abs(Math.abs(this.lat0)-e)<=1e-7||Math.abs(Math.abs(M)-e)<=1e-7)throw new Error;var T=1-this.es;i=Math.sqrt(T),Math.abs(this.lat0)>1e-10?(u=Math.sin(this.lat0),o=Math.cos(this.lat0),t=1-this.es*u*u,this.B=o*o,this.B=Math.sqrt(1+this.es*this.B*this.B/T),this.A=this.B*this.k0*i/t,(l=(a=this.B*i/(o*Math.sqrt(t)))*a-1)<=0?l=0:(l=Math.sqrt(l),this.lat0<0&&(l=-l)),this.E=l+=a,this.E*=Math.pow(P(this.e,this.lat0,u),this.B)):(this.B=1/i,this.A=this.k0,this.E=a=l=1),E||S?(E?(f=Math.asin(Math.sin(w)/a),S||(v=w)):(f=v,w=Math.asin(a*Math.sin(f))),this.lam0=y-Math.asin(.5*(l-1/l)*Math.tan(f))/this.B):(c=Math.pow(P(this.e,b,Math.sin(b)),this.B),h=Math.pow(P(this.e,M,Math.sin(M)),this.B),l=this.E/c,d=(h-c)/(h+c),p=((p=this.E*this.E)-h*c)/(p+h*c),(t=_-x)<-Math.pi?x-=s:t>Math.pi&&(x+=s),this.lam0=C(.5*(_+x)-Math.atan(p*Math.tan(.5*this.B*(_-x))/d)/this.B),f=Math.atan(2*Math.sin(this.B*C(_-this.lam0))/(l-1/l)),v=w=Math.asin(a*Math.sin(f))),this.singam=Math.sin(f),this.cosgam=Math.cos(f),this.sinrot=Math.sin(v),this.cosrot=Math.cos(v),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(a*a-1)/Math.cos(w))),this.lat0<0&&(this.u_0=-this.u_0)),l=.5*f,this.v_pole_n=this.ArB*Math.log(Math.tan(r-l)),this.v_pole_s=this.ArB*Math.log(Math.tan(r+l))},forward:function(t){var n,i,r,s,o,a,l,c,h={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-e)>1e-10){if(n=.5*((o=this.E/Math.pow(P(this.e,t.y,Math.sin(t.y)),this.B))-(a=1/o)),i=.5*(o+a),s=Math.sin(this.B*t.x),r=(n*this.singam-s*this.cosgam)/i,Math.abs(Math.abs(r)-1)<1e-10)throw new Error;c=.5*this.ArB*Math.log((1-r)/(1+r)),a=Math.cos(this.B*t.x),l=Math.abs(a)<1e-7?this.A*t.x:this.ArB*Math.atan2(n*this.cosgam+s*this.singam,a)}else c=t.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*t.y;return this.no_rot?(h.x=l,h.y=c):(l-=this.u_0,h.x=c*this.cosrot+l*this.sinrot,h.y=l*this.cosrot-c*this.sinrot),h.x=this.a*h.x+this.x0,h.y=this.a*h.y+this.y0,h},inverse:function(t){var n,i,r,s,o,a,l,c={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(i=t.y,n=t.x):(i=t.x*this.cosrot-t.y*this.sinrot,n=t.y*this.cosrot+t.x*this.sinrot+this.u_0),s=.5*((r=Math.exp(-this.BrA*i))-1/r),o=.5*(r+1/r),l=((a=Math.sin(this.BrA*n))*this.cosgam+s*this.singam)/o,Math.abs(Math.abs(l)-1)<1e-10)c.x=0,c.y=l<0?-e:e;else{if(c.y=this.E/Math.sqrt((1+l)/(1-l)),c.y=L(this.e,Math.pow(c.y,1/this.B)),c.y===1/0)throw new Error;c.x=-this.rB*Math.atan2(s*this.cosgam-a*this.singam,Math.cos(this.BrA*n))}return c.x+=this.lam0,c},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},zt={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<1e-10)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),n=Math.cos(this.lat1),i=R(this.e,e,n),r=P(this.e,this.lat1,e),s=Math.sin(this.lat2),o=Math.cos(this.lat2),a=R(this.e,s,o),l=P(this.e,this.lat2,s),c=P(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>1e-10?this.ns=Math.log(i/a)/Math.log(r/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var n=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=1e-10&&(i=A(i)*(e-2e-10));var r,s,o=Math.abs(Math.abs(i)-e);if(o>1e-10)r=P(this.e,i,Math.sin(i)),s=this.a*this.f0*Math.pow(r,this.ns);else{if((o=i*this.ns)<=0)return null;s=0}var a=this.ns*C(n-this.long0);return t.x=this.k0*(s*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,t},inverse:function(t){var n,i,r,s,o,a=(t.x-this.x0)/this.k0,l=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(n=Math.sqrt(a*a+l*l),i=1):(n=-Math.sqrt(a*a+l*l),i=-1);var c=0;if(0!==n&&(c=Math.atan2(i*a,i*l)),0!==n||this.ns>0){if(i=1/this.ns,r=Math.pow(n/(this.a*this.f0),i),-9999===(s=L(this.e,r)))return null}else s=-e;return o=C(c/this.ns+this.long0),t.x=o,t.y=s,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc"]},Vt={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,n,i,r,s,o,a,l=t.x,c=t.y,h=C(l-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),i=-h*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),s=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(r)),o=this.n*s,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),t.y=a*Math.cos(o)/1,t.x=a*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,n,i,r,s,o,a,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),s=Math.sqrt(t.x*t.x+t.y*t.y),r=Math.atan2(t.y,t.x)/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),n=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(e)),t.x=this.long0-n/this.alfa,o=e,a=0;var c=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(a=1),o=t.y,c+=1}while(0===a&&c<15);return c>=15?null:t},names:["Krovak","krovak"]},Ht=function(t,e,n,i,r){return t*r-e*Math.sin(2*r)+n*Math.sin(4*r)-i*Math.sin(6*r)},Wt=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))},jt=function(t){return.375*t*(1+.25*t*(1+.46875*t))},qt=function(t){return.05859375*t*t*(1+.75*t)},Xt=function(t){return t*t*t*(35/3072)},Yt=function(t,e,n){var i=e*n;return t/Math.sqrt(1-i*i)},Jt=function(t){return Math.abs(t)<e?t:t-A(t)*Math.PI},Zt=function(t,e,n,i,r){var s,o;s=t/e;for(var a=0;a<15;a++)if(s+=o=(t-(e*s-n*Math.sin(2*s)+i*Math.sin(4*s)-r*Math.sin(6*s)))/(e-2*n*Math.cos(2*s)+4*i*Math.cos(4*s)-6*r*Math.cos(6*s)),Math.abs(o)<=1e-10)return s;return NaN},Kt={init:function(){this.sphere||(this.e0=Wt(this.es),this.e1=jt(this.es),this.e2=qt(this.es),this.e3=Xt(this.es),this.ml0=this.a*Ht(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,n,i=t.x,r=t.y;if(i=C(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(i)),n=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var s=Math.sin(r),o=Math.cos(r),a=Yt(this.a,this.e,s),l=Math.tan(r)*Math.tan(r),c=i*Math.cos(r),h=c*c,u=this.es*o*o/(1-this.es);e=a*c*(1-h*l*(1/6-(8-l+8*u)*h/120)),n=this.a*Ht(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+a*s/o*h*(.5+(5-l+6*u)*h/24)}return t.x=e+this.x0,t.y=n+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var n,i,r=t.x/this.a,s=t.y/this.a;if(this.sphere){var o=s+this.lat0;n=Math.asin(Math.sin(o)*Math.cos(r)),i=Math.atan2(Math.tan(r),Math.cos(o))}else{var a=this.ml0/this.a+s,l=Zt(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-e)<=1e-10)return t.x=this.long0,t.y=e,s<0&&(t.y*=-1),t;var c=Yt(this.a,this.e,Math.sin(l)),h=c*c*c/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(l),2),d=r*this.a/c,p=d*d;n=l-c*Math.tan(l)/h*d*d*(.5-(1+3*u)*d*d/24),i=d*(1-p*(u/3+(1+3*u)*u*p/15))/Math.cos(l)}return t.x=C(i+this.long0),t.y=Jt(n),t},names:["Cassini","Cassini_Soldner","cass"]},Qt=function(t,e){var n;return t>1e-7?(1-t*t)*(e/(1-(n=t*e)*n)-.5/t*Math.log((1-n)/(1+n))):2*e},$t={init:function(){var t,n=Math.abs(this.lat0);if(Math.abs(n-e)<1e-10?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<1e-10?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Qt(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,n=[];return n[0]=.3333333333333333*t,e=t*t,n[0]+=.17222222222222222*e,n[1]=.06388888888888888*e,e*=t,n[0]+=.10257936507936508*e,n[1]+=.0664021164021164*e,n[2]=.016415012942191543*e,n}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Qt(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var n,i,s,o,a,l,c,h,u,d,p=t.x,f=t.y;if(p=C(p-this.long0),this.sphere){if(a=Math.sin(f),d=Math.cos(f),s=Math.cos(p),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+d*s:1+this.sinph0*a+this.cosph0*d*s)<=1e-10)return null;n=(i=Math.sqrt(2/i))*d*Math.sin(p),i*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*d*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(f+this.lat0)<1e-10)return null;i=r-.5*f,n=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(p),i*=s}}else{switch(c=0,h=0,u=0,s=Math.cos(p),o=Math.sin(p),a=Math.sin(f),l=Qt(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(c=l/this.qp,h=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:u=1+this.sinb1*c+this.cosb1*h*s;break;case this.EQUIT:u=1+h*s;break;case this.N_POLE:u=e+f,l=this.qp-l;break;case this.S_POLE:u=f-e,l=this.qp+l}if(Math.abs(u)<1e-10)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:u=Math.sqrt(2/u),i=this.mode===this.OBLIQ?this.ymf*u*(this.cosb1*c-this.sinb1*h*s):(u=Math.sqrt(2/(1+h*s)))*c*this.ymf,n=this.xmf*u*h*o;break;case this.N_POLE:case this.S_POLE:l>=0?(n=(u=Math.sqrt(l))*o,i=s*(this.mode===this.S_POLE?u:-u)):n=i=0}}return t.x=this.a*n+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var n,i,r,s,o,a,l,c,h,u,d=t.x/this.a,p=t.y/this.a;if(this.sphere){var f,m=0,g=0;if((i=.5*(f=Math.sqrt(d*d+p*p)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(i),m=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(f)<=1e-10?0:Math.asin(p*g/f),d*=g,p=m*f;break;case this.OBLIQ:i=Math.abs(f)<=1e-10?this.lat0:Math.asin(m*this.sinph0+p*g*this.cosph0/f),d*=g*this.cosph0,p=(m-Math.sin(i)*this.sinph0)*f;break;case this.N_POLE:p=-p,i=e-i;break;case this.S_POLE:i-=e}n=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(d,p):0}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(d/=this.dd,p*=this.dd,(a=Math.sqrt(d*d+p*p))<1e-10)return t.x=this.long0,t.y=this.lat0,t;s=2*Math.asin(.5*a/this.rq),r=Math.cos(s),d*=s=Math.sin(s),this.mode===this.OBLIQ?(l=r*this.sinb1+p*s*this.cosb1/a,o=this.qp*l,p=a*this.cosb1*r-p*this.sinb1*s):(l=p*s/a,o=this.qp*l,p=a*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(o=d*d+p*p))return t.x=this.long0,t.y=this.lat0,t;l=1-o/this.qp,this.mode===this.S_POLE&&(l=-l)}n=Math.atan2(d,p),c=Math.asin(l),h=this.apa,u=c+c,i=c+h[0]*Math.sin(u)+h[1]*Math.sin(u+u)+h[2]*Math.sin(u+u+u)}return t.x=C(this.long0+n),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},te=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)},ee={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=R(this.e3,this.sin_po,this.cos_po),this.qs1=Qt(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=R(this.e3,this.sin_po,this.cos_po),this.qs2=Qt(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Qt(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>1e-10?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,n=t.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var i=Qt(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,s=this.ns0*C(e-this.long0),o=r*Math.sin(s)+this.x0,a=this.rh-r*Math.cos(s)+this.y0;return t.x=o,t.y=a,t},inverse:function(t){var e,n,i,r,s,o;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1),r=0,0!==e&&(r=Math.atan2(i*t.x,i*t.y)),i=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-i*i)/(2*this.ns0)):(n=(this.c-i*i)/this.ns0,o=this.phi1z(this.e3,n)),s=C(r/this.ns0+this.long0),t.x=s,t.y=o,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var n,i,r,s,o=te(.5*e);if(t<1e-10)return o;for(var a=t*t,l=1;l<=25;l++)if(o+=s=.5*(r=1-(i=t*(n=Math.sin(o)))*i)*r/Math.cos(o)*(e/(1-a)-n/r+.5/t*Math.log((1-i)/(1+i))),Math.abs(s)<=1e-7)return o;return null}},ne={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,n,i,r,s,o,a,l=t.x,c=t.y;return i=C(l-this.long0),e=Math.sin(c),n=Math.cos(c),r=Math.cos(i),(s=this.sin_p14*e+this.cos_p14*n*r)>0||Math.abs(s)<=1e-10?(o=this.x0+1*this.a*n*Math.sin(i)/s,a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*n*r)/s):(o=this.x0+this.infinity_dist*n*Math.sin(i),a=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*n*r)),t.x=o,t.y=a,t},inverse:function(t){var e,n,i,r,s,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(r=Math.atan2(e,this.rc),n=Math.sin(r),i=Math.cos(r),o=te(i*this.sin_p14+t.y*n*this.cos_p14/e),s=Math.atan2(t.x*n,e*this.cos_p14*i-t.y*this.sin_p14*n),s=C(this.long0+s)):(o=this.phic0,s=0),t.x=s,t.y=o,t},names:["gnom"]},ie={init:function(){this.sphere||(this.k0=R(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,n,i=t.x,r=t.y,s=C(i-this.long0);if(this.sphere)e=this.x0+this.a*s*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var o=Qt(this.e,Math.sin(r));e=this.x0+this.a*this.k0*s,n=this.y0+this.a*o*.5/this.k0}return t.x=e,t.y=n,t},inverse:function(t){var n,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(n=C(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=function(t,n){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(n)-i)<1e-6)return n<0?-1*e:e;for(var r,s,o,a,l=Math.asin(.5*n),c=0;c<30;c++)if(s=Math.sin(l),o=Math.cos(l),a=t*s,l+=r=Math.pow(1-a*a,2)/(2*o)*(n/(1-t*t)-s/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),Math.abs(r)<=1e-10)return l;return NaN}(this.e,2*t.y*this.k0/this.a),n=C(this.long0+t.x/(this.a*this.k0))),t.x=n,t.y=i,t},names:["cea"]},re={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,n=t.y,i=C(e-this.long0),r=Jt(n-this.lat0);return t.x=this.x0+this.a*i*this.rc,t.y=this.y0+this.a*r,t},inverse:function(t){var e=t.x,n=t.y;return t.x=C(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=Jt(this.lat0+(n-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},se={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Wt(this.es),this.e1=jt(this.es),this.e2=qt(this.es),this.e3=Xt(this.es),this.ml0=this.a*Ht(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,n,i,r=t.x,s=t.y,o=C(r-this.long0);if(i=o*Math.sin(s),this.sphere)Math.abs(s)<=1e-10?(e=this.a*o,n=-1*this.a*this.lat0):(e=this.a*Math.sin(i)/Math.tan(s),n=this.a*(Jt(s-this.lat0)+(1-Math.cos(i))/Math.tan(s)));else if(Math.abs(s)<=1e-10)e=this.a*o,n=-1*this.ml0;else{var a=Yt(this.a,this.e,Math.sin(s))/Math.tan(s);e=a*Math.sin(i),n=this.a*Ht(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+a*(1-Math.cos(i))}return t.x=e+this.x0,t.y=n+this.y0,t},inverse:function(t){var e,n,i,r,s,o,a,l,c;if(i=t.x-this.x0,r=t.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=1e-10)e=C(i/this.a+this.long0),n=0;else{var h;for(o=this.lat0+r/this.a,a=i*i/this.a/this.a+o*o,l=o,s=20;s;--s)if(l+=c=-1*(o*(l*(h=Math.tan(l))+1)-l-.5*(l*l+a)*h)/((l-o)/h-1),Math.abs(c)<=1e-10){n=l;break}e=C(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(n))}else if(Math.abs(r+this.ml0)<=1e-10)n=0,e=C(this.long0+i/this.a);else{var u,d,p,f,m;for(o=(this.ml0+r)/this.a,a=i*i/this.a/this.a+o*o,l=o,s=20;s;--s)if(m=this.e*Math.sin(l),u=Math.sqrt(1-m*m)*Math.tan(l),d=this.a*Ht(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=c=(o*(u*(f=d/this.a)+1)-f-.5*u*(f*f+a))/(this.es*Math.sin(2*l)*(f*f+a-2*o*f)/(4*u)+(o-f)*(u*p-2/Math.sin(2*l))-p),Math.abs(c)<=1e-10){n=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),e=C(this.long0+Math.asin(i*u/this.a)/Math.sin(n))}return t.x=e,t.y=n,t},names:["Polyconic","poly"]},oe={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var n,i=e.x,r=e.y-this.lat0,s=i-this.long0,o=r/t*1e-5,a=s,l=1,c=0;for(n=1;n<=10;n++)l*=o,c+=this.A[n]*l;var h,u=c,d=a,p=1,f=0,m=0,g=0;for(n=1;n<=6;n++)h=f*u+p*d,p=p*u-f*d,f=h,m=m+this.B_re[n]*p-this.B_im[n]*f,g=g+this.B_im[n]*p+this.B_re[n]*f;return e.x=g*this.a+this.x0,e.y=m*this.a+this.y0,e},inverse:function(e){var n,i,r=e.x,s=e.y,o=r-this.x0,a=(s-this.y0)/this.a,l=o/this.a,c=1,h=0,u=0,d=0;for(n=1;n<=6;n++)i=h*a+c*l,c=c*a-h*l,h=i,u=u+this.C_re[n]*c-this.C_im[n]*h,d=d+this.C_im[n]*c+this.C_re[n]*h;for(var p=0;p<this.iterations;p++){var f,m=u,g=d,v=a,y=l;for(n=2;n<=6;n++)f=g*u+m*d,m=m*u-g*d,g=f,v+=(n-1)*(this.B_re[n]*m-this.B_im[n]*g),y+=(n-1)*(this.B_im[n]*m+this.B_re[n]*g);m=1,g=0;var _=this.B_re[1],x=this.B_im[1];for(n=2;n<=6;n++)f=g*u+m*d,m=m*u-g*d,g=f,_+=n*(this.B_re[n]*m-this.B_im[n]*g),x+=n*(this.B_im[n]*m+this.B_re[n]*g);var b=_*_+x*x;u=(v*_+y*x)/b,d=(y*_-v*x)/b}var M=u,w=d,E=1,S=0;for(n=1;n<=9;n++)E*=M,S+=this.D[n]*E;var T=this.lat0+S*t*1e5,R=this.long0+w;return e.x=R,e.y=T,e},names:["New_Zealand_Map_Grid","nzmg"]},ae={init:function(){},forward:function(t){var e=t.x,n=t.y,i=C(e-this.long0),r=this.x0+this.a*i,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return t.x=r,t.y=s,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=C(this.long0+t.x/this.a),n=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=n,t},names:["Miller_Cylindrical","mill"]},le={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Et(this.es)},forward:function(t){var e,n,i=t.x,r=t.y;if(i=C(i-this.long0),this.sphere){if(this.m)for(var s=this.n*Math.sin(r),o=20;o;--o){var a=(this.m*r+Math.sin(r)-s)/(this.m+Math.cos(r));if(r-=a,Math.abs(a)<1e-10)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;e=this.a*this.C_x*i*(this.m+Math.cos(r)),n=this.a*this.C_y*r}else{var l=Math.sin(r),c=Math.cos(r);n=this.a*St(r,l,c,this.en),e=this.a*i*c/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=n,t},inverse:function(t){var n,i,r,s;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,n=t.y/this.a,this.sphere?(n/=this.C_y,r/=this.C_x*(this.m+Math.cos(n)),this.m?n=te((this.m*n+Math.sin(n))/this.n):1!==this.n&&(n=te(Math.sin(n)/this.n)),r=C(r+this.long0),n=Jt(n)):(n=Tt(t.y/this.a,this.es,this.en),(s=Math.abs(n))<e?(s=Math.sin(n),i=this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(n)),r=C(i)):s-1e-10<e&&(r=this.long0)),t.x=r,t.y=n,t},names:["Sinusoidal","sinu"]},ce={init:function(){},forward:function(t){for(var e=t.x,n=t.y,i=C(e-this.long0),r=n,s=Math.PI*Math.sin(n);;){var o=-(r+Math.sin(r)-s)/(1+Math.cos(r));if(r+=o,Math.abs(o)<1e-10)break}r/=2,Math.PI/2-Math.abs(n)<1e-10&&(i=0);var a=.900316316158*this.a*i*Math.cos(r)+this.x0,l=1.4142135623731*this.a*Math.sin(r)+this.y0;return t.x=a,t.y=l,t},inverse:function(t){var e,n;t.x-=this.x0,t.y-=this.y0,n=t.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),e=Math.asin(n);var i=C(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),n=(2*e+Math.sin(2*e))/Math.PI,Math.abs(n)>1&&(n=1);var r=Math.asin(n);return t.x=i,t.y=r,t},names:["Mollweide","moll"]},he={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Wt(this.es),this.e1=jt(this.es),this.e2=qt(this.es),this.e3=Xt(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=R(this.e,this.sinphi,this.cosphi),this.ml1=Ht(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<1e-10?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=R(this.e,this.sinphi,this.cosphi),this.ml2=Ht(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ht(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,n=t.x,i=t.y;if(this.sphere)e=this.a*(this.g-i);else{var r=Ht(this.e0,this.e1,this.e2,this.e3,i);e=this.a*(this.g-r)}var s=this.ns*C(n-this.long0),o=this.x0+e*Math.sin(s),a=this.y0+this.rh-e*Math.cos(s);return t.x=o,t.y=a,t},inverse:function(t){var e,n,i,r;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(n=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(n=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var s=0;if(0!==n&&(s=Math.atan2(e*t.x,e*t.y)),this.sphere)return r=C(this.long0+s/this.ns),i=Jt(this.g-n/this.a),t.x=r,t.y=i,t;var o=this.g-n/this.a;return i=Zt(o,this.e0,this.e1,this.e2,this.e3),r=C(this.long0+s/this.ns),t.x=r,t.y=i,t},names:["Equidistant_Conic","eqdc"]},ue={init:function(){this.R=this.a},forward:function(t){var n,i,r=t.x,s=t.y,o=C(r-this.long0);Math.abs(s)<=1e-10&&(n=this.x0+this.R*o,i=this.y0);var a=te(2*Math.abs(s/Math.PI));(Math.abs(o)<=1e-10||Math.abs(Math.abs(s)-e)<=1e-10)&&(n=this.x0,i=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var l=.5*Math.abs(Math.PI/o-o/Math.PI),c=l*l,h=Math.sin(a),u=Math.cos(a),d=u/(h+u-1),p=d*d,f=d*(2/h-1),m=f*f,g=Math.PI*this.R*(l*(d-m)+Math.sqrt(c*(d-m)*(d-m)-(m+c)*(p-m)))/(m+c);o<0&&(g=-g),n=this.x0+g;var v=c+d;return g=Math.PI*this.R*(f*v-l*Math.sqrt((m+c)*(c+1)-v*v))/(m+c),i=s>=0?this.y0+g:this.y0-g,t.x=n,t.y=i,t},inverse:function(t){var e,n,i,r,s,o,a,l,c,h,u,d;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,s=(i=t.x/u)*i+(r=t.y/u)*r,u=3*(r*r/(l=-2*(o=-Math.abs(r)*(1+s))+1+2*r*r+s*s)+(2*(a=o-2*r*r+i*i)*a*a/l/l/l-9*o*a/l/l)/27)/(c=(o-a*a/3/l)/l)/(h=2*Math.sqrt(-c/3)),Math.abs(u)>1&&(u=u>=0?1:-1),d=Math.acos(u)/3,n=t.y>=0?(-h*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI:-(-h*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI,e=Math.abs(i)<1e-10?this.long0:C(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(i*i-r*r)+s*s))/2/i),t.x=e,t.y=n,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},de={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var n,i,r,s,o,a,l,c,h,u,d,p,f,m,g,v,y,_,x,b,M,w,E=t.x,S=t.y,T=Math.sin(t.y),R=Math.cos(t.y),A=C(E-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=1e-10?(t.x=this.x0+this.a*(e-S)*Math.sin(A),t.y=this.y0-this.a*(e-S)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=1e-10?(t.x=this.x0+this.a*(e+S)*Math.sin(A),t.y=this.y0+this.a*(e+S)*Math.cos(A),t):(_=this.sin_p12*T+this.cos_p12*R*Math.cos(A),y=(v=Math.acos(_))?v/Math.sin(v):1,t.x=this.x0+this.a*y*R*Math.sin(A),t.y=this.y0+this.a*y*(this.cos_p12*T-this.sin_p12*R*Math.cos(A)),t):(n=Wt(this.es),i=jt(this.es),r=qt(this.es),s=Xt(this.es),Math.abs(this.sin_p12-1)<=1e-10?(o=this.a*Ht(n,i,r,s,e),a=this.a*Ht(n,i,r,s,S),t.x=this.x0+(o-a)*Math.sin(A),t.y=this.y0-(o-a)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=1e-10?(o=this.a*Ht(n,i,r,s,e),a=this.a*Ht(n,i,r,s,S),t.x=this.x0+(o+a)*Math.sin(A),t.y=this.y0+(o+a)*Math.cos(A),t):(l=T/R,c=Yt(this.a,this.e,this.sin_p12),h=Yt(this.a,this.e,T),u=Math.atan((1-this.es)*l+this.es*c*this.sin_p12/(h*R)),x=0===(d=Math.atan2(Math.sin(A),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(A)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(d)-Math.PI)<=1e-10?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(A)*Math.cos(u)/Math.sin(d)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),v=c*x*(1-(b=x*x)*(g=(f=this.e*this.cos_p12*Math.cos(d)/Math.sqrt(1-this.es))*f)*(1-g)/6+(M=b*x)/8*(m=p*f)*(1-2*g)+(w=M*x)/120*(g*(4-7*g)-3*p*p*(1-7*g))-w*x/48*m),t.x=this.x0+v*Math.sin(d),t.y=this.y0+v*Math.cos(d),t))},inverse:function(t){var n,i,r,s,o,a,l,c,h,u,d,p,f,m,g,v,y,_,x,b,M,w,E;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((n=Math.sqrt(t.x*t.x+t.y*t.y))>2*e*this.a)return;return i=n/this.a,r=Math.sin(i),s=Math.cos(i),o=this.long0,Math.abs(n)<=1e-10?a=this.lat0:(a=te(s*this.sin_p12+t.y*r*this.cos_p12/n),l=Math.abs(this.lat0)-e,o=Math.abs(l)<=1e-10?this.lat0>=0?C(this.long0+Math.atan2(t.x,-t.y)):C(this.long0-Math.atan2(-t.x,t.y)):C(this.long0+Math.atan2(t.x*r,n*this.cos_p12*s-t.y*this.sin_p12*r))),t.x=o,t.y=a,t}return c=Wt(this.es),h=jt(this.es),u=qt(this.es),d=Xt(this.es),Math.abs(this.sin_p12-1)<=1e-10?(p=this.a*Ht(c,h,u,d,e),n=Math.sqrt(t.x*t.x+t.y*t.y),a=Zt((p-n)/this.a,c,h,u,d),o=C(this.long0+Math.atan2(t.x,-1*t.y)),t.x=o,t.y=a,t):Math.abs(this.sin_p12+1)<=1e-10?(p=this.a*Ht(c,h,u,d,e),n=Math.sqrt(t.x*t.x+t.y*t.y),a=Zt((n-p)/this.a,c,h,u,d),o=C(this.long0+Math.atan2(t.x,t.y)),t.x=o,t.y=a,t):(n=Math.sqrt(t.x*t.x+t.y*t.y),g=Math.atan2(t.x,t.y),f=Yt(this.a,this.e,this.sin_p12),v=Math.cos(g),_=-(y=this.e*this.cos_p12*v)*y/(1-this.es),x=3*this.es*(1-_)*this.sin_p12*this.cos_p12*v/(1-this.es),w=1-_*(M=(b=n/f)-_*(1+_)*Math.pow(b,3)/6-x*(1+3*_)*Math.pow(b,4)/24)*M/2-b*M*M*M/6,m=Math.asin(this.sin_p12*Math.cos(M)+this.cos_p12*Math.sin(M)*v),o=C(this.long0+Math.asin(Math.sin(g)*Math.sin(M)/Math.cos(m))),E=Math.sin(m),a=Math.atan2((E-this.es*w*this.sin_p12)*Math.tan(m),E*(1-this.es)),t.x=o,t.y=a,t)},names:["Azimuthal_Equidistant","aeqd"]},pe={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,n,i,r,s,o,a,l=t.x,c=t.y;return i=C(l-this.long0),e=Math.sin(c),n=Math.cos(c),r=Math.cos(i),((s=this.sin_p14*e+this.cos_p14*n*r)>0||Math.abs(s)<=1e-10)&&(o=1*this.a*n*Math.sin(i),a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*n*r)),t.x=o,t.y=a,t},inverse:function(t){var n,i,r,s,o,a,l;return t.x-=this.x0,t.y-=this.y0,n=Math.sqrt(t.x*t.x+t.y*t.y),i=te(n/this.a),r=Math.sin(i),s=Math.cos(i),a=this.long0,Math.abs(n)<=1e-10?(l=this.lat0,t.x=a,t.y=l,t):(l=te(s*this.sin_p14+t.y*r*this.cos_p14/n),o=Math.abs(this.lat0)-e,Math.abs(o)<=1e-10?(a=this.lat0>=0?C(this.long0+Math.atan2(t.x,-t.y)):C(this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=l,t):(a=C(this.long0+Math.atan2(t.x*r,n*this.cos_p14*s-t.y*this.sin_p14*r)),t.x=a,t.y=l,t))},names:["ortho"]},fe=1,me=2,ge=3,ve=4,ye=5,_e=6,xe=1,be=2,Me=3,we=4;function Ee(t,n,i,s){var a;return t<1e-10?(s.value=xe,a=0):(a=Math.atan2(n,i),Math.abs(a)<=r?s.value=xe:a>r&&a<=e+r?(s.value=be,a-=e):a>e+r||a<=-(e+r)?(s.value=Me,a=a>=0?a-o:a+o):(s.value=we,a+=e)),a}function Se(t,e){var n=t+e;return n<-o?n+=s:n>+o&&(n-=s),n}var Te,Re={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=e-r/2?this.face=ye:this.lat0<=-(e-r/2)?this.face=_e:Math.abs(this.long0)<=r?this.face=fe:Math.abs(this.long0)<=e+r?this.face=this.long0>0?me:ve:this.face=ge,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var n,i,s,a,l,c,h={x:0,y:0},u={value:0};if(t.x-=this.long0,n=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,this.face===ye)a=e-n,i>=r&&i<=e+r?(u.value=xe,s=i-e):i>e+r||i<=-(e+r)?(u.value=be,s=i>0?i-o:i+o):i>-(e+r)&&i<=-r?(u.value=Me,s=i+e):(u.value=we,s=i);else if(this.face===_e)a=e+n,i>=r&&i<=e+r?(u.value=xe,s=-i+e):i<r&&i>=-r?(u.value=be,s=-i):i<-r&&i>=-(e+r)?(u.value=Me,s=-i-e):(u.value=we,s=i>0?-i+o:-i-o);else{var d,p,f,m,g,v;this.face===me?i=Se(i,+e):this.face===ge?i=Se(i,+o):this.face===ve&&(i=Se(i,-e)),m=Math.sin(n),g=Math.cos(n),v=Math.sin(i),d=g*Math.cos(i),p=g*v,f=m,this.face===fe?s=Ee(a=Math.acos(d),f,p,u):this.face===me?s=Ee(a=Math.acos(p),f,-d,u):this.face===ge?s=Ee(a=Math.acos(-d),f,-p,u):this.face===ve?s=Ee(a=Math.acos(-p),f,d,u):(a=s=0,u.value=xe)}return c=Math.atan(12/o*(s+Math.acos(Math.sin(s)*Math.cos(r))-e)),l=Math.sqrt((1-Math.cos(a))/(Math.cos(c)*Math.cos(c))/(1-Math.cos(Math.atan(1/Math.cos(s))))),u.value===be?c+=e:u.value===Me?c+=o:u.value===we&&(c+=1.5*o),h.x=l*Math.cos(c),h.y=l*Math.sin(c),h.x=h.x*this.a+this.x0,h.y=h.y*this.a+this.y0,t.x=h.x,t.y=h.y,t},inverse:function(t){var n,i,r,s,a,l,c,h,u,d,p,f,m={lam:0,phi:0},g={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),n=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?g.value=xe:t.y>=0&&t.y>=Math.abs(t.x)?(g.value=be,n-=e):t.x<0&&-t.x>=Math.abs(t.y)?(g.value=Me,n=n<0?n+o:n-o):(g.value=we,n+=e),u=o/12*Math.tan(n),a=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),l=Math.atan(a),(c=1-(r=Math.cos(n))*r*(s=Math.tan(i))*s*(1-Math.cos(Math.atan(1/Math.cos(l)))))<-1?c=-1:c>1&&(c=1),this.face===ye)h=Math.acos(c),m.phi=e-h,g.value===xe?m.lam=l+e:g.value===be?m.lam=l<0?l+o:l-o:g.value===Me?m.lam=l-e:m.lam=l;else if(this.face===_e)h=Math.acos(c),m.phi=h-e,g.value===xe?m.lam=-l+e:g.value===be?m.lam=-l:g.value===Me?m.lam=-l-e:m.lam=l<0?-l-o:-l+o;else{var v,y,_;u=(v=c)*v,y=(u+=(_=u>=1?0:Math.sqrt(1-u)*Math.sin(l))*_)>=1?0:Math.sqrt(1-u),g.value===be?(u=y,y=-_,_=u):g.value===Me?(y=-y,_=-_):g.value===we&&(u=y,y=_,_=-u),this.face===me?(u=v,v=-y,y=u):this.face===ge?(v=-v,y=-y):this.face===ve&&(u=v,v=y,y=-u),m.phi=Math.acos(-_)-e,m.lam=Math.atan2(y,v),this.face===me?m.lam=Se(m.lam,-e):this.face===ge?m.lam=Se(m.lam,-o):this.face===ve&&(m.lam=Se(m.lam,+e))}return 0!==this.es&&(d=m.phi<0?1:0,p=Math.tan(m.phi),f=this.b/Math.sqrt(p*p+this.one_minus_f_squared),m.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),d&&(m.phi=-m.phi)),m.lam+=this.long0,t.x=m.lam,t.y=m.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Ae=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Ce=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Pe=i/5,Le=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},Ie={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=C(t.x-this.long0),n=Math.abs(t.y),r=Math.floor(n*Pe);r<0?r=0:r>=18&&(r=17);var s={x:Le(Ae[r],n=i*(n-.08726646259971647*r))*e,y:Le(Ce[r],n)};return t.y<0&&(s.y=-s.y),s.x=s.x*this.a*.8487+this.x0,s.y=s.y*this.a*1.3523+this.y0,s},inverse:function(t){var i={x:(t.x-this.x0)/(.8487*this.a),y:Math.abs(t.y-this.y0)/(1.3523*this.a)};if(i.y>=1)i.x/=Ae[18][0],i.y=t.y<0?-e:e;else{var r=Math.floor(18*i.y);for(r<0?r=0:r>=18&&(r=17);;)if(Ce[r][0]>i.y)--r;else{if(!(Ce[r+1][0]<=i.y))break;++r}var s=Ce[r],o=5*(i.y-s[0])/(Ce[r+1][0]-s[0]);o=function(t,e,n,i){for(var r=e;i;--i){var s=t(r);if(r-=s,Math.abs(s)<n)break}return r}((function(t){return(Le(s,t)-i.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(s,t)}),o,1e-10,100),i.x/=Le(Ae[r],o),i.y=(5*r+o)*n,t.y<0&&(i.y=-i.y)}return i.x=C(i.x+this.long0),i},names:["Robinson","robin"]},Ne={init:function(){this.name="geocent"},forward:function(t){return J(t,this.es,this.a)},inverse:function(t){return Z(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},De=0,Oe=1,Ge=2,ke=3,Ue={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}},Fe={init:function(){if(Object.keys(Ue).forEach(function(t){if(void 0===this[t])this[t]=Ue[t].def;else{if(Ue[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Ue[t].num&&(this[t]=parseFloat(this[t]))}Ue[t].degrees&&(this[t]=this[t]*n)}.bind(this)),Math.abs(Math.abs(this.lat0)-e)<1e-10?this.mode=this.lat0<0?Oe:De:Math.abs(this.lat0)<1e-10?this.mode=Ge:(this.mode=ke,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,i=this.azi;this.cg=Math.cos(i),this.sg=Math.sin(i),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,n,i,r,s=Math.sin(t.y),o=Math.cos(t.y),a=Math.cos(t.x);switch(this.mode){case ke:n=this.sinph0*s+this.cosph0*o*a;break;case Ge:n=o*a;break;case Oe:n=-s;break;case De:n=s}switch(e=(n=this.pn1/(this.p-n))*o*Math.sin(t.x),this.mode){case ke:n*=this.cosph0*s-this.sinph0*o*a;break;case Ge:n*=s;break;case De:n*=-o*a;break;case Oe:n*=o*a}return r=1/((i=n*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-n*this.sg)*this.cw*r,n=i*r,t.x=e*this.a,t.y=n*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,n,i,r={x:t.x,y:t.y};i=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*i,n=this.pn1*t.y*this.cw*i,t.x=e*this.cg+n*this.sg,t.y=n*this.cg-e*this.sg;var s=Ct(t.x,t.y);if(Math.abs(s)<1e-10)r.x=0,r.y=t.y;else{var o,a;switch(a=1-s*s*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/s+s/this.pn1),o=Math.sqrt(1-a*a),this.mode){case ke:r.y=Math.asin(o*this.sinph0+t.y*a*this.cosph0/s),t.y=(o-this.sinph0*Math.sin(r.y))*s,t.x*=a*this.cosph0;break;case Ge:r.y=Math.asin(t.y*a/s),t.y=o*s,t.x*=a;break;case De:r.y=Math.asin(o),t.y=-t.y;break;case Oe:r.y=-Math.asin(o)}r.x=Math.atan2(t.x,t.y)}return t.x=r.x+this.long0,t.y=r.y,t},names:["Tilted_Perspective","tpers"]};return ct.defaultDatum="WGS84",ct.Proj=Y,ct.WGS84=new ct.Proj("WGS84"),ct.Point=Mt,ct.toPoint=it,ct.defs=M,ct.nadgrid=function(t,e){var n=new DataView(e),i=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(n),r=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:W(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(n,i);r.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var s=function(t,e,n){for(var i=[],r=0;r<e.nSubgrids;r++){var s=q(t,176,n),o=X(t,176,s,n),a=Math.round(1+(s.upperLongitude-s.lowerLongitude)/s.longitudeInterval),l=Math.round(1+(s.upperLatitude-s.lowerLatitude)/s.latitudeInterval);i.push({ll:[H(s.lowerLongitude),H(s.lowerLatitude)],del:[H(s.longitudeInterval),H(s.latitudeInterval)],lim:[a,l],count:s.gridNodeCount,cvs:j(o)})}return i}(n,r,i),o={header:r,subgrids:s};return z[t]=o,o},ct.transform=st,ct.mgrs=pt,ct.version="2.7.5",(Te=ct).Proj.projections.add(Rt),Te.Proj.projections.add(Nt),Te.Proj.projections.add(Dt),Te.Proj.projections.add(kt),Te.Proj.projections.add(Ut),Te.Proj.projections.add(Ft),Te.Proj.projections.add(Bt),Te.Proj.projections.add(zt),Te.Proj.projections.add(Vt),Te.Proj.projections.add(Kt),Te.Proj.projections.add($t),Te.Proj.projections.add(ee),Te.Proj.projections.add(ne),Te.Proj.projections.add(ie),Te.Proj.projections.add(re),Te.Proj.projections.add(se),Te.Proj.projections.add(oe),Te.Proj.projections.add(ae),Te.Proj.projections.add(le),Te.Proj.projections.add(ce),Te.Proj.projections.add(he),Te.Proj.projections.add(ue),Te.Proj.projections.add(de),Te.Proj.projections.add(pe),Te.Proj.projections.add(Re),Te.Proj.projections.add(Ie),Te.Proj.projections.add(Ne),Te.Proj.projections.add(Fe),ct}()},function(t,e){var n,i,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var l,c=[],h=!1,u=-1;function d(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&p())}function p(){if(!h){var t=a(d);h=!0;for(var e=c.length;e;){for(l=c,c=[];++u<e;)l&&l[u].run();u=-1,e=c.length}l=null,h=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new f(t,e)),1!==c.length||h||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){t.exports=n},function(t,e,n){"use strict";n.r(e),n.d(e,"Services",(function(){return If})),n.d(e,"Error",(function(){return Nf})),n.d(e,"Helper",(function(){return Df})),n.d(e,"Protocols",(function(){return Of})),n.d(e,"servicesDate",(function(){return Gf})),n.d(e,"servicesVersion",(function(){return kf})),n.d(e,"LayerUtils",(function(){return ef})),n.d(e,"ProxyUtils",(function(){return Af})),n.d(e,"ColorUtils",(function(){return Cf})),n.d(e,"MathUtils",(function(){return Pf})),n.d(e,"Logger",(function(){return o.a})),n.d(e,"itownsExtVersion",(function(){return Ff})),n.d(e,"itownsExtDate",(function(){return Bf})),n.d(e,"itownsExtended",(function(){return zf}));var i=n(3),r=(n(10),n(11),n(12),n(13),n(14),n(15),n(16),n(17),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(8)),s=n.n(r),o=n(1),a=n(4),l={getLogger:function(t){"true".match(/true/)?a.disableAll():a.enableAll();var e=t||"default";return a.getLogger(e)}},c={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(t,e){if(0===Object.keys(arguments).length)return"Message indefined !";var n=Array.prototype.slice.call(arguments),i=n.shift(),r=n,s=this[i];try{s=Array.isArray(r)&&r.length>0?s.replace("%var%",r.join(" - ")):s.replace("%var%","%var% (not specified)")}catch(t){}return s}};function h(t){if(!(this instanceof h))throw new TypeError("ErrorService constructor cannot be called as a function.");var e=t;"string"==typeof t||t instanceof String?(this.message=t,this.status=-1,this.type=h.TYPE_UNKERR):(this.message=e.message||"undefined!?",this.type=e.type,this.status=e.status||-1),this.name="ErrorService",this.stack=(new Error).stack}h.TYPE_SRVERR="SERVICE_ERROR",h.TYPE_USEERR="USAGE_ERROR",h.TYPE_UNKERR="UNKNOWN_ERROR",h.prototype=Object.create(Error.prototype,{constructor:{value:h,writable:!0,configurable:!0}});var u,d=h,p={normalyzeParameters:function(t){var e=null;if(t){var n=[];for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];r||(r=""),n.push(i+"="+r)}e=n.join("&")}return e},normalyzeUrl:function(t,e,n){var i=t;if(t){var r=t.indexOf("?");-1===r&&(i+="?"),-1!==r&&r!==t.length-1&&(i+="&")}return e&&(i+="string"==typeof e?e:this.normalyzeParameters(e)),n&&(i=encodeURIComponent(i)),i},indent:function(t,e){return new Array((t||0)+1).join("\t")+e}},f=n(9),m=n.n(f),g={call:function(t){var e=l.getLogger("XHR");if(e.trace("[XHR::call()]"),m.a.polyfill(),!t.url)throw new Error("missing parameter : url is not defined !");if(!t.method)throw new Error("missing parameter : method is not defined !");t.format||(t.format="text");var n={};switch(n.url=t.url,n.data=t.data?t.data:null,n.method=t.method,n.timeOut=t.timeOut||0,n.scope=t.scope||this,n.proxy=t.proxy||null,n.content=t.content||null,n.headers=t.headers||{referer:"http://localhost"},t.method){case"DELETE":case"GET":break;case"PUT":case"POST":n.content=t.content?t.content:"application/x-www-form-urlencoded",n.headers=t.headers?t.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(t.format){case"text":this.__call(n).then((function(n){e.trace(n),t.onResponse.call(this,n)})).catch((function(e){t.onFailure.call(this,e)}));break;case"json":this.__callJSON(n).then((function(n){e.trace(n),t.onResponse.call(this,n)})).catch((function(e){t.onFailure.call(this,e)}));break;case"xml":this.__callXML(n).then((function(n){e.trace(n),t.onResponse.call(this,n)})).catch((function(e){t.onFailure.call(this,e)}));break;default:throw new Error("This output Format is not yet supported !")}},__call:function(t){var e=l.getLogger("XHR");return e.trace("[XHR::__call()]"),new Promise((function(i,r){var s="POST"===t.method||"PUT"===t.method?1:0;t.data&&("object"==typeof t.data&&Object.keys(t.data).length||"string"==typeof t.data&&t.data.length)&&!s&&(t.url=p.normalyzeUrl(t.url,t.data)),e.trace("URL = ",t.url);var o=null;if("undefined"==typeof window){var a=n(36),l={headers:{Referer:"https://localhost"}};return t.data&&"string"==typeof t.data&&s&&(l={method:t.method,body:t.data,headers:{"Content-Type":t.content,Referer:"https://localhost"}}),a(t.url,l).then((function(t){if(t.ok)i(t.text());else{var e="Errors Occured on Http Request (status : '"+t.statusText+"' | url : '"+t.url+"')",n=t.status;r({message:e,status:n})}})).catch((function(t){r({message:t,status:-1})}))}if(window.XMLHttpRequest){e.trace("XMLHttpRequest"),(o=new XMLHttpRequest).open(t.method,t.url,!0),o.overrideMimeType=t.content;var c=null;t.timeOut>0&&(e.trace("XHR - TimeOut actif !"),c=window.setTimeout((function(){r({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})}),t.timeOut)),s&&(e.trace("data = ",t.data),o.setRequestHeader("Content-type",t.content)),o.onerror=function(t){console.log(t),r(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},o.ontimeout=function(t){console.log(t),r(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},o.onreadystatechange=function(t){if(4===o.readyState)if(200===o.status)window.clearTimeout(c),i(o.response);else{var e="Errors Occured on Http Request (status : '"+t.target.statusText+"' | url : '"+t.target.responseURL+"')",n=t.target.status;r({message:e,status:n})}};var h=t.data&&s?t.data:null;o.send(h)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");e.trace("XDomainRequest"),(o=new XDomainRequest).open(t.method,t.url),o.overrideMimeType=t.content,t.timeOut>0&&(o.timeout=t.timeout,e.trace("XHR - TimeOut actif !")),s&&o.setRequestHeader("Content-type",t.content),o.onerror=function(){r(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},o.ontimeout=function(){r(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},o.onload=function(t){if(200===o.status)i(o.responseText);else{var e="Errors Occured on Http Request (status : '"+t.target.statusText+"' | url : '"+t.target.responseURL+"')",n=t.target.status;r({message:e,status:n})}};var u=t.data&&s?t.data:null;o.send(u)}}))},__callJSON:function(t){return this.__call(t).then(JSON.parse).catch((function(e){console.log("_callJSON failed on : ",t.url,e)}))},__callXML:function(t){return this.__call(t).then((function(t){var e;"undefined"==typeof window?e=(new(0,n(7).DOMParser)).parseFromString(t,"text/xml"):window.DOMParser?e=(new window.DOMParser).parseFromString(t,"text/xml"):((e=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(t));return e})).catch((function(e){console.log("__callXML failed on : ",t.url,e)}))}},v={uuid:(u=Math.floor(Date.now()),function(){return u++}),call:function(t){var e=l.getLogger("JSONP");if(e.trace("[JSONP::call ()]"),!t)throw e.error("missing parameter : options !"),new Error("missing parameter : options !");if(!t.url)throw e.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(t.timeOut||(e.info("setting 'options.timeOut' default value"),t.timeOut=0),!t.onResponse)throw e.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var n="string"==typeof t.callbackSuffix?t.callbackSuffix:this.uuid(),i=!1,r=!1,s=t.url.indexOf("callback=");if(-1!==s){i=!0;var o=t.url.indexOf("&",s);-1===o&&(o=t.url.length);var a=t.url.substring(s+9,o);a&&(r=!0,t.callbackName=a,e.info("setting 'options.callbackName' value ("+t.callbackName+") from 'options.url' parameter"))}if(!i){var c=t.url.indexOf("?");-1===c?t.url=t.url+"?callback=":c===t.url.length?t.url=t.url+"callback=":t.url=t.url+"&callback=",e.info("setting callback default key in 'options.url' : "+t.url)}var h=!!t.callbackName||r;if(r||(t.callbackName||(e.info("setting 'options.callbackName' default value"),t.callbackName="callback",(n||""===n)&&(t.callbackName+=n)),t.url=t.url.replace("callback=","callback="+t.callbackName),e.info("setting callback function name in 'options.url' : "+t.url)),t.onTimeOut||(e.info("setting 'options.onTimeOut' default value"),t.onTimeOut=function(){console.log("TimeOut while invoking url : "+t.url)}),!h){var u=this,d=null;t.timeOut>0&&(d=window.setTimeout((function(){window[t.callbackName]=function(){},t.onTimeOut(),u._deleteScript(n)}),t.timeOut)),window[t.callbackName]=function(e){window.clearTimeout(d),t.onResponse(e),u._deleteScript(n)}}this._createScript(n,t.url)},_createScript:function(t,e){var n,i=document.getElementById("results"+t);(n=document.createElement("script")).setAttribute("type","text/javascript"),n.setAttribute("src",e),n.setAttribute("charset","UTF-8"),n.setAttribute("id","results"+t),n.setAttribute("async","true");var r=document.documentElement||document.getElementsByTagName("head")[0];null===i?r.appendChild(n):r.replaceChild(n,i)},_deleteScript:function(t){var e=document.getElementById("results"+t);if(e){var n=e.parentNode||document.documentElement;if(!n)return;n.removeChild(e)}}},y={send:function(t){var e=t||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if("undefined"!=typeof window||"JSONP"!==t.protocol){if("XHR"===t.protocol||"json"===t.format?e.wrap=!1:"JSONP"===t.protocol&&"xml"===t.format&&(e.wrap=!0),e.callback=null,e.output=e.wrap?"json":null,e.wrap){var n={};n.output=e.output,n.callback=e.callback,delete n.callback,e.url=p.normalyzeUrl(t.url,n)}switch(e.protocol){case"XHR":"GET"===t.method&&t.nocache&&(e.url=p.normalyzeUrl(e.url,{t:(new Date).getTime()})),g.call(e);break;case"JSONP":e.data&&(e.url=p.normalyzeUrl(e.url,e.data)),v.call(e);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}},_={ssl:!0,url:function(t,e){return(!1===_.ssl?"http://":"https://")+"wxs.ign.fr".concat("/",t,e)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(t){return{"elevation-json":_.url(t,this._key["elevation-json"]),"elevation-xml":_.url(t,this._key["elevation-xml"]),"profil-json":_.url(t,this._key["profil-json"]),"profil-xml":_.url(t,this._key["profil-xml"]),wps:_.url(t,this._key.wps)}}},ProcessIsoCurve:{_key:{"iso-json":"/isochrone/isochrone.json","iso-xml":"/isochrone/isochrone.xml"},url:function(t){return{"iso-json":_.url(t,this._key["iso-json"]),"iso-xml":_.url(t,this._key["iso-xml"])}}},AutoComplete:{_key:"/ols/apis/completion",url:function(t){return _.url(t,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(t){return _.url(t,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(t){var e="";if(Array.isArray(t)&&t.length>0){e=t[0];for(var n=1;n<t.length;n++)e+=","+t[n]}return{apiKey:_.url(t,this._key.apiKey),apiKeys:_.url(t[0],this._key.apiKeys).replace("%KEYS%",e),aggregate:_.url(t,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(t){return _.url(t,this._key)}},Route:{_key:"/geoportail/itineraire/rest/1.0.0/route",url:function(t){return _.url(t,this._key)}}},x=_,b=n(5);function M(t){if(!(this instanceof M))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR"));for(var e in this.logger=l.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(t){console.log("onSuccess - la reponse est la suivante : ",t)},onFailure:function(t){200!==t.status&&t.status?console.log("onFailure - Erreur (",t.status,") : ",t.message):console.log("onFailure : ",t.message)}},t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(c.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(t){console.log("onSuccess - la réponse brute du service est la suivante : ",t)}),!!(null===this.options.onSuccess||"function"!=typeof this.options.onSuccess))throw new Error(c.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){x.ssl=this.options.ssl;var n=x[this.CLASSNAME].url(this.options.apiKey);"string"==typeof n?this.options.serverUrl=n:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod="string"==typeof t.httpMethod?t.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(c.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(c.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof t.protocol?t.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(c.getMessage("PARAM_UNKNOWN","protocol"))}if("undefined"==typeof window&&"JSONP"===this.options.protocol)throw new Error(c.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=t.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}M.prototype={constructor:M,call:function(){this.logger.trace("CommonService::call ()");var t=this;function e(e){this.logger.trace("CommonService::onBuildRequest : ",e),this.callService.call(t,r,n)}function n(e){this.logger.trace("CommonService::onCallService : ",e),this.analyzeResponse.call(t,r,i)}function i(t){if(this.logger.trace("CommonService::onAnalyzeResponse : ",t),!t)return r.call(this,new d("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,t)}function r(t){this.logger.trace("CommonService::onError()");var e=t;e instanceof d||(e=new d(t.message)),this.options.onFailure.call(this,e)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(t,r,e)}).call(t)},buildRequest:function(t,e){this.logger.error("overwritten method !"),t&&t.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")},callService:function(t,e){var n=null,i=this.request,r=!(!this.options.proxyURL||"XHR"!==this.options.protocol);this.options.serverUrl=p.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":b.version},!1),r&&("GET"===this.options.httpMethod&&(n=this.options.proxyURL+p.normalyzeUrl(this.options.serverUrl,this.request,!0),i=null),"POST"===this.options.httpMethod&&(n=this.options.proxyURL+p.normalyzeUrl(this.options.serverUrl,null,!0),i=this.request));var s=this,o={url:n||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"!==this.options.protocol,callbackSuffix:this.options.callbackSuffix,data:i,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(n){s.logger.trace("callService::onResponse()");var i=null;if("XHR"===s.options.protocol&&(s.logger.trace("Response XHR",n),i=n),"JSONP"===s.options.protocol){if(s.logger.trace("Response JSON",n),!n)return void t.call(s,new d("Le contenu de la reponse est vide !?"));if(n.http){if(200!==n.http.status)return void t.call(s,new d({status:n.http.status,message:n.http.error,type:d.TYPE_SRVERR}));i=n.xml,s.options.rawResponse&&(i=n)}else i=n}if("function"==typeof s.options.onBeforeParse){var r=s.options.onBeforeParse(i);"string"==typeof r&&(i=r)}s.response=i,e.call(s,i)},onFailure:function(e){s.logger.trace("callService::onFailure()"),e.type=d.TYPE_SRVERR,t.call(s,new d(e))},onTimeOut:function(){s.logger.trace("callService::onTimeOut()"),t.call(s,new d("TimeOut!"))}};y.send(o)},analyzeResponse:function(t,e){this.logger.error("overwritten method !"),t&&t.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")}};var w=M;function E(t){if(!(this instanceof E))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=l.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=t||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}E.CLASSNAME="AltiRequest",E.prototype={constructor:E,setPositions:function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];i.lon&&i.lat&&e.push(i)}this.positions=e},getPositions:function(t){if(!t)return this.positions;var e=this.positions.length-1;return t>e||t<e?(this.logger.warn("index out of range !"),this.positions):this.positions[t]},addPositions:function(t){for(var e=0;e<t.length;e++){var n=t[e];n.lon&&n.lat&&this.positions.push(t[e])}},getLon:function(){for(var t=[],e=0;e<this.positions.length;e++)t.push(this.positions[e].lon);return this.logger.trace(t),t.join(this.delimiter)},getLat:function(){for(var t=[],e=0;e<this.positions.length;e++)t.push(this.positions[e].lat);return this.logger.trace(t),t.join(this.delimiter)}},E.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"delimiter",v:this.delimiter}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"format",v:this.format}),t};var S=E;function T(t){if(!(this instanceof T))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",S.apply(this,arguments),this.logger=l.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}T.prototype=Object.create(S.prototype,{zonly:{get:function(){return this._zonly},set:function(t){this._zonly=t}}}),T.prototype.constructor=T,T.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"zonly",v:this.zonly}),t.push({k:"format",v:this.format}),t};var R=T;function A(t){if(!(this instanceof A))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",S.apply(this,arguments),this.logger=l.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}A.prototype=Object.create(S.prototype,{sampling:{get:function(){return this._sampling},set:function(t){this._sampling=t}}}),A.prototype.constructor=A,A.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"sampling",v:this.sampling}),t.push({k:"format",v:this.format}),t};var C=A;function P(t){if(this.logger=l.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof P))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=t||{},!this.options)throw new Error(c.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(c.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new R(this.options.param);break;case"Profil":this.DataObject=new C(this.options.param);break;default:throw new Error(c.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}P.prototype={requestString:null,constructor:P,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:"lon=__LON__\nlat=__LAT__\nindent=__INDENT__\ncrs='__CRS__'\n",input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var t="";return"POST"===this.method?t=this.template.post.value:"GET"===this.method&&(t=this.template.get.value),t=(t=(t=(t=t.replace(/__LON__/g,this.DataObject.getLon())).replace(/__LAT__/g,this.DataObject.getLat())).replace(/__INDENT__/g,this.DataObject.indent)).replace(/__CRS__/g,this.DataObject.crs),t+=this.__addDataInputs(),this.logger.trace("traduction tmpl",t),this.requestString=t,this.requestString},__addDataInputs:function(){var t;if(this.logger.trace("AltiRequestREST::addDataInput ()"),"POST"===this.method)t=this.template.post;else{if("GET"!==this.method)throw new Error("No other HTTP method supported by the service !");t=this.template.get}if("AltiElevationRequest"===this.DataObject.CLASSNAME)return t.input.point.replace(/__ZONLY__/g,this.DataObject.zonly);if("AltiProfilRequest"===this.DataObject.CLASSNAME)return t.input.profil.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};var L=P;function I(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof I))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=t||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}I.prototype={requestString:null,constructor:I,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=\x3c!-- __DATAINPUTS__ --\x3e",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs>\x3c!-- __DATAINPUTS__ --\x3e</wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var t="";if("POST"===this.method)t=this.template.post.value;else{if("GET"!==this.method)return this.logger.error("No other method supported by the service !"),!1;t=this.template.get.value}return t=(t=(t=(t=(t=t.replace(/__SERVICE__/g,this.paramservice)).replace(/__VERSION__/g,this.paramversion)).replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput)).replace(/__IDENTIFIER__/g,this.paramidentifier)).replace(/__REQUEST__/g,this.paramrequest),"POST"===this.method&&(t=(t=t.replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(t=t.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=t,this.logger.trace("traduction tmpl",t),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var t,e="GET"===this.method?this.template.get.input:this.template.post.input,n="GET"===this.method?";":"",i="",r=this,s=this.DataObject.getData(),o=0;o<s.length;o++)t=o,n&&(n=t===s.length-1?"":";"),i=i.concat(r.__addDataInput(e,s[t].k,s[t].v),n);return i},__addDataInput:function(t,e,n){var i=t;return i=(i=i.replace(/__KEY__/g,e)).replace(/__DATA__/g,n)},setMethod:function(t){"GET"===t||"POST"===t?this.method=t:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var N=I,D={build:function(t){if(l.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!t)throw new Error(c.getMessage("PARAM_EMPTY","options"));if(!t.type)throw new Error(c.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var e=null;switch(t.type){case"Elevation":t.wps.identifier="gs:WPSElevation",e=new R(t.param);break;case"Profil":t.wps.identifier="gs:WPSLineElevation",e=new C(t.param);break;default:throw new Error(c.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var n={data:e,method:t.method,param:t.wps},i=new N(n);if(!i.processRequestString())throw new Error("Enable to process request !");return i.requestString}},O={build:function(t){l.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var e=null,n={type:t.sampling?"Profil":"Elevation",method:t.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};n.param.positions=t.positions,n.param.format=t.outputFormat,n.param.sampling=t.sampling,n.param.zonly=t.zonly;var i=!(null===t.onError||"function"!=typeof t.onError),r=!(null===t.onSuccess||"function"!=typeof t.onSuccess),s=null;switch(t.api){case"REST":var o=new L(n);if(!o.processRequestString()){if(s="Error in process request (rest) !",i)return void t.onError.call(t.scope,new d(s));throw new Error(s)}e=o.requestString;break;case"WPS":if(n.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(e=D.build(n))){if(s="Error in process request (wps) !",i)return void t.onError.call(t.scope,new d(s));throw new Error(s)}break;default:if(s="Type of API is not supported by service (REST or WPS) !",i)return void t.onError.call(t.scope,new d(s));throw new Error(s)}return r&&t.onSuccess.call(t.scope,e),e}};function G(t){if(!(this instanceof G))throw new TypeError("XML constructor cannot be called as a function.");this.logger=l.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,t&&(t.xmlString&&"string"==typeof t.xmlString&&(this.xmlString=t.xmlString,this.xmlDoc=k(t.xmlString)),t.reader&&this.setReader(t.reader))}function k(t){if("undefined"==typeof window)return(new(0,n(7).DOMParser)).parseFromString(t,"text/xml");var e,i,r="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){(i=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,i.loadXML(t);var s=i.parseError;if(s.errorCode)throw s.line&&s.linepos&&(r+="( ligne "+s.line+", colonne "+s.linepos),s.reason&&(r+=":  "+s.reason+")"),new Error(r);return i}if(window.DOMParser){e=new window.DOMParser;try{i=e.parseFromString(t,"text/xml")}catch(t){throw"SyntaxError"===t.message?new Error(r):new Error("Erreur lors du parsing de la réponse du service : "+t.message)}if(i.getElementsByTagName("parsererror").length>0)for(var o=i.getElementsByTagName("parsererror"),a=0;a<o.length;a++){var l=o[a].innerHTML;if(-1===l.indexOf("Huge input lookup"))throw r+="("+l+")",new Error(r)}else if(!i.documentElement)throw new Error(r);return i}throw new Error("Incompatible DOM Parser pour ce navigateur !")}G.prototype={constructor:G,getXMLString:function(){return this.xmlString},setXMLString:function(t){t&&"string"==typeof t&&(this.xmlString=t,this.xmlDoc=k(t))},getReader:function(){return this.reader},setReader:function(t){t&&t.read&&"function"==typeof t.read&&(this.reader=t)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(t){this.xmlDoc=t},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=k(this.xmlString)),this.xmlDoc){var t,e=function(t){var e;9===t.nodeType?e=t.documentElement:1===t.nodeType&&(e=t);return e}(this.xmlDoc);return e?(this.reader&&this.reader.read?t=this.reader.read(e):(t={})[e.nodeName]=function t(e){var n={};if(e.attributes.length>0){var i=function(t){if(t.attributes.length>0){for(var e={},n=t.attributes,i=0;i<n.length;i++){var r=n[i];e[r.nodeName]=r.nodeValue}return e}}(e);n.attributes=i}if(e.hasChildNodes())for(var r,s={},o=e.childNodes,a=0;a<o.length;a++)if(3===(r=o[a]).nodeType)n.textContent=r.nodeValue;else if(1===r.nodeType)if(s=t(r),n[r.nodeName]){if(!Array.isArray(n[r.nodeName])){var l=n[r.nodeName];n[r.nodeName]=[],n[r.nodeName].push(l)}n[r.nodeName].push(s)}else n[r.nodeName]=s;return n}(e),t):{}}}};var U=G;function F(){if(!(this instanceof F))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}F.prototype={constructor:F};var B=F;function z(){if(!(this instanceof z))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}z.prototype={constructor:z};var V=z,H={};H.READERS={elevations:function(t){var e=new B;if(t.hasChildNodes())for(var n,i,r=t.childNodes,s=0;s<r.length;s++)n=r[s],H.READERS[n.nodeName]&&(i=H.READERS[n.nodeName](n),e.elevations.push(i));return e},elevation:function(t){var e=new V;if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)n=i[r],H.READERS[n.nodeName]&&H.READERS[n.nodeName](n,e);return e},lat:function(t,e){var n=t.firstChild;if(!n||3!==n.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");e.lat=parseFloat(n.nodeValue)},lon:function(t,e){var n=t.firstChild;if(!n||3!==n.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");e.lon=parseFloat(n.nodeValue)},z:function(t,e){var n=t.firstChild;if(!n||3!==n.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!e)return(e=new V).z=parseFloat(n.nodeValue),e;e.z=parseFloat(n.nodeValue)},acc:function(t,e){var n=t.firstChild;if(!n||3!==n.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");e.acc=parseFloat(n.nodeValue)},exceptionreport:function(t){var e={};if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)"Exception"===(n=i[r]).nodeName&&(e.exceptionReport=H.READERS.exception(n));return e},exception:function(t){var e={},n=t.getAttribute("exceptionCode");n&&(e.exceptionCode=n);var i=t.firstChild;return i&&3===i.nodeType&&(e.exception=i.nodeValue),e},error:function(t){var e={error:{}};if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++){var s;1===(n=i[r]).nodeType&&"code"===n.nodeName&&(s=n.firstChild)&&3===s.nodeType&&(e.error.code=s.nodeValue),1===n.nodeType&&"description"===n.nodeName&&(s=n.firstChild)&&3===s.nodeType&&(e.error.description=s.nodeValue)}return e}},H.read=function(t){if("elevations"===t.nodeName)return H.READERS.elevations(t);if("ExceptionReport"===t.nodeName)return H.READERS.exceptionreport(t);if("error"===t.nodeName)return H.READERS.error(t);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var W=H,j={build:function(t){var e=l.getLogger("AltiResponseFactory");e.trace(["AltiResponseFactory::build()"]);var n=null;if(t.response){if(t.rawResponse)e.trace("analyze response : raw"),n=t.response;else{switch(t.outputFormat){case"xml":e.trace("analyze response : xml");try{var i=new U({reader:W});if("string"==typeof t.response?i.setXMLString(t.response):i.setXMLDoc(t.response),!(n=i.parse()))throw new Error(c.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(e){var r=e.message;return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",r),status:200,type:d.TYPE_SRVERR}))}break;case"json":e.trace("analyze response : json"),e.trace("analyze response : ",typeof t.response);var s=null;if((s="string"==typeof t.response?JSON.parse(t.response):t.response)&&s.error)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",s.error.description),status:200,type:d.TYPE_SRVERR}));if(s){var o,a=s.elevations,h=new B;if(Array.isArray(a)&&a.length)for(var u=0;u<a.length;u++)o=new V,"object"==typeof a[u]?(a[u].lon&&(o.lon=a[u].lon),a[u].lat&&(o.lat=a[u].lat),a[u].z&&(o.z=a[u].z),a[u].acc&&(o.acc=a[u].acc)):"number"==typeof a[u]&&(o.z=a[u]),Array.isArray(h.elevations)&&h.elevations.push(o);n=h}if(!n)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:d.TYPE_UNKERR,status:-1}));break;default:return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:d.TYPE_UNKERR,status:-1}))}if(n.exceptionReport)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",n.exceptionReport),type:d.TYPE_SRVERR,status:200}));if(n.error){var p=n.error.description;return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",p),type:d.TYPE_SRVERR,status:200}))}}t.onSuccess.call(t.scope,n)}else t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))}};function q(t){if(!(this instanceof q))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",w.apply(this,arguments),this.logger=l.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!t.positions)throw new Error(c.getMessage("PARAM_MISSING","positions"));if(0===t.positions.length)throw new Error(c.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=t.positions,this.options.outputFormat="string"==typeof t.outputFormat?t.outputFormat.toLowerCase():"xml",this.options.sampling=t.sampling||null,this.options.api="string"==typeof t.api?t.api.toUpperCase():"REST","REST"===this.options.api&&(this.options.httpMethod="GET"),this.options.zonly=t.zonly||!1,!this.options.serverUrl){var e=x.Alti.url(this.options.apiKey),n=null;switch(this.options.api){case"WPS":n=e.wps;break;case"REST":var i=(t.sampling?"profil":"elevation")+"-"+this.options.outputFormat;n=e[i];break;default:throw new Error(c.getMessage("PARAM_UNKNOWN","api"))}if(!n)throw new Error("Url by default not found !");this.options.serverUrl=n,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var r=this.options.serverUrl.lastIndexOf(".");if(-1!==r){var s=this.options.serverUrl.substring(r+1);if(s&&s.length<5)switch(this.logger.trace("Server Extension URL : "+s),s.toLowerCase()){case"json":case"xml":this.options.outputFormat=s.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}q.prototype=Object.create(w.prototype,{}),q.prototype.constructor=q,q.prototype.buildRequest=function(t,e){var n={httpMethod:this.options.httpMethod,onSuccess:function(t){this.request=t,e.call(this,this.request)},onError:t,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};O.build(n)},q.prototype.analyzeResponse=function(t,e){if(this.response){var n={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};j.build(n)}else t.call(this,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))};var X=q;function Y(){if(!(this instanceof Y))throw new TypeError("AutoConfResponse constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.territories={},this.tileMatrixSets={},this.services={}}Y.prototype={constructor:Y,isConfLoaded:function(t){if(t)return!!this.generalOptions.apiKeys[t]},getLayersId:function(t){return this.generalOptions.apiKeys[t]},getLayersConf:function(t){var e={},n=this.getLayersId(t);if(n)for(var i=0;i<n.length;i++){var r=n[i];e[r]=this.layers[r]}return e},getLayerConf:function(t){if(this.layers)return this.layers[t]},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(t){if(this.tileMatrixSets)return this.tileMatrixSets[t]},getTerritories:function(){return this.territories},getTerritoryConf:function(t){if(this.territories)return this.territories[t]},getServices:function(){return this.services},getServiceConf:function(t){if(this.services)return this.services[t]}};var J=Y;function Z(){if(!(this instanceof Z))throw new TypeError("Constraint constructor cannot be called as a function.");this.crs=null,this.bbox={left:null,right:null,top:null,bottom:null},this.minScaleDenominator=null,this.maxScaleDenominator=null,this.temporalExtent=[null,null]}Z.prototype={constructor:Z};var K=Z;function Q(){if(!(this instanceof Q))throw new TypeError("Format constructor cannot be called as a function.");this.current=null,this.name=null}Q.prototype={constructor:Q};var $=Q;function tt(){if(!(this instanceof tt))throw new TypeError("Layer constructor cannot be called as a function.")}tt.prototype={constructor:tt,getName:function(){return this.name},getTitle:function(){return this.title},getDescription:function(){return this.description},getLayerId:function(){return this.layerId},getQuicklookUrl:function(){return this.quicklookUrl},getDefaultProjection:function(){return this.defaultProjection},getProjections:function(){var t=[];return t.push(this.defaultProjection),t.concat(this.additionalProjections)},getBBOX:function(){if(this.globalConstraint)return this.globalConstraint.bbox},getMinScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.minScaleDenominator},getMaxScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.maxScaleDenominator},getTMSID:function(){if(this.wmtsOptions)return this.wmtsOptions.tileMatrixSetLink},getServiceParams:function(){return this.serviceParams},getServerUrl:function(t){if(t&&this.serviceParams&&this.serviceParams.serverUrl)return this.serviceParams.serverUrl[t]},getLegends:function(){return this.legends},getMetadata:function(){return this.metadata},getStyles:function(){return this.styles},getDefaultStyle:function(){if(this.styles){for(var t,e=this.styles,n=0;n<e.length;n++)if(!0===e[n].current){t=e[n].name;break}return t}},getThematics:function(){return this.thematics},getDefaultFormat:function(){if(this.formats){for(var t,e=this.formats,n=0;n<e.length;n++)if(!0===e[n].current){t=e[n].name;break}return t}},getConstraints:function(){return this.constraints},getOriginators:function(){return this.originators},getDimensions:function(){return this.dimensions},getAggregatedLayers:function(){if(this.isAggregate)return this.aggregatedLayers}};var et=tt;function nt(){if(!(this instanceof nt))throw new TypeError("Legend constructor cannot be called as a function.");this.format=null,this.url=null,this.minScaleDenominator=null}nt.prototype={constructor:nt};var it=nt;function rt(){if(!(this instanceof rt))throw new TypeError("Metadata constructor cannot be called as a function.");this.format=null,this.url=null}rt.prototype={constructor:rt};var st=rt;function ot(){if(!(this instanceof ot))throw new TypeError("Originator constructor cannot be called as a function.");this.name=null,this.attribution=null,this.logo=null,this.url=null,this.constraints=[]}ot.prototype={constructor:ot};var at=ot;function lt(){if(!(this instanceof lt))throw new TypeError("Service constructor cannot be called as a function.");this.title=null,this.serverUrl=null,this.version=null}lt.prototype={constructor:lt};var ct=lt;function ht(){if(!(this instanceof ht))throw new TypeError("Style constructor cannot be called as a function.");this.name=null,this.title=null,this.current=null,this.url=null}ht.prototype={constructor:ht};var ut=ht;function dt(){if(!(this instanceof dt))throw new TypeError("Territory constructor cannot be called as a function.");this.isDefault=null,this.defaultCRS=null,this.additionalCRS=[],this.geoBBOX={left:null,right:null,top:null,bottom:null},this.geoCenter={lon:null,lat:null},this.defaultOptions={resolution:null,minScaleDenominator:null,maxScaleDenominator:null},this.defaultLayers=[]}dt.prototype={constructor:dt};var pt=dt;function ft(){if(!(this instanceof ft))throw new TypeError("Thematic constructor cannot be called as a function.");this.inspire=null,this.name=null}ft.prototype={constructor:ft};var mt=ft;function gt(){if(!(this instanceof gt))throw new TypeError("TileMatrixSet constructor cannot be called as a function.");this.projection=null,this.nativeResolutions=[],this.matrixIds=[],this.tileMatrices={}}gt.prototype={constructor:gt,getResolutions:function(){return this.nativeResolutions},getMatrixIds:function(){return this.matrixIds},getProjection:function(){return this.projection},getTileMatrices:function(){return this.tileMatrices},getTopLeftCorner:function(){var t,e=this.getTileMatrices();if(e)for(var n in e)if(e.hasOwnProperty(n)){t=e[n].topLeftCorner;break}return t}};var vt=gt;function yt(){if(!(this instanceof yt))throw new TypeError("TileMatrix constructor cannot be called as a function.");this.matrixId=null,this.matrixHeight=null,this.matrixWidth=null,this.scaleDenominator=null,this.tileHeight=null,this.tileWidth=null,this.topLeftCorner=null}yt.prototype={constructor:yt,getTopLeftCorner:function(){return this.topLeftCorner},getScaleDenominator:function(){return this.scaleDenominator},getTileHeight:function(){return this.tileHeight},getTileWidth:function(){return this.tileWidth},getMatrixHeight:function(){return this.matrixHeight},getMatrixWidth:function(){return this.matrixWidth}};var _t=yt;function xt(){if(!(this instanceof xt))throw new TypeError("TileMatrixLimit constructor cannot be called as a function.");this.minTileRow=null,this.maxTileRow=null,this.minTileCol=null,this.maxTileCol=null}xt.prototype={constructor:xt};var bt=xt,Mt={};function wt(t,e){if(t.hasChildNodes())for(var n,i,r,s=t.childNodes,o=0;o<s.length;o++){if(1===(n=s[o]).nodeType)if(i=n.localName||n.baseName||n.nodeName,r=n.prefix||Mt.DEFAULTPREFIX,Mt.READERS[r][i])(0,Mt.READERS[r][i])(n,e);else wt(n,e)}}function Et(t){var e,n="";return t.hasChildNodes()&&(3!==(e=t.firstChild).nodeType&&4!==e.nodeType||(n=e.nodeValue)),n}Mt.VERSION="1.1.0",Mt.NAMESPACES={xmlns:"http://www.opengis.net/context",gpp:"http://api.ign.fr/geoportail",ows:"http://www.opengis.net/ows/2.0",sld:"http://www.opengis.net/sld",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},Mt.SCHEMALOCATION=["http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd","http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf.xsd"],Mt.DEFAULTPREFIX="context",Mt.READERS={context:{ViewContext:function(t){!function(t){if(t.attributes.length>0){var e=function(t){if(t.attributes.length>0){for(var e={},n=t.attributes,i=0;i<n.length;i++){var r=n[i];e[r.nodeName]=r.nodeValue}return e}}(t);for(var n in e)if(e.hasOwnProperty(n)){if("version"===n&&e.version!==Mt.VERSION)return void console.log("[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing");if("xmlns"===n){if(e[n]!==Mt.NAMESPACES.xmlns)return void console.log("[AutoConfResponseReader] autoconf response default namespace is not the expected one");continue}var i=n.split(":")[0],r=n.split(":")[1];if("xmlns"===i&&r&&Mt.NAMESPACES[r]&&Mt.NAMESPACES[r]!==e[n])return void console.log("[AutoConfResponseReader] autoconf response "+n+" namespace is not the expected one");if("schemaLocation"===r&&e[n]!==Mt.SCHEMALOCATION[0]&&e[n]!==Mt.SCHEMALOCATION[1])return void console.log("[AutoConfResponseReader] autoconf response schema location is not the expected one")}}}(t);var e=new J;return wt(t,e),e},Title:function(t,e){e&&e.generalOptions?e.generalOptions.title=Et(t):e&&e.lyr&&(e.lyr.title=Et(t))},Abstract:function(t,e){e&&e.lyr&&(e.lyr.description=Et(t))},Server:function(t,e){var n=t.getAttribute("service"),i=t.getAttribute("title"),r=t.getAttribute("version");if(n)if(e&&e.services&&"object"==typeof e.services&&!e.services[n]){var s=new ct;s.title=i,s.version=r,wt(t,s),e.services[n]=s}else e&&e.lyr&&(e.lyr.serviceParams||(e.lyr.serviceParams={}),e.lyr.serviceParams.id=n,e.lyr.serviceParams.version=r)},OnlineResource:function(t,e){e&&e.hasOwnProperty("serverUrl")&&(e.serverUrl=t.getAttribute("xlink:href"))},LayerList:function(t,e){if(wt(t,e),e&&e.layers&&e.generalOptions&&e.services)for(var n in e.layers)if(e.layers.hasOwnProperty(n)){var i=e.layers[n],r=i.apiKeys;if(r&&Array.isArray(r))for(var s=0;s<r.length;s++){var o=r[s];e.generalOptions.apiKeys&&(e.generalOptions.apiKeys[o]&&Array.isArray(e.generalOptions.apiKeys[o])||(e.generalOptions.apiKeys[o]=[]),e.generalOptions.apiKeys[o].push(n))}var a=i.serviceParams;if(a&&a.id&&!e.services[a.id]){var l=new ct;a.serverUrl&&(l.serverUrl=a.serverUrl),a.version&&(l.version=a.version),e.services[a.id]=l}if(i.wmtsOptions&&i.wmtsOptions.tileMatrixSetLink&&e.tileMatrixSets){var c=i.wmtsOptions.tileMatrixSetLink,h=e.tileMatrixSets;for(var u in h)h.hasOwnProperty(u)&&u===c&&(i.defaultProjection=h[u].projection)}}},Layer:function(t,e){if(e&&e.layers){var n={lyr:new et,lyrId:null},i=t.getAttribute("hidden");n.lyr.hidden="1"===i;var r=t.getAttribute("queryable");if(n.lyr.queryable="1"===r,wt(t,n),n.lyrId){if(n.lyr.serviceParams&&n.lyr.serviceParams.id){var s=n.lyr.serviceParams.id;if(-1!==s.toUpperCase().indexOf("OPENLS")||-1!==s.toUpperCase().indexOf("ELEVATION")){var o=n.lyrId.split("$")[0];n.lyrId=o+"$"+s}}n.lyr.layerId=n.lyrId,e.layers[n.lyrId]=n.lyr}}},Name:function(t,e){e&&e.lyr&&(e.lyr.name=Et(t))},SRS:function(t,e){e&&e.lyr&&(e.lyr.defaultProjection=Et(t))},Format:function(t,e){if(e&&e.lyr){var n=new $,i=t.getAttribute("current");n.current="1"===i,n.name=Et(t),e.lyr.formats&&Array.isArray(e.lyr.formats)||(e.lyr.formats=[]),e.lyr.formats.push(n)}},Style:function(t,e){if(e&&e.lyr){var n=new ut,i=t.getAttribute("current");if(n.current="1"===i||1===i,t.hasChildNodes)for(var r,s,o=t.childNodes,a=0;a<o.length;a++)1===(r=o[a]).nodeType&&("Name"===(s=r.localName||r.baseName||r.nodeName)?n.name=Et(r):"Title"===s?n.title=Et(r):"URL"===s&&(n.url=Et(r)));e.lyr.styles&&Array.isArray(e.lyr.styles)||(e.lyr.styles=[]),e.lyr.styles.push(n)}},Dimension:function(t,e){var n=t.getAttribute("name"),i=Et(t);e&&e.lyr&&(e.lyr.dimensions||(e.lyr.dimensions={}),"Type"===n?e.lyr.dimensions.type=i:"VisibilityRange"===n?e.lyr.dimensions.visibilityRange=i:"VisibilityMode "===n?e.lyr.dimensions.visibilityMode=i:"GeometricType"===n?e.lyr.dimensions.geometricType=i:"NoDataValue"===n&&(e.lyr.dimensions.noDataValue=i))}},gpp:{Theme:function(t,e){e&&e.generalOptions&&e.generalOptions.hasOwnProperty("theme")&&(e.generalOptions.theme=Et(t))},defaultGMLGFIStyleUrl:function(t,e){e&&e.generalOptions&&e.generalOptions.hasOwnProperty("defaultGMLGFIStyle")&&(e.generalOptions.defaultGMLGFIStyle=Et(t))},Territory:function(t,e){var n=t.getAttribute("id");if(n){var i=new pt,r=t.getAttribute("default");i.isDefault="1"===r,wt(t,i),e&&e.territories&&"object"==typeof e.territories&&(e.territories[n]=i)}},defaultCRS:function(t,e){e&&e.hasOwnProperty("defaultCRS")&&(e.defaultCRS=Et(t))},AdditionalCRS:function(t,e){var n=Et(t);n&&e&&(Array.isArray(e.additionalCRS)?e.additionalCRS.push(n):(e.additionalProjections&&Array.isArray(e.additionalProjections)||(e.additionalProjections=[]),e.additionalProjections.push(n)))},DefaultLayer:function(t,e){var n=t.getAttribute("layerId");n&&e&&Array.isArray(e.defaultLayers)&&e.defaultLayers.push(n)},BoundingBox:function(t,e){if(e){var n=Et(t).split(",");if(4===n.length){var i={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[3]),bottom:parseFloat(n[1])},r=t.getAttribute("minT"),s=t.getAttribute("maxT");if(e.hasOwnProperty("geoBBOX"))e.geoBBOX=i;else if(e.hasOwnProperty("bbox"))if(e.bbox.left||e.bbox.right||e.bbox.top||e.bbox.bottom){e.multiConstraints||(e.multiConstraints=[]);var o=new K;o.bbox=i,o.temporalExtent=[r,s],e.multiConstraints.push(o)}else e.bbox=i,e.temporalExtent=[r,s];else e.globalConstraint||(e.globalConstraint=new K),e.globalConstraint.bbox=i,e.globalConstraint.temporalExtent=[r,s]}}},Resolution:function(t,e){var n=Et(t);n&&e&&e.defaultOptions&&e.defaultOptions.hasOwnProperty("resolution")&&(e.defaultOptions.resolution=parseFloat(n))},x:function(t,e){var n=Et(t);n&&e&&e.geoCenter&&e.geoCenter.hasOwnProperty("lon")&&(e.geoCenter.lon=parseFloat(n))},y:function(t,e){var n=Et(t);n&&e&&e.geoCenter&&e.geoCenter.hasOwnProperty("lat")&&(e.geoCenter.lat=parseFloat(n))},Resolutions:function(t,e){e&&e.generalOptions&&e.generalOptions.hasOwnProperty("wgs84Resolutions")&&(e.generalOptions.wgs84Resolutions=Et(t).split(","))},Layer:function(t,e){if(e&&e.hasOwnProperty("lyrId")&&e.lyr){e.lyrId=t.getAttribute("id");var n=t.getAttribute("aggregate"),i=t.getAttribute("more");(n||i)&&(e.lyr.isAggregate=!0),wt(t,e.lyr)}},Constraint:function(t,e){var n=new K;if(wt(t,n),e)if(e.constraints&&Array.isArray(e.constraints)||(e.constraints=[]),n.multiConstraints&&Array.isArray(n.multiConstraints)){var i=new K;i.crs=n.crs,i.bbox=n.bbox,i.minScaleDenominator=n.minScaleDenominator,i.maxScaleDenominator=n.maxScaleDenominator,i.temporalExtent=n.temporalExtent,e.constraints.push(i);for(var r=0;r<n.multiConstraints.length;r++)(i=new K).crs=n.crs,i.minScaleDenominator=n.minScaleDenominator,i.maxScaleDenominator=n.maxScaleDenominator,i.bbox=n.multiConstraints[r].bbox,i.temporalExtent=n.multiConstraints[r].temporalExtent,e.constraints.push(i)}else e.constraints.push(n)},CRS:function(t,e){e&&e.hasOwnProperty("crs")&&(e.crs=Et(t))},Thematic:function(t,e){if(e){var n=new mt;n.inspire=!1,n.name=Et(t),e.thematics&&Array.isArray(e.thematics)||(e.thematics=[]),e.thematics.push(n)}},InspireThematic:function(t,e){if(e){var n=new mt;n.inspire=!0,n.name=Et(t),e.thematics&&Array.isArray(e.thematics)||(e.thematics=[]),e.thematics.push(n)}},Originator:function(t,e){if(e){var n=new at;n.name=t.getAttribute("name"),wt(t,n),e.originators&&Array.isArray(e.originators)||(e.originators=[]),e.originators.push(n)}},Attribution:function(t,e){e&&e.hasOwnProperty("attribution")&&(e.attribution=Et(t))},Logo:function(t,e){e&&e.hasOwnProperty("logo")&&(e.logo=Et(t))},URL:function(t,e){e&&e.hasOwnProperty("url")&&(e.url=Et(t))},Legend:function(t,e){var n=new it;wt(t,n),e&&(e.legends&&Array.isArray(e.legends)||(e.legends=[]),e.legends.push(n))},LegendURL:function(t,e){if(e&&e.hasOwnProperty("format")&&(e.format=t.getAttribute("format"),t.hasChildNodes)){var n=t.childNodes[0];"OnlineResource"===(n.localName||n.baseName||n.nodeName)&&e.hasOwnProperty("url")&&(e.url=n.getAttribute("xlink:href"))}},QuickLook:function(t,e){if(t.hasChildNodes){var n=t.childNodes[0];"OnlineResource"===(n.localName||n.baseName||n.nodeName)&&e&&(e.quicklookUrl=n.getAttribute("xlink:href"))}},MetadataURL:function(t,e){if(e){var n=new st;if(n.format=t.getAttribute("format"),t.hasChildNodes){var i=t.childNodes[0];"OnlineResource"===(i.localName||i.baseName||i.nodeName)&&(n.url=i.getAttribute("xlink:href"))}e.metadata||(e.metadata=[]),e.metadata.push(n)}},Key:function(t,e){if(e){var n=t.getAttribute("id");e.apiKeys&&Array.isArray(e.apiKeys)||(e.apiKeys=[]),e.apiKeys.push(n);var i=Et(t);e.serviceParams||(e.serviceParams={}),e.serviceParams.serverUrl||(e.serviceParams.serverUrl={}),e.serviceParams.serverUrl[n]||(e.serviceParams.serverUrl[n]=i)}}},ows:{Identifier:function(t,e){e&&e.hasOwnProperty("TMS")?e.identifier=Et(t):e&&e.hasOwnProperty("matrixId")&&(e.matrixId=Et(t))},SupportedCRS:function(t,e){e&&e.TMS&&e.TMS.hasOwnProperty("projection")&&(e.TMS.projection=Et(t))}},sld:{MinScaleDenominator:function(t,e){var n=Et(t);n&&e&&(e.hasOwnProperty("defaultOptions")?e.defaultOptions.minScaleDenominator=parseFloat(n):e.lyr?(e.lyr.globalConstraint||(e.lyr.globalConstraint=new K),e.lyr.globalConstraint.minScaleDenominator=parseFloat(n)):e.hasOwnProperty("minScaleDenominator")&&(e.minScaleDenominator=parseFloat(n)))},MaxScaleDenominator:function(t,e){var n=Et(t);n&&e&&(e.hasOwnProperty("defaultOptions")?e.defaultOptions.maxScaleDenominator=parseFloat(n):e.lyr?(e.lyr.globalConstraint||(e.lyr.globalConstraint=new K),e.lyr.globalConstraint.maxScaleDenominator=parseFloat(n)):e.hasOwnProperty("maxScaleDenominator")&&(e.maxScaleDenominator=parseFloat(n)))}},wmts:{TileMatrixSetLimits:function(t,e){if(e){var n={};wt(t,n),e.wmtsOptions||(e.wmtsOptions={}),e.wmtsOptions.tileMatrixSetLimits=n}},TileMatrixLimits:function(t,e){var n,i=new bt;if(t.hasChildNodes){for(var r=t.childNodes,s=0;s<r.length;s++){var o=r[s],a=o.localName||o.baseName||o.nodeName;"TileMatrix"===a?n=Et(o):"MinTileRow"===a?i.minTileRow=Et(o):"MaxTileRow"===a?i.maxTileRow=Et(o):"MinTileCol"===a?i.minTileCol=Et(o):"MaxTileCol"===a&&(i.maxTileCol=Et(o))}n&&e&&!e[n]&&(e[n]=i)}},TileMatrixSet:function(t,e){if(e&&e.tileMatrixSets){var n={};n.TMS=new vt,n.resolutions=[],wt(t,n);var i=n.TMS.tileMatrices;for(var r in i)i.hasOwnProperty(r)&&n.TMS.matrixIds.push(r);if(("IGNF:WGS84G"===n.TMS.getProjection()||"EPSG:4326"===n.TMS.getProjection())&&e.generalOptions&&Array.isArray(e.generalOptions.wgs84Resolutions))for(var s=e.generalOptions.wgs84Resolutions,o=0;o<s.length;o++)n.resolutions[o]=parseFloat(s[o]);Array.isArray(n.resolutions)&&void 0!==n.resolutions.sort&&n.resolutions.sort((function(t,e){return e-t})),n.TMS.nativeResolutions=n.resolutions,e.tileMatrixSets[n.identifier]=n.TMS}else e&&!e.wmtsOptions&&(e.wmtsOptions={}),e.wmtsOptions.tileMatrixSetLink=Et(t)},TileMatrix:function(t,e){if(e){var n=new _t;if(wt(t,n),e.TMS&&e.TMS.getProjection()){var i=e.TMS.getProjection();if("EPSG:3857"===i||"EPSG:2154"===i){var r=28e-5*n.scaleDenominator;e.resolutions&&Array.isArray(e.resolutions)&&e.resolutions.push(r)}}e.TMS&&e.TMS.tileMatrices&&(e.TMS.tileMatrices[n.matrixId]=n)}},ScaleDenominator:function(t,e){var n=Et(t);n&&e&&e.hasOwnProperty("scaleDenominator")&&(e.scaleDenominator=parseFloat(n))},TopLeftCorner:function(t,e){var n=Et(t).split(" ");n&&e&&(e.topLeftCorner={},e.topLeftCorner.x=parseFloat(n[0]),e.topLeftCorner.y=parseFloat(n[1]))},TileWidth:function(t,e){var n=Et(t);n&&e&&e.hasOwnProperty("tileWidth")&&(e.tileWidth=parseInt(n,10))},TileHeight:function(t,e){var n=Et(t);n&&e&&e.hasOwnProperty("tileHeight")&&(e.tileHeight=parseInt(n,10))},MatrixWidth:function(t,e){var n=Et(t);n&&e&&e.hasOwnProperty("matrixWidth")&&(e.matrixWidth=parseInt(n,10))},MatrixHeight:function(t,e){var n=Et(t);n&&e&&e.hasOwnProperty("matrixHeight")&&(e.matrixHeight=parseInt(n,10))}},serviceException:function(t){var e={};if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)"exception"===(n=i[r]).nodeName&&(e.exceptionReport=Mt.READERS.exception(n));return e},exception:function(t){var e={},n=t.getAttribute("code");n&&(e.exceptionCode=n);var i=t.firstChild;return i&&3===i.nodeType&&(e.exception=i.nodeValue),e}},Mt.read=function(t){if("ViewContext"===t.nodeName){var e=t.prefix||Mt.DEFAULTPREFIX;return Mt.READERS[e][t.nodeName](t)}if("serviceException"===t.nodeName)return Mt.READERS[t.nodeName](t);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var St=Mt,Tt={build:function(t){l.getLogger("AutoConfResponseFactory").trace(["AutoConfResponseFactory::build()"]);var e=null;if(t.response){if(t.rawResponse)e=t.response;else{try{var n=new U({reader:St});"string"==typeof t.response?n.setXMLString(t.response):n.setXMLDoc(t.response),e=n.parse()}catch(e){var i=e.message;return"string"==typeof t.response?i+="\n (raw response service'"+t.response+"')":i+="\n (raw response service'"+t.response.documentElement.innerHTML+"')",void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",i),status:200,type:d.TYPE_SRVERR}))}var r=!0;for(var s in e)e.hasOwnProperty(s)&&(r=!1);if(r)return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EMPTY_2")));if(e.exceptionReport)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:d.TYPE_SRVERR,status:200}))}var o="undefined"!=typeof window?window:{};o.Gp||(o.Gp={}),o.Gp.Config?this.mergeConfig(o.Gp.Config,e,t.layerId):o.Gp.Config=e,t.onSuccess.call(t.scope,o.Gp.Config)}else t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))},mergeConfig:function(t,e,n){if(e&&t){for(var i in e)if(e.hasOwnProperty(i))if("generalOptions"===i)for(var r in e[i].apiKeys)e[i].apiKeys.hasOwnProperty(r)&&!t.generalOptions.apiKeys[r]&&(t.generalOptions.apiKeys[r]=e[i].apiKeys[r]);else if(t[i])for(var s in e[i])e[i].hasOwnProperty(s)&&!t[i][s]&&(t[i][s]=e[i][s]);if(n){var o=[];for(var a in e.layers)e.layers.hasOwnProperty(a)&&o.push(a);t.layers[n]&&(t.layers[n].aggregatedLayers=o)}}}};function Rt(t){if(!(this instanceof Rt))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR","AutoConf"));if(this.CLASSNAME="AutoConf",t||(t={}),t.protocol=t.protocol||"JSONP",w.apply(this,arguments),this.logger=l.getLogger("Gp.Services.AutoConf"),this.logger.trace("[Constructeur AutoConf (options)]"),("string"==typeof this.options.apiKey||this.options.apiKey instanceof String)&&Array.isArray(this.options.apiKey.split(","))&&this.options.apiKey.split(",").length>1&&(this.options.apiKey=this.options.apiKey.split(",")),!this.options.serverUrl&&!this.options.serverUrl){var e=x.AutoConf.url(this.options.apiKey);this.options.layerId?this.options.serverUrl=e.aggregate+this.options.layerId:Array.isArray(this.options.apiKey)&&this.options.apiKey.length>0?this.options.serverUrl=e.apiKeys:this.options.serverUrl=e.apiKey}"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"xml"}Rt.prototype=Object.create(w.prototype,{}),Rt.prototype.constructor=Rt,Rt.prototype.buildRequest=function(t,e){var n="undefined"!=typeof window?window:{};if(n.Gp&&n.Gp.Config&&n.Gp.Config.generalOptions&&n.Gp.Config.layers&&n.Gp.Config.generalOptions.apiKeys[this.options.apiKey]){if(!this.options.layerId)return this.logger.warn("Gp.Config existe déjà pour cette clé"),void this.options.onSuccess.call(this,n.Gp.Config);if(n.Gp.Config.layers[this.options.layerId]&&n.Gp.Config.layers[this.options.layerId].aggregatedLayers)return this.logger.warn("Gp.Config existe déjà pour cette clé et cette couche"),void this.options.onSuccess.call(this,n.Gp.Config)}this.request="",!(-1===this.options.serverUrl.indexOf("http://"))&&this.layerId&&(this.request=p.normalyzeParameters({layerId:this.layerId})),this.request||""===this.request?e.call(this,this.request):t.call(this,new d(c.getMessage("SERVICE_REQUEST_BUILD")))},Rt.prototype.analyzeResponse=function(t,e){if(this.response){var n={layerId:this.options.layerId,response:this.response,rawResponse:this.options.rawResponse,onSuccess:e,onError:t,scope:this};Tt.build(n)}else t.call(this,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))};var At=Rt;function Ct(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur RequestHeader ()]"),!(this instanceof Ct))throw new TypeError("RequestHeader constructor cannot be called as a function.");for(var e in this.options=t||{srsName:"EPSG:4326"},t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}Ct.prototype={requestString:null,template:'<RequestHeader srsName="__SRSNAME__"/>',constructor:Ct,toString:function(){var t=null;return t=(t=this.template).replace(/__SRSNAME__/g,this.options.srsName),this.requestString=t,this.requestString}};var Pt=Ct;function Lt(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur Request ()]"),!(this instanceof Lt))throw new TypeError("Request constructor cannot be called as a function.");for(var e in this.options=t||{maximumResponses:25,methodName:null,version:"1.2"},t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}Lt.prototype={requestString:null,template:'<Request maximumResponses="__MAXRESPONSES__" methodName="__METHODNAME__" requestID="__UUID__" version="__VERSION__">\x3c!-- __REQUESTSERVICE__ --\x3e</Request>',constructor:Lt,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},toString:function(){var t=null;return t=(t=(t=(t=(t=this.template).replace(/__MAXRESPONSES__/g,this.options.maximumResponses)).replace(/__METHODNAME__/g,this.options.methodName)).replace(/__UUID__/g,this.guid())).replace(/__VERSION__/g,this.options.version),this.requestString=t,this.requestString}};var It=Lt;function Nt(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur AbstractService ()]"),!(this instanceof Nt))throw new TypeError("AbstractService constructor cannot be called as a function.");for(var e in this.options=t||{},t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}Nt.prototype={strRequest:null,oRequest:null,oFilter:null,constructor:Nt,addRequest:function(t){this.logger.error("overwritten method !")},addFilter:function(t){this.logger.error("overwritten method !")},toString:function(){this.logger.error("overwritten method !")}};var Dt=Nt;function Ot(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur XLS()]"),!(this instanceof Ot))throw new TypeError("XLS constructor cannot be called as a function.");for(var e in this.options={srsName:"EPSG:4326",maximumResponses:25},t)t.hasOwnProperty(e)&&t[e]&&(this.options[e]=t[e])}Ot.VERSION="1.2",Ot.prototype={requestString:null,namespace:!1,oService:null,constructor:Ot,template:'<?xml version="1.0" encoding="UTF-8"?>\n<XLS version="__VERSION__"\n__NAMESPACE__ \n__SCHEMALOCATION__>\n__REQUESTHEADER__\n__REQUEST__\n</XLS>\n',namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns:xls="http://www.opengis.net/xls"','xmlns:gml="http://www.opengis.net/gml"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"'},setService:function(t){t?t instanceof Dt?this.oService=t:this.logger.error("L'objet n'est pas du type 'LocationUtilityService' ou 'RouteService' !?"):this.logger.trace("L'objet de type Service XSL n'est pas encore defini !?")},getService:function(){return this.oService}},Ot.prototype.addNamespace=function(t,e){for(var n,i,r=t.key,s=!1,o=this.namespaceByDefault().split(" "),a=0;a<o.length;a++){if(o[a].split("=")[0]==="xmlns:"+r){s=!0;break}}return s?(n=/<(\w+[\s>])/g,i="<"+r+":$1",e=e.replace(n,i),n=/<\/(\w+[\s>])/g,i="</"+r+":$1",e=e.replace(n,i),this.logger.trace("namespace",e),e):(this.logger.warn("L'ajout d'un nouvel namespace n'est pas encore implémenté !"),e)},Ot.prototype.build=function(){var t=!!this.getService(),e="";e=(e=(e=(e=this.template).replace(/__VERSION__/g,Ot.VERSION)).replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault);var n=new Pt({srsName:this.options.srsName});e=e.replace(/__REQUESTHEADER__/g,n.toString());var i=new It({maximumResponses:this.options.maximumResponses,version:Ot.VERSION,methodName:t?this.getService().CLASSTYPE:null});if(e=e.replace(/__REQUEST__/g,i.toString()),t&&(e=e.replace(/<!-- __REQUESTSERVICE__ -->/g,this.getService().toString())),e)return this.namespace&&(e=this.addNamespace({key:"xls",url:"http://www.opengis.net/xls"},e)),this.requestString=e,this.logger.trace("traduction tmpl",e),this.requestString;this.logger.warn("traduction tmpl : empty request !?")};var Gt=Ot;function kt(t){if(this.logger=l.getLogger("Address"),this.logger.trace("[Constructeur Address ()]"),!(this instanceof kt))throw new TypeError("Address constructor cannot be called as a function.");if(this.options=t||{location:{},type:["StreetAddress"],filter:{}},!this.options.location||0===Object.keys(this.options.location).length)throw new Error("l'option 'location' n'est pas renseignée !")}kt.prototype={constructor:kt,requestString:null,template:{address:'<Address countryCode="__COUNTRYCODE__">__LOCATION____PLACE____POSTALCODE____ENVELOPE__</Address>',location:{freeFormAddress:"<freeFormAddress>__FREEFORMADDRESSVALUE__</freeFormAddress>",streetAddress:{container:"<StreetAddress>__STREET____BUILDING__</StreetAddress>",building:'<Building number="__BUILDINGVALUE__"/>',street:"<Street>__STREETVALUE__</Street>"}},place:'<Place type="__PLACETYPE__">__PLACEVALUE__</Place>',postalCode:"<PostalCode>__POSTALCODEVALUE__</PostalCode>",envelope:"<gml:Envelope><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>"}},kt.prototype.toString=function(){var t=null;if(t=(t=this.template.address).replace(/__COUNTRYCODE__/g,this.options.type),"string"==typeof this.options.location){var e=this.template.location.freeFormAddress;e=e.replace(/__FREEFORMADDRESSVALUE__/g,this.options.location),t=t.replace(/__LOCATION__/g,e)}else{var n="",i="";this.options.location.number&&(n=(n=this.template.location.streetAddress.building).replace(/__BUILDINGVALUE__/g,this.options.location.number)),this.options.location.street&&(i=(i=this.template.location.streetAddress.street).replace(/__STREETVALUE__/g,this.options.location.street));var r=this.template.location.streetAddress.container;r=(r=r.replace(/__STREET__/g,i)).replace(/__BUILDING__/g,n),t=t.replace(/__LOCATION__/g,r)}var s="";this.options.location.postalCode&&(s=(s=this.template.postalCode).replace(/__POSTALCODEVALUE__/g,this.options.location.postalCode));var o="";if(this.options.filter){var a=this.options.filter.bbox;a&&(o=(o=(o=(o=(o=this.template.envelope).replace(/__LEFT__/g,a.left)).replace(/__BOTTOM__/g,a.bottom)).replace(/__RIGHT__/g,a.right)).replace(/__TOP__/g,a.top))}var l=[],c="";if(this.options.filter){var h=this.options.filter;for(var u in h)"bbox"!==u&&(c=(c=(c=this.template.place).replace(/__PLACETYPE__/g,u)).replace(/__PLACEVALUE__/g,h[u]),l.push(c))}var d="";return this.options.location.city&&(d=(d=(d=this.template.place).replace(/__PLACETYPE__/g,"Municipality")).replace(/__PLACEVALUE__/g,this.options.location.city),l.push(d)),t=(t=(t=t.replace(/__POSTALCODE__/g,s)).replace(/__PLACE__/g,l.join("\n"))).replace(/__ENVELOPE__/g,o),this.requestString=t,this.requestString};var Ut=kt;function Ft(){if(this.logger=l.getLogger("GeocodeFilterExtension"),this.logger.trace("[Constructeur GeocodeFilterExtension ()]"),!(this instanceof Ft))throw new TypeError("GeocodeFilterExtension constructor cannot be called as a function.");this.filters=[]}Ft.prototype={constructor:Ft,addFilterExtensions:function(t){t&&this.filters.push(t)},getNames:function(){var t=[];for(var e in this.filters)t.push(this.filters[e].CLASSNAME);return this.logger.trace(t),t},getFilter:function(t){var e=null;for(var n in this.filters)this.filters[n].CLASSNAME===t&&(e=this.filters[n]);return this.logger.trace(e),e},getFilters:function(){return this.logger.trace(this.filters),this.filters},getAttributs:function(t){var e=[];for(var n in this.filters)this.filters[n].CLASSNAME===t&&(e=this.filters[n].attributesList);return this.logger.trace(e),e},setPlaceAttributs:function(t,e){var n=this.getFilter(t),i=this.getAttributs(t);for(var r in i){var s=i[r];e[s]&&(n.placeAttributes[s]=e[s])}},getPlaceAttributs:function(t){var e={};for(var n in this.filters)this.filters[n].CLASSNAME===t&&(e=this.filters[n].placeAttributes);return this.logger.trace(e),e}};var Bt=Ft;function zt(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur GeocodeRequest ()]"),!(this instanceof zt))throw new TypeError("GeocodeRequest constructor cannot be called as a function.");for(var e in this.options=t||{},t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);this.CLASSNAME="GeocodeRequest"}zt.prototype={strRequest:null,oAddress:null,oFilter:null,template:'<GeocodeRequest returnFreeForm="__RETURNFREEFORM__">__ADDRESS__</GeocodeRequest>',addAddress:function(t){t instanceof Ut&&(this.oAddress=t)},addFilter:function(t){t instanceof Bt&&(this.oFilter=t)},constructor:zt,toString:function(){var t="";if(t=this.template,!this.oAddress){var e={};if(e.location=this.options.location,e.type=this.options.filterOptions.type||["StreetAddress"],e.filter=this.options.filterOptions,delete e.filter.type,this.oFilter)for(var n in e.filter={},e.type){var i=e.type[n],r=this.oFilter.getFilter(i);if(r){for(var s=this.options.filterOptions,o=r.attributesList,a=0;a<o.length;a++){var l=o[a];if(s[l]){var c=r.serviceAttributes[a];r.placeAttributes[c]=s[l],this.logger.trace("Selection du filtre '"+l+"' sur le type '"+i+"'.")}}var h=r.placeAttributes;for(var u in h)h.hasOwnProperty(u)&&(e.filter[u]=h[u])}else this.logger.warn("Le filtre '"+i+"' n'existe pas !?")}if(this.oAddress=new Ut(e),!this.oAddress)throw new Error("La construction de l'adresse n'est pas correctement definie !?")}return t=(t=t.replace(/__ADDRESS__/g,this.oAddress.toString())).replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=t,this.strRequest}};var Vt=zt;function Ht(t){if(this.logger=l.getLogger("Position"),this.logger.trace("[Constructeur Position ()]"),!(this instanceof Ht))throw new TypeError("Position constructor cannot be called as a function.");if(this.options=t||{},!this.options.position)throw new Error("l'option 'position' n'est pas renseignée !")}Ht.prototype={constructor:Ht,requestString:null,template:{position:"<Position>__GMLPOINT____GMLFILTER__</Position>",gml:{point:'<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point>',pos:null,filter:{bbox:'<gml:Envelope xmlns:gml="http://www.opengis.net/gml"><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>',circle:'<gml:CircleByCenterPoint xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos><gml:radius>__RADIUS__</gml:radius></gml:CircleByCenterPoint>',polygon:'<gml:Polygon xmlns:gml="http://www.opengis.net/gml"><gml:exterior><gml:LinearRing><gml:posList>__XY__</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>',multipolygon:null}}}},Ht.prototype.toString=function(){var t=this.template.position,e=this.template.gml.point;e=(e=e.replace(/__X__/g,this.options.position.x)).replace(/__Y__/g,this.options.position.y);var n="";if(this.options.filter){var i=this.options.filter;for(var r in i)switch(r){case"circle":n=(n=(n=(n=this.template.gml.filter[r]).replace(/__X__/g,i[r].x)).replace(/__Y__/g,i[r].y)).replace(/__RADIUS__/g,i[r].radius);break;case"bbox":n=(n=(n=(n=(n=this.template.gml.filter[r]).replace(/__LEFT__/g,i[r].left)).replace(/__BOTTOM__/g,i[r].bottom)).replace(/__RIGHT__/g,i[r].right)).replace(/__TOP__/g,i[r].top);break;case"polygon":n=this.template.gml.filter[r];for(var s="",o=i[r],a=0;a<o.length;a++){var l=o[a];if(Array.isArray(l)){this.logger.error("Holes are not implemented !");break}(l.x&&l.y||0===l.x||0===l.y)&&(s+=l.x+" "+l.y),o.length!==a+1&&(s+=" ")}n=n.replace(/__XY__/g,s);break;case"multipolygon":this.logger.warn("Filter '"+r+"' is not yet implemented !");break;default:this.logger.error("This filter '"+r+"' is not useful !")}}return t=(t=t.replace(/__GMLPOINT__/g,e)).replace(/__GMLFILTER__/g,n),this.requestString=t,this.requestString};var Wt=Ht;function jt(t){if(this.logger=l.getLogger("Preference"),this.logger.trace("[Constructeur Preference ()]"),!(this instanceof jt))throw new TypeError("Preference constructor cannot be called as a function.");this.type=t}jt.prototype={constructor:jt,requestString:null,template:"<ReverseGeocodePreference>__TYPE__</ReverseGeocodePreference>"},jt.prototype.toString=function(){for(var t=[],e="",n=0;n<this.type.length;n++)e=(e=this.template).replace(/__TYPE__/g,this.type[n]),t.push(e);return this.strRequest=t.join("\n"),this.strRequest};var qt=jt;function Xt(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur ReverseGeocodeRequest ()]"),!(this instanceof Xt))throw new TypeError("ReverseGeocodeRequest constructor cannot be called as a function.");for(var e in this.options=t||{},t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);this.CLASSNAME="ReverseGeocodeRequest"}Xt.prototype={strRequest:null,oPosition:null,oPreference:null,constructor:Xt,template:'<ReverseGeocodeRequest returnFreeForm="__RETURNFREEFORM__">__POSITION____PREFERENCE__</ReverseGeocodeRequest>',addPosition:function(t){t instanceof Wt&&(this.oPosition=t)},addPreferences:function(t){t instanceof qt&&(this.oPreference=t)},toString:function(){var t="";if(t=this.template,!this.oPreference&&(this.oPreference=new qt(this.options.filterOptions.type||["StreetAddress"]),!this.oPreference))throw new Error("Les preferences ne sont pas definies !?");if(t=t.replace(/__PREFERENCE__/g,this.oPreference.toString()),!this.oPosition){var e={position:this.options.position,filter:{}};if(this.options.filterOptions&&(e.filter=this.options.filterOptions,delete e.filter.type),this.oPosition=new Wt(e),!this.oPosition)throw new Error("La position et ses filtres ne sont pas definis !?")}return t=(t=t.replace(/__POSITION__/g,this.oPosition.toString())).replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=t,this.strRequest}};var Yt=Xt;function Jt(t){if(this.logger=l.getLogger(),this.logger.trace("[Constructeur LocationUtilityService ()]"),!(this instanceof Jt))throw new TypeError("LocationUtilityService constructor cannot be called as a function.");this.CLASSNAME="LocationUtilityService",this.CLASSTYPE=null,Dt.apply(this,arguments),this.options&&(this.CLASSTYPE=this.options.location?"GeocodeRequest":this.options.position?"ReverseGeocodeRequest":null)}Jt.prototype=Object.create(Dt.prototype,{}),Jt.prototype.constructor=Jt,Jt.prototype.addRequest=function(t){switch(this.CLASSTYPE=t.CLASSNAME,this.CLASSTYPE){case"GeocodeRequest":case"ReverseGeocodeRequest":this.oRequest=t;break;default:throw new Error("Ce n'est pas un objet de type 'LUS Request' !?")}},Jt.prototype.addFilter=function(t){t instanceof Bt&&(this.oFilter=t)},Jt.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("GeocodeRequest"===this.CLASSTYPE){var t={location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new Vt(t),this.oFilter&&this.oRequest.addFilter(this.oFilter)}else if("ReverseGeocodeRequest"===this.CLASSTYPE){var e={position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new Yt(e)}else this.logger.error("impossible de determiner le type de geocodage : Direct ou Inverse !?")}if(!this.oRequest)throw new Error("Type de Geocodage indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest};var Zt=Jt;function Kt(){if(!(this instanceof Kt))throw new TypeError("GeocodeLocation constructor cannot be called as a function.");this.placeAttributes={},this.attributesList=[],this.serviceAttributes=[]}Kt.prototype={constructor:Kt};var Qt=Kt;function $t(){if(!(this instanceof $t))throw new TypeError("StreetAddress constructor cannot be called as a function.");Qt.apply(this,arguments),this.CLASSNAME="StreetAddress",this.attributesList=["bbox","ID","IDTR","quality","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","ID","IDTR","Qualite","Territoire","Commune","Departement","INSEE","Municipality"]}$t.prototype=Object.create(Qt.prototype),$t.prototype.constructor=$t;var te=$t;function ee(){if(!(this instanceof ee))throw new TypeError("PositionOfInterest constructor cannot be called as a function.");Qt.apply(this,arguments),this.CLASSNAME="PositionOfInterest",this.attributesList=["bbox","importance","nature","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","Importance","Nature","Territoire","Commune","Departement","INSEE","Municipality"]}ee.prototype=Object.create(Qt.prototype),ee.prototype.constructor=ee;var ne=ee;function ie(){if(!(this instanceof ie))throw new TypeError("CadastralParcel constructor cannot be called as a function.");Qt.apply(this,arguments),this.CLASSNAME="CadastralParcel",this.attributesList=["absorbedCity","sheet","number","section","commune","department","insee","municipality","origin"],this.serviceAttributes=["CommuneAbsorbee","Feuille","Numero","Section","Commune","Departement","INSEE","Municipality","Type"]}ie.prototype=Object.create(Qt.prototype),ie.prototype.constructor=ie;var re=ie;function se(){if(!(this instanceof se))throw new TypeError("Administratif constructor cannot be called as a function.");Qt.apply(this,arguments),this.CLASSNAME="Administratif",this.attributesList=["bbox","prefecture","inseeRegion","inseeDepartment","municipality"],this.serviceAttributes=["bbox","Prefecture","InseeRegion","InseeDepartement","Municipality"]}se.prototype=Object.create(Qt.prototype),se.prototype.constructor=se;var oe=se,ae={build:function(t){var e=l.getLogger("DirectGeocodeRequestFactory");e.trace(["DirectGeocodeRequestFactory::build()"]);var n=null,i=new Bt;i.addFilterExtensions(new oe),i.addFilterExtensions(new te),i.addFilterExtensions(new ne),i.addFilterExtensions(new re);var r=new Zt({location:t.location,returnFreeForm:t.returnFreeForm,filterOptions:t.filterOptions});r.addFilter(i);var s=new Gt({srsName:t.srs,maximumResponses:t.maximumResponses});(s.namespace=!0,s.setService(r),n=s.build(),"GET"===t.httpMethod)&&(n="qxml="+encodeURIComponent(n).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"));return e.trace(n),n}};function le(){if(!(this instanceof le))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}le.prototype={constructor:le};var ce=le;function he(){if(!(this instanceof he))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position={x:null,y:null},this.matchType=null,this.placeAttributes={},this.type=null}he.prototype={constructor:he};var ue=he;function de(){if(!(this instanceof de))throw new TypeError("DirectGeocodedLocation constructor cannot be called as a function.");ue.apply(this,arguments),this.CLASSNAME="DirectGeocodedLocation",this.accuracy=null}de.prototype=Object.create(ue.prototype),de.prototype.constructor=de;var pe=de,fe={};function me(t,e){if(t.hasChildNodes())for(var n,i,r,s=t.childNodes,o=0;o<s.length;o++){if(1===(n=s[o]).nodeType)if(i=n.localName||n.baseName||n.nodeName,r=n.prefix||fe.DEFAULTPREFIX,fe.READERS[r][i])(0,fe.READERS[r][i])(n,e);else me(n,e)}}function ge(t){var e,n="";return t.hasChildNodes()&&3===(e=t.firstChild).nodeType&&(n=e.nodeValue),n}fe.VERSION="1.2",fe.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},fe.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",fe.DEFAULTPREFIX="xls",fe.READERS={xls:{XLS:function(t){var e=new ce;return function(t){if(t.attributes.length>0){var e=function(t){if(t.attributes.length>0){for(var e={},n=t.attributes,i=0;i<n.length;i++){var r=n[i];e[r.nodeName]=r.nodeValue}return e}}(t);for(var n in e)if(e.hasOwnProperty(n)){if("version"===n&&e.version!==fe.VERSION)return void console.log("[DirectGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===n){if(e[n]!==fe.NAMESPACES[fe.DEFAULTPREFIX])return void console.log("[DirectGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var i=n.split(":")[0],r=n.split(":")[1];if("xmlns"===i&&r&&fe.NAMESPACES[r]&&fe.NAMESPACES[r]!==e[n])return void console.log("[DirectGeocodeResponseReader] geocode response "+n+" namespace is not the expected one");if("schemaLocation"===r&&fe.SCHEMALOCATION!==e[n])return void console.log("[DirectGeocodeResponseReader] geocode response schema location is not the expected one")}}}(t),me(t,e),e},GeocodedAddress:function(t,e){var n=new pe;me(t,n),e&&Array.isArray(e.locations)&&e.locations.push(n)},GeocodeMatchCode:function(t,e){var n=t.getAttribute("accuracy");n&&e&&(e.accuracy=parseFloat(n));var i=t.getAttribute("matchType");i&&e&&(e.matchType=i)},Address:function(t,e){var n=t.getAttribute("countryCode");e&&n&&(e.type=n),me(t,e)},freeFormAddress:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&(e.placeAttributes.freeform=ge(t))},Building:function(t,e){var n=t.getAttribute("number");e&&e.hasOwnProperty("placeAttributes")&&(n?e.placeAttributes.number=n:t.getAttribute("buildingName")?e.placeAttributes.number=t.getAttribute("buildingName"):t.getAttribute("subdivision")&&(e.placeAttributes.number=t.getAttribute("subdivision")))},Street:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&("StreetAddress"===e.type?e.placeAttributes.street=ge(t):"CadastralParcel"===e.type&&(e.placeAttributes.cadastralParcel=ge(t)))},Place:function(t,e){var n=t.getAttribute("type"),i=ge(t);if(e&&e.hasOwnProperty("placeAttributes"))if("Municipality"===n)e.placeAttributes.municipality=i;else if("Bbox"===n){var r=i.split(";");4===r.length&&(e.placeAttributes.bbox={left:parseFloat(r[0]),right:parseFloat(r[2]),top:parseFloat(r[1]),bottom:parseFloat(r[3])})}else"Commune"===n?e.placeAttributes.commune=i:"Departement"===n?e.placeAttributes.department=i:"INSEE"===n?e.placeAttributes.insee=i:"Qualite"===n?e.placeAttributes.quality=i:"Territoire"===n?e.placeAttributes.territory=i:"ID"===n?e.placeAttributes.ID=i:"ID_TR"===n?e.placeAttributes.IDTR=i:"Importance"===n?e.placeAttributes.importance=parseInt(i,10):"Nature"===n?e.placeAttributes.nature=i:"Numero"===n?e.placeAttributes.number=i:"Feuille"===n?e.placeAttributes.sheet=i:"Section"===n?e.placeAttributes.section=i:"CommuneAbsorbee"===n?e.placeAttributes.absorbedCity=i:"Arrondissement"===n?i&&(e.placeAttributes.arrondissement=i):"Type"===n?e.placeAttributes.origin=i:"Prefecture"===n?e.placeAttributes.prefecture=i:"InseeRegion"===n?e.placeAttributes.inseeRegion=i:"InseeDepartment"===n&&(e.placeAttributes.inseeDepartment=i)},PostalCode:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&(e.placeAttributes.postalCode=ge(t))},Error:function(t){var e=t.getAttribute("message"),n=t.getAttribute("errorCode"),i=c.getMessage("SERVICE_RESPONSE_EXCEPTION","("+n+") : "+e);throw new d({message:i,type:d.TYPE_SRVERR})}},gml:{pos:function(t,e){var n=ge(t);e&&n&&(e.position={x:parseFloat(n.split(" ")[0]),y:parseFloat(n.split(" ")[1])})}},ExceptionReport:function(t){var e={};if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)"Exception"===(n=i[r]).nodeName&&(e.exceptionReport=fe.READERS.Exception(n));return e},Exception:function(t){var e={},n=t.getAttribute("exceptionCode");n&&(e.exceptionCode=n);var i=t.firstChild;return i&&3===i.nodeType&&(e.exception=i.nodeValue),e}},fe.read=function(t){if("XLS"===t.nodeName){var e=t.prefix;return e||(e=fe.DEFAULTPREFIX),fe.READERS[e][t.nodeName](t)}if("ExceptionReport"===t.nodeName)return fe.READERS[t.nodeName](t);var n=c.getMessage("SERVICE_RESPONSE_ANALYSE",t.nodeName);throw new d({message:n,type:d.TYPE_UNKERR,status:200})};var ve=fe,ye={build:function(t){var e=null;if(t.response){if(t.rawResponse)e=t.response;else{try{var n=new U({reader:ve});if("string"==typeof t.response?n.setXMLString(t.response):n.setXMLDoc(t.response),!(e=n.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(e){var i=e.message;return"string"==typeof t.response?i+="('"+t.response+"')":i+="('"+t.response.documentElement.innerHTML+"')",void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_ANALYSE",i),type:d.TYPE_UNKERR,status:-1}))}if(e.exceptionReport)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:d.TYPE_SRVERR,status:200}))}t.onSuccess.call(t.scope,e)}else t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EMPTY"),type:d.TYPE_SRVERR,status:-1}))}};function _e(t){if(!(this instanceof _e))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR","Geocode"));if(this.CLASSNAME="Geocode",w.apply(this,arguments),this.logger=l.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]"),!t.location)throw new Error(c.getMessage("PARAM_MISSING","location"));if("object"==typeof t.location&&0===Object.keys(t.location).length)throw new Error(c.getMessage("PARAM_EMPTY","location"));if("string"==typeof t.location&&0===t.location.length)throw new Error(c.getMessage("PARAM_EMPTY","location"));this.options.location=t.location,t.filterOptions&&"object"==typeof t.filterOptions||(this.options.filterOptions=t.filterOptions={type:["StreetAddress"]}),0===Object.keys(t.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var e=Object.keys(t.filterOptions),n=0;n<e.length;n++){var i=e[n],r=["department","number","postalCode","insee","importance","ID","IDTR","absorbedCity","sheet","section","inseeRegion","inseeDepartment"];-1!==r.indexOf(i)&&"string"!=typeof t.filterOptions[i]&&(t.filterOptions[i]=t.filterOptions[i].toString()),t.filterOptions[i]||delete this.options.filterOptions[i]}this.options.filterOptions.type=t.filterOptions.type||["StreetAddress"],this.options.maximumResponses=t.maximumResponses||25,this.options.returnFreeForm=t.returnFreeForm||!1,this.options.srs=t.srs||"EPSG:4326",this.options.outputFormat=this.options.rawResponse?"":"xml"}_e.prototype=Object.create(w.prototype,{}),_e.prototype.constructor=_e,_e.prototype.buildRequest=function(t,e){var n={httpMethod:this.options.httpMethod,location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:this.options.srs,maximumResponses:this.options.maximumResponses};this.request=ae.build(n),this.request?e.call(this,this.request):t.call(this,new d(c.getMessage("SERVICE_REQUEST_BUILD")))},_e.prototype.analyzeResponse=function(t,e){if(this.response){var n={response:this.response,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};ye.build(n)}else t.call(this,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))};var xe=_e,be={build:function(t){var e=l.getLogger("ReverseGeocodeRequestFactory");e.trace(["ReverseGeocodeRequestFactory::build()"]);var n=t||{},i=null,r=new Zt({position:n.position,returnFreeForm:n.returnFreeForm,filterOptions:n.filterOptions}),s=new Gt({srsName:n.srs,maximumResponses:n.maximumResponses});(s.namespace=!0,s.setService(r),i=s.build(),"GET"===n.httpMethod)&&(i="qxml="+encodeURIComponent(i).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"));return e.trace(i),i}};function Me(){if(!(this instanceof Me))throw new TypeError("ReverseGeocodedLocation constructor cannot be called as a function.");ue.apply(this,arguments),this.CLASSNAME="ReverseGeocodedLocation",this.searchCenterDistance=null}Me.prototype=Object.create(ue.prototype),Me.prototype.constructor=Me;var we=Me,Ee={};function Se(t,e){if(t.hasChildNodes())for(var n,i,r,s=t.childNodes,o=0;o<s.length;o++){if(1===(n=s[o]).nodeType)if(i=n.localName||n.baseName||n.nodeName,r=n.prefix||Ee.DEFAULTPREFIX,Ee.READERS[r][i])(0,Ee.READERS[r][i])(n,e);else Se(n,e)}}function Te(t){var e,n="";return t.hasChildNodes()&&3===(e=t.firstChild).nodeType&&(n=e.nodeValue),n}Ee.VERSION="1.2",Ee.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},Ee.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",Ee.DEFAULTPREFIX="xls",Ee.READERS={xls:{XLS:function(t){var e=new ce;return function(t){if(t.attributes.length>0){var e=function(t){if(t.attributes.length>0){for(var e={},n=t.attributes,i=0;i<n.length;i++){var r=n[i];e[r.nodeName]=r.nodeValue}return e}}(t);for(var n in e)if(e.hasOwnProperty(n)){if("version"===n&&e.version!==Ee.VERSION)return void console.log("[ReverseGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===n){if(e[n]!==Ee.NAMESPACES[Ee.DEFAULTPREFIX])return void console.log("[ReverseGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var i=n.split(":")[0],r=n.split(":")[1];if("xmlns"===i&&r&&Ee.NAMESPACES[r]&&Ee.NAMESPACES[r]!==e[n])return void console.log("[ReverseGeocodeResponseReader] geocode response "+n+" namespace is not the expected one");if("schemaLocation"===r&&Ee.SCHEMALOCATION!==e[n])return void console.log("[ReverseGeocodeResponseReader] geocode response schema location is not the expected one")}}}(t),Se(t,e),e},ReverseGeocodedLocation:function(t,e){var n=new we;Se(t,n),e&&Array.isArray(e.locations)&&e.locations.push(n)},Address:function(t,e){var n=t.getAttribute("countryCode");e&&n&&(e.type=n),Se(t,e)},Building:function(t,e){var n=t.getAttribute("number");e&&e.hasOwnProperty("placeAttributes")&&(n?e.placeAttributes.number=n:t.getAttribute("buildingName")?e.placeAttributes.number=t.getAttribute("buildingName"):t.getAttribute("subdivision")&&(e.placeAttributes.number=t.getAttribute("subdivision")))},Street:function(t,e){"StreetAddress"===e.type?e.placeAttributes.street=Te(t):"CadastralParcel"===e.type&&(e.placeAttributes.cadastralParcel=Te(t))},Place:function(t,e){var n=t.getAttribute("type"),i=Te(t);if(e&&e.hasOwnProperty("placeAttributes"))if("Municipality"===n)e.placeAttributes.municipality=i;else if("Bbox"===n){var r=i.split(";");4===r.length&&(e.placeAttributes.bbox={left:parseFloat(r[0]),right:parseFloat(r[2]),top:parseFloat(r[1]),bottom:parseFloat(r[3])})}else"Commune"===n?e.placeAttributes.commune=i:"Departement"===n?e.placeAttributes.department=i:"INSEE"===n?e.placeAttributes.insee=i:"Qualite"===n?e.placeAttributes.quality=i:"Territoire"===n?e.placeAttributes.territory=i:"ID"===n?e.placeAttributes.ID=i:"ID_TR"===n?e.placeAttributes.IDTR=i:"Importance"===n?e.placeAttributes.importance=parseInt(i,10):"Nature"===n?e.placeAttributes.nature=i:"Numero"===n?e.placeAttributes.number=i:"Feuille"===n?e.placeAttributes.sheet=i:"Section"===n?e.placeAttributes.section=i:"CommuneAbsorbee"===n?e.placeAttributes.absorbedCity=i:"Arrondissement"===n?i&&(e.placeAttributes.arrondissement=i):"Type"===n?e.placeAttributes.origin=i:"Prefecture"===n?e.placeAttributes.prefecture=i:"InseeRegion"===n?e.placeAttributes.inseeRegion=i:"InseeDepartment"===n&&(e.placeAttributes.inseeDepartment=i)},PostalCode:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&(e.placeAttributes.postalCode=Te(t))},SearchCentreDistance:function(t,e){e&&(e.searchCenterDistance=parseFloat(t.getAttribute("value")))},Error:function(t){var e=t.getAttribute("message"),n=t.getAttribute("errorCode"),i=c.getMessage("SERVICE_RESPONSE_EXCEPTION","("+n+") : "+e);throw new d({message:i,type:d.TYPE_SRVERR})}},gml:{pos:function(t,e){var n=Te(t);e&&n&&(e.position={x:parseFloat(n.split(" ")[0]),y:parseFloat(n.split(" ")[1])})}},xlsext:{ExtendedGeocodeMatchCode:function(t,e){e&&(e.matchType=Te(t))}},ExceptionReport:function(t){var e={};if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)"Exception"===(n=i[r]).nodeName&&(e.exceptionReport=Ee.READERS.Exception(n));return e},Exception:function(t){var e={},n=t.getAttribute("exceptionCode");n&&(e.exceptionCode=n);var i=t.firstChild;return i&&3===i.nodeType&&(e.exception=i.nodeValue),e}},Ee.read=function(t){if("XLS"===t.nodeName){var e=t.prefix;return e||(e=Ee.DEFAULTPREFIX),Ee.READERS[e][t.nodeName](t)}if("ExceptionReport"===t.nodeName)return Ee.READERS[t.nodeName](t);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var Re=Ee,Ae={build:function(t){var e=null;if(t.response){if(t.rawResponse)e=t.response;else{try{var n=new U({reader:Re});if("string"==typeof t.response?n.setXMLString(t.response):n.setXMLDoc(t.response),!(e=n.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(e){return e.status=200,void t.onError.call(t.scope,e)}if(e.exceptionReport)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:d.TYPE_SRVERR,status:200}));var i,r;if(t.scope&&t.scope.options&&t.scope.options.srs&&"EPSG:4326"!==t.scope.options.srs)if(e.locations)for(var s=0;s<e.locations.length;s++)(i=e.locations[s])&&(r=i.position)&&(i.position={x:r.y,y:r.x})}t.onSuccess.call(t.scope,e)}else t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EMPTY"),type:d.TYPE_SRVERR,status:-1}))}};function Ce(t){if(!(this instanceof Ce))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));if(this.CLASSNAME="ReverseGeocode",w.apply(this,arguments),this.logger=l.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]"),!t.position)throw new Error(c.getMessage("PARAM_MISSING","position"));if(null===t.position.x)throw new Error(c.getMessage("PARAM_MISSING","position.x"));if(null===t.position.y)throw new Error(c.getMessage("PARAM_MISSING","position.y"));this.options.position=t.position,t.filterOptions&&"object"==typeof t.filterOptions||(this.options.filterOptions=t.filterOptions={type:["StreetAddress"]}),0===Object.keys(t.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var e=Object.keys(t.filterOptions),n=0;n<e.length;n++){var i=e[n];t.filterOptions[i]&&0!==Object.keys(t.filterOptions[i]).length||delete this.options.filterOptions[i]}if(this.options.filterOptions.type=t.filterOptions.type||["StreetAddress"],!Array.isArray(this.options.filterOptions.type))throw new Error(c.getMessage("PARAM_TYPE","filterOptions.type"));if(this.options.maximumResponses=t.maximumResponses||25,this.options.returnFreeForm=t.returnFreeForm||!1,this.options.srs=t.srs||"CRS:84",-1===Ce.geoEPSG.indexOf(this.options.srs)){if(this.options.position={x:this.options.position.y,y:this.options.position.x},this.options.filterOptions&&this.options.filterOptions.circle){var r=this.options.filterOptions.circle;this.options.filterOptions.circle={x:r.y,y:r.x,radius:r.radius}}if(this.options.filterOptions&&this.options.filterOptions.polygon){var s=this.options.filterOptions.polygon;for(n=0;n<s.length;n++){var o=s[n];this.options.filterOptions.polygon[n]={x:o.y,y:o.x}}}}this.options.outputFormat=this.options.rawResponse?"":"xml"}Ce.prototype=Object.create(w.prototype,{}),Ce.prototype.constructor=Ce,Ce.prototype.buildRequest=function(t,e){var n={httpMethod:this.options.httpMethod,position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:"EPSG:4326",maximumResponses:this.options.maximumResponses};this.request=be.build(n),this.request?e.call(this,this.request):t.call(this,new d(c.getMessage("SERVICE_REQUEST_BUILD")))},Ce.prototype.analyzeResponse=function(t,e){if(this.response){var n={response:this.response,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};Ae.build(n)}else t.call(this,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))},Ce.geoEPSG=["EPSG:4326"];var Pe=Ce;function Le(){if(!(this instanceof Le))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}Le.prototype={constructor:Le};var Ie=Le;function Ne(){if(!(this instanceof Ne))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}Ne.prototype={constructor:Ne};var De=Ne,Oe={build:function(t){var e=l.getLogger("AutoCompleteResponseFactory");e.trace(["AutoCompleteResponseFactory::build()"]);var n=null;if(t.response){if(t.rawResponse)e.trace("analyze response : raw"),n=t.response;else{var i=null;if(i="string"==typeof t.response?JSON.parse(t.response):t.response){if(i.error)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",i.error.description),status:i.error.code,type:d.TYPE_SRVERR}));if(n=new Ie,!i.results||!Array.isArray(i.results))return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var r=null,s=0;s<i.results.length;s++){var o=i.results[s];r=new De,o&&("StreetAddress"===o.country?(r.street=o.street,r.type="StreetAddress"):"PositionOfInterest"===o.country&&(r.poi=o.street,r.kind=o.kind,r.type="PositionOfInterest"),r.position&&(r.position.x=o.x,r.position.y=o.y),r.commune=o.city,r.fullText=o.fulltext,r.postalCode=o.zipcode,r.classification=o.classification),n.suggestedLocations.push(r)}if(!n.suggestedLocations.length)return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!n)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:d.TYPE_UNKERR,status:-1}));if(n.exceptionReport)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",n.exceptionReport),type:d.TYPE_SRVERR,status:200}))}t.onSuccess.call(t.scope,n)}else t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Ge(t){if(!(this instanceof Ge))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));if(this.CLASSNAME="AutoComplete",w.apply(this,arguments),this.logger=l.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]"),!t.text)throw new Error(c.getMessage("PARAM_MISSING","text"));this.options.text=t.text,t.filterOptions&&"object"==typeof t.filterOptions||(this.options.filterOptions=t.filterOptions={territory:[],type:["StreetAddress"]}),0===Object.keys(t.filterOptions).length&&(this.options.filterOptions={territory:[],type:["StreetAddress"]}),this.options.filterOptions.type=t.filterOptions.type||["StreetAddress"],this.options.filterOptions.territory=t.filterOptions.territory||[],this.options.maximumResponses=t.maximumResponses||10,"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}Ge.prototype=Object.create(w.prototype,{}),Ge.prototype.constructor=Ge,Ge.prototype.buildRequest=function(t,e){var n="";this.options.filterOptions.territory&&(n=this.options.filterOptions.territory.join(";"));var i="";this.options.filterOptions.type&&(i=this.options.filterOptions.type.join(",")),this.request=p.normalyzeParameters({text:encodeURIComponent(this.options.text),type:i,terr:n,maximumResponses:this.options.maximumResponses}),this.request?e.call(this,this.request):t.call(this,new d(c.getMessage("SERVICE_REQUEST_BUILD")))},Ge.prototype.analyzeResponse=function(t,e){if(this.response){var n={response:this.response,rawResponse:this.options.rawResponse,onSuccess:e,onError:t,scope:this};Oe.build(n)}else t.call(this,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))};var ke=Ge;function Ue(t){if(!(this instanceof Ue))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=l.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=t||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}Ue.CLASSNAME="RouteParamREST",Ue.prototype={constructor:Ue,getIntermediates:function(){var t=[];if(0!==this.intermediates.length)for(var e=0;e<this.intermediates.length;e++){var n=this.intermediates[e];t.push(n.x+","+n.y)}return t.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return"m"===this.distanceUnit?"meter":"km"===this.distanceUnit?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var t=[];if(0!==this.constraints.length)for(var e=0;e<this.constraints.length;e++)t.push(JSON.stringify(this.constraints[e]));return t.join("|")}},Ue.prototype.getParams=function(){var t=[];return t.push({k:"resource",v:this.resource}),t.push({k:"start",v:this.start}),t.push({k:"end",v:this.end}),t.push({k:"geometryFormat",v:"geojson"}),this.optimization&&t.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&t.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&t.push({k:"profile",v:this.getProfile()}),this.constraints&&t.push({k:"constraints",v:this.getConstraints()}),this.crs&&t.push({k:"crs",v:this.crs}),this.distanceUnit&&t.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&t.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&t.push({k:"waysAttributes",v:this.getWaysAttributes()}),t};var Fe=Ue;function Be(t){if(this.logger=l.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof Be))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!t)throw new Error(c.getMessage("PARAM_EMPTY","options"));this.settings=t}Be.prototype={requestString:null,constructor:Be,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var t=new Fe(this.settings).getParams(),e="",n=0;n<t.length;n++){var i=t[n];e&&(e+="&"),e+=i.k+"="+i.v}return this.logger.trace(e),this.requestString=e,this.requestString}};var ze=Be,Ve={build:function(t){l.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var e=t||{},n=!(null===t.onError||"function"!=typeof t.onError),i=null,r=new ze(e);if(!r.processRequestString()){if(i="Error process request (rest) !",n)return void t.onError.call(t.scope,new d(i));throw new Error(i)}return r.requestString}};function He(){if(!(this instanceof He))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}He.prototype={constructor:He};var We=He;function je(){if(!(this instanceof je))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}je.prototype={constructor:je};var qe=je,Xe={build:function(t){var e=l.getLogger("RouteResponseFactory");e.trace("RouteResponseFactory::build()");var n=null;if(t.response){if(t.rawResponse)e.trace("analyze response : raw"),n=t.response;else{var i;if(e.trace("analyze response : json"),i="string"==typeof t.response?JSON.parse(t.response):t.response){if(i.message)return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EXCEPTION",i.message)));var r=[],s=[],o=[];if((n=new We).hasOwnProperty("totalTime")&&(n.totalTime=parseFloat(i.duration)),n.hasOwnProperty("totalDistance")&&(n.totalDistance=parseFloat(i.distance)),n.hasOwnProperty("bbox")&&(n.bbox.left=parseFloat(i.bbox[0]),n.bbox.bottom=parseFloat(i.bbox[1]),n.bbox.right=parseFloat(i.bbox[2]),n.bbox.top=parseFloat(i.bbox[3])),n.hasOwnProperty("routeGeometry")&&!t.geometryInInstructions&&(n.routeGeometry=i.geometry),n.hasOwnProperty("routeInstructions")&&t.geometryInInstructions){var a,h=i.portions;if(Array.isArray(h)&&h.length)for(a=0;a<h.length;a++)r.push(h[a]);if(r.length)for(a=0;a<r.length;a++)s.push(r[a].steps);if(s.length)for(a=0;a<s.length;a++)o=o.concat(s[a]);o.forEach((function(t){switch(n.routeInstructions.push(new qe),n.routeInstructions[n.routeInstructions.length-1].duration=t.duration,n.routeInstructions[n.routeInstructions.length-1].distance=t.distance,n.routeInstructions[n.routeInstructions.length-1].code="",n.routeInstructions[n.routeInstructions.length-1].instruction="",n.routeInstructions[n.routeInstructions.length-1].geometry=t.geometry,"Valeur non renseignée"===t.name&&(t.name=""),t.instruction.type){case"turn":n.routeInstructions[n.routeInstructions.length-1].instruction+="Tourner";break;case"new name":n.routeInstructions[n.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":n.routeInstructions[n.routeInstructions.length-1].instruction+="Départ";break;case"arrive":n.routeInstructions[n.routeInstructions.length-1].instruction+="Arrivée";break;case"merge":n.routeInstructions[n.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":case"on ramp":n.routeInstructions[n.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":n.routeInstructions[n.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":n.routeInstructions[n.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":n.routeInstructions[n.routeInstructions.length-1].instruction+="À la fin de la route, prendre";break;case"use lane":n.routeInstructions[n.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":n.routeInstructions[n.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":case"rotary":n.routeInstructions[n.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":n.routeInstructions[n.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":n.routeInstructions[n.routeInstructions.length-1].instruction+="";break;default:n.routeInstructions[n.routeInstructions.length-1].instruction+="?"+t.instruction.type+"?"}if(t.instruction.modifier)switch(t.instruction.modifier){case"uturn":n.routeInstructions[n.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":n.routeInstructions[n.routeInstructions.length-1].instruction+=" complètement à droite";break;case"right":n.routeInstructions[n.routeInstructions.length-1].instruction+=" à droite";break;case"slight right":n.routeInstructions[n.routeInstructions.length-1].instruction+=" légèrement à droite";break;case"straight":n.routeInstructions[n.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":n.routeInstructions[n.routeInstructions.length-1].instruction+=" lègèrement à gauche";break;case"left":n.routeInstructions[n.routeInstructions.length-1].instruction+=" à gauche";break;case"sharp left":n.routeInstructions[n.routeInstructions.length-1].instruction+=" complètement à gauche";break;default:n.routeInstructions[n.routeInstructions.length-1].instruction+=" ?"+t.instruction.modifier+"?"}t.instruction.exit&&(n.routeInstructions[n.routeInstructions.length-1].instruction+=t.instruction.exit+"e sortie"),t.attributes.name&&((t.attributes.name.nom_1_droite||t.attributes.name.toponyme)&&(n.routeInstructions[n.routeInstructions.length-1].instruction+=" sur"),t.attributes.name.nom_1_droite&&(n.routeInstructions[n.routeInstructions.length-1].instruction+=" "+t.attributes.name.nom_1_droite),t.attributes.name.toponyme&&(n.routeInstructions[n.routeInstructions.length-1].instruction+=" "+t.attributes.name.toponyme))}))}}if(!n)return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_ANALYSE","json")));if(n.exceptionReport)return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}t.onSuccess.call(t.scope,n)}else t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Ye(t){if(!(this instanceof Ye))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",w.apply(this,arguments),this.logger=l.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!t.startPoint)throw new Error(c.getMessage("PARAM_MISSING","startPoint"));if(null===t.startPoint.x)throw new Error(c.getMessage("PARAM_MISSING","startPoint.x"));if(null===t.startPoint.y)throw new Error(c.getMessage("PARAM_MISSING","startPoint.y"));if(!t.endPoint)throw new Error(c.getMessage("PARAM_MISSING","endPoint"));if(null===t.endPoint.x)throw new Error(c.getMessage("PARAM_MISSING","endPoint.x"));if(null===t.endPoint.y)throw new Error(c.getMessage("PARAM_MISSING","endPoint.y"));if(t.outputFormat&&"json"!==t.outputFormat&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=t.resource||"bdtopo-osrm",this.options.startPoint=t.startPoint,this.options.endPoint=t.endPoint,this.options.viaPoints=t.viaPoints||[],this.options.routePreference=t.routePreference||"fastest",t.graph?("Voiture"===t.graph&&(this.options.graph="car"),"Pieton"===t.graph&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],t.constraints){if(!Array.isArray(t.constraints))throw new Error(c.getMessage("PARAM_TYPE","constraints"));for(var e=0;e<t.constraints.length;e++)this.options.constraints.push(t.constraints[e])}var n={},i={},r={};if(t.exclusions&&0!==t.exclusions.length){this.logger.warn("options.exclusions is DEPRECATED !!");for(var s=0;s<t.exclusions.length;s++)"string"==typeof t.exclusions[s]&&(t.exclusions[s]=t.exclusions[s].toLowerCase(),"toll"===t.exclusions[s]&&(r.constraintType="banned",r.key="wayType",r.operator="=",r.value="autoroute",this.options.constraints.push(r)),"tunnel"===t.exclusions[s]&&(n.constraintType="banned",n.key="wayType",n.operator="=",n.value="tunnel",this.options.constraints.push(n)),"bridge"===t.exclusions[s]&&(i.constraintType="banned",i.key="wayType",i.operator="=",i.value="pont",this.options.constraints.push(i)))}if(this.options.geometryInInstructions=t.geometryInInstructions||!1,this.options.provideBbox=t.provideBbox||!0,this.options.distanceUnit=t.distanceUnit||"m",this.options.timeUnit=t.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=t.srs||"EPSG:4326",this.options.waysAttributes=t.waysAttributes||[],!this.options.serverUrl){var o=x.Route.url(this.options.apiKey);if(!o)throw new Error("Url by default not found !");this.options.serverUrl=o,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}Ye.prototype=Object.create(w.prototype,{}),Ye.prototype.constructor=Ye,Ye.prototype.buildRequest=function(t,e){var n={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=Ve.build(n),this.request?e.call(this,this.request):t.call(this,new d(c.getMessage("SERVICE_REQUEST_BUILD")))},Ye.prototype.analyzeResponse=function(t,e){if(this.response){var n={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this,geometryInInstructions:this.options.geometryInInstructions};Xe.build(n)}else t.call(this,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))};var Je=Ye;function Ze(t){if(!(this instanceof Ze))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");switch(this.logger=l.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=t||{},this.id=this.options.id,this.location=this.options.position,this.srs=this.options.srs,this.graphName=this.options.graph,this.profileId=this.options.profileId||null,this.profileName=this.options.profileName||null,this.exclusions=this.options.exclusions,this.reverse=this.options.reverse,this.smoothing=this.options.smoothing,this.holes=this.options.holes,this.options.method){case"time":this.method="time",this.time=this.options.time;break;case"distance":this.method="distance",this.distance=this.options.distance;break;default:this.logger.warn("Par defaut, on calcule un isochrone !"),this.method="time"}}Ze.CLASSNAME="ProcessIsoCurveParam",Ze.prototype={constructor:Ze,getLocation:function(){return this.location.x+","+this.location.y},getExclusions:function(){return this.exclusions.join(";")}},Ze.prototype.getParams=function(){var t=[];return t.push({k:"location",v:this.getLocation()}),t.push({k:"smoothing",v:this.smoothing}),t.push({k:"holes",v:this.holes}),t.push({k:"reverse",v:this.reverse}),t.push({k:"method",v:this.method}),this.time&&t.push({k:"time",v:this.time}),this.distance&&t.push({k:"distance",v:this.distance}),t.push({k:"graphName",v:this.graphName}),this.exclusions&&t.push({k:"exclusions",v:this.getExclusions()}),this.srs&&t.push({k:"srs",v:this.srs}),t};var Ke=Ze;function Qe(t){if(this.logger=l.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof Qe))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!t)throw new Error(c.getMessage("PARAM_EMPTY","options"));this.settings=t,this.mode=this.settings.httpMethod||"GET"}Qe.prototype={requestString:null,constructor:Qe,template:{container:'<?xml version="1.0" encoding="UTF-8"?>\n<isochroneRequest>\n__ID__\t<location>\n\t\t<x>__X__</x>\n\t\t<y>__Y__</y>\n\t</location>\n\t<srs>__SRS__</srs>\n\t<graphName>__GRAPHNAME__</graphName>\n__PROFIL____EXCLUSIONS__\t<method>__METHOD__</method>\n__TIME____DISTANCE__\t<reverse>__REVERSE__</reverse>\n\t<smoothing>__SMOOTHING__</smoothing>\n\t<holes>__HOLES__</holes>\n</isochroneRequest>',id:"\t<id>__IDVALUE__</id>\n",profil:"\t<profileId>__PROFILID__</profileId>\n\t<profileName>__PROFILNAME__</profileName>\n",exclusions:{container:"\t<exclusions>\n__EXCLUSIONFEATURE__\n\t</exclusions>\n",feature:"\t\t<exclusion>__EXCLUSIONVALUE__</exclusion>"},time:"\t<time>__TIMEVALUE__</time>\n",distance:"\t<distance>__DISTANCEVALUE__</distance>\n"},processRequestString:function(){var t="",e=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var n=new Ke(this.settings).getParams();for(e=0;e<n.length;e++){var i=n[e];t&&(t+="&"),t+=i.k+"="+i.v}break;case"POST":if(this.logger.trace("Process POST Request"),t=(t=(t=(t=(t=(t=(t=(t=(t=(t=this.template.container).replace(/__ID__/g,"")).replace(/__PROFIL__/g,"")).replace(/__X__/g,this.settings.position.x)).replace(/__Y__/g,this.settings.position.y)).replace(/__GRAPHNAME__/g,this.settings.graph)).replace(/__SRS__/g,this.settings.srs)).replace(/__SMOOTHING__/g,this.settings.smoothing)).replace(/__HOLES__/g,this.settings.holes)).replace(/__REVERSE__/g,this.settings.reverse),this.settings.exclusions){var r=this.template.exclusions.container,s=[];for(e=0;e<this.settings.exclusions.length;e++){var o=this.template.exclusions.feature;o=o.replace(/__EXCLUSIONVALUE__/,this.settings.exclusions[e]),s.push(o)}r=r.replace(/__EXCLUSIONFEATURE__/,s.join("\n")),t=t.replace(/__EXCLUSIONS__/g,r)}if(t=t.replace(/__EXCLUSIONS__/g,""),this.settings.distance){var a=this.template.distance;a=a.replace(/__DISTANCEVALUE__/g,this.settings.distance),t=(t=t.replace(/__DISTANCE__/g,a)).replace(/__METHOD__/g,"distance")}if(t=t.replace(/__DISTANCE__/g,""),this.settings.time){var l=this.template.time;l=l.replace(/__TIMEVALUE__/g,this.settings.time),t=(t=t.replace(/__TIME__/g,l)).replace(/__METHOD__/g,"time")}t=t.replace(/__TIME__/g,"");break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(t),this.requestString=t,this.requestString}};var $e=Qe,tn={toJson:function(t,e,n){var i=l.getLogger(),r=null;try{if(!t)throw new Error("La chaine WKT n'est pas renseignée !");var s,o;if(e||(e=function(t){console.log(t)}),n||(n=function(t){console.log(t)}),s=/(-?\d+\.?[0-9]*)\s(-?\d+\.?[0-9]+)/g,o="[$1,$2]",t=t.replace(s,o),(s=/^(\w+)/).exec(t),"POLYGON"===RegExp.$1?(o='{"type" : "Polygon",',t=t.replace(RegExp.$1,o),s=/(\({2}?)/,o='"coordinates" : [[',t=t.replace(s,o),s=/(\){2}?)/,o="]]}",t=t.replace(s,o),s=/(\()/g,o="[",t=t.replace(s,o),s=/(\))/g,o="]",t=t.replace(s,o)):"LINESTRING"===RegExp.$1&&(o='{"type" : "LineString",',t=t.replace(RegExp.$1,o),s=/(\(\(?)/,o='"coordinates" : [',t=t.replace(s,o),s=/(\)\)?)/,o="]}",t=t.replace(s,o)),i.trace(t),!(r=JSON.parse(t)))throw new Error("Le JSON est vide !");if(!r.type)throw new Error("Le type de geometrie n'est pas connu !");if(!r.coordinates)throw new Error("La liste des points est vide !");e.call(this,r)}catch(t){if("SyntaxError"===t.name)return void n.call(this,"Erreur de parsing JSON !");n.call(this,t)}}};function en(){if(!(this instanceof en))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}en.prototype={constructor:en};var nn=en,rn={};function sn(t){var e,n="";return t.hasChildNodes()&&(e=t.firstChild)&&3===e.nodeType&&(n=e.nodeValue),n}rn.READERS={isochronResult:function(t){var e=new nn;if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)n=i[r],rn.READERS[n.nodeName]&&rn.READERS[n.nodeName](n,e);if("error"===e.status){var s=c.getMessage("SERVICE_RESPONSE_EXCEPTION",e.message);throw new d({message:s,type:d.TYPE_SRVERR})}return e},message:function(t,e){e&&(e.message=sn(t))},status:function(t,e){var n=sn(t);"ERROR"!==n&&"error"!==n||e&&(e.status="error")},id:function(t,e){e&&(e.id=sn(t))},location:function(t,e){var n=sn(t);e&&e.location&&(e.location.x=parseFloat(n.split(",")[0]),e.location.y=parseFloat(n.split(",")[1]))},srs:function(t,e){e&&(e.srs=sn(t))},distance:function(t,e){e&&(e.distance=parseFloat(sn(t)))},time:function(t,e){e&&(e.time=parseFloat(sn(t)))},wktGeometry:function(t,e){if(e){var n=t.innerHTML;e.hasOwnProperty("geometry")&&tn.toJson(n,(function(t){e.geometry=t}),(function(){var t=c.getMessage("PARAM_FORMAT",["wktGeometry"]);throw new Error(t)}))}},serviceResult:function(t){var e={};if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)n=i[r],rn.READERS[n.nodeName]&&rn.READERS[n.nodeName](n,e);return e},ExceptionReport:function(t){var e={};if(t.hasChildNodes())for(var n,i=t.childNodes,r=0;r<i.length;r++)"Exception"===(n=i[r]).nodeName&&(e.exceptionReport=rn.READERS.Exception(n));return e},Exception:function(t){var e={},n=t.getAttribute("exceptionCode");n&&(e.exceptionCode=n);var i=t.firstChild;return i&&3===i.nodeType&&(e.exception=i.nodeValue),e}},rn.read=function(t){var e;if("isochronResult"===t.nodeName||"isochroneResult"===t.nodeName||"IsochroneResult"===t.nodeName)return e=rn.READERS.isochronResult(t);if("ExceptionReport"===t.nodeName)return e=rn.READERS[t.nodeName](t);if(rn.READERS[t.nodeName]){if("error"===(e=rn.READERS[t.nodeName](t)).status){var n=c.getMessage("SERVICE_RESPONSE_EXCEPTION",e.message);throw new d({message:n,type:d.TYPE_SRVERR})}return e}throw new d({message:c.getMessage("SERVICE_RESPONSE_ANALYSE",t.nodeName),type:d.TYPE_UNKERR})};var on=rn,an={build:function(t){var e=l.getLogger("ProcessIsoCurveResponseFactory");e.trace(["ProcessIsoCurveResponseFactory::build()"]);var n=null;if(t.response){if(t.rawResponse)e.trace("analyze response : raw"),n=t.response;else{switch(t.outputFormat){case"xml":e.trace("analyze response : xml");try{var i=new U({reader:on});if("string"==typeof t.response?i.setXMLString(t.response):i.setXMLDoc(t.response),!(n=i.parse()))throw new Error(c.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(e){var r=e.message;return r+="\n (raw response service : '"+t.response+"')",void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",r),status:200,type:d.TYPE_SRVERR}))}break;case"json":e.trace("analyze response : json");var s=null;if(!(s="string"==typeof t.response?JSON.parse(t.response):t.response)||"OK"!==s.status&&"ok"!==s.status){if(s&&("ERROR"===s.status||"error"===s.status)){var o=s.message;return o+="\n (raw response service : '"+s+"')",void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EXCEPTION",o)))}}else{(n=new nn).time=s.time,n.distance=s.distance,n.message=s.message,n.id=s.id,n.srs=s.srs;if(n.hasOwnProperty("geometry")&&(tn.toJson(s.wktGeometry,(function(t){n.geometry=t}),(function(){t.onError.call(t.scope,new d({message:c.getMessage("PARAM_FORMAT","wktGeometry")}))})),!n.geometry))return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_ANALYSE",t.response)));var a=s.location.split(",");n.location&&(n.location.x=a[0],n.location.y=a[1])}break;default:return void t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(n&&n.exceptionReport)return void t.onError.call(t.scope,new d({message:c.getMessage("SERVICE_RESPONSE_EXCEPTION",n.exceptionReport),type:d.TYPE_SRVERR,status:200}))}t.onSuccess.call(t.scope,n)}else t.onError.call(t.scope,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))}};function ln(t){if(!(this instanceof ln))throw new TypeError(c.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",w.apply(this,arguments),this.logger=l.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!t.position)throw new Error(c.getMessage("PARAM_MISSING","position"));if(null===t.position.x)throw new Error(c.getMessage("PARAM_MISSING","position.x"));if(null===t.position.y)throw new Error(c.getMessage("PARAM_MISSING","position.y"));if(!t.time&&!t.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!t.time&&t.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),t.time&&!t.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.exclusions=t.exclusions||null,this.options.graph=t.graph||"Voiture",this.options.reverse=t.reverse||!1,this.options.smoothing=t.smoothing||!1,this.options.holes=t.holes||!1,this.options.srs=t.srs||"EPSG:4326",this.options.outputFormat="string"==typeof t.outputFormat?t.outputFormat.toLowerCase():"json",!this.options.serverUrl){var e=x.ProcessIsoCurve.url(this.options.apiKey),n=e["iso-"+this.options.outputFormat];if(!n)throw new Error("Url by default not found !");this.options.serverUrl=n,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var r=this.options.serverUrl.substring(i+1);if(r&&r.length<5)switch(this.logger.trace("Serveur Extension URL : "+r),r.toLowerCase()){case"json":case"xml":this.options.outputFormat=r.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}ln.prototype=Object.create(w.prototype,{}),ln.prototype.constructor=ln,ln.prototype.buildRequest=function(t,e){try{var n=new $e(this.options);if(!n.processRequestString())throw new Error(c.getMessage("SERVICE_REQUEST_BUILD"));this.request=n.requestString}catch(e){return void t.call(this,new d(e.message))}e.call(this,this.request)},ln.prototype.analyzeResponse=function(t,e){if(this.response){var n={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:e,onError:t,scope:this};an.build(n)}else t.call(this,new d(c.getMessage("SERVICE_RESPONSE_EMPTY")))};var cn=ln,hn={getConfig:function(t){new At(t).call()},getAltitude:function(t){new X(t).call()},geocode:function(t){new xe(t).call()},reverseGeocode:function(t){new Pe(t).call()},autoComplete:function(t){new ke(t).call()},route:function(t){new Je(t).call()},isoCurve:function(t){new cn(t).call()}};const un=b.version,dn=b.date;var pn={};pn.servicesVersion=un,pn.servicesDate=dn,pn.Protocols={},pn.Protocols.XHR=g,pn.Services=hn,pn.Services.DefaultUrl=x,pn.Services.AltiResponse=B,pn.Services.Alti={},pn.Services.Alti.Elevation=V,pn.Services.AutoCompleteResponse=Ie,pn.Services.AutoComplete={},pn.Services.AutoComplete.SuggestedLocation=De,pn.Services.GetConfigResponse=J,pn.Services.Config={},pn.Services.Config.Constraint=K,pn.Services.Config.Format=$,pn.Services.Config.Layer=et,pn.Services.Config.Legend=it,pn.Services.Config.Metadata=st,pn.Services.Config.Originator=at,pn.Services.Config.Service=ct,pn.Services.Config.Style=ut,pn.Services.Config.Territory=pt,pn.Services.Config.Thematic=mt,pn.Services.Config.TileMatrix=_t,pn.Services.Config.TileMatrixLimit=bt,pn.Services.Config.TileMatrixSet=vt,pn.Services.GeocodeResponse=ce,pn.Services.Geocode={},pn.Services.Geocode.GeocodedLocation=ue,pn.Services.Geocode.DirectGeocodedLocation=pe,pn.Services.Geocode.ReverseGeocodedLocation=we,pn.Services.IsoCurveResponse=nn,pn.Services.RouteResponse=We,pn.Services.Route={},pn.Services.Route.RouteInstruction=qe,pn.Error=d,pn.Helper=p;var fn=pn,mn=n(0),gn=o.a.getLogger("GlobeViewExtended");function vn(t,e,n){(!t.style.position||n&&n.position)&&(t.style.position=n&&n.position?n.position:"relative");var i=document.createElement("div");i.style.width="100%",i.style.height="100%",t.appendChild(i),this._viewerDiv=t,this._widgets=[],this._initEventMap(),this._isInitialized=!1,this._globeView=new mn.GlobeView(i,e,n);var r=this;this.listen(vn.EVENTS.GLOBE_INITIALIZED,(function(){r._isInitialized=!0})),this._globeView.addFrameRequester(mn.MAIN_LOOP_EVENTS.BEFORE_RENDER,function(){clearTimeout(this._preRenderTimer),r._preRenderTimer=setTimeout((function(){for(var t=[],e=[],n=0;n<r.getGlobeView().tileLayer.info.displayed.layers.length;++n)r.getGlobeView().tileLayer.info.displayed.layers[n].isColorLayer&&t.push(r.getGlobeView().tileLayer.info.displayed.layers[n].id),r.getGlobeView().tileLayer.info.displayed.layers[n].isElevationLayer&&e.push(r.getGlobeView().tileLayer.info.displayed.layers[n].id);var i=r.getGlobeView().tileLayer.info.displayed.extent;r._globeView.dispatchEvent({type:vn.EVENTS.PRE_RENDER,colorLayersId:t,elevationLayersId:e,extent:i})}),100)}.bind(this)),this._globeView.controls&&this.freezeControl()}vn.prototype._initEventMap=function(){vn.EVENTS||(vn.EVENTS={RANGE_CHANGED:mn.CONTROL_EVENTS.RANGE_CHANGED,CENTER_CHANGED:mn.CONTROL_EVENTS.CAMERA_TARGET_CHANGED,ORIENTATION_CHANGED:mn.CONTROL_EVENTS.ORIENTATION_CHANGED,LAYER_ADDED:mn.GLOBE_VIEW_EVENTS.LAYER_ADDED,LAYER_REMOVED:mn.GLOBE_VIEW_EVENTS.LAYER_REMOVED,LAYERS_ORDER_CHANGED:mn.GLOBE_VIEW_EVENTS.COLOR_LAYERS_ORDER_CHANGED,GLOBE_INITIALIZED:mn.GLOBE_VIEW_EVENTS.GLOBE_INITIALIZED,LAYERS_INITIALIZED:mn.VIEW_EVENTS.LAYERS_INITIALIZED,VIEW_INITIALIZED:"viewinitialized",PRE_RENDER:"prerender",MOUSE_MOVE:"mousemove",AFTER_RENDER:mn.MAIN_LOOP_EVENTS.AFTER_RENDER,OPACITY_PROPERTY_CHANGED:"opacity-property-changed",VISIBLE_PROPERTY_CHANGED:"visible-property-changed",SEQUENCE_PROPERTY_CHANGED:"sequence-property-changed"})},vn.prototype.constructor=vn,vn.prototype.getGlobeView=function(){return this._globeView},vn.prototype.isInitialized=function(){return this._isInitialized},vn.prototype.onCameraMoveStop=function(t){var e=this;this._globeView.addFrameRequester(mn.MAIN_LOOP_EVENTS.AFTER_CAMERA_UPDATE,(function n(){e._globeView.removeFrameRequester(mn.MAIN_LOOP_EVENTS.AFTER_CAMERA_UPDATE,n),t()}))},vn.prototype.freezeControl=function(){this._globeView.controls.enabled=!1,this.onCameraMoveStop(function(){this._globeView.controls.enabled=!0}.bind(this))},vn.prototype.listen=function(t,e){if("function"!=typeof e)return gn.warn("no callback provided for event : "+t),null;var n=this._getEventTarget(t);return n?(t===vn.EVENTS.AFTER_RENDER?n.addFrameRequester(t,e):n.addEventListener(t,e),{target:n,callback:e,type:t}):null},vn.prototype.addLayerListener=function(t,e,n){return"function"!=typeof n?(gn.warn("no callback provided for event : "+e),null):(t.addEventListener(e,n),{target:t,callback:n,type:e})},vn.prototype._getEventTarget=function(t){switch(t){case vn.EVENTS.RANGE_CHANGED:case vn.EVENTS.CENTER_CHANGED:case vn.EVENTS.ORIENTATION_CHANGED:return this.getGlobeView().controls;case vn.EVENTS.LAYER_ADDED:case vn.EVENTS.LAYER_REMOVED:case vn.EVENTS.LAYERS_ORDER_CHANGED:case vn.EVENTS.LAYERS_INITIALIZED:case vn.EVENTS.GLOBE_INITIALIZED:case vn.EVENTS.PRE_RENDER:case vn.EVENTS.AFTER_RENDER:case vn.EVENTS.VIEW_INITIALIZED:return this.getGlobeView();case vn.EVENTS.MOUSE_MOVE:return this._viewerDiv;default:return gn.warn("unhandled event : "+t),null}},vn.prototype.forgetByKey=function(t){t.type===vn.EVENTS.AFTER_RENDER?t.target.removeFrameRequester(t.type,t.callback):t.target.removeEventListener(t.type,t.callback)},vn.prototype.removeLayerListener=function(t,e,n){this.forgetByKey({target:t,callback:n,type:e})},vn.prototype.forget=function(t,e){var n=this._getEventTarget(t);n&&this.forgetByKey({target:n,callback:e,type:t})},vn.prototype.addLayer=function(t){try{var e=this.getGlobeView().addLayer(t)}catch(t){return Promise.reject(t)}return e},vn.prototype.removeLayer=function(t){this.getGlobeView().removeLayer(t)},vn.prototype.setLayerOpacity=function(t,e){var n=this.getColorLayerById(t);n.opacity=e,this.getGlobeView().notifyChange(n)},vn.prototype.setLayerVisibility=function(t,e){var n=this.getColorLayerById(t);n.visible=e,this.getGlobeView().notifyChange(n)},vn.prototype.moveLayerToIndex=function(t,e){mn.ColorLayersOrdering.moveLayerToIndex(this.getGlobeView(),t,e)},vn.prototype.removeEventListener=function(t,e){switch(t){case"mousemove":this._viewerDiv.removeEventListener(t,e);break;case"centerchanged":this.getGlobeView().controls.removeEventListener(t,e);break;default:this.getGlobeView().removeEventListener(t,e)}},vn.prototype.preRenderEventFetchViewExtent=function(t){void 0===t&&(t=!0),this._fetchExtent=t},vn.prototype.preRenderEventFetchColorLayersDisplayed=function(t){void 0===t&&(t=!0),this._fetchVisibleColorLayers=t},vn.prototype.preRenderEventFetchElevationLayersDisplayed=function(t){void 0===t&&(t=!0),this._fetchVisibleElevationLayers=t},vn.prototype.preRenderEventFetchLayersDisplayed=function(t){void 0===t&&(t=!0),this._fetchVisibleColorLayers=t,this._fetchVisibleElevationLayers=t},vn.prototype.getLayerById=function(t){var e=this.getGlobeView().getLayers((function(e){if(e.id===t)return e}))[0];if(e)return e;gn.trace("[GlobeViewExtended]  : no Layer found for the id '"+t+"'")},vn.prototype.getColorLayerById=function(t){var e=this.getGlobeView().getLayers((function(e){if(e.id===t&&e.isColorLayer)return e}))[0];if(e)return e;gn.trace("[GlobeViewExtended]  : no colorLayer found for the id '"+t+"'")},vn.prototype.getColorLayers=function(){return this.getGlobeView().getLayers((function(t){if(t.isColorLayer)return t}))},vn.prototype.getVectorLayers=function(){return this.getGlobeView().getLayers((function(t){if(t.source&&t.source.isFileSource)return t}))},vn.prototype.getElevationLayers=function(){return this.getGlobeView().getLayers((function(t){if(t.isElevationLayer)return t}))},vn.prototype.getExtent=function(){return this.getGlobeView().tileLayer.info.displayed.extent},vn.prototype.addWidget=function(t){t.getTarget()||t.setTarget(this._viewerDiv,t.getPosition()?t.getPosition():"absolute"),t.setGlobe(this),this._widgets.push(t)},vn.prototype.getWidgets=function(){return this._widgets},vn.prototype.removeWidget=function(t){t.setGlobe();for(var e=0;e<this._widgets.length;e++)this._widgets[e]===t&&this._widgets.splice(e,1)},vn.prototype.getTargetElement=function(){return this._viewerDiv},vn.prototype.getScale=function(){return this.getGlobeView().getScale()},vn.prototype.setTilt=function(t){return this.getGlobeView().controls.setTilt(t,!1)},vn.prototype.getTilt=function(){return this.getGlobeView().controls.getTilt()},vn.prototype.setAzimuth=function(t){return this.getGlobeView().controls.setHeading(t,!1)},vn.prototype.getAzimuth=function(){return this.getGlobeView().controls.getHeading()},vn.prototype.getCoordinateFromPixel=function(t,e){return this.getGlobeView().controls.pickGeoPosition({x:t,y:e})},vn.prototype.getCoordinateFromMouseEvent=function(t){var e=this.getGlobeView().eventToViewCoords(t);return this.getGlobeView().controls.pickGeoPosition(e)},vn.prototype.getFeaturesAtMousePosition=function(t){var e=this.getVectorLayers();if(!e)return Promise.resolve([]);var n=this.getCoordinateFromMouseEvent(t);if(!n)return Promise.resolve([]);for(var i=this.getGlobeView().getPixelsToMeters(5),r=this.getGlobeView().getMetersToDegrees(i),s=[],o=0;o<e.length;o++)e[o].visible&&s.push(e[o].source.loadData({},{crs:"EPSG:4326"}));return Promise.all(s).then((function(t){for(var e=[],i=0;i<t.length;i++)e=e.concat(mn.FeaturesUtils.filterFeaturesUnderCoordinate(n,t[i],r));return e}))},vn.prototype.setCameraTargetGeoPosition=function(t){var e=this._transformCoords(t);return this.getGlobeView().controls.lookAtCoordinate(e,!1)},vn.prototype.getCenter=function(){var t=this.getGlobeView().controls.getLookAtCoordinate();return this._fromItownsCoords(t)},vn.prototype.getZoom=function(){return this.getGlobeView().controls.getZoom()},vn.prototype.setZoom=function(t){return this.getGlobeView().controls.setZoom(t,!1)},vn.prototype.pixelsToMeters=function(t){return this.getGlobeView().getPixelsToMeters(t)},vn.prototype.metersToPixels=function(t){return this.getGlobeView().getMetersToPixels(t)},vn.prototype.getRange=function(){return this.getGlobeView().controls.getRange()},vn.prototype.getCameraTargetPosition=function(){return this.getGlobeView().controls.getCameraTargetPosition()},vn.prototype.getLayerEventInfos=function(t){var e=t.type.replace("-property-changed","");return{propertyName:e,previousValue:t.previous[e],newValue:t.new[e]}},vn.prototype.setBackground=function(){this.getGlobeView().mainLoop.gfxEngine.renderer.setClearColor(0,0)},vn.prototype.setCameraPosition=function(t,e){this.getGlobeView().camera.camera3D.position.copy(t).setLength(e)},vn.prototype.lookAt=function(t){this.getGlobeView().camera.camera3D.lookAt(t)},vn.prototype.parseMapboxStyle=function(t){return mn.Fetcher.json(t)},vn.prototype.notifyChange=function(){this.getGlobeView().notifyChange(this.getGlobeView().camera.camera3D)},vn.prototype.resize=function(t,e){this.getGlobeView().mainLoop.gfxEngine.onWindowResize(t,e),this.notifyChange()},vn.prototype._transformCoords=function(t){if(void 0!==t){var e={};if(void 0!==t.zoom&&(e.zoom=t.zoom),void 0!==t.tilt&&(e.tilt=t.tilt),void 0!==t.heading&&(e.heading=t.heading),void 0!==t.longitude&&void 0!==t.latitude){var n=t.altitude||0;e.coord=new mn.Coordinates("EPSG:4326",t.longitude,t.latitude,n)}return e}},vn.prototype._fromItownsCoords=function(t){return{lon:t.x,lat:t.y,alt:t.z}};var yn=vn;function _n(t){return(_n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var xn,bn={detectSupport:function(){var t=!0,e=window.navigator.userAgent.toLowerCase();return-1===e.indexOf("iphone")&&-1===e.indexOf("ipod")&&-1===e.indexOf("ipad")&&-1===e.indexOf("android")&&-1===e.indexOf("mobile")&&-1===e.indexOf("blackberry")&&-1===e.indexOf("tablet")&&-1===e.indexOf("phone")&&-1===e.indexOf("touch")||(t=!1),-1===e.indexOf("msie")&&-1===e.indexOf("trident")||(t=!0),t},assign:function(t,e){for(var n in t=t||{},e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},mergeParams:function(t,e,n){if(t&&e)for(var i in void 0===n&&(n=!0),e)e.hasOwnProperty(i)&&("object"===_n(e[i])?t.hasOwnProperty(i)?this.mergeParams(t[i],e[i],n):t[i]=e[i]:t.hasOwnProperty(i)?n&&(t[i]=e[i]):t[i]=e[i])}},Mn=n(2),wn=function(t){var e=o.a.getLogger("checkrightmanagement");if(t){var n=t.key,i=t.resources||[],r=t.services||[];if(0!==i.length){if(0!==r.length){var s={};if(!n){if(!Mn.a.isConfigLoaded())return void e.warn("WARNING : The 'apiKey' parameter is missing, and the contract key configuration has not been loaded, so impossible to check yours rights !");n=Object.keys(Mn.a.configuration.generalOptions.apiKeys),e.log(n)}if(Mn.a.isConfigLoaded()){for(var a=0;a<i.length;a++)for(var l=i[a],c=0;c<r.length;c++){var h=r[c],u=Mn.a.getServiceParams(l,h,n);u&&0!==Object.keys(u).length?(s[h]||(s[h]=[]),s[h].push(l)):e.warn("WARNING : The contract key configuration has no rights to load this geoportal resource ("+l+") for this service ("+h+") ")}return 0===Object.keys(s).length?void e.warn("WARNING : The contract key configuration has been loaded, and the 'apiKey' parameter has been set, but, there is a problem on the mapping between the contract and the key !"):(s.key=u.key,e.log("right management checked",s),s)}e.warn("WARNING : the contract key configuration has not been loaded, so be carefull !");for(var d={},p=0;p<r.length;p++){var f=r[p];d[f]=[];for(var m=0;m<i.length;m++){var g=i[m];d[f].push(g)}}return d.key=n,e.log("right management not checked",d),d}e.error("WARNING : no parameter 'services' specified !")}else e.error("WARNING : no parameter 'resources' specified !")}else e.error("WARNING : no parameter specified !")},En={generate:(xn=Math.floor(Date.now()),function(){return xn++}),name:function(t){var e=null,n=t.lastIndexOf("-");return e=-1===n?t:t.substring(0,n),e},index:function(t){var e=null,n=this.name(t),i=n.lastIndexOf("_");return-1!==i&&(e=n.substring(i+1)),e},uuid:function(t){var e=null,n=t.lastIndexOf("-");return-1!==n&&(e=parseInt(t.substring(n+1),10)),e}};function Sn(t){return(Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Tn={_addUID:function(t){return this._uid?t+"-"+this._uid:t},_createMainContainerElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPmousePosition"),t.className="GPwidget",t},_createShowMousePositionElement:function(){var t=document.createElement("input");return t.id=this._addUID("GPshowMousePosition"),t.type="checkbox",t},_createShowMousePositionPictoElement:function(t){var e=this,n=document.createElement("label");n.id=this._addUID("GPshowMousePositionPicto"),n.className="GPshowAdvancedToolPicto",n.htmlFor=this._addUID("GPshowMousePosition"),n.title="Afficher les coordonnées du curseur",n.addEventListener("click",(function(n){var i="";document.getElementById(e._addUID("GPshowMousePosition")).checked||t||(i="GPmapCenterVisible"),document.getElementById("GPmapCenter").className=i,e.onShowMousePositionClick(n)}));var i=document.createElement("span");return i.id=this._addUID("GPshowMousePositionOpen"),i.className="GPshowAdvancedToolOpen",n.appendChild(i),n},_createMousePositionPanelElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPmousePositionPanel"),t.className="GPpanel",t},_createMapCenter:function(){var t=document.createElement("div");return t.id="GPmapCenter",t.className="",t},_createMousePositionPanelHeaderElement:function(){var t=document.createElement("div");t.className="GPpanelHeader";var e=document.createElement("div");e.className="GPpanelTitle",e.innerHTML="Coordonnées",t.appendChild(e);var n=document.createElement("div");n.id="GPmousePositionPanelClose",n.className="GPpanelClose",n.title="Fermer le panneau";var i=this;return n.addEventListener?n.addEventListener("click",(function(){document.getElementById(i._addUID("GPshowMousePositionPicto")).click()}),!1):n.attachEvent&&n.attachEvent("onclick",(function(){document.getElementById(i._addUID("GPshowMousePositionPicto")).click()})),t.appendChild(n),t},_createMousePositionPanelBasicElement:function(t,e,n,i){t=void 0===t||t,e=void 0===e||e,n=void 0!==n&&n;var r=document.createElement("div");return r.id=this._addUID("GPmousePositionBasicPanel"),r.appendChild(this._createMousePositionPanelBasicCoordinateElement(e,n,i)),r.appendChild(this._createMousePositionPanelEditToolsElement(n)),r.appendChild(this._createMousePositionPanelBasicAltitudeElement(t)),r},_createCoordinateElement:function(t,e){var n=this;if(-1===["Lon","Lat"].indexOf(t))return[];var i=[],r=document.createElement("input");r.id=this._addUID("GPmousePosition"+t),r.title=!0===e?"Cliquer pour saisir des coordonnées":"",r.readOnly=!0,e&&(r.addEventListener("click",(function(){n.onMousePositionEditModeClick(!0)})),r.addEventListener("change",(function(e){this.classList.remove("error"),n.validateExtentCoordinate(t,this.value,e)?this.classList.remove("error"):this.classList.add("error")}))),i.push(r);var s=document.createElement("span");return s.className="GPmousePositionUnits",i.push(s),i},_createDMSCoordinateElement:function(t,e){if(-1===["Lon","Lat"].indexOf(t))return[];var n=this,i=[],r=document.createElement("input");r.id=this._addUID("GPmousePosition"+t+"Degrees"),r.className="GPSexagesimal",r.setAttribute("name","degrees"),r.title=!0===e?"Cliquer pour saisir des coordonnées":"",r.readOnly=!0,r.dataset.min=0,r.dataset.max="Lon"===t?180:90,e&&(r.addEventListener("click",(function(){n.onMousePositionEditModeClick(!0)})),r.addEventListener("change",(function(){this.classList.remove("error"),n._checkDMSDegrees(t,this)?this.classList.remove("error"):this.classList.add("error")}))),i.push(r);var s=document.createElement("span");s.className="GPmousePositionSexagesimalLabel",s.innerHTML="°",i.push(s);var o=document.createElement("input");o.id=this._addUID("GPmousePosition"+t+"Minutes"),o.className="GPSexagesimal",o.setAttribute("name","minutes"),o.title=!0===e?"Cliquer pour saisir des coordonnées":"",o.readOnly=!0,o.dataset.min=0,o.dataset.max=59,e&&(o.addEventListener("click",(function(){n.onMousePositionEditModeClick(!0)})),o.addEventListener("change",(function(){this.classList.remove("error"),n._checkDMSElement(this)?this.classList.remove("error"):this.classList.add("error")}))),i.push(o);var a=document.createElement("span");a.className="GPmousePositionSexagesimalLabel",a.innerHTML="'",i.push(a);var l=document.createElement("input");l.id=this._addUID("GPmousePosition"+t+"Seconds"),l.className="GPSexagesimalsec",l.setAttribute("name","seconds"),l.title=!0===e?"Cliquer pour saisir des coordonnées":"",l.readOnly=!0,l.dataset.min=0,l.dataset.max=59,e&&(l.addEventListener("click",(function(){n.onMousePositionEditModeClick(!0)})),l.addEventListener("change",(function(){this.classList.remove("error"),n._checkDMSElement(this,!0)?this.classList.remove("error"):this.classList.add("error")}))),i.push(l);var c=document.createElement("span");c.className="GPmousePositionSexagesimalLabel",c.innerHTML="''",i.push(c);var h=document.createElement("select");h.id=this._addUID("GPmousePosition"+t+"Direction"),h.className="GPmousePositionDirection",h.setAttribute("name","direction"),h.disabled=!0;var u=document.createElement("option");u.value="Lon"===t?"E":"N",u.innerHTML="Lon"===t?"E":"N",h.appendChild(u);var d=document.createElement("option");return d.value="Lon"===t?"O":"S",d.innerHTML="Lon"===t?"O":"S",h.appendChild(d),i.push(h),i},_createMousePositionPanelBasicCoordinateElement:function(t,e,n){var i=document.createElement("div");i.id=this._addUID("GPmousePositionCoordinate"),i.style.display=t?"block":"none";var r=document.createElement("div"),s=document.createElement("span");s.className="GPmousePositionLabel",s.id=this._addUID("GPmousePositionLatLabel"),s.innerHTML="Latitude : ",r.appendChild(s);var o,a=document.createElement("span");a.id=this._addUID("GPmousePositionLatCoordinate"),o="DMS"===n?this._createDMSCoordinateElement("Lat",e):this._createCoordinateElement("Lat",e);for(var l=0;l<o.length;l++)a.appendChild(o[l]);r.appendChild(a),i.appendChild(r);var c=document.createElement("div"),h=document.createElement("span");h.className="GPmousePositionLabel",h.id=this._addUID("GPmousePositionLonLabel"),h.innerHTML="Longitude : ",c.appendChild(h);var u,d=document.createElement("span");d.id=this._addUID("GPmousePositionLonCoordinate"),u="DMS"===n?this._createDMSCoordinateElement("Lon",e):this._createCoordinateElement("Lon",e);for(var p=0;p<u.length;p++)d.appendChild(u[p]);return c.appendChild(d),i.appendChild(c),i},_createMousePositionPanelBasicAltitudeElement:function(t){var e=document.createElement("div");e.id=this._addUID("GPmousePositionAltitude"),e.style.display=t?"block":"none";var n=document.createElement("span");n.className="GPmousePositionLabel",n.innerHTML="Altitude : ",e.appendChild(n);var i=document.createElement("span");i.className="GPmousePositionCoords",i.id=this._addUID("GPmousePositionAlt"),i.innerHTML="...",e.appendChild(i);var r=document.createElement("span");return r.className="GPmousePositionAltitudeUnits",r.innerHTML="m",e.appendChild(r),e},_createMousePositionPanelEditToolsElement:function(t){var e=this,n=document.createElement("div");n.className="GPmousePositionPanelEditTools",n.id=this._addUID("GPmousePositionPanelEditTools"),t||(n.style.display="none");var i=document.createElement("span");i.className="GPmousePositionEditTool",i.id=this._addUID("GPmousePositionLocate"),i.title=!0===t?"Cliquer pour saisir des coordonnées":"",t&&i.addEventListener("click",(function(){e.onMousePositionEditModeLocateClick()})),n.appendChild(i);var r=document.createElement("span");return r.className="GPmousePositionEditTool",r.id=this._addUID("GPmousePositionCloseEdit"),r.title="Quitter la saisie des coordonnées",r.style.display="none",t&&r.addEventListener("click",(function(){e.onMousePositionEditModeClick(!1)})),n.appendChild(r),n},_createShowMousePositionSettingsElement:function(t){var e=[],n=this,i=document.createElement("input");i.type="checkbox",i.id=this._addUID("GPshowMousePositionSettings");var r=document.createElement("label");return r.id=this._addUID("GPshowMousePositionSettingsPicto"),r.htmlFor=this._addUID("GPshowMousePositionSettings"),r.title="Réglages",r.className="GPshowMoreOptionsImage GPshowMoreOptions GPshowMousePositionSettingsPicto",r.style.display=t?"block":"none",r.addEventListener?r.addEventListener("click",(function(t){"function"==typeof n.onShowMousePositionSettingsClick&&n.onShowMousePositionSettingsClick(t)}),!1):r.attachEvent&&r.attachEvent("onclick",(function(t){"function"==typeof n.onShowMousePositionSettingsClick&&n.onShowMousePositionSettingsClick(t)})),e.push(i),e.push(r),e},_createMousePositionSettingsElement:function(t){var e=document.createElement("div");e.id=this._addUID("GPmousePositionSettings"),e.style.display=void 0===t||t?"block":"none";var n=document.createElement("span");return n.className="GPmousePositionSettingsLabel",n.innerHTML="Système de référence",e.appendChild(n),e},_createMousePositionSettingsSystemsElement:function(t){var e=this,n=document.createElement("select");n.id=this._addUID("GPmousePositionProjectionSystem"),n.className="GPinputSelect GPmousePositionSettingsSelect",n.addEventListener("change",(function(t){e.onMousePositionProjectionSystemChange(t)})),n.addEventListener("mouseover",(function(t){"OPTION"!==t.target.nodeName&&e.onMousePositionProjectionSystemMouseOver(t)}));for(var i=0;i<t.length;i++){var r=t[i],s=document.createElement("option");s.value=r.code,s.text=r.label||i,n.appendChild(s)}return n},_createMousePositionSettingsUnitsElement:function(t){var e=this,n=document.createElement("select");n.id=this._addUID("GPmousePositionProjectionUnits"),n.className="GPinputSelect GPmousePositionSettingsSelect",n.addEventListener("change",(function(t){e.onMousePositionProjectionUnitsChange(t)}));for(var i=0;i<t.length;i++){var r=t[i],s=document.createElement("option");s.value=r.code?r.code:i,s.text=r.label||i,n.appendChild(s)}return n},_resetLabelElements:function(t){document.getElementById(this._addUID("GPmousePositionLatLabel")).innerHTML="Geographical"===t?"Latitude :":"X :",document.getElementById(this._addUID("GPmousePositionLonLabel")).innerHTML="Geographical"===t?"Longitude :":"Y :"},_resetUnitElements:function(t){var e="";"M"!==t&&"KM"!==t||(e=t.toLowerCase());for(var n=document.getElementsByClassName("GPmousePositionUnits"),i=0;i<n.length;i++)n[i].innerHTML=e},_resetCoordinateElements:function(t,e,n){for(var i,r=document.getElementById(this._addUID("GPmousePositionLatCoordinate"));r.firstChild;)r.removeChild(r.firstChild);i="DMS"===n?this._createDMSCoordinateElement("Lat",t):this._createCoordinateElement("Lat",t);for(var s=0;s<i.length;s++)r.appendChild(i[s]);for(var o,a=document.getElementById(this._addUID("GPmousePositionLonCoordinate"));a.firstChild;)a.removeChild(a.firstChild);o="DMS"===n?this._createDMSCoordinateElement("Lon",t):this._createCoordinateElement("Lon",t);for(var l=0;l<o.length;l++)a.appendChild(o[l])},_setEditMode:function(t){document.getElementById(this._addUID("GPmousePositionLocate")).title=t?"Aller à la position ...":"Cliquer pour saisir des coordonnées",document.getElementById(this._addUID("GPmousePositionCloseEdit")).style.display=t?"inline-block":"none";for(var e="div[id^="+this._addUID("GPmousePositionCoordinate")+"]",n=document.querySelectorAll(e+" input"),i=0;i<n.length;i++)n[i].readOnly=!t,t&&(n[i].value="",n[i].classList.remove("error"));for(var r=document.querySelectorAll(e+" select"),s=0;s<r.length;s++)r[s].disabled=!t},_checkDMSElement:function(t,e){var n=void 0!==e,i=t.value;if(n&&(i=i.replace(",",".")),isNaN(i))return!1;var r=parseFloat(i);if(!n&&(0|r)!==r)return!1;var s=Number(t.dataset.min),o=Number(t.dataset.max);return r>=s&&r<=o},_checkDMSDegrees:function(t,e){if(isNaN(e.value))return!1;var n=parseFloat(e.value);if((0|n)!==n)return!1;var i=Number(e.dataset.min),r=Number(e.dataset.max);if(n<i||n>r)return!1;var s=document.getElementById(this._addUID("GPmousePosition"+t+"Minutes")),o=document.getElementById(this._addUID("GPmousePosition"+t+"Seconds"));return n>=r?(s.dataset.max=0,o.dataset.max=0):(s.dataset.max=59,o.dataset.max=59.9999),!0},GPdisplayCoords:function(t){if(t){var e=document.getElementById(this._addUID("GPmousePositionLonLabel")),n=document.getElementById(this._addUID("GPmousePositionLatLabel"));if(t.x||t.y?(n.innerHTML="X : ",e.innerHTML="Y : "):t.e||t.n?(n.innerHTML="E : ",e.innerHTML="N : "):(n.innerHTML="Latitude : ",e.innerHTML="Longitude : "),"object"===Sn(t.lat)&&"object"===Sn(t.lng)){var i={lng:"Lon",lat:"Lat"},r=["Degrees","Minutes","Seconds"];for(var s in i)for(var o=0;o<r.length;++o){var a="GPmousePosition"+i[s]+r[o],l=document.getElementById(this._addUID(a)),c=r[o].charAt(0).toLowerCase();l.value=t[s][c]}document.getElementById(this._addUID("GPmousePositionLonDirection")).value=t.lng.direction,document.getElementById(this._addUID("GPmousePositionLatDirection")).value=t.lat.direction}else{var h=document.getElementById(this._addUID("GPmousePositionLat")),u=document.getElementById(this._addUID("GPmousePositionLon"));h.value=t.x||t.lat||t.e||"0",u.value=t.y||t.lng||t.lon||t.n||"0";for(var d=void 0===t.unit?"":t.unit,p=document.getElementsByClassName("GPmousePositionUnits"),f=0;f<p.length;++f)p[f].innerHTML=d}}},GPdisplayElevation:function(t,e,n,i){var r,s=this;e||(e=500),clearTimeout(r),document.getElementById(this._addUID("GPmousePositionAlt")).innerHTML="...",null==n&&(n=-99999),null==i&&(i=99980);var o=n+i,a=n-i;t&&document.getElementById(this._addUID("GPmousePositionAltitude"))&&(r=setTimeout((function(){s.onRequestAltitude(t,(function(t){a<t&&t<o?s.GPresetElevation():document.getElementById(s._addUID("GPmousePositionAlt")).innerHTML=t}))}),e))},GPresetElevation:function(){document.getElementById(this._addUID("GPmousePositionAltitude"))&&(document.getElementById(this._addUID("GPmousePositionAlt")).innerHTML="---")}};class Rn{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const An=[];for(let t=0;t<256;t++)An[t]=(t<16?"0":"")+t.toString(16);const Cn=Math.PI/180,Pn=180/Math.PI;function Ln(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(An[255&t]+An[t>>8&255]+An[t>>16&255]+An[t>>24&255]+"-"+An[255&e]+An[e>>8&255]+"-"+An[e>>16&15|64]+An[e>>24&255]+"-"+An[63&n|128]+An[n>>8&255]+"-"+An[n>>16&255]+An[n>>24&255]+An[255&i]+An[i>>8&255]+An[i>>16&255]+An[i>>24&255]).toUpperCase()}function In(t,e,n){return Math.max(e,Math.min(n,t))}function Nn(t,e){return(t%e+e)%e}function Dn(t,e,n){return(1-n)*t+n*e}function On(t){return 0==(t&t-1)&&0!==t}function Gn(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}class kn{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}kn.prototype.isVector2=!0;class Un{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=r,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],_=i[7],x=i[2],b=i[5],M=i[8];return r[0]=s*f+o*v+a*x,r[3]=s*m+o*y+a*b,r[6]=s*g+o*_+a*M,r[1]=l*f+c*v+h*x,r[4]=l*m+c*y+h*b,r[7]=l*g+c*_+h*M,r[2]=u*f+d*v+p*x,r[5]=u*m+d*y+p*b,r[8]=u*g+d*_+p*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*r*c+n*o*a+i*r*l-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,p=e*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(i*l-c*n)*f,t[2]=(o*n-i*s)*f,t[3]=u*f,t[4]=(c*e-i*a)*f,t[5]=(i*r-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-i*l,i*a,-i*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],s=i[3],o=i[6],a=i[1],l=i[4],c=i[7];return i[0]=e*r+n*a,i[3]=e*s+n*l,i[6]=e*o+n*c,i[1]=-n*r+e*a,i[4]=-n*s+e*l,i[7]=-n*o+e*c,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Fn(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}Un.prototype.isMatrix3=!0;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Bn(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function zn(t,e=0){let n=3735928559^e,i=1103547991^e;for(let e,r=0;r<t.length;r++)e=t.charCodeAt(r),n=Math.imul(n^e,2654435761),i=Math.imul(i^e,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)}let Vn;class Hn{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Vn&&(Vn=Bn("canvas")),Vn.width=t.width,Vn.height=t.height;const n=Vn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Vn}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let Wn=0;class jn extends Rn{constructor(t=jn.DEFAULT_IMAGE,e=jn.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,o=1023,a=1009,l=1,c=3e3){super(),Object.defineProperty(this,"id",{value:Wn++}),this.uuid=Ln(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new kn(0,0),this.repeat=new kn(1,1),this.center=new kn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Un,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Ln()),!e&&void 0===t.images[i.uuid]){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(qn(i[t].image)):e.push(qn(i[t]))}else e=qn(i);t.images[i.uuid]={uuid:i.uuid,url:e}}n.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function qn(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Hn.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}jn.DEFAULT_IMAGE=void 0,jn.DEFAULT_MAPPING=300,jn.prototype.isTexture=!0;class Xn{constructor(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(o+h+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(o+1)/2,s=(h+1)/2,m=(f+1)/2,g=(a+c)/4,v=(l+d)/4,y=(u+p)/4;return t>s&&t>m?t<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=g/n,r=v/n):s>m?s<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=g/i,r=y/i):m<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(m),n=v/r,i=y/r),this.set(n,i,r,e),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((o+h+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Xn.prototype.isVector4=!0;class Yn extends Rn{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Xn(0,0,t,e),this.scissorTest=!1,this.viewport=new Xn(0,0,t,e),this.texture=new jn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Yn.prototype.isWebGLRenderTarget=!0;(class extends Yn{constructor(t,e,n){super(t,e);const i=this.texture;this.texture=[];for(let t=0;t<n;t++)this.texture[t]=i.clone()}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=t,this.texture[i].image.height=e,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}).prototype.isWebGLMultipleRenderTargets=!0;class Jn extends Yn{constructor(t,e,n={}){super(t,e,n),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===n.ignoreDepth||n.ignoreDepth,this.useRenderToTexture=void 0!==n.useRenderToTexture&&n.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(t){return super.copy.call(this,t),this.samples=t.samples,this.useRenderToTexture=t.useRenderToTexture,this.useRenderbuffer=t.useRenderbuffer,this}}Jn.prototype.isWebGLMultisampleRenderTarget=!0;class Zn{constructor(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}static slerp(t,e,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,i)}static slerpFlat(t,e,n,i,r,s,o){let a=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==u||l!==d||c!==p){let t=1-o;const e=a*u+l*d+c*p+h*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=t,l*=t,c*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,i,r,s){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+c*h+a*d-l*u,t[e+1]=a*p+c*u+l*h-o*d,t[e+2]=l*p+c*d+o*u-a*h,t[e+3]=c*p-o*h-a*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(i/2),h=o(r/2),u=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],h=e[10],u=n+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>o&&n>h){const t=2*Math.sqrt(1+n-o-h);this._w=(c-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-n-h);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+h-n-o);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(In(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+i*l-r*a,this._y=i*c+s*a+r*o-n*l,this._z=r*c+s*l+n*a-i*o,this._w=s*c-n*o-i*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Zn.prototype.isQuaternion=!0;class Kn{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion($n.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion($n.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*i-o*n,c=a*n+o*e-r*i,h=a*i+r*n-s*e,u=-r*e-s*n-o*i;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Qn.copy(this).projectOnVector(t),this.sub(Qn)}reflect(t){return this.sub(Qn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(In(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Kn.prototype.isVector3=!0;const Qn=new Kn,$n=new Zn;class ti{constructor(t=new Kn(1/0,1/0,1/0),e=new Kn(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],h=t[a+2];l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),h=t.getZ(a);l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=ni.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),ii.copy(e.boundingBox),ii.applyMatrix4(t.matrixWorld),this.union(ii));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ni),ni.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(hi),ui.subVectors(this.max,hi),ri.subVectors(t.a,hi),si.subVectors(t.b,hi),oi.subVectors(t.c,hi),ai.subVectors(si,ri),li.subVectors(oi,si),ci.subVectors(ri,oi);let e=[0,-ai.z,ai.y,0,-li.z,li.y,0,-ci.z,ci.y,ai.z,0,-ai.x,li.z,0,-li.x,ci.z,0,-ci.x,-ai.y,ai.x,0,-li.y,li.x,0,-ci.y,ci.x,0];return!!fi(e,ri,si,oi,ui)&&(e=[1,0,0,0,1,0,0,0,1],!!fi(e,ri,si,oi,ui)&&(di.crossVectors(ai,li),e=[di.x,di.y,di.z],fi(e,ri,si,oi,ui)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ni.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(ni).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(ei[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ei[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ei[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ei[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ei[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ei[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ei[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ei[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ei)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}ti.prototype.isBox3=!0;const ei=[new Kn,new Kn,new Kn,new Kn,new Kn,new Kn,new Kn,new Kn],ni=new Kn,ii=new ti,ri=new Kn,si=new Kn,oi=new Kn,ai=new Kn,li=new Kn,ci=new Kn,hi=new Kn,ui=new Kn,di=new Kn,pi=new Kn;function fi(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){pi.fromArray(t,s);const o=r.x*Math.abs(pi.x)+r.y*Math.abs(pi.y)+r.z*Math.abs(pi.z),a=e.dot(pi),l=n.dot(pi),c=i.dot(pi);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const mi=new ti,gi=new Kn,vi=new Kn,yi=new Kn;class _i{constructor(t=new Kn,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):mi.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){yi.subVectors(t,this.center);const e=yi.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(yi.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return vi.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(gi.copy(t.center).add(vi)),this.expandByPoint(gi.copy(t.center).sub(vi)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const xi=new Kn,bi=new Kn,Mi=new Kn,wi=new Kn,Ei=new Kn,Si=new Kn,Ti=new Kn;class Ri{constructor(t=new Kn,e=new Kn(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,xi)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=xi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(xi.copy(this.direction).multiplyScalar(e).add(this.origin),xi.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){bi.copy(t).add(e).multiplyScalar(.5),Mi.copy(e).sub(t).normalize(),wi.copy(this.origin).sub(bi);const r=.5*t.distanceTo(e),s=-this.direction.dot(Mi),o=wi.dot(this.direction),a=-wi.dot(Mi),l=wi.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*a-o,u=s*o-a,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(Mi).multiplyScalar(u).add(bi),d}intersectSphere(t,e){xi.subVectors(t.center,this.origin);const n=xi.dot(this.direction),i=xi.dot(xi)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),n>s||r>i?null:((r>n||n!=n)&&(n=r),(s<i||i!=i)&&(i=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,xi)}intersectTriangle(t,e,n,i,r){Ei.subVectors(e,t),Si.subVectors(n,t),Ti.crossVectors(Ei,Si);let s,o=this.direction.dot(Ti);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}wi.subVectors(this.origin,t);const a=s*this.direction.dot(Si.crossVectors(wi,Si));if(a<0)return null;const l=s*this.direction.dot(Ei.cross(wi));if(l<0)return null;if(a+l>o)return null;const c=-s*wi.dot(Ti);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ai{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ai).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Ci.setFromMatrixColumn(t,0).length(),r=1/Ci.setFromMatrixColumn(t,1).length(),s=1/Ci.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,n=s*h,i=o*c,r=o*h;e[0]=a*c,e[4]=-a*h,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*h,i=l*c,r=l*h;e[0]=t+r*o,e[4]=i*o-n,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*h,i=l*c,r=l*h;e[0]=t-r*o,e[4]=-s*h,e[8]=i+n*o,e[1]=n+i*o,e[5]=s*c,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*h,i=o*c,r=o*h;e[0]=a*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=a*h,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=n*h-i,e[2]=i*h-n,e[6]=o*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Li,t,Ii)}lookAt(t,e,n){const i=this.elements;return Oi.subVectors(t,e),0===Oi.lengthSq()&&(Oi.z=1),Oi.normalize(),Ni.crossVectors(n,Oi),0===Ni.lengthSq()&&(1===Math.abs(n.z)?Oi.x+=1e-4:Oi.z+=1e-4,Oi.normalize(),Ni.crossVectors(n,Oi)),Ni.normalize(),Di.crossVectors(Oi,Ni),i[0]=Ni.x,i[4]=Di.x,i[8]=Oi.x,i[1]=Ni.y,i[5]=Di.y,i[9]=Oi.y,i[2]=Ni.z,i[6]=Di.z,i[10]=Oi.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=i[0],M=i[4],w=i[8],E=i[12],S=i[1],T=i[5],R=i[9],A=i[13],C=i[2],P=i[6],L=i[10],I=i[14],N=i[3],D=i[7],O=i[11],G=i[15];return r[0]=s*b+o*S+a*C+l*N,r[4]=s*M+o*T+a*P+l*D,r[8]=s*w+o*R+a*L+l*O,r[12]=s*E+o*A+a*I+l*G,r[1]=c*b+h*S+u*C+d*N,r[5]=c*M+h*T+u*P+d*D,r[9]=c*w+h*R+u*L+d*O,r[13]=c*E+h*A+u*I+d*G,r[2]=p*b+f*S+m*C+g*N,r[6]=p*M+f*T+m*P+g*D,r[10]=p*w+f*R+m*L+g*O,r[14]=p*E+f*A+m*I+g*G,r[3]=v*b+y*S+_*C+x*N,r[7]=v*M+y*T+_*P+x*D,r[11]=v*w+y*R+_*L+x*O,r[15]=v*E+y*A+_*I+x*G,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*a*h-i*l*h-r*o*u+n*l*u+i*o*d-n*a*d)+t[7]*(+e*a*d-e*l*u+r*s*u-i*s*d+i*l*c-r*a*c)+t[11]*(+e*l*h-e*o*d-r*s*h+n*s*d+r*o*c-n*l*c)+t[15]*(-i*o*c-e*a*h+e*o*u+i*s*h-n*s*u+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=h*m*l-f*u*l+f*a*d-o*m*d-h*a*g+o*u*g,y=p*u*l-c*m*l-p*a*d+s*m*d+c*a*g-s*u*g,_=c*f*l-p*h*l+p*o*d-s*f*d-c*o*g+s*h*g,x=p*h*a-c*f*a-p*o*u+s*f*u+c*o*m-s*h*m,b=e*v+n*y+i*_+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/b;return t[0]=v*M,t[1]=(f*u*r-h*m*r-f*i*d+n*m*d+h*i*g-n*u*g)*M,t[2]=(o*m*r-f*a*r+f*i*l-n*m*l-o*i*g+n*a*g)*M,t[3]=(h*a*r-o*u*r-h*i*l+n*u*l+o*i*d-n*a*d)*M,t[4]=y*M,t[5]=(c*m*r-p*u*r+p*i*d-e*m*d-c*i*g+e*u*g)*M,t[6]=(p*a*r-s*m*r-p*i*l+e*m*l+s*i*g-e*a*g)*M,t[7]=(s*u*r-c*a*r+c*i*l-e*u*l-s*i*d+e*a*d)*M,t[8]=_*M,t[9]=(p*h*r-c*f*r-p*n*d+e*f*d+c*n*g-e*h*g)*M,t[10]=(s*f*r-p*o*r+p*n*l-e*f*l-s*n*g+e*o*g)*M,t[11]=(c*o*r-s*h*r-c*n*l+e*h*l+s*n*d-e*o*d)*M,t[12]=x*M,t[13]=(c*f*i-p*h*i+p*n*u-e*f*u-c*n*m+e*h*m)*M,t[14]=(p*o*i-s*f*i-p*n*a+e*f*a+s*n*m-e*o*m)*M,t[15]=(s*h*i-c*o*i+c*n*a-e*h*a-s*n*u+e*o*u)*M,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,o=t.y,a=t.z,l=r*s,c=r*o;return this.set(l*s+n,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+n,c*a-i*s,0,l*a-i*o,c*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=o*h,v=a*l,y=a*c,_=a*h,x=n.x,b=n.y,M=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+_)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-_)*b,i[5]=(1-(u+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+y)*M,i[9]=(m-v)*M,i[10]=(1-(u+f))*M,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Ci.set(i[0],i[1],i[2]).length();const s=Ci.set(i[4],i[5],i[6]).length(),o=Ci.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Pi.copy(this);const a=1/r,l=1/s,c=1/o;return Pi.elements[0]*=a,Pi.elements[1]*=a,Pi.elements[2]*=a,Pi.elements[4]*=l,Pi.elements[5]*=l,Pi.elements[6]*=l,Pi.elements[8]*=c,Pi.elements[9]*=c,Pi.elements[10]*=c,e.setFromRotationMatrix(Pi),n.x=r,n.y=s,n.z=o,this}makePerspective(t,e,n,i,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(e-t),l=2*r/(n-i),c=(e+t)/(e-t),h=(n+i)/(n-i),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s){const o=this.elements,a=1/(e-t),l=1/(n-i),c=1/(s-r),h=(e+t)*a,u=(n+i)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}Ai.prototype.isMatrix4=!0;const Ci=new Kn,Pi=new Ai,Li=new Kn(0,0,0),Ii=new Kn(1,1,1),Ni=new Kn,Di=new Kn,Oi=new Kn,Gi=new Ai,ki=new Zn;class Ui{constructor(t=0,e=0,n=0,i=Ui.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(In(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-In(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(In(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-In(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(In(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-In(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Gi.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Gi,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ki.setFromEuler(this),this.setFromQuaternion(ki,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Kn(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Ui.prototype.isEuler=!0,Ui.DefaultOrder="XYZ",Ui.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Fi{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Bi=0;const zi=new Kn,Vi=new Zn,Hi=new Ai,Wi=new Kn,ji=new Kn,qi=new Kn,Xi=new Zn,Yi=new Kn(1,0,0),Ji=new Kn(0,1,0),Zi=new Kn(0,0,1),Ki={type:"added"},Qi={type:"removed"};class $i extends Rn{constructor(){super(),Object.defineProperty(this,"id",{value:Bi++}),this.uuid=Ln(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=$i.DefaultUp.clone();const t=new Kn,e=new Ui,n=new Zn,i=new Kn(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ai},normalMatrix:{value:new Un}}),this.matrix=new Ai,this.matrixWorld=new Ai,this.matrixAutoUpdate=$i.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Fi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Vi.setFromAxisAngle(t,e),this.quaternion.multiply(Vi),this}rotateOnWorldAxis(t,e){return Vi.setFromAxisAngle(t,e),this.quaternion.premultiply(Vi),this}rotateX(t){return this.rotateOnAxis(Yi,t)}rotateY(t){return this.rotateOnAxis(Ji,t)}rotateZ(t){return this.rotateOnAxis(Zi,t)}translateOnAxis(t,e){return zi.copy(t).applyQuaternion(this.quaternion),this.position.add(zi.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Yi,t)}translateY(t){return this.translateOnAxis(Ji,t)}translateZ(t){return this.translateOnAxis(Zi,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Hi.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Wi.copy(t):Wi.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ji.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Hi.lookAt(ji,Wi,this.up):Hi.lookAt(Wi,ji,this.up),this.quaternion.setFromRotationMatrix(Hi),i&&(Hi.extractRotation(i.matrixWorld),Vi.setFromRotationMatrix(Hi),this.quaternion.premultiply(Vi.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ki)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Qi)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Qi)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Hi.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Hi.multiply(t.parent.matrixWorld)),t.applyMatrix4(Hi),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ji,t,qi),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ji,Xi,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}$i.DefaultUp=new Kn(0,1,0),$i.DefaultMatrixAutoUpdate=!0,$i.prototype.isObject3D=!0;const tr=new Kn,er=new Kn,nr=new Kn,ir=new Kn,rr=new Kn,sr=new Kn,or=new Kn,ar=new Kn,lr=new Kn,cr=new Kn;class hr{constructor(t=new Kn,e=new Kn,n=new Kn){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),tr.subVectors(t,e),i.cross(tr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){tr.subVectors(i,e),er.subVectors(n,e),nr.subVectors(t,e);const s=tr.dot(tr),o=tr.dot(er),a=tr.dot(nr),l=er.dot(er),c=er.dot(nr),h=s*l-o*o;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,p=(s*c-o*a)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,ir),ir.x>=0&&ir.y>=0&&ir.x+ir.y<=1}static getUV(t,e,n,i,r,s,o,a){return this.getBarycoord(t,e,n,i,ir),a.set(0,0),a.addScaledVector(r,ir.x),a.addScaledVector(s,ir.y),a.addScaledVector(o,ir.z),a}static isFrontFacing(t,e,n,i){return tr.subVectors(n,e),er.subVectors(t,e),tr.cross(er).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return tr.subVectors(this.c,this.b),er.subVectors(this.a,this.b),.5*tr.cross(er).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return hr.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return hr.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return hr.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return hr.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return hr.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,o;rr.subVectors(i,n),sr.subVectors(r,n),ar.subVectors(t,n);const a=rr.dot(ar),l=sr.dot(ar);if(a<=0&&l<=0)return e.copy(n);lr.subVectors(t,i);const c=rr.dot(lr),h=sr.dot(lr);if(c>=0&&h<=c)return e.copy(i);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(rr,s);cr.subVectors(t,r);const d=rr.dot(cr),p=sr.dot(cr);if(p>=0&&d<=p)return e.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(sr,o);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return or.subVectors(r,i),o=(h-c)/(h-c+(d-p)),e.copy(i).addScaledVector(or,o);const g=1/(m+f+u);return s=f*g,o=u*g,e.copy(n).addScaledVector(rr,s).addScaledVector(sr,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let ur=0;class dr extends Rn{constructor(){super(),Object.defineProperty(this,"id",{value:ur++}),this.uuid=Ln(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=1023,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),1023!==this.format&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}dr.prototype.isMaterial=!0;const pr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fr={h:0,s:0,l:0},mr={h:0,s:0,l:0};function gr(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function vr(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function yr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class _r{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=Nn(t,1),e=In(e,0,1),n=In(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=gr(r,i,t+1/3),this.g=gr(r,i,t),this.b=gr(r,i,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=pr[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=vr(t.r),this.g=vr(t.g),this.b=vr(t.b),this}copyLinearToSRGB(t){return this.r=yr(t.r),this.g=yr(t.g),this.b=yr(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,n=this.g,i=this.b,r=Math.max(e,n,i),s=Math.min(e,n,i);let o,a;const l=(s+r)/2;if(s===r)o=0,a=0;else{const t=r-s;switch(a=l<=.5?t/(r+s):t/(2-r-s),r){case e:o=(n-i)/t+(n<i?6:0);break;case n:o=(i-e)/t+2;break;case i:o=(e-n)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(fr),fr.h+=t,fr.s+=e,fr.l+=n,this.setHSL(fr.h,fr.s,fr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(fr),t.getHSL(mr);const n=Dn(fr.h,mr.h,e),i=Dn(fr.s,mr.s,e),r=Dn(fr.l,mr.l,e);return this.setHSL(n,i,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}_r.NAMES=pr,_r.prototype.isColor=!0,_r.prototype.r=1,_r.prototype.g=1,_r.prototype.b=1;class xr extends dr{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new _r(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}xr.prototype.isMeshBasicMaterial=!0;const br=new Kn,Mr=new kn;class wr{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new _r),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new kn),e[n++]=r.x,e[n++]=r.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Kn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new Xn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Mr.fromBufferAttribute(this,e),Mr.applyMatrix3(t),this.setXY(e,Mr.x,Mr.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)br.fromBufferAttribute(this,e),br.applyMatrix3(t),this.setXYZ(e,br.x,br.y,br.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)br.x=this.getX(e),br.y=this.getY(e),br.z=this.getZ(e),br.applyMatrix4(t),this.setXYZ(e,br.x,br.y,br.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)br.x=this.getX(e),br.y=this.getY(e),br.z=this.getZ(e),br.applyNormalMatrix(t),this.setXYZ(e,br.x,br.y,br.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)br.x=this.getX(e),br.y=this.getY(e),br.z=this.getZ(e),br.transformDirection(t),this.setXYZ(e,br.x,br.y,br.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}wr.prototype.isBufferAttribute=!0;class Er extends wr{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Sr extends wr{constructor(t,e,n){super(new Uint32Array(t),e,n)}}(class extends wr{constructor(t,e,n){super(new Uint16Array(t),e,n)}}).prototype.isFloat16BufferAttribute=!0;class Tr extends wr{constructor(t,e,n){super(new Float32Array(t),e,n)}}let Rr=0;const Ar=new Ai,Cr=new $i,Pr=new Kn,Lr=new ti,Ir=new ti,Nr=new Kn;class Dr extends Rn{constructor(){super(),Object.defineProperty(this,"id",{value:Rr++}),this.uuid=Ln(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Fn(t)>65535?Sr:Er)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Un).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ar.makeRotationFromQuaternion(t),this.applyMatrix4(Ar),this}rotateX(t){return Ar.makeRotationX(t),this.applyMatrix4(Ar),this}rotateY(t){return Ar.makeRotationY(t),this.applyMatrix4(Ar),this}rotateZ(t){return Ar.makeRotationZ(t),this.applyMatrix4(Ar),this}translate(t,e,n){return Ar.makeTranslation(t,e,n),this.applyMatrix4(Ar),this}scale(t,e,n){return Ar.makeScale(t,e,n),this.applyMatrix4(Ar),this}lookAt(t){return Cr.lookAt(t),Cr.updateMatrix(),this.applyMatrix4(Cr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pr).negate(),this.translate(Pr.x,Pr.y,Pr.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Tr(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ti);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Kn(-1/0,-1/0,-1/0),new Kn(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Lr.setFromBufferAttribute(n),this.morphTargetsRelative?(Nr.addVectors(this.boundingBox.min,Lr.min),this.boundingBox.expandByPoint(Nr),Nr.addVectors(this.boundingBox.max,Lr.max),this.boundingBox.expandByPoint(Nr)):(this.boundingBox.expandByPoint(Lr.min),this.boundingBox.expandByPoint(Lr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new _i);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Kn,1/0);if(t){const n=this.boundingSphere.center;if(Lr.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Ir.setFromBufferAttribute(n),this.morphTargetsRelative?(Nr.addVectors(Lr.min,Ir.min),Lr.expandByPoint(Nr),Nr.addVectors(Lr.max,Ir.max),Lr.expandByPoint(Nr)):(Lr.expandByPoint(Ir.min),Lr.expandByPoint(Ir.max))}Lr.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Nr.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Nr));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Nr.fromBufferAttribute(s,e),o&&(Pr.fromBufferAttribute(t,e),Nr.add(Pr)),i=Math.max(i,n.distanceToSquared(Nr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,o=i.length/3;void 0===e.tangent&&this.setAttribute("tangent",new wr(new Float32Array(4*o),4));const a=e.tangent.array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new Kn,c[t]=new Kn;const h=new Kn,u=new Kn,d=new Kn,p=new kn,f=new kn,m=new kn,g=new Kn,v=new Kn;function y(t,e,n){h.fromArray(i,3*t),u.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(v),c[e].add(v),c[n].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let t=0,e=_.length;t<e;++t){const e=_[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)y(n[t+0],n[t+1],n[t+2])}const x=new Kn,b=new Kn,M=new Kn,w=new Kn;function E(t){M.fromArray(r,3*t),w.copy(M);const e=l[t];x.copy(e),x.sub(M.multiplyScalar(M.dot(e))).normalize(),b.crossVectors(w,e);const n=b.dot(c[t])<0?-1:1;a[4*t]=x.x,a[4*t+1]=x.y,a[4*t+2]=x.z,a[4*t+3]=n}for(let t=0,e=_.length;t<e;++t){const e=_[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)E(n[t+0]),E(n[t+1]),E(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new wr(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Kn,r=new Kn,s=new Kn,o=new Kn,a=new Kn,l=new Kn,c=new Kn,h=new Kn;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const r=n[i].array,s=t.attributes[i],o=s.array,a=s.itemSize*e,l=Math.min(o.length,r.length-a);for(let t=0,e=a;t<l;t++,e++)r[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Nr.fromBufferAttribute(t,e),Nr.normalize(),t.setXYZ(e,Nr.x,Nr.y,Nr.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let o=0,a=0;for(let r=0,l=e.length;r<l;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[a++]=n[o++]}return new wr(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Dr,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],o=r[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Dr.prototype.isBufferGeometry=!0;const Or=new Ai,Gr=new Ri,kr=new _i,Ur=new Kn,Fr=new Kn,Br=new Kn,zr=new Kn,Vr=new Kn,Hr=new Kn,Wr=new Kn,jr=new Kn,qr=new Kn,Xr=new kn,Yr=new kn,Jr=new kn,Zr=new Kn,Kr=new Kn;class Qr extends $i{constructor(t=new Dr,e=new xr){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),kr.copy(n.boundingSphere),kr.applyMatrix4(r),!1===t.ray.intersectsSphere(kr))return;if(Or.copy(r).invert(),Gr.copy(t.ray).applyMatrix4(Or),null!==n.boundingBox&&!1===Gr.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,h=n.attributes.uv2,u=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=u.length;n<p;n++){const p=u[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));n<i;n+=3){const i=r.getX(n),u=r.getX(n+1),d=r.getX(n+2);s=$r(this,f,t,Gr,o,a,l,c,h,i,u,d),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{for(let n=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);n<u;n+=3){const u=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);s=$r(this,i,t,Gr,o,a,l,c,h,u,d,p),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(i))for(let n=0,r=u.length;n<r;n++){const r=u[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));n<i;n+=3){s=$r(this,p,t,Gr,o,a,l,c,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let n=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);n<r;n+=3){s=$r(this,i,t,Gr,o,a,l,c,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function $r(t,e,n,i,r,s,o,a,l,c,h,u){Ur.fromBufferAttribute(r,c),Fr.fromBufferAttribute(r,h),Br.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){Wr.set(0,0,0),jr.set(0,0,0),qr.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],n=s[t];0!==e&&(zr.fromBufferAttribute(n,c),Vr.fromBufferAttribute(n,h),Hr.fromBufferAttribute(n,u),o?(Wr.addScaledVector(zr,e),jr.addScaledVector(Vr,e),qr.addScaledVector(Hr,e)):(Wr.addScaledVector(zr.sub(Ur),e),jr.addScaledVector(Vr.sub(Fr),e),qr.addScaledVector(Hr.sub(Br),e)))}Ur.add(Wr),Fr.add(jr),Br.add(qr)}t.isSkinnedMesh&&(t.boneTransform(c,Ur),t.boneTransform(h,Fr),t.boneTransform(u,Br));const p=function(t,e,n,i,r,s,o,a){let l;if(l=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,2!==e.side,a),null===l)return null;Kr.copy(a),Kr.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(Kr);return c<n.near||c>n.far?null:{distance:c,point:Kr.clone(),object:t}}(t,e,n,i,Ur,Fr,Br,Zr);if(p){a&&(Xr.fromBufferAttribute(a,c),Yr.fromBufferAttribute(a,h),Jr.fromBufferAttribute(a,u),p.uv=hr.getUV(Zr,Ur,Fr,Br,Xr,Yr,Jr,new kn)),l&&(Xr.fromBufferAttribute(l,c),Yr.fromBufferAttribute(l,h),Jr.fromBufferAttribute(l,u),p.uv2=hr.getUV(Zr,Ur,Fr,Br,Xr,Yr,Jr,new kn));const t={a:c,b:h,c:u,normal:new Kn,materialIndex:0};hr.getNormal(Ur,Fr,Br,t.normal),p.face=t}return p}Qr.prototype.isMesh=!0;class ts extends Dr{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,n,i,r,s,p,f,m,g,v){const y=s/m,_=p/g,x=s/2,b=p/2,M=f/2,w=m+1,E=g+1;let S=0,T=0;const R=new Kn;for(let s=0;s<E;s++){const o=s*_-b;for(let a=0;a<w;a++){const u=a*y-x;R[t]=u*i,R[e]=o*r,R[n]=M,l.push(R.x,R.y,R.z),R[t]=0,R[e]=0,R[n]=f>0?1:-1,c.push(R.x,R.y,R.z),h.push(a/m),h.push(1-s/g),S+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=u+e+w*t,i=u+e+w*(t+1),r=u+(e+1)+w*(t+1),s=u+(e+1)+w*t;a.push(n,i,s),a.push(i,r,s),T+=6}o.addGroup(d,T,v),d+=T,u+=S}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new Tr(l,3)),this.setAttribute("normal",new Tr(c,3)),this.setAttribute("uv",new Tr(h,2))}static fromJSON(t){return new ts(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function es(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function ns(t){const e={};for(let n=0;n<t.length;n++){const i=es(t[n]);for(const t in i)e[t]=i[t]}return e}const is={clone:es,merge:ns};class rs extends dr{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=es(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}rs.prototype.isShaderMaterial=!0;class ss extends $i{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Ai,this.projectionMatrix=new Ai,this.projectionMatrixInverse=new Ai}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}ss.prototype.isCamera=!0;class os extends ss{constructor(t=50,e=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Pn*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Cn*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Pn*Math.atan(Math.tan(.5*Cn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Cn*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/o,i*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}os.prototype.isPerspectiveCamera=!0;class as extends $i{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new os(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Kn(1,0,0)),this.add(i);const r=new os(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Kn(-1,0,0)),this.add(r);const s=new os(90,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Kn(0,1,0)),this.add(s);const o=new os(90,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Kn(0,-1,0)),this.add(o);const a=new os(90,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Kn(0,0,1)),this.add(a);const l=new os(90,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Kn(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,o,a,l]=this.children,c=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=u,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(h),t.xr.enabled=c}}class ls extends jn{constructor(t,e,n,i,r,s,o,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:301,n,i,r,s,o,a,l,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}ls.prototype.isCubeTexture=!0;class cs extends Yn{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),e=e||{},this.texture=new ls(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:1006,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=1023,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new ts(5,5,5),r=new rs({name:"CubemapFromEquirect",uniforms:es(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new Qr(i,r),o=e.minFilter;1008===e.minFilter&&(e.minFilter=1006);return new as(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}cs.prototype.isWebGLCubeRenderTarget=!0;const hs=new Kn,us=new Kn,ds=new Un;class ps{constructor(t=new Kn(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=hs.subVectors(n,e).cross(us.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(hs),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||ds.getNormalMatrix(t),i=this.coplanarPoint(hs).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}ps.prototype.isPlane=!0;const fs=new _i,ms=new Kn;class gs{constructor(t=new ps,e=new ps,n=new ps,i=new ps,r=new ps,s=new ps){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(o-i,h-a,f-u,y-m).normalize(),e[1].setComponents(o+i,h+a,f+u,y+m).normalize(),e[2].setComponents(o+r,h+l,f+d,y+g).normalize(),e[3].setComponents(o-r,h-l,f-d,y-g).normalize(),e[4].setComponents(o-s,h-c,f-p,y-v).normalize(),e[5].setComponents(o+s,h+c,f+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),fs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(fs)}intersectsSprite(t){return fs.center.set(0,0,0),fs.radius=.7071067811865476,fs.applyMatrix4(t.matrixWorld),this.intersectsSphere(fs)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(ms.x=i.normal.x>0?t.max.x:t.min.x,ms.y=i.normal.y>0?t.max.y:t.min.y,ms.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(ms)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function vs(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function ys(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);void 0===s?i.set(e,function(e,i){const r=e.array,s=e.usage,o=t.createBuffer();t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,i,r){const s=i.array,o=i.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(n?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class _s extends Dr{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,o=Math.floor(n),a=Math.floor(i),l=o+1,c=a+1,h=t/o,u=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-s;for(let n=0;n<l;n++){const i=n*h-r;p.push(i,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,i=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Tr(p,3)),this.setAttribute("normal",new Tr(f,3)),this.setAttribute("uv",new Tr(m,2))}static fromJSON(t){return new _s(t.width,t.height,t.widthSegments,t.heightSegments)}}const xs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},bs={common:{diffuse:{value:new _r(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Un},uv2Transform:{value:new Un},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new kn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _r(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new _r(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Un}},sprite:{diffuse:{value:new _r(16777215)},opacity:{value:1},center:{value:new kn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Un}}},Ms={basic:{uniforms:ns([bs.common,bs.specularmap,bs.envmap,bs.aomap,bs.lightmap,bs.fog]),vertexShader:xs.meshbasic_vert,fragmentShader:xs.meshbasic_frag},lambert:{uniforms:ns([bs.common,bs.specularmap,bs.envmap,bs.aomap,bs.lightmap,bs.emissivemap,bs.fog,bs.lights,{emissive:{value:new _r(0)}}]),vertexShader:xs.meshlambert_vert,fragmentShader:xs.meshlambert_frag},phong:{uniforms:ns([bs.common,bs.specularmap,bs.envmap,bs.aomap,bs.lightmap,bs.emissivemap,bs.bumpmap,bs.normalmap,bs.displacementmap,bs.fog,bs.lights,{emissive:{value:new _r(0)},specular:{value:new _r(1118481)},shininess:{value:30}}]),vertexShader:xs.meshphong_vert,fragmentShader:xs.meshphong_frag},standard:{uniforms:ns([bs.common,bs.envmap,bs.aomap,bs.lightmap,bs.emissivemap,bs.bumpmap,bs.normalmap,bs.displacementmap,bs.roughnessmap,bs.metalnessmap,bs.fog,bs.lights,{emissive:{value:new _r(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xs.meshphysical_vert,fragmentShader:xs.meshphysical_frag},toon:{uniforms:ns([bs.common,bs.aomap,bs.lightmap,bs.emissivemap,bs.bumpmap,bs.normalmap,bs.displacementmap,bs.gradientmap,bs.fog,bs.lights,{emissive:{value:new _r(0)}}]),vertexShader:xs.meshtoon_vert,fragmentShader:xs.meshtoon_frag},matcap:{uniforms:ns([bs.common,bs.bumpmap,bs.normalmap,bs.displacementmap,bs.fog,{matcap:{value:null}}]),vertexShader:xs.meshmatcap_vert,fragmentShader:xs.meshmatcap_frag},points:{uniforms:ns([bs.points,bs.fog]),vertexShader:xs.points_vert,fragmentShader:xs.points_frag},dashed:{uniforms:ns([bs.common,bs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xs.linedashed_vert,fragmentShader:xs.linedashed_frag},depth:{uniforms:ns([bs.common,bs.displacementmap]),vertexShader:xs.depth_vert,fragmentShader:xs.depth_frag},normal:{uniforms:ns([bs.common,bs.bumpmap,bs.normalmap,bs.displacementmap,{opacity:{value:1}}]),vertexShader:xs.meshnormal_vert,fragmentShader:xs.meshnormal_frag},sprite:{uniforms:ns([bs.sprite,bs.fog]),vertexShader:xs.sprite_vert,fragmentShader:xs.sprite_frag},background:{uniforms:{uvTransform:{value:new Un},t2D:{value:null}},vertexShader:xs.background_vert,fragmentShader:xs.background_frag},cube:{uniforms:ns([bs.envmap,{opacity:{value:1}}]),vertexShader:xs.cube_vert,fragmentShader:xs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xs.equirect_vert,fragmentShader:xs.equirect_frag},distanceRGBA:{uniforms:ns([bs.common,bs.displacementmap,{referencePosition:{value:new Kn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xs.distanceRGBA_vert,fragmentShader:xs.distanceRGBA_frag},shadow:{uniforms:ns([bs.lights,bs.fog,{color:{value:new _r(0)},opacity:{value:1}}]),vertexShader:xs.shadow_vert,fragmentShader:xs.shadow_frag}};function ws(t,e,n,i,r){const s=new _r(0);let o,a,l=0,c=null,h=0,u=null;function d(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),l=e,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,d(s,l)},render:function(n,r){let p=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=e.get(f));const m=t.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?d(s,l):f&&f.isColor&&(d(f,1),p=!0),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||306===f.mapping)?(void 0===a&&(a=new Qr(new ts(1,1,1),new rs({name:"BackgroundCubeMaterial",uniforms:es(Ms.cube.uniforms),vertexShader:Ms.cube.vertexShader,fragmentShader:Ms.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),a.material.uniforms.envMap.value=f,a.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,c===f&&h===f.version&&u===t.toneMapping||(a.material.needsUpdate=!0,c=f,h=f.version,u=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):f&&f.isTexture&&(void 0===o&&(o=new Qr(new _s(2,2),new rs({name:"BackgroundMaterial",uniforms:es(Ms.background.uniforms),vertexShader:Ms.background.vertexShader,fragmentShader:Ms.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),o.material.uniforms.uvTransform.value.copy(f.matrix),c===f&&h===f.version&&u===t.toneMapping||(o.material.needsUpdate=!0,c=f,h=f.version,u=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function Es(t,e,n,i){const r=t.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=d(null);let c=l;function h(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function u(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function d(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function p(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function g(){const e=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function v(e,n,r,s,o,a){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,s,o,a):t.vertexAttribIPointer(e,n,r,o,a)}function y(){_(),c!==l&&(c=l,h(c.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,y,_){let x=!1;if(o){const e=function(e,n,r){const o=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let h=c[o];void 0===h&&(h=d(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=h);return h}(y,u,l);c!==e&&(c=e,h(c.object)),x=function(t,e){const n=c.attributes,i=t.attributes;let r=0;for(const t in i){const e=n[t],s=i[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(y,_),x&&function(t,e){const n={},i=t.attributes;let r=0;for(const t in i){const e=i[t],s={};s.attribute=e,e.data&&(s.data=e.data),n[t]=s,r++}c.attributes=n,c.attributesNum=r,c.index=e}(y,_)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===u.id&&c.wireframe===t||(c.geometry=y.id,c.program=u.id,c.wireframe=t,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==_&&n.update(_,34963),x&&(!function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const i=c[e];if(i.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=n.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,l=n.stride,d=s.offset;if(n&&n.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)m(i.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<i.locationSize;t++)f(i.location+t);t.bindBuffer(34962,c);for(let t=0;t<i.locationSize;t++)v(i.location+t,o/i.locationSize,h,e,l*u,(d+o/i.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)m(i.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<i.locationSize;t++)f(i.location+t);t.bindBuffer(34962,c);for(let t=0;t<i.locationSize;t++)v(i.location+t,o/i.locationSize,h,e,o*u,o/i.locationSize*t*u)}}else if(void 0!==h){const n=h[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i.location,n);break;case 3:t.vertexAttrib3fv(i.location,n);break;case 4:t.vertexAttrib4fv(i.location,n);break;default:t.vertexAttrib1fv(i.location,n)}}}}g()}(r,l,u,y),null!==_&&t.bindBuffer(34963,n.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)u(i[t].object),delete i[t];delete n[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function Ss(t,e,n,i){const r=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,o,a),n.update(o,s,a)}}function Ts(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,h=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=u>0,_=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:s?t.getParameter(36183):0}}function Rs(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new ps,a=new Un,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(t,n,i,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==i||r;return r=e,n=h(t,s,0),i=t.length,o},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const t=s?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=h(u,o,e,a);for(let t=0;t!==e;++t)r[t]=n[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function As(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=301:304===e&&(t.mapping=302),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(303===s||304===s){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=t.getRenderTarget(),a=new cs(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),t.setRenderTarget(o),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}Ms.physical={uniforms:ns([Ms.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new kn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new _r(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new kn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new _r(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new _r(1,1,1)},specularColorMap:{value:null}}]),vertexShader:xs.meshphysical_vert,fragmentShader:xs.meshphysical_frag};class Cs extends ss{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Cs.prototype.isOrthographicCamera=!0;class Ps extends rs{constructor(t){super(t),this.type="RawShaderMaterial"}}Ps.prototype.isRawShaderMaterial=!0;const Ls=Math.pow(2,8),Is=[.125,.215,.35,.446,.526,.582],Ns=5+Is.length,Ds={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Os=new Cs,{_lodPlanes:Gs,_sizeLods:ks,_sigmas:Us}=qs(),Fs=new _r;let Bs=null;const zs=(1+Math.sqrt(5))/2,Vs=1/zs,Hs=[new Kn(1,1,1),new Kn(-1,1,1),new Kn(1,1,-1),new Kn(-1,1,-1),new Kn(0,zs,Vs),new Kn(0,zs,-Vs),new Kn(Vs,0,zs),new Kn(-Vs,0,zs),new Kn(zs,Vs,0),new Kn(-zs,Vs,0)];class Ws{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),n=new Kn(0,1,0);return new Ps({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Ds[3e3]},outputEncoding:{value:Ds[3e3]}},vertexShader:Ks(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${Qs()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Bs=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Zs(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Js(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<Gs.length;t++)Gs[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Bs),t.scissorTest=!1,Ys(t,0,0,t.width,t.height)}_fromTexture(t){Bs=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:js(t)?t.encoding:3002,depthBuffer:!1},n=Xs(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Xs(e),n}_compileMaterial(t){const e=new Qr(Gs[0],t);this._renderer.compile(e,Os)}_sceneToCubeUV(t,e,n,i){const r=new os(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,h=a.toneMapping;a.getClearColor(Fs),a.toneMapping=0,a.outputEncoding=3e3,a.autoClear=!1;const u=new xr({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Qr(new ts,u);let p=!1;const f=t.background;f?f.isColor&&(u.color.copy(f),t.background=null,p=!0):(u.color.copy(Fs),p=!0);for(let e=0;e<6;e++){const n=e%3;0==n?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1==n?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e])),Ys(i,n*Ls,e>2?Ls:0,Ls,Ls),a.setRenderTarget(i),p&&a.render(d,r),a.render(t,r)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=h,a.outputEncoding=c,a.autoClear=l,t.background=f}_setEncoding(t,e){t.value=Ds[e.encoding]}_textureToCubeUV(t,e){const n=this._renderer,i=301===t.mapping||302===t.mapping;i?null==this._cubemapShader&&(this._cubemapShader=Zs()):null==this._equirectShader&&(this._equirectShader=Js());const r=i?this._cubemapShader:this._equirectShader,s=new Qr(Gs[0],r),o=r.uniforms;o.envMap.value=t,i||o.texelSize.value.set(1/t.image.width,1/t.image.height),this._setEncoding(o.inputEncoding,t),this._setEncoding(o.outputEncoding,e.texture),Ys(e,0,0,3*Ls,2*Ls),n.setRenderTarget(e),n.render(s,Os)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<Ns;e++){const n=Math.sqrt(Us[e]*Us[e]-Us[e-1]*Us[e-1]),i=Hs[(e-1)%Hs.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Qr(Gs[i],l),h=l.uniforms,u=ks[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0==t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o),h.dTheta.value=d,h.mipInt.value=8-n,this._setEncoding(h.inputEncoding,t.texture),this._setEncoding(h.outputEncoding,t.texture);const v=ks[i];Ys(e,3*Math.max(0,Ls-2*v),(0===i?0:2*Ls)+2*v*(i>4?i-8+4:0),3*v,2*v),a.setRenderTarget(e),a.render(c,Os)}}function js(t){return void 0!==t&&1009===t.type&&(3e3===t.encoding||3001===t.encoding||3007===t.encoding)}function qs(){const t=[],e=[],n=[];let i=8;for(let r=0;r<Ns;r++){const s=Math.pow(2,i);e.push(s);let o=1/s;r>4?o=Is[r-8+4-1]:0==r&&(o=0),n.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*u),v=new Float32Array(f*d*u),y=new Float32Array(m*d*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(i,p*d*t),v.set(h,f*d*t);const r=[t,t,t,t,t,t];y.set(r,m*d*t)}const _=new Dr;_.setAttribute("position",new wr(g,p)),_.setAttribute("uv",new wr(v,f)),_.setAttribute("faceIndex",new wr(y,m)),t.push(_),i>4&&i--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function Xs(t){const e=new Yn(3*Ls,3*Ls,t);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ys(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Js(){const t=new kn(1,1);return new Ps({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:Ds[3e3]},outputEncoding:{value:Ds[3e3]}},vertexShader:Ks(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${Qs()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function Zs(){return new Ps({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ds[3e3]},outputEncoding:{value:Ds[3e3]}},vertexShader:Ks(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${Qs()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function Ks(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Qs(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function $s(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping,o=303===s||304===s,a=301===s||302===s;if(o||a){if(e.has(r))return e.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(t){let e=0;for(let n=0;n<6;n++)void 0!==t[n]&&e++;return 6===e}(s)){const s=t.getRenderTarget();null===n&&(n=new Ws(t));const a=o?n.fromEquirectangular(r):n.fromCubemap(r);return e.set(r,a),t.setRenderTarget(s),r.addEventListener("dispose",i),a.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function to(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function eo(t,e,n,i){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const a=new(Fn(n)>65535?Sr:Er)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const i=t.morphAttributes;for(const t in i){const n=i[t];for(let t=0,i=n.length;t<i;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function no(t,e,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,o,e*a),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,i*a,c),n.update(l,s,c)}}function io(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}class ro extends jn{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function so(t,e){return t[0]-e[0]}function oo(t,e){return Math.abs(e[1])-Math.abs(t[1])}function ao(t,e){let n=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),t.divideScalar(n)}function lo(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new Kn,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,c,h,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const i=c.morphAttributes.position.length;let r=s.get(c);if(void 0===r||r.count!==i){void 0!==r&&r.texture.dispose();const t=void 0!==c.morphAttributes.normal,n=c.morphAttributes.position,a=c.morphAttributes.normal||[],l=!0===t?2:1;let h=c.attributes.position.count*l,u=1;h>e.maxTextureSize&&(u=Math.ceil(h/e.maxTextureSize),h=e.maxTextureSize);const d=new Float32Array(h*u*4*i),p=new ro(d,h,u,i);p.format=1023,p.type=1015;const f=4*l;for(let e=0;e<i;e++){const i=n[e],r=a[e],s=h*u*4*e;for(let e=0;e<i.count;e++){o.fromBufferAttribute(i,e),!0===i.normalized&&ao(o,i);const n=e*f;d[s+n+0]=o.x,d[s+n+1]=o.y,d[s+n+2]=o.z,d[s+n+3]=0,!0===t&&(o.fromBufferAttribute(r,e),!0===r.normalized&&ao(o,r),d[s+n+4]=o.x,d[s+n+5]=o.y,d[s+n+6]=o.z,d[s+n+7]=0)}}r={count:i,texture:p,size:new kn(h,u)},s.set(c,r)}let a=0;for(let t=0;t<d.length;t++)a+=d[t];const l=c.morphTargetsRelative?1:1-a;u.getUniforms().setValue(t,"morphTargetBaseInfluence",l),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",r.texture,n),u.getUniforms().setValue(t,"morphTargetsTextureSize",r.size)}else{const e=void 0===d?0:d.length;let n=i[c.id];if(void 0===n||n.length!==e){n=[];for(let t=0;t<e;t++)n[t]=[t,0];i[c.id]=n}for(let t=0;t<e;t++){const e=n[t];e[0]=t,e[1]=d[t]}n.sort(oo);for(let t=0;t<8;t++)t<e&&n[t][1]?(a[t][0]=n[t][0],a[t][1]=n[t][1]):(a[t][0]=Number.MAX_SAFE_INTEGER,a[t][1]=0);a.sort(so);const s=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=a[t],n=e[0],i=e[1];n!==Number.MAX_SAFE_INTEGER&&i?(s&&c.getAttribute("morphTarget"+t)!==s[n]&&c.setAttribute("morphTarget"+t,s[n]),o&&c.getAttribute("morphNormal"+t)!==o[n]&&c.setAttribute("morphNormal"+t,o[n]),r[t]=i,l+=i):(s&&!0===c.hasAttribute("morphTarget"+t)&&c.deleteAttribute("morphTarget"+t),o&&!0===c.hasAttribute("morphNormal"+t)&&c.deleteAttribute("morphNormal"+t),r[t]=0)}const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",h),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function co(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const o=i.render.frame,a=t.geometry,l=e.get(t,a);return r.get(l)!==o&&(e.update(l),r.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}ro.prototype.isDataTexture2DArray=!0;class ho extends jn{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ho.prototype.isDataTexture3D=!0;const uo=new jn,po=new ro,fo=new ho,mo=new ls,go=[],vo=[],yo=new Float32Array(16),_o=new Float32Array(9),xo=new Float32Array(4);function bo(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=go[r];if(void 0===s&&(s=new Float32Array(r),go[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function Mo(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function wo(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Eo(t,e){let n=vo[e];void 0===n&&(n=new Int32Array(e),vo[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function So(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function To(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Mo(n,e))return;t.uniform2fv(this.addr,e),wo(n,e)}}function Ro(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Mo(n,e))return;t.uniform3fv(this.addr,e),wo(n,e)}}function Ao(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Mo(n,e))return;t.uniform4fv(this.addr,e),wo(n,e)}}function Co(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Mo(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),wo(n,e)}else{if(Mo(n,i))return;xo.set(i),t.uniformMatrix2fv(this.addr,!1,xo),wo(n,i)}}function Po(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Mo(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),wo(n,e)}else{if(Mo(n,i))return;_o.set(i),t.uniformMatrix3fv(this.addr,!1,_o),wo(n,i)}}function Lo(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Mo(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),wo(n,e)}else{if(Mo(n,i))return;yo.set(i),t.uniformMatrix4fv(this.addr,!1,yo),wo(n,i)}}function Io(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function No(t,e){const n=this.cache;Mo(n,e)||(t.uniform2iv(this.addr,e),wo(n,e))}function Do(t,e){const n=this.cache;Mo(n,e)||(t.uniform3iv(this.addr,e),wo(n,e))}function Oo(t,e){const n=this.cache;Mo(n,e)||(t.uniform4iv(this.addr,e),wo(n,e))}function Go(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ko(t,e){const n=this.cache;Mo(n,e)||(t.uniform2uiv(this.addr,e),wo(n,e))}function Uo(t,e){const n=this.cache;Mo(n,e)||(t.uniform3uiv(this.addr,e),wo(n,e))}function Fo(t,e){const n=this.cache;Mo(n,e)||(t.uniform4uiv(this.addr,e),wo(n,e))}function Bo(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||uo,r)}function zo(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||fo,r)}function Vo(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||mo,r)}function Ho(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||po,r)}function Wo(t,e){t.uniform1fv(this.addr,e)}function jo(t,e){const n=bo(e,this.size,2);t.uniform2fv(this.addr,n)}function qo(t,e){const n=bo(e,this.size,3);t.uniform3fv(this.addr,n)}function Xo(t,e){const n=bo(e,this.size,4);t.uniform4fv(this.addr,n)}function Yo(t,e){const n=bo(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Jo(t,e){const n=bo(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Zo(t,e){const n=bo(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Ko(t,e){t.uniform1iv(this.addr,e)}function Qo(t,e){t.uniform2iv(this.addr,e)}function $o(t,e){t.uniform3iv(this.addr,e)}function ta(t,e){t.uniform4iv(this.addr,e)}function ea(t,e){t.uniform1uiv(this.addr,e)}function na(t,e){t.uniform2uiv(this.addr,e)}function ia(t,e){t.uniform3uiv(this.addr,e)}function ra(t,e){t.uniform4uiv(this.addr,e)}function sa(t,e,n){const i=e.length,r=Eo(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTexture2D(e[t]||uo,r[t])}function oa(t,e,n){const i=e.length,r=Eo(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture3D(e[t]||fo,r[t])}function aa(t,e,n){const i=e.length,r=Eo(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTextureCube(e[t]||mo,r[t])}function la(t,e,n){const i=e.length,r=Eo(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture2DArray(e[t]||po,r[t])}function ca(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return So;case 35664:return To;case 35665:return Ro;case 35666:return Ao;case 35674:return Co;case 35675:return Po;case 35676:return Lo;case 5124:case 35670:return Io;case 35667:case 35671:return No;case 35668:case 35672:return Do;case 35669:case 35673:return Oo;case 5125:return Go;case 36294:return ko;case 36295:return Uo;case 36296:return Fo;case 35678:case 36198:case 36298:case 36306:case 35682:return Bo;case 35679:case 36299:case 36307:return zo;case 35680:case 36300:case 36308:case 36293:return Vo;case 36289:case 36303:case 36311:case 36292:return Ho}}(e.type)}function ha(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Wo;case 35664:return jo;case 35665:return qo;case 35666:return Xo;case 35674:return Yo;case 35675:return Jo;case 35676:return Zo;case 5124:case 35670:return Ko;case 35667:case 35671:return Qo;case 35668:case 35672:return $o;case 35669:case 35673:return ta;case 5125:return ea;case 36294:return na;case 36295:return ia;case 36296:return ra;case 35678:case 36198:case 36298:case 36306:case 35682:return sa;case 35679:case 36299:case 36307:return oa;case 35680:case 36300:case 36308:case 36293:return aa;case 36289:case 36303:case 36311:case 36292:return la}}(e.type)}function ua(t){this.id=t,this.seq=[],this.map={}}ha.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),wo(e,t)},ua.prototype.setValue=function(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}};const da=/(\w+)(\])?(\[|\.)?/g;function pa(t,e){t.seq.push(e),t.map[e.id]=e}function fa(t,e,n){const i=t.name,r=i.length;for(da.lastIndex=0;;){const s=da.exec(i),o=da.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){pa(n,void 0===c?new ca(a,t,e):new ha(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new ua(a),pa(n,t)),n=t}}}function ma(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);fa(n,t.getUniformLocation(e,n.name),this)}}function ga(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}ma.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},ma.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},ma.upload=function(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,i)}},ma.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n};let va=0;function ya(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function _a(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":n.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function xa(t,e){const n=ya(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function ba(t,e){const n=ya(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ma(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function wa(t){return""!==t}function Ea(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Sa(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Ta=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ra(t){return t.replace(Ta,Aa)}function Aa(t,e){const n=xs[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Ra(n)}const Ca=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Pa=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function La(t){return t.replace(Pa,Na).replace(Ca,Ia)}function Ia(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Na(t,e,n,i)}function Na(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Da(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Oa(t,e,n,i){const r=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),h=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(n),u=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=t.gammaFactor>0?t.gammaFactor:1,p=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(wa).join("\n")}(n),f=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(wa).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(wa).join("\n"),v.length>0&&(v+="\n")):(g=[Da(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(wa).join("\n"),v=[p,Da(n),"#define SHADER_NAME "+n.shaderName,f,"#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?xs.tonemapping_pars_fragment:"",0!==n.toneMapping?Ma("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",1022===n.format?"#define OPAQUE":"",xs.encodings_pars_fragment,n.map?xa("mapTexelToLinear",n.mapEncoding):"",n.matcap?xa("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?xa("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?xa("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularColorMap?xa("specularColorMapTexelToLinear",n.specularColorMapEncoding):"",n.sheenColorMap?xa("sheenColorMapTexelToLinear",n.sheenColorMapEncoding):"",n.lightMap?xa("lightMapTexelToLinear",n.lightMapEncoding):"",ba("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(wa).join("\n")),o=Ra(o),o=Ea(o,n),o=Sa(o,n),a=Ra(a),a=Ea(a,n),a=Sa(a,n),o=La(o),a=La(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const _=y+v+a,x=ga(r,35633,y+g+o),b=ga(r,35632,_);if(r.attachShader(m,x),r.attachShader(m,b),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(m).trim(),e=r.getShaderInfoLog(x).trim(),n=r.getShaderInfoLog(b).trim();let i=!0,s=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const e=_a(r,x,"vertex"),n=_a(r,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:v}})}let M,w;return r.deleteShader(x),r.deleteShader(b),this.getUniforms=function(){return void 0===M&&(M=new ma(r,m)),M},this.getAttributes=function(){return void 0===w&&(w=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(r,m)),w},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=va++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=b,this}function Ga(t,e,n,i,r,s,o){const a=[],l=r.isWebGL2,c=r.logarithmicDepthBuffer,h=r.floatVertexTextures,u=r.maxVertexUniforms,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function g(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=3e3,e}return{getParameters:function(s,a,m,v,y){const _=v.fog,x=s.isMeshStandardMaterial?v.environment:null,b=(s.isMeshStandardMaterial?n:e).get(s.envMap||x),M=f[s.type],w=y.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(h)return 1024;{const t=u,n=Math.floor((t-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}}(y):0;let E,S;if(null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead.")),M){const t=Ms[M];E=t.vertexShader,S=t.fragmentShader}else E=s.vertexShader,S=s.fragmentShader;const T=t.getRenderTarget(),R=s.alphaTest>0,A=s.clearcoat>0;return{isWebGL2:l,shaderID:M,shaderName:s.type,vertexShader:E,fragmentShader:S,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:d,outputEncoding:null!==T?g(T.texture):t.outputEncoding,map:!!s.map,mapEncoding:g(s.map),matcap:!!s.matcap,matcapEncoding:g(s.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:g(b),envMapCubeUV:!!b&&(306===b.mapping||307===b.mapping),lightMap:!!s.lightMap,lightMapEncoding:g(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:g(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,clearcoat:A,clearcoatMap:A&&!!s.clearcoatMap,clearcoatRoughnessMap:A&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:A&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,specularColorMapEncoding:g(s.specularColorMap),alphaMap:!!s.alphaMap,alphaTest:R,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenColorMapEncoding:g(s.sheenColorMap),sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularColorMap||!!s.sheenColorMap||s.sheenRoughnessMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!_,useFog:s.fog,fogExp2:_&&_.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===y.isSkinnedMesh&&w>0,maxBones:w,useVertexTexture:h,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,morphTargetsCount:y.geometry&&y.geometry.morphAttributes.position?y.geometry.morphAttributes.position.length:0,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:s.format,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&m.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(zn(e.fragmentShader)),n.push(zn(e.vertexShader))),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<m.length;t++)n.push(e[m[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=Ms[e];n=is.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=a.length;t<e;t++){const e=a[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new Oa(t,n,e,s),a.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function ka(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function Ua(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Fa(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ba(t){const e=[];let n=0;const i=[],r=[],s=[],o={id:-1};function a(i,r,s,a,l,c){let h=e[n];const u=t.get(s);return void 0===h?(h={id:i.id,object:i,geometry:r,material:s,program:u.program||o,groupOrder:a,renderOrder:i.renderOrder,z:l,group:c},e[n]=h):(h.id=i.id,h.object=i,h.geometry=r,h.material=s,h.program=u.program||o,h.groupOrder=a,h.renderOrder=i.renderOrder,h.z=l,h.group=c),n++,h}return{opaque:i,transmissive:r,transparent:s,init:function(){n=0,i.length=0,r.length=0,s.length=0},push:function(t,e,n,o,l,c){const h=a(t,e,n,o,l,c);n.transmission>0?r.push(h):!0===n.transparent?s.push(h):i.push(h)},unshift:function(t,e,n,o,l,c){const h=a(t,e,n,o,l,c);n.transmission>0?r.unshift(h):!0===n.transparent?s.unshift(h):i.unshift(h)},finish:function(){for(let t=n,i=e.length;t<i;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Ua),r.length>1&&r.sort(e||Fa),s.length>1&&s.sort(e||Fa)}}}function za(t){let e=new WeakMap;return{get:function(n,i){let r;return!1===e.has(n)?(r=new Ba(t),e.set(n,[r])):i>=e.get(n).length?(r=new Ba(t),e.get(n).push(r)):r=e.get(n)[i],r},dispose:function(){e=new WeakMap}}}function Va(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Kn,color:new _r};break;case"SpotLight":n={position:new Kn,direction:new Kn,color:new _r,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Kn,color:new _r,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Kn,skyColor:new _r,groundColor:new _r};break;case"RectAreaLight":n={color:new _r,position:new Kn,halfWidth:new Kn,halfHeight:new Kn}}return t[e.id]=n,n}}}let Ha=0;function Wa(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function ja(t,e){const n=new Va,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new Kn);const s=new Kn,o=new Ai,a=new Ai;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0;s.sort(Wa);const y=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,_=e.intensity,x=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*_*y,l+=o.g*_*y,c+=o.b*_*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],_);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[h]=n,r.directionalShadowMap[h]=b,r.directionalShadowMatrix[h]=e.shadow.matrix,m++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(_*y),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.spotShadow[d]=n,r.spotShadowMap[d]=b,r.spotShadowMatrix[d]=e.shadow.matrix,v++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(o).multiplyScalar(_),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=b,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(_*y),t.groundColor.copy(e.groundColor).multiplyScalar(_*y),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=bs.LTC_FLOAT_1,r.rectAreaLTC2=bs.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=bs.LTC_HALF_1,r.rectAreaLTC2=bs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const _=r.hash;_.directionalLength===h&&_.pointLength===u&&_.spotLength===d&&_.rectAreaLength===p&&_.hemiLength===f&&_.numDirectionalShadows===m&&_.numPointShadows===g&&_.numSpotShadows===v||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=v,_.directionalLength=h,_.pointLength=u,_.spotLength=d,_.rectAreaLength=p,_.hemiLength=f,_.numDirectionalShadows=m,_.numPointShadows=g,_.numSpotShadows=v,r.version=Ha++)},setupView:function(t,e){let n=0,i=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),n++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),h++}}},state:r}}function qa(t,e){const n=new ja(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function Xa(t,e){let n=new WeakMap;return{get:function(i,r=0){let s;return!1===n.has(i)?(s=new qa(t,e),n.set(i,[s])):r>=n.get(i).length?(s=new qa(t,e),n.get(i).push(s)):s=n.get(i)[r],s},dispose:function(){n=new WeakMap}}}class Ya extends dr{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Ya.prototype.isMeshDepthMaterial=!0;class Ja extends dr{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Kn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Ja.prototype.isMeshDistanceMaterial=!0;function Za(t,e,n){let i=new gs;const r=new kn,s=new kn,o=new Xn,a=new Ya({depthPacking:3201}),l=new Ja,c={},h=n.maxTextureSize,u={0:1,1:0,2:2},d=new rs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new kn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Dr;f.setAttribute("position",new wr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Qr(f,d),g=this;function v(n,i){const r=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,p,m,null)}function y(e,n,i,r,s,o,h){let d=null;const p=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(d=void 0!==p?p:!0===r.isPointLight?l:a,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=d.uuid,e=i.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let r=n[e];void 0===r&&(r=d.clone(),n[e]=r),d=r}return d.visible=i.visible,d.wireframe=i.wireframe,d.side=3===h?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],d.alphaMap=i.alphaMap,d.alphaTest=i.alphaTest,d.clipShadows=i.clipShadows,d.clippingPlanes=i.clippingPlanes,d.clipIntersection=i.clipIntersection,d.displacementMap=i.displacementMap,d.displacementScale=i.displacementScale,d.displacementBias=i.displacementBias,d.wireframeLinewidth=i.wireframeLinewidth,d.linewidth=i.linewidth,!0===r.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(r.matrixWorld),d.nearDistance=s,d.farDistance=o),d}function _(n,r,s,o,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=y(n,0,h,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,c)}}}else if(r.visible){const e=y(n,0,r,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)_(l[t],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const p=u.getFrameExtents();if(r.multiply(p),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/p.x),r.x=s.x*p.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/p.y),r.y=s.y*p.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&3===this.type){const t={minFilter:1006,magFilter:1006,format:1023};u.map=new Yn(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.mapPass=new Yn(r.x,r.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:1003,magFilter:1003,format:1023};u.map=new Yn(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const f=u.getViewportCount();for(let t=0;t<f;t++){const e=u.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),u.updateMatrices(c,t),i=u.getFrustum(),_(n,a,u.camera,c,this.type)}u.isPointLightShadow||3!==this.type||v(u,a),u.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function Ka(t,e,n){const i=n.isWebGL2;const r=new function(){let e=!1;const n=new Xn;let i=null;const r=new Xn(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,o,a){!0===a&&(e*=o,i*=o,s*=o),n.set(e,i,s,o),!1===r.equals(n)&&(t.clearColor(e,i,s,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?G(2929):k(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},o=new function(){let e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?G(2960):k(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&s===o||(t.stencilFunc(e,n,o),i=e,r=n,s=o)},setOp:function(e,n,i){o===e&&a===n&&l===i||(t.stencilOp(e,n,i),o=e,a=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null}}};let a={},l={},c=null,h=!1,u=null,d=null,p=null,f=null,m=null,g=null,v=null,y=!1,_=null,x=null,b=null,M=null,w=null;const E=t.getParameter(35661);let S=!1,T=0;const R=t.getParameter(7938);-1!==R.indexOf("WebGL")?(T=parseFloat(/^WebGL (\d)/.exec(R)[1]),S=T>=1):-1!==R.indexOf("OpenGL ES")&&(T=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),S=T>=2);let A=null,C={};const P=t.getParameter(3088),L=t.getParameter(2978),I=(new Xn).fromArray(P),N=(new Xn).fromArray(L);function D(e,n,i){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<i;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,r);return s}const O={};function G(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function k(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}O[3553]=D(3553,3553,1),O[34067]=D(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),G(2929),s.setFunc(3),z(!1),V(1),G(2884),B(0);const U={100:32774,101:32778,102:32779};if(i)U[103]=32775,U[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(U[103]=t.MIN_EXT,U[104]=t.MAX_EXT)}const F={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function B(e,n,i,r,s,o,a,l){if(0!==e){if(!1===h&&(G(3042),h=!0),5===e)s=s||n,o=o||i,a=a||r,n===d&&s===m||(t.blendEquationSeparate(U[n],U[s]),d=n,m=s),i===p&&r===f&&o===g&&a===v||(t.blendFuncSeparate(F[i],F[r],F[o],F[a]),p=i,f=r,g=o,v=a),u=e,y=null;else if(e!==u||l!==y){if(100===d&&100===m||(t.blendEquation(32774),d=100,m=100),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}p=null,f=null,g=null,v=null,u=e,y=l}}else!0===h&&(k(3042),h=!1)}function z(e){_!==e&&(e?t.frontFace(2304):t.frontFace(2305),_=e)}function V(e){0!==e?(G(2884),e!==x&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):k(2884),x=e}function H(e,n,i){e?(G(32823),M===n&&w===i||(t.polygonOffset(n,i),M=n,w=i)):k(32823)}function W(e){void 0===e&&(e=33984+E-1),A!==e&&(t.activeTexture(e),A=e)}return{buffers:{color:r,depth:s,stencil:o},enable:G,disable:k,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,i&&(36009===e&&(l[36160]=n),36160===e&&(l[36009]=n)),!0)},useProgram:function(e){return c!==e&&(t.useProgram(e),c=e,!0)},setBlending:B,setMaterial:function(t,e){2===t.side?k(2884):G(2884);let n=1===t.side;e&&(n=!n),z(n),1===t.blending&&!1===t.transparent?B(0):B(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);const i=t.stencilWrite;o.setTest(i),i&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),H(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?G(32926):k(32926)},setFlipSided:z,setCullFace:V,setLineWidth:function(e){e!==b&&(S&&t.lineWidth(e),b=e)},setPolygonOffset:H,setScissorTest:function(t){t?G(3089):k(3089)},activeTexture:W,bindTexture:function(e,n){null===A&&W();let i=C[A];void 0===i&&(i={type:void 0,texture:void 0},C[A]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||O[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=C[A];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===I.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),I.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===i&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},A=null,C={},l={},c=null,h=!1,u=null,d=null,p=null,f=null,m=null,g=null,v=null,y=!1,_=null,x=null,b=null,M=null,w=null,I.set(0,0,t.canvas.width,t.canvas.height),N.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),o.reset()}}}function Qa(t,e,n,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):void 0,p=new WeakMap;let f,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function g(t,e){return m?new OffscreenCanvas(t,e):Bn("canvas")}function v(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?Gn:Math.floor,s=i(r*t.width),o=i(r*t.height);void 0===f&&(f=g(s,o));const a=n?g(s,o):f;a.width=s,a.height=o;return a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return On(t.width)&&On(t.height)}function _(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function x(e){t.generateMipmap(e)}function b(n,i,r){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=i;return 6403===i&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),6407===i&&(5126===r&&(s=34837),5131===r&&(s=34843),5121===r&&(s=32849)),6408===i&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function M(t){return 1003===t||1004===t||1005===t?9728:9729}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=i.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),i.remove(e)}(n),n.isVideoTexture&&p.delete(n),o.memory.textures--}function E(e){const n=e.target;n.removeEventListener("dispose",E),function(e){const n=e.texture,r=i.get(e),s=i.get(n);if(!e)return;void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),i.remove(n[e])}i.remove(n),i.remove(e)}(n)}let S=0;function T(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void I(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function R(e,r){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,i,r){if(6!==i.image.length)return;L(e,i),n.activeTexture(33984+r),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const o=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=o||l?l?i.image[t].image:i.image[t]:v(i.image[t],!1,!0,c);const u=y(h[0])||a,d=s.convert(i.format),p=s.convert(i.type),f=b(i.internalFormat,d,p,i.encoding);let m;if(P(34067,i,u),o)for(let t=0;t<6;t++){m=h[t].mipmaps;for(let e=0;e<m.length;e++){const r=m[e];1023!==i.format&&1022!==i.format?null!==d?n.compressedTexImage2D(34069+t,e,f,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,f,r.width,r.height,0,d,p,r.data)}}else{m=i.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,f,h[t].width,h[t].height,0,d,p,h[t].data);for(let e=0;e<m.length;e++){const i=m[e].image[t].image;n.texImage2D(34069+t,e+1,f,i.width,i.height,0,d,p,i.data)}}else{n.texImage2D(34069+t,0,f,d,p,h[t]);for(let e=0;e<m.length;e++){const i=m[e];n.texImage2D(34069+t,e+1,f,d,p,i.image[t])}}}_(i,u)&&x(34067);e.__version=i.version,i.onUpdate&&i.onUpdate(i)}(o,e,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))}const A={1e3:10497,1001:33071,1002:33648},C={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function P(n,s,o){if(o?(t.texParameteri(n,10242,A[s.wrapS]),t.texParameteri(n,10243,A[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,A[s.wrapR]),t.texParameteri(n,10240,C[s.magFilter]),t.texParameteri(n,10241,C[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),1001===s.wrapS&&1001===s.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,M(s.magFilter)),t.texParameteri(n,10241,M(s.minFilter)),1003!==s.minFilter&&1006!==s.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(1015===s.type&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&1016===s.type&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function L(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),o.memory.textures++)}function I(e,i,r){let o=3553;i.isDataTexture2DArray&&(o=35866),i.isDataTexture3D&&(o=32879),L(e,i),n.activeTexture(33984+r),n.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!a&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)}(i)&&!1===y(i.image),c=v(i.image,l,!1,h),u=y(c)||a,d=s.convert(i.format);let p,f=s.convert(i.type),m=b(i.internalFormat,d,f,i.encoding);P(o,i,u);const g=i.mipmaps;if(i.isDepthTexture)m=6402,a?m=1015===i.type?36012:1014===i.type?33190:1020===i.type?35056:33189:1015===i.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===i.format&&6402===m&&1012!==i.type&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=1012,f=s.convert(i.type)),1027===i.format&&6402===m&&(m=34041,1020!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=1020,f=s.convert(i.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(i.isDataTexture)if(g.length>0&&u){for(let t=0,e=g.length;t<e;t++)p=g[t],n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data);else if(i.isCompressedTexture)for(let t=0,e=g.length;t<e;t++)p=g[t],1023!==i.format&&1022!==i.format?null!==d?n.compressedTexImage2D(3553,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data);else if(i.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data);else{const t=function(t,e,n){return!0===_(t,n)?Math.log2(Math.max(e.width,e.height))+1:t.mipmaps.length>0?t.mipmaps.length:1}(i,c,u),r=a&&!0!==i.isVideoTexture,s=void 0===e.__version;if(g.length>0&&u){r&&s&&n.texStorage2D(3553,t,m,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)p=g[t],r?n.texSubImage2D(3553,t,0,0,d,f,p):n.texImage2D(3553,t,m,d,f,p);i.generateMipmaps=!1}else r?(s&&n.texStorage2D(3553,t,m,c.width,c.height),n.texSubImage2D(3553,0,0,0,d,f,c)):n.texImage2D(3553,0,m,d,f,c)}_(i,u)&&x(o),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function N(e,r,o,a,l){const c=s.convert(o.format),h=s.convert(o.type),u=b(o.internalFormat,c,h,o.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):n.texImage2D(l,0,u,r.width,r.height,0,c,h,null)),n.bindFramebuffer(36160,e),r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,a,l,i.get(o).__webglTexture,0,G(r)):t.framebufferTexture2D(36160,a,l,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function D(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||n.useRenderToTexture){const e=n.depthTexture;e&&e.isDepthTexture&&(1015===e.type?r=36012:1014===e.type&&(r=33190));const i=G(n);n.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=G(n);i&&n.useRenderbuffer?t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):n.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,r=s.convert(e.format),o=s.convert(e.type),a=b(e.internalFormat,r,o,e.encoding),l=G(n);i&&n.useRenderbuffer?t.renderbufferStorageMultisample(36161,l,a,n.width,n.height):n.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,l,a,n.width,n.height):t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function O(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),T(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=G(r);if(1026===r.depthTexture.format)r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(1027!==r.depthTexture.format)throw new Error("Unknown depthTexture format");r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),D(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),D(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function G(t){return a&&(t.useRenderbuffer||t.useRenderToTexture)?Math.min(u,t.samples):0}let k=!1,U=!1;this.allocateTextureUnit=function(){const t=S;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?I(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?I(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=R,this.rebindTextures=function(t,e,n){const r=i.get(t);void 0!==e&&N(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&O(t)},this.setupRenderTarget=function(e){const l=e.texture,c=i.get(e),h=i.get(l);e.addEventListener("dispose",E),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=l.isDataTexture3D||l.isDataTexture2DArray,f=y(e)||a;if(!a||1022!==l.format||1015!==l.type&&1016!==l.type||(l.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(e.useRenderbuffer)if(a){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const i=s.convert(l.format),r=s.convert(l.type),o=b(l.internalFormat,i,r,l.encoding),a=G(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),D(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(34067,h.__webglTexture),P(34067,l,f);for(let t=0;t<6;t++)N(c.__webglFramebuffer[t],e,l,36064,34069+t);_(l,f)&&x(34067),n.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=i.get(s);n.bindTexture(3553,o.__webglTexture),P(3553,s,f),N(c.__webglFramebuffer,e,s,36064+r,3553),_(s,f)&&x(3553)}n.unbindTexture()}else{let t=3553;if(p)if(a){t=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(t,h.__webglTexture),P(t,l,f),N(c.__webglFramebuffer,e,l,36064,t),_(l,f)&&x(t),n.unbindTexture()}e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(t){const e=y(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(_(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=i.get(o).__webglTexture;n.bindTexture(e,r),x(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.useRenderbuffer)if(a){const r=e.width,s=e.height;let o=16384;const a=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&a.push(l),e.ignoreDepthForMultisampleCopy||(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024));const c=i.get(e);n.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,c.__webglFramebuffer),e.ignoreDepthForMultisampleCopy&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),t.invalidateFramebuffer(36008,a),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=N,this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),R(t,e)}}function $a(t,e,n){const i=n.isWebGL2;return{convert:function(t){let n;if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t)return i?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):36492===t?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):1020===t?i?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class tl extends os{constructor(t=[]){super(),this.cameras=t}}tl.prototype.isArrayCamera=!0;class el extends $i{constructor(){super(),this.type="Group"}}el.prototype.isGroup=!0;const nl={type:"move"};class il{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new el,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new el,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Kn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Kn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new el,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Kn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Kn),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(i=e.getPose(t.targetRaySpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(nl))),l&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const t=new el;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[i.jointName]=t,l.add(t)}const r=l.joints[i.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class rl extends jn{constructor(t,e,n,i,r,s,o,a,l,c){if(1026!==(c=void 0!==c?c:1026)&&1027!==c)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===c&&(n=1012),void 0===n&&1027===c&&(n=1020),super(null,i,r,s,o,a,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:1003,this.minFilter=void 0!==a?a:1003,this.flipY=!1,this.generateMipmaps=!1}}rl.prototype.isDepthTexture=!0;class sl extends Rn{constructor(t,e){super();const n=this;let i=null,r=1,s=null,o="local-floor";const a=t.extensions.has("WEBGL_multisampled_render_to_texture");let l=null,c=null,h=null,u=null,d=!1,p=null;const f=e.getContextAttributes();let m=null,g=null;const v=[],y=new Map,_=new os;_.layers.enable(1),_.viewport=new Xn;const x=new os;x.layers.enable(2),x.viewport=new Xn;const b=[_,x],M=new tl;M.layers.enable(1),M.layers.enable(2);let w=null,E=null;function S(t){const e=y.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function T(){y.forEach((function(t,e){t.disconnect(e)})),y.clear(),w=null,E=null,t.setRenderTarget(m),u=null,h=null,c=null,i=null,g=null,I.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function R(t){const e=i.inputSources;for(let t=0;t<v.length;t++)y.set(e[t],v[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=y.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),y.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],i=y.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new il,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new il,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new il,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==h?h:u},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(l){if(i=l,null!==i){if(m=t.getRenderTarget(),i.addEventListener("select",S),i.addEventListener("selectstart",S),i.addEventListener("selectend",S),i.addEventListener("squeeze",S),i.addEventListener("squeezestart",S),i.addEventListener("squeezeend",S),i.addEventListener("end",T),i.addEventListener("inputsourceschange",R),!0!==f.xrCompatible&&await e.makeXRCompatible(),void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const t={antialias:void 0!==i.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(i,e,t),i.updateRenderState({baseLayer:u}),g=new Yn(u.framebufferWidth,u.framebufferHeight)}else{d=f.antialias;let t=null,n=null,s=null;f.depth&&(s=f.stencil?35056:33189,t=f.stencil?1027:1026,n=f.stencil?1020:1012);const o={colorFormat:f.alpha||d?32856:32849,depthFormat:s,scaleFactor:r};c=new XRWebGLBinding(i,e),h=c.createProjectionLayer(o),i.updateRenderState({layers:[h]}),g=d?new Jn(h.textureWidth,h.textureHeight,{format:1023,type:1009,depthTexture:new rl(h.textureWidth,h.textureHeight,n,void 0,void 0,void 0,void 0,void 0,void 0,t),stencilBuffer:f.stencil,ignoreDepth:h.ignoreDepthValues,useRenderToTexture:a}):new Yn(h.textureWidth,h.textureHeight,{format:f.alpha?1023:1022,type:1009,depthTexture:new rl(h.textureWidth,h.textureHeight,n,void 0,void 0,void 0,void 0,void 0,void 0,t),stencilBuffer:f.stencil,ignoreDepth:h.ignoreDepthValues})}this.setFoveation(0),s=await i.requestReferenceSpace(o),I.setContext(i),I.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const A=new Kn,C=new Kn;function P(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;M.near=x.near=_.near=t.near,M.far=x.far=_.far=t.far,w===M.near&&E===M.far||(i.updateRenderState({depthNear:M.near,depthFar:M.far}),w=M.near,E=M.far);const e=t.parent,n=M.cameras;P(M,e);for(let t=0;t<n.length;t++)P(n[t],e);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),t.position.copy(M.position),t.quaternion.copy(M.quaternion),t.scale.copy(M.scale),t.matrix.copy(M.matrix),t.matrixWorld.copy(M.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===n.length?function(t,e,n){A.setFromMatrixPosition(e.matrixWorld),C.setFromMatrixPosition(n.matrixWorld);const i=A.distanceTo(C),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,p=o*u,f=i/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,v=a+f,y=d-m,_=p+(i-m),x=l*a/v*g,b=c*a/v*g;t.projectionMatrix.makePerspective(y,_,x,b,g,v)}(M,_,x):M.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==h&&(h.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let L=null;const I=new vs;I.setAnimationLoop((function(e,n){if(l=n.getViewerPose(s),p=n,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(g,u.framebuffer),t.setRenderTarget(g));let n=!1;e.length!==M.cameras.length&&(M.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==u)s=u.getViewport(r);else{const e=c.getViewSubImage(h,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(g,e.colorTexture,h.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}const o=b[i];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&M.matrix.copy(o.matrix),!0===n&&M.cameras.push(o)}}const r=i.inputSources;for(let t=0;t<v.length;t++){const e=v[t],i=r[t];e.update(i,n,s)}L&&L(e,n),p=null})),this.setAnimationLoop=function(t){L=t},this.dispose=function(){}}}function ol(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest);const i=t.get(n).envMap;let r,s;i&&(e.envMap.value=i,e.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,e.reflectivity.value=n.reflectivity,e.ior.value=n.ior,e.refractionRatio.value=n.refractionRatio),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,s,o){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i),i.isMeshPhysicalMaterial?function(t,e,i){n(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,i,o):n(t,i)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,r,s):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function al(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=Bn("canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,d=null;const p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,_=null,x=-1,b=null;const M=new Xn,w=new Xn;let E=null,S=e.width,T=e.height,R=1,A=null,C=null;const P=new Xn(0,0,S,T),L=new Xn(0,0,S,T);let I=!1;const N=[],D=new gs;let O=!1,G=!1,k=null;const U=new Ai,F=new Kn,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===_?R:1}let V,H,W,j,q,X,Y,J,Z,K,Q,$,tt,et,nt,it,rt,st,ot,at,lt,ct,ht,ut=n;function dt(t,n){for(let i=0;i<t.length;i++){const r=t[i],s=e.getContext(r,n);if(null!==s)return s}return null}try{const t={alpha:i,depth:r,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r135"),e.addEventListener("webglcontextlost",mt,!1),e.addEventListener("webglcontextrestored",gt,!1),null===ut){const e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),ut=dt(e,t),null===ut)throw dt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ut.getShaderPrecisionFormat&&(ut.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function pt(){V=new to(ut),H=new Ts(ut,V,t),V.init(H),ct=new $a(ut,V,H),W=new Ka(ut,V,H),N[0]=1029,j=new io(ut),q=new ka,X=new Qa(ut,V,W,q,H,ct,j),Y=new As(m),J=new $s(m),Z=new ys(ut,H),ht=new Es(ut,V,Z,H),K=new eo(ut,Z,j,ht),Q=new co(ut,K,Z,j),ot=new lo(ut,H,X),it=new Rs(q),$=new Ga(m,Y,J,V,H,ht,it),tt=new ol(q),et=new za(q),nt=new Xa(V,H),st=new ws(m,Y,W,Q,a),rt=new Za(m,Q,H),at=new Ss(ut,V,j,H),lt=new no(ut,V,j,H),j.programs=$.programs,m.capabilities=H,m.extensions=V,m.properties=q,m.renderLists=et,m.shadowMap=rt,m.state=W,m.info=j}pt();const ft=new sl(m,ut);function mt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function gt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const t=j.autoReset,e=rt.enabled,n=rt.autoUpdate,i=rt.needsUpdate,r=rt.type;pt(),j.autoReset=t,rt.enabled=e,rt.autoUpdate=n,rt.needsUpdate=i,rt.type=r}function vt(t){const e=t.target;e.removeEventListener("dispose",vt),function(t){(function(t){const e=q.get(t).programs;void 0!==e&&e.forEach((function(t){$.releaseProgram(t)}))})(t),q.remove(t)}(e)}this.xr=ft,this.getContext=function(){return ut},this.getContextAttributes=function(){return ut.getContextAttributes()},this.forceContextLoss=function(){const t=V.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=V.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(t){void 0!==t&&(R=t,this.setSize(S,T,!1))},this.getSize=function(t){return t.set(S,T)},this.setSize=function(t,n,i){ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=t,T=n,e.width=Math.floor(t*R),e.height=Math.floor(n*R),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(S*R,T*R).floor()},this.setDrawingBufferSize=function(t,n,i){S=t,T=n,R=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(M)},this.getViewport=function(t){return t.copy(P)},this.setViewport=function(t,e,n,i){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,n,i),W.viewport(M.copy(P).multiplyScalar(R).floor())},this.getScissor=function(t){return t.copy(L)},this.setScissor=function(t,e,n,i){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,i),W.scissor(w.copy(L).multiplyScalar(R).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(t){W.setScissorTest(I=t)},this.setOpaqueSort=function(t){A=t},this.setTransparentSort=function(t){C=t},this.getClearColor=function(t){return t.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor.apply(st,arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha.apply(st,arguments)},this.clear=function(t,e,n){let i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),ut.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",mt,!1),e.removeEventListener("webglcontextrestored",gt,!1),et.dispose(),nt.dispose(),q.dispose(),Y.dispose(),J.dispose(),Q.dispose(),ht.dispose(),ft.dispose(),ft.removeEventListener("sessionstart",_t),ft.removeEventListener("sessionend",xt),k&&(k.dispose(),k=null),bt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=B);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,n,i,r){!0!==e.isScene&&(e=B);X.resetTextureUnits();const s=e.fog,o=i.isMeshStandardMaterial?e.environment:null,a=null===_?m.outputEncoding:_.texture.encoding,l=(i.isMeshStandardMaterial?J:Y).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!i.normalMap&&!!n.attributes.tangent,u=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,f=n.morphAttributes.position?n.morphAttributes.position.length:0,g=q.get(i),v=d.state.lights;if(!0===O&&(!0===G||t!==b)){const e=t===b&&i.id===x;it.setState(i,t,e)}let y=!1;i.version===g.__version?g.needsLights&&g.lightsStateVersion!==v.state.version||g.outputEncoding!==a||r.isInstancedMesh&&!1===g.instancing?y=!0:r.isInstancedMesh||!0!==g.instancing?r.isSkinnedMesh&&!1===g.skinning?y=!0:r.isSkinnedMesh||!0!==g.skinning?g.envMap!==l||i.fog&&g.fog!==s?y=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===it.numPlanes&&g.numIntersection===it.numIntersection?(g.vertexAlphas!==c||g.vertexTangents!==h||g.morphTargets!==u||g.morphNormals!==p||!0===H.isWebGL2&&g.morphTargetsCount!==f)&&(y=!0):y=!0:y=!0:y=!0:(y=!0,g.__version=i.version);let M=g.currentProgram;!0===y&&(M=St(i,e,r));let w=!1,E=!1,S=!1;const A=M.getUniforms(),C=g.uniforms;W.useProgram(M.program)&&(w=!0,E=!0,S=!0);i.id!==x&&(x=i.id,E=!0);if(w||b!==t){if(A.setValue(ut,"projectionMatrix",t.projectionMatrix),H.logarithmicDepthBuffer&&A.setValue(ut,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),b!==t&&(b=t,E=!0,S=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=A.map.cameraPosition;void 0!==e&&e.setValue(ut,F.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&A.setValue(ut,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&A.setValue(ut,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){A.setOptional(ut,r,"bindMatrix"),A.setOptional(ut,r,"bindMatrixInverse");const t=r.skeleton;t&&(H.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),A.setValue(ut,"boneTexture",t.boneTexture,X),A.setValue(ut,"boneTextureSize",t.boneTextureSize)):A.setOptional(ut,t,"boneMatrices"))}!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ot.update(r,n,i,M);(E||g.receiveShadow!==r.receiveShadow)&&(g.receiveShadow=r.receiveShadow,A.setValue(ut,"receiveShadow",r.receiveShadow));E&&(A.setValue(ut,"toneMappingExposure",m.toneMappingExposure),g.needsLights&&(L=S,(P=C).ambientLightColor.needsUpdate=L,P.lightProbe.needsUpdate=L,P.directionalLights.needsUpdate=L,P.directionalLightShadows.needsUpdate=L,P.pointLights.needsUpdate=L,P.pointLightShadows.needsUpdate=L,P.spotLights.needsUpdate=L,P.spotLightShadows.needsUpdate=L,P.rectAreaLights.needsUpdate=L,P.hemisphereLights.needsUpdate=L),s&&i.fog&&tt.refreshFogUniforms(C,s),tt.refreshMaterialUniforms(C,i,R,T,k),ma.upload(ut,g.uniformsList,C,X));var P,L;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ma.upload(ut,g.uniformsList,C,X),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&A.setValue(ut,"center",r.center);return A.setValue(ut,"modelViewMatrix",r.modelViewMatrix),A.setValue(ut,"normalMatrix",r.normalMatrix),A.setValue(ut,"modelMatrix",r.matrixWorld),M}(t,e,n,i,r);W.setMaterial(i,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===i.wireframe&&(l=K.getWireframeAttribute(n),u=2),ht.setup(r,i,a,n,l);let p=at;null!==l&&(h=Z.get(l),p=lt,p.setIndex(h));const f=null!==l?l.count:c.count,g=n.drawRange.start*u,v=n.drawRange.count*u,y=null!==s?s.start*u:0,M=null!==s?s.count*u:1/0,w=Math.max(g,y),E=Math.min(f,g+v,y+M)-1,S=Math.max(0,E-w+1);if(0!==S){if(r.isMesh)!0===i.wireframe?(W.setLineWidth(i.wireframeLinewidth*z()),p.setMode(1)):p.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),W.setLineWidth(t*z()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(w,S,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(w,S,t)}else p.render(w,S)}},this.compile=function(t,e){d=nt.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++){St(n[i],t,e)}else St(n,t,e)})),f.pop(),d=null};let yt=null;function _t(){bt.stop()}function xt(){bt.start()}const bt=new vs;function Mt(t,e,n,i){const r=t.opaque,s=t.transmissive,a=t.transparent;d.setupLightsView(n),s.length>0&&function(t,e,n){if(null===k){const t=!0===o&&!0===H.isWebGL2;k=new(t?Jn:Yn)(1024,1024,{generateMipmaps:!0,type:null!==ct.convert(1016)?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001,useRenderToTexture:V.has("WEBGL_multisampled_render_to_texture")})}const i=m.getRenderTarget();m.setRenderTarget(k),m.clear();const r=m.toneMapping;m.toneMapping=0,wt(t,e,n),m.toneMapping=r,X.updateMultisampleRenderTarget(k),X.updateRenderTargetMipmap(k),m.setRenderTarget(i)}(r,e,n),i&&W.viewport(M.copy(i)),r.length>0&&wt(r,e,n),s.length>0&&wt(s,e,n),a.length>0&&wt(a,e,n)}function wt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===i?s.material:i,c=s.group;o.layers.test(n.layers)&&Et(o,e,n,a,l,c)}}function Et(t,e,n,i,r,s){t.onBeforeRender(m,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,n,i,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(n,e,i,r,t,s),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(n,e,i,r,t,s),r.side=2):m.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(m,e,n,i,r,s)}function St(t,e,n){!0!==e.isScene&&(e=B);const i=q.get(t),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=$.getParameters(t,r.state,s,e,n),l=$.getProgramCacheKey(a);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?J:Y).get(t.envMap||i.environment),void 0===c&&(t.addEventListener("dispose",vt),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===o)return Tt(t,a),h}else a.uniforms=$.getUniforms(t),t.onBuild(n,a,m),t.onBeforeCompile(a,m),h=$.acquireProgram(a,l),c.set(l,h),i.uniforms=a.uniforms;const u=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=it.uniform),Tt(t,a),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=h.getUniforms(),f=ma.seqWithValue(p.seq,u);return i.currentProgram=h,i.uniformsList=f,h}function Tt(t,e){const n=q.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents}bt.setAnimationLoop((function(t){yt&&yt(t)})),"undefined"!=typeof window&&bt.setContext(window),this.setAnimationLoop=function(t){yt=t,ft.setAnimationLoop(t),null===t?bt.stop():bt.start()},ft.addEventListener("sessionstart",_t),ft.addEventListener("sessionend",xt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ft.enabled&&!0===ft.isPresenting&&(!0===ft.cameraAutoUpdate&&ft.updateCamera(e),e=ft.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,_),d=nt.get(t,f.length),d.init(),f.push(d),U.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(U),G=this.localClippingEnabled,O=it.init(this.clippingPlanes,G,e),u=et.get(t,p.length),u.init(),p.push(u),function t(e,n,i,r){if(!1===e.visible)return;if(e.layers.test(n.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(n);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||D.intersectsSprite(e)){r&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=Q.update(e),n=e.material;n.visible&&u.push(e,t,n,i,F.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==j.render.frame&&(e.skeleton.update(),e.skeleton.frame=j.render.frame),!e.frustumCulled||D.intersectsObject(e))){r&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=Q.update(e),n=e.material;if(Array.isArray(n)){const r=t.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=n[o.materialIndex];a&&a.visible&&u.push(e,t,a,i,F.z,o)}}else n.visible&&u.push(e,t,n,i,F.z,null)}const s=e.children;for(let e=0,o=s.length;e<o;e++)t(s[e],n,i,r)}(t,e,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(A,C),!0===O&&it.beginShadows();const n=d.state.shadowsArray;if(rt.render(n,t,e),!0===O&&it.endShadows(),!0===this.info.autoReset&&this.info.reset(),st.render(u,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Mt(u,t,i,i.viewport)}}else Mt(u,t,e);null!==_&&(X.updateMultisampleRenderTarget(_),X.updateRenderTargetMipmap(_)),!0===t.isScene&&t.onAfterRender(m,t,e),W.buffers.depth.setTest(!0),W.buffers.depth.setMask(!0),W.buffers.color.setMask(!0),W.setPolygonOffset(!1),ht.resetDefaultState(),x=-1,b=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(t,e,n){q.get(t.texture).__webglTexture=e,q.get(t.depthTexture).__webglTexture=n;const i=q.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||t.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),t.useRenderToTexture=!1,t.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(t,e){const n=q.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){_=t,v=e,y=n;let i=!0;if(t){const e=q.get(t);void 0!==e.__useDefaultFramebuffer?(W.bindFramebuffer(36160,null),i=!1):void 0===e.__webglFramebuffer?X.setupRenderTarget(t):e.__hasExternalTextures&&X.rebindTextures(t,q.get(t.texture).__webglTexture,q.get(t.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(t){const n=t.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(o=!0);const i=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=i[e],s=!0):r=t.useRenderbuffer?q.get(t).__webglMultisampledFramebuffer:i,M.copy(t.viewport),w.copy(t.scissor),E=t.scissorTest}else M.copy(P).multiplyScalar(R).floor(),w.copy(L).multiplyScalar(R).floor(),E=I;if(W.bindFramebuffer(36160,r)&&H.drawBuffers&&i){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const n=t.texture;if(N.length!==n.length||36064!==N[0]){for(let t=0,e=n.length;t<e;t++)N[t]=36064+t;N.length=n.length,e=!0}}else 1===N.length&&36064===N[0]||(N[0]=36064,N.length=1,e=!0);else 1===N.length&&1029===N[0]||(N[0]=1029,N.length=1,e=!0);e&&(H.isWebGL2?ut.drawBuffers(N):V.get("WEBGL_draw_buffers").drawBuffersWEBGL(N))}if(W.viewport(M),W.scissor(w),W.setScissorTest(E),s){const i=q.get(t.texture);ut.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}else if(o){const i=q.get(t.texture),r=e||0;ut.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}x=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){W.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,l=o.type;if(1023!==a&&ct.convert(a)!==ut.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=1016===l&&(V.has("EXT_color_buffer_half_float")||H.isWebGL2&&V.has("EXT_color_buffer_float"));if(!(1009===l||ct.convert(l)===ut.getParameter(35738)||1015===l&&(H.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ut.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&ut.readPixels(e,n,i,r,ct.convert(a),ct.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==_?q.get(_).__webglFramebuffer:null;W.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);let o=ct.convert(e.format);H.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),X.setTexture2D(e,0),ut.copyTexImage2D(3553,n,o,t.x,t.y,r,s,0),W.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,o=ct.convert(n.format),a=ct.convert(n.type);X.setTexture2D(n,0),ut.pixelStorei(37440,n.flipY),ut.pixelStorei(37441,n.premultiplyAlpha),ut.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ut.texSubImage2D(3553,i,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?ut.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):ut.texSubImage2D(3553,i,t.x,t.y,o,a,e.image),0===i&&n.generateMipmaps&&ut.generateMipmap(3553),W.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=ct.convert(i.format),c=ct.convert(i.type);let h;if(i.isDataTexture3D)X.setTexture3D(i,0),h=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(i,0),h=35866}ut.pixelStorei(37440,i.flipY),ut.pixelStorei(37441,i.premultiplyAlpha),ut.pixelStorei(3317,i.unpackAlignment);const u=ut.getParameter(3314),d=ut.getParameter(32878),p=ut.getParameter(3316),f=ut.getParameter(3315),g=ut.getParameter(32877),v=n.isCompressedTexture?n.mipmaps[0]:n.image;ut.pixelStorei(3314,v.width),ut.pixelStorei(32878,v.height),ut.pixelStorei(3316,t.min.x),ut.pixelStorei(3315,t.min.y),ut.pixelStorei(32877,t.min.z),n.isDataTexture||n.isDataTexture3D?ut.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,v.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ut.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,v.data)):ut.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,v),ut.pixelStorei(3314,u),ut.pixelStorei(32878,d),ut.pixelStorei(3316,p),ut.pixelStorei(3315,f),ut.pixelStorei(32877,g),0===r&&i.generateMipmaps&&ut.generateMipmap(h),W.unbindTexture()},this.initTexture=function(t){X.setTexture2D(t,0),W.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,W.reset(),ht.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}al.prototype.isWebGLRenderer=!0;(class extends al{}).prototype.isWebGL1Renderer=!0;class ll{constructor(t,e=25e-5){this.name="",this.color=new _r(t),this.density=e}clone(){return new ll(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}ll.prototype.isFogExp2=!0;class cl{constructor(t,e=1,n=1e3){this.name="",this.color=new _r(t),this.near=e,this.far=n}clone(){return new cl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}cl.prototype.isFog=!0;class hl extends $i{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}hl.prototype.isScene=!0;class ul{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ln()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ln()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ln()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ul.prototype.isInterleavedBuffer=!0;const dl=new Kn;class pl{constructor(t,e,n,i=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)dl.x=this.getX(e),dl.y=this.getY(e),dl.z=this.getZ(e),dl.applyMatrix4(t),this.setXYZ(e,dl.x,dl.y,dl.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)dl.x=this.getX(e),dl.y=this.getY(e),dl.z=this.getZ(e),dl.applyNormalMatrix(t),this.setXYZ(e,dl.x,dl.y,dl.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)dl.x=this.getX(e),dl.y=this.getY(e),dl.z=this.getZ(e),dl.transformDirection(t),this.setXYZ(e,dl.x,dl.y,dl.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new wr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new pl(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}pl.prototype.isInterleavedBufferAttribute=!0;class fl extends dr{constructor(t){super(),this.type="SpriteMaterial",this.color=new _r(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let ml;fl.prototype.isSpriteMaterial=!0;const gl=new Kn,vl=new Kn,yl=new Kn,_l=new kn,xl=new kn,bl=new Ai,Ml=new Kn,wl=new Kn,El=new Kn,Sl=new kn,Tl=new kn,Rl=new kn;class Al extends $i{constructor(t){if(super(),this.type="Sprite",void 0===ml){ml=new Dr;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ul(t,5);ml.setIndex([0,1,2,0,2,3]),ml.setAttribute("position",new pl(e,3,0,!1)),ml.setAttribute("uv",new pl(e,2,3,!1))}this.geometry=ml,this.material=void 0!==t?t:new fl,this.center=new kn(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),vl.setFromMatrixScale(this.matrixWorld),bl.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),yl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&vl.multiplyScalar(-yl.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;Cl(Ml.set(-.5,-.5,0),yl,s,vl,i,r),Cl(wl.set(.5,-.5,0),yl,s,vl,i,r),Cl(El.set(.5,.5,0),yl,s,vl,i,r),Sl.set(0,0),Tl.set(1,0),Rl.set(1,1);let o=t.ray.intersectTriangle(Ml,wl,El,!1,gl);if(null===o&&(Cl(wl.set(-.5,.5,0),yl,s,vl,i,r),Tl.set(0,1),o=t.ray.intersectTriangle(Ml,El,wl,!1,gl),null===o))return;const a=t.ray.origin.distanceTo(gl);a<t.near||a>t.far||e.push({distance:a,point:gl.clone(),uv:hr.getUV(gl,Ml,wl,El,Sl,Tl,Rl,new kn),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Cl(t,e,n,i,r,s){_l.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(xl.x=s*_l.x-r*_l.y,xl.y=r*_l.x+s*_l.y):xl.copy(_l),t.copy(e),t.x+=xl.x,t.y+=xl.y,t.applyMatrix4(bl)}Al.prototype.isSprite=!0;const Pl=new Kn,Ll=new Xn,Il=new Xn,Nl=new Kn,Dl=new Ai;class Ol extends Qr{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ai,this.bindMatrixInverse=new Ai}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Xn,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,i=this.geometry;Ll.fromBufferAttribute(i.attributes.skinIndex,t),Il.fromBufferAttribute(i.attributes.skinWeight,t),Pl.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const i=Il.getComponent(t);if(0!==i){const r=Ll.getComponent(t);Dl.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(Nl.copy(Pl).applyMatrix4(Dl),i)}}return e.applyMatrix4(this.bindMatrixInverse)}}Ol.prototype.isSkinnedMesh=!0;class Gl extends $i{constructor(){super(),this.type="Bone"}}Gl.prototype.isBone=!0;class kl extends jn{constructor(t=null,e=1,n=1,i,r,s,o,a,l=1003,c=1003,h,u){super(null,s,o,a,l,c,i,r,h,u),this.image={data:t,width:e,height:n},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}kl.prototype.isDataTexture=!0;class Ul extends wr{constructor(t,e,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Ul.prototype.isInstancedBufferAttribute=!0;const Fl=new Ai,Bl=new Ai,zl=[],Vl=new Qr;class Hl extends Qr{constructor(t,e,n){super(t,e),this.instanceMatrix=new Ul(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Vl.geometry=this.geometry,Vl.material=this.material,void 0!==Vl.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Fl),Bl.multiplyMatrices(n,Fl),Vl.matrixWorld=Bl,Vl.raycast(t,zl);for(let t=0,n=zl.length;t<n;t++){const n=zl[t];n.instanceId=r,n.object=this,e.push(n)}zl.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Ul(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Hl.prototype.isInstancedMesh=!0;class Wl extends dr{constructor(t){super(),this.type="LineBasicMaterial",this.color=new _r(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}Wl.prototype.isLineBasicMaterial=!0;const jl=new Kn,ql=new Kn,Xl=new Ai,Yl=new Ri,Jl=new _i;class Zl extends $i{constructor(t=new Dr,e=new Wl){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)jl.fromBufferAttribute(e,t-1),ql.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=jl.distanceTo(ql);t.setAttribute("lineDistance",new Tr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Jl.copy(n.boundingSphere),Jl.applyMatrix4(i),Jl.radius+=r,!1===t.ray.intersectsSphere(Jl))return;Xl.copy(i).invert(),Yl.copy(t.ray).applyMatrix4(Xl);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Kn,c=new Kn,h=new Kn,u=new Kn,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i){for(let n=Math.max(0,s.start),o=Math.min(i.count,s.start+s.count)-1;n<o;n+=d){const s=i.getX(n),o=i.getX(n+1);l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o);if(Yl.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(r.count,s.start+s.count)-1;n<i;n+=d){l.fromBufferAttribute(r,n),c.fromBufferAttribute(r,n+1);if(Yl.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Zl.prototype.isLine=!0;const Kl=new Kn,Ql=new Kn;class $l extends Zl{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Kl.fromBufferAttribute(e,t),Ql.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Kl.distanceTo(Ql);t.setAttribute("lineDistance",new Tr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}$l.prototype.isLineSegments=!0;class tc extends Zl{constructor(t,e){super(t,e),this.type="LineLoop"}}tc.prototype.isLineLoop=!0;class ec extends dr{constructor(t){super(),this.type="PointsMaterial",this.color=new _r(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}ec.prototype.isPointsMaterial=!0;const nc=new Ai,ic=new Ri,rc=new _i,sc=new Kn;class oc extends $i{constructor(t=new Dr,e=new ec){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),rc.copy(n.boundingSphere),rc.applyMatrix4(i),rc.radius+=r,!1===t.ray.intersectsSphere(rc))return;nc.copy(i).invert(),ic.copy(t.ray).applyMatrix4(nc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position;if(null!==r){for(let n=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);n<l;n++){const s=r.getX(n);sc.fromBufferAttribute(o,s),ac(sc,s,a,i,t,e,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);n<r;n++)sc.fromBufferAttribute(o,n),ac(sc,n,a,i,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ac(t,e,n,i,r,s,o){const a=ic.distanceSqToPoint(t);if(a<n){const n=new Kn;ic.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}oc.prototype.isPoints=!0;(class extends jn{constructor(t,e,n,i,r,s,o,a,l){super(t,e,n,i,r,s,o,a,l),this.format=void 0!==o?o:1022,this.minFilter=void 0!==s?s:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0;class lc extends jn{constructor(t,e,n,i,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,i,r,h,u),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}lc.prototype.isCompressedTexture=!0;(class extends jn{constructor(t,e,n,i,r,s,o,a,l){super(t,e,n,i,r,s,o,a,l),this.needsUpdate=!0}}).prototype.isCanvasTexture=!0;new Kn,new Kn,new Kn,new hr;class cc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let o,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=n[i]-s,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(t,e){let n=t-1e-4,i=t+1e-4;n<0&&(n=0),i>1&&(i=1);const r=this.getPoint(n),s=this.getPoint(i),o=e||(r.isVector2?new kn:new Kn);return o.copy(s).sub(r).normalize(),o}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new Kn,i=[],r=[],s=[],o=new Kn,a=new Ai;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new Kn)}r[0]=new Kn,s[0]=new Kn;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(i[e-1],i[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(In(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(In(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class hc extends cc{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const n=e||new kn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}hc.prototype.isEllipseCurve=!0;class uc extends hc{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.type="ArcCurve"}}function dc(){let t=0,e=0,n=0,i=0;function r(r,s,o,a){t=r,e=o,n=-3*r+3*s-2*o-a,i=2*r-2*s+o+a}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(i-e)/(o+a)+(i-n)/a;l*=o,c*=o,r(e,n,l,c)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}uc.prototype.isArcCurve=!0;const pc=new Kn,fc=new dc,mc=new dc,gc=new dc;class vc extends cc{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new Kn){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=i[(l-1)%r]:(pc.subVectors(i[0],i[1]).add(i[0]),o=pc);const h=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?a=i[(l+2)%r]:(pc.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=pc),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),fc.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,n,i),mc.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,n,i),gc.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,n,i)}else"catmullrom"===this.curveType&&(fc.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),mc.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),gc.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return n.set(fc.calc(c),mc.calc(c),gc.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Kn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function yc(t,e,n,i,r){const s=.5*(i-e),o=.5*(r-n),a=t*t;return(2*n-2*i+s+o)*(t*a)+(-3*n+3*i-2*s-o)*a+s*t+n}function _c(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function xc(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}vc.prototype.isCatmullRomCurve3=!0;class bc extends cc{constructor(t=new kn,e=new kn,n=new kn,i=new kn){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new kn){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(xc(t,i.x,r.x,s.x,o.x),xc(t,i.y,r.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}bc.prototype.isCubicBezierCurve=!0;class Mc extends cc{constructor(t=new Kn,e=new Kn,n=new Kn,i=new Kn){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Kn){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(xc(t,i.x,r.x,s.x,o.x),xc(t,i.y,r.y,s.y,o.y),xc(t,i.z,r.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Mc.prototype.isCubicBezierCurve3=!0;class wc extends cc{constructor(t=new kn,e=new kn){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new kn){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new kn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}wc.prototype.isLineCurve=!0;class Ec extends cc{constructor(t=new kn,e=new kn,n=new kn){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new kn){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(_c(t,i.x,r.x,s.x),_c(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Ec.prototype.isQuadraticBezierCurve=!0;class Sc extends cc{constructor(t=new Kn,e=new Kn,n=new Kn){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Kn){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(_c(t,i.x,r.x,s.x),_c(t,i.y,r.y,s.y),_c(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Sc.prototype.isQuadraticBezierCurve3=!0;class Tc extends cc{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new kn){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),o=r-s,a=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(yc(o,a.x,l.x,c.x,h.x),yc(o,a.y,l.y,c.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new kn).fromArray(n))}return this}}Tc.prototype.isSplineCurve=!0;var Rc=Object.freeze({__proto__:null,ArcCurve:uc,CatmullRomCurve3:vc,CubicBezierCurve:bc,CubicBezierCurve3:Mc,EllipseCurve:hc,LineCurve:wc,LineCurve3:class extends cc{constructor(t=new Kn,e=new Kn){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Kn){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Ec,QuadraticBezierCurve3:Sc,SplineCurve:Tc});class Ac extends cc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new wc(e,t))}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],o=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Rc[n.type]).fromJSON(n))}return this}}class Cc extends Ac{constructor(t){super(),this.type="Path",this.currentPoint=new kn,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new wc(this.currentPoint.clone(),new kn(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new Ec(this.currentPoint.clone(),new kn(t,e),new kn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const o=new bc(this.currentPoint.clone(),new kn(t,e),new kn(n,i),new kn(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Tc(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,s,o,a),this}absellipse(t,e,n,i,r,s,o,a){const l=new hc(t,e,n,i,r,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Pc extends Cc{constructor(t){super(t),this.uuid=Ln(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new Cc).fromJSON(n))}return this}}const Lc=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=Ic(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=Ic(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Hc(c));for(r.sort(Fc),s=0;s<r.length;s++)Bc(r[s],n),n=Nc(n,n.next);return n}(t,e,s,n)),t.length>80*n){a=c=t[0],l=h=t[1];for(let e=n;e<r;e+=n)u=t[e],d=t[e+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return Dc(s,o,n,a,l,p),o};function Ic(t,e,n,i,r){let s,o;if(r===function(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)o=$c(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=$c(s,t[s],t[s+1],o);return o&&Xc(o,o.next)&&(th(o),o=o.next),o}function Nc(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Xc(i,i.next)&&0!==qc(i.prev,i,i.next))i=i.next;else{if(th(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function Dc(t,e,n,i,r,s,o){if(!t)return;!o&&s&&function(t,e,n,i){let r=t;do{null===r.z&&(r.z=Vc(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,i);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(t,i,r,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?Gc(t,i,r,s):Oc(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),th(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?Dc(t=kc(Nc(t),e,n),e,n,i,r,s,2):2===o&&Uc(t,e,n,i,r,s):Dc(Nc(t),e,n,i,r,s,1);break}}function Oc(t){const e=t.prev,n=t,i=t.next;if(qc(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Wc(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&qc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Gc(t,e,n,i){const r=t.prev,s=t,o=t.next;if(qc(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=Vc(a,l,e,n,i),d=Vc(c,h,e,n,i);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&Wc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&qc(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&Wc(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&qc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&Wc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&qc(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&Wc(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&qc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function kc(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Xc(r,s)&&Yc(r,i,i.next,s)&&Kc(r,s)&&Kc(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),th(i),th(i.next),i=t=s),i=i.next}while(i!==t);return Nc(i)}function Uc(t,e,n,i,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&jc(o,t)){let a=Qc(o,t);return o=Nc(o,o.next),a=Nc(a,a.next),Dc(o,e,n,i,r,s),void Dc(a,e,n,i,r,s)}t=t.next}o=o.next}while(o!==t)}function Fc(t,e){return t.x-e.x}function Bc(t,e){if(e=function(t,e){let n=e;const i=t.x,r=t.y;let s,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o){if(o=t,t===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(i===o)return s;const a=s,l=s.x,c=s.y;let h,u=1/0;n=s;do{i>=n.x&&n.x>=l&&i!==n.x&&Wc(r<c?i:o,r,l,c,r<c?o:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),Kc(n,t)&&(h<u||h===u&&(n.x>s.x||n.x===s.x&&zc(s,n)))&&(s=n,u=h)),n=n.next}while(n!==a);return s}(t,e)){const n=Qc(e,t);Nc(e,e.next),Nc(n,n.next)}}function zc(t,e){return qc(t.prev,t,e.prev)<0&&qc(e.next,t,t.next)<0}function Vc(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hc(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Wc(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function jc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Yc(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Kc(t,e)&&Kc(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(qc(t.prev,t,e.prev)||qc(t,e.prev,e))||Xc(t,e)&&qc(t.prev,t,t.next)>0&&qc(e.prev,e,e.next)>0)}function qc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Xc(t,e){return t.x===e.x&&t.y===e.y}function Yc(t,e,n,i){const r=Zc(qc(t,e,n)),s=Zc(qc(t,e,i)),o=Zc(qc(n,i,t)),a=Zc(qc(n,i,e));return r!==s&&o!==a||(!(0!==r||!Jc(t,n,e))||(!(0!==s||!Jc(t,i,e))||(!(0!==o||!Jc(n,t,i))||!(0!==a||!Jc(n,e,i)))))}function Jc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Zc(t){return t>0?1:t<0?-1:0}function Kc(t,e){return qc(t.prev,t,t.next)<0?qc(t,e,t.next)>=0&&qc(t,t.prev,e)>=0:qc(t,e,t.prev)<0||qc(t,t.next,e)<0}function Qc(t,e){const n=new eh(t.i,t.x,t.y),i=new eh(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function $c(t,e,n,i){const r=new eh(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function th(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function eh(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class nh{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return nh.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];ih(t),rh(n,t);let s=t.length;e.forEach(ih);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,rh(n,e[t]);const o=Lc(n,i);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function ih(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function rh(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class sh extends Dr{constructor(t=new Pc([new kn(.5,.5),new kn(-.5,.5),new kn(-.5,-.5),new kn(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++){s(t[e])}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:oh;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,v,y,_,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new Kn,_=new Kn,x=new Kn),c||(p=0,h=0,u=0,d=0);const M=t.extractPoints(o);let w=M.shape;const E=M.holes;if(!nh.isClockWise(w)){w=w.reverse();for(let t=0,e=E.length;t<e;t++){const e=E[t];nh.isClockWise(e)&&(E[t]=e.reverse())}}const S=nh.triangulateShape(w,E),T=w;for(let t=0,e=E.length;t<e;t++){const e=E[t];w=w.concat(e)}function R(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const A=w.length,C=S.length;function P(t,e,n){let i,r,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-a/u,f=e.y+o/u,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(o*c-a*l);i=p+o*m-t.x,r=f+a*m-t.y;const g=i*i+r*r;if(g<=2)return new kn(i,r);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(i=-a,r=o,s=Math.sqrt(h)):(i=o,r=a,s=Math.sqrt(h/2))}return new kn(i/s,r/s)}const L=[];for(let t=0,e=T.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),L[t]=P(T[t],T[n],T[i]);const I=[];let N,D=L.concat();for(let t=0,e=E.length;t<e;t++){const e=E[t];N=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),N[t]=P(e[t],e[i],e[r]);I.push(N),D=D.concat(N)}for(let t=0;t<p;t++){const e=t/p,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=R(T[t],L[t],i);k(e.x,e.y,-n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];N=I[t];for(let t=0,r=e.length;t<r;t++){const r=R(e[t],N[t],i);k(r.x,r.y,-n)}}}const O=u+d;for(let t=0;t<A;t++){const e=c?R(w[t],D[t],O):w[t];b?(_.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(_).add(y),k(x.x,x.y,x.z)):k(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<A;e++){const n=c?R(w[e],D[e],O):w[e];b?(_.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(_).add(y),k(x.x,x.y,x.z)):k(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=R(T[t],L[t],i);k(e.x,e.y,l+n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];N=I[t];for(let t=0,r=e.length;t<r;t++){const r=R(e[t],N[t],i);b?k(r.x,r.y+g[a-1].y,g[a-1].x+n):k(r.x,r.y,l+n)}}}function G(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=A*t,s=A*(t+1);F(e+i+n,e+r+n,e+r+s,e+i+s)}}}function k(t,e,n){s.push(t),s.push(e),s.push(n)}function U(t,e,r){B(t),B(e),B(r);const s=i.length/3,o=m.generateTopUV(n,i,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[2])}function F(t,e,r,s){B(t),B(e),B(s),B(e),B(r),B(s);const o=i.length/3,a=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[3]),z(a[1]),z(a[2]),z(a[3])}function B(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function z(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=A*t;for(let t=0;t<C;t++){const n=S[t];U(n[2]+e,n[1]+e,n[0]+e)}t=a+2*p,e=A*t;for(let t=0;t<C;t++){const n=S[t];U(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<C;t++){const e=S[t];U(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=S[t];U(e[0]+A*a,e[1]+A*a,e[2]+A*a)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;G(T,e),e+=T.length;for(let t=0,n=E.length;t<n;t++){const n=E[t];G(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Tr(i,3)),this.setAttribute("uv",new Tr(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Rc[i.type]).fromJSON(i)),new sh(n,t.options)}}const oh={generateTopUV:function(t,e,n,i,r){const s=e[3*n],o=e[3*n+1],a=e[3*i],l=e[3*i+1],c=e[3*r],h=e[3*r+1];return[new kn(s,o),new kn(a,l),new kn(c,h)]},generateSideWallUV:function(t,e,n,i,r,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*i],h=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new kn(o,1-l),new kn(c,1-u),new kn(d,1-f),new kn(m,1-v)]:[new kn(a,1-l),new kn(h,1-u),new kn(p,1-f),new kn(g,1-v)]}};class ah extends Dr{constructor(t=new Pc([new kn(0,.5),new kn(-.5,-.5),new kn(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=i.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===nh.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===nh.isClockWise(e)&&(h[t]=e.reverse())}const u=nh.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+o,r=e[1]+o,s=e[2]+o;n.push(i,r,s),a+=3}}this.setIndex(n),this.setAttribute("position",new Tr(i,3)),this.setAttribute("normal",new Tr(r,3)),this.setAttribute("uv",new Tr(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new ah(n,t.curveSegments)}}class lh extends dr{constructor(t){super(),this.type="ShadowMaterial",this.color=new _r(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}lh.prototype.isShadowMaterial=!0;class ch extends dr{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new _r(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}ch.prototype.isMeshStandardMaterial=!0;class hh extends ch{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new kn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return In(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new _r(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new _r(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new _r(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}hh.prototype.isMeshPhysicalMaterial=!0;class uh extends dr{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new _r(16777215),this.specular=new _r(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}uh.prototype.isMeshPhongMaterial=!0;class dh extends dr{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new _r(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}dh.prototype.isMeshToonMaterial=!0;class ph extends dr{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}ph.prototype.isMeshNormalMaterial=!0;class fh extends dr{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new _r(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}fh.prototype.isMeshLambertMaterial=!0;class mh extends dr{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new _r(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}mh.prototype.isMeshMatcapMaterial=!0;class gh extends Wl{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}gh.prototype.isLineDashedMaterial=!0;const vh={arraySlice:function(t,e,n){return vh.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[o++]=t[i+n]}return r},flattenJSON:function(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),n.push(o)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<n||s>=i)){l.push(e.times[t]);for(let n=0;n<a;++n)c.push(e.values[t*a+n])}}0!==l.length&&(e.times=vh.convertArray(l,e.times.constructor),e.values=vh.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let e=0;e<r;++e){const i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find((function(t){return t.name===i.name&&t.ValueTypeName===r}));if(void 0===o)continue;let a=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=i.times.length-1;let d;if(s<=i.times[0]){const t=a,e=l-a;d=vh.arraySlice(i.values,t,e)}else if(s>=i.times[u]){const t=u*l+a,e=t+l-a;d=vh.arraySlice(i.values,t,e)}else{const t=i.createInterpolant(),e=a,n=l-a;t.evaluate(s),d=vh.arraySlice(t.resultBuffer,e,n)}if("quaternion"===r){(new Zn).fromArray(d).normalize().conjugate().toArray(d)}const p=o.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===r)Zn.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=h-2*c;for(let n=0;n<t;++n)o.values[e+n]-=d[n]}}}return t.blendMode=2501,t}};class yh{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const o=e[1];t<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}yh.prototype.beforeStart_=yh.prototype.copySampleValue_,yh.prototype.afterEnd_=yh.prototype.copySampleValue_;class _h extends yh{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=t,o=2*e-n;break;case 2402:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=t,a=2*n-e;break;case 2402:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let t=0;t!==o;++t)r[t]=g*s[c+t]+v*s[l+t]+y*s[a+t]+_*s[h+t];return r}}class xh extends yh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(i-e),h=1-c;for(let t=0;t!==o;++t)r[t]=s[l+t]*h+s[a+t]*c;return r}}class bh extends yh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Mh{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=vh.convertArray(e,this.TimeBufferType),this.values=vh.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:vh.convertArray(t.times,Array),values:vh.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new bh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new xh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new _h(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=vh.arraySlice(n,r,s),this.values=vh.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&vh.isTypedArray(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=vh.arraySlice(this.times),e=vh.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const i=o*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,o=0;o!==n;++o)e[i+o]=e[t+o];++s}return s!==t.length?(this.times=vh.arraySlice(t,0,s),this.values=vh.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=vh.arraySlice(this.times,0),e=vh.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Mh.prototype.TimeBufferType=Float32Array,Mh.prototype.ValueBufferType=Float32Array,Mh.prototype.DefaultInterpolation=2301;class wh extends Mh{}wh.prototype.ValueTypeName="bool",wh.prototype.ValueBufferType=Array,wh.prototype.DefaultInterpolation=2300,wh.prototype.InterpolantFactoryMethodLinear=void 0,wh.prototype.InterpolantFactoryMethodSmooth=void 0;class Eh extends Mh{}Eh.prototype.ValueTypeName="color";class Sh extends Mh{}Sh.prototype.ValueTypeName="number";class Th extends yh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(i-e);let l=t*o;for(let t=l+o;l!==t;l+=4)Zn.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Rh extends Mh{InterpolantFactoryMethodLinear(t){return new Th(this.times,this.values,this.getValueSize(),t)}}Rh.prototype.ValueTypeName="quaternion",Rh.prototype.DefaultInterpolation=2301,Rh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ah extends Mh{}Ah.prototype.ValueTypeName="string",Ah.prototype.ValueBufferType=Array,Ah.prototype.DefaultInterpolation=2300,Ah.prototype.InterpolantFactoryMethodLinear=void 0,Ah.prototype.InterpolantFactoryMethodSmooth=void 0;class Ch extends Mh{}Ch.prototype.ValueTypeName="vector";class Ph{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Ln(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(Lh(n[t]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(Mh.toJSON(n[t]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let t=0;t<r;t++){let o=[],a=[];o.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const l=vh.getKeyframeOrder(o);o=vh.sortedArray(o,1,l),a=vh.sortedArray(a,1,l),i||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new Sh(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(r);if(s&&s.length>1){const t=s[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const s=[];for(const t in i)s.push(this.CreateFromMorphTargetSequence(t,i[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],o=[];vh.flattenJSON(n,s,o,i),0!==s.length&&r.push(new t(e,s,o))}},i=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new Sh(".morphTargetInfluence["+n+"]",t,s))}a=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";n(Ch,s+".position",r,"pos",i),n(Rh,s+".quaternion",r,"rot",i),n(Ch,s+".scale",r,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Lh(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Sh;case"vector":case"vector2":case"vector3":case"vector4":return Ch;case"color":return Eh;case"quaternion":return Rh;case"bool":case"boolean":return wh;case"string":return Ah}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];vh.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ih={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Nh{constructor(t,e,n){const i=this;let r=!1,s=0,o=0,a=void 0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===r&&void 0!==i.onStart&&i.onStart(t,s,o),r=!0},this.itemEnd=function(t){s++,void 0!==i.onProgress&&i.onProgress(t,s,o),s===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const Dh=new Nh;class Oh{constructor(t){this.manager=void 0!==t?t:Dh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Gh={};class kh extends Oh{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Ih.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(void 0!==Gh[t])return void Gh[t].push({onLoad:e,onProgress:n,onError:i});Gh[t]=[],Gh[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(s).then(e=>{if(200===e.status||0===e.status){0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const n=Gh[t],i=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;return new ReadableStream({start(t){!function e(){i.read().then(({done:i,value:r})=>{if(i)t.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}})}()}})}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)}).then(t=>{const e=new Response(t);switch(this.responseType){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(t=>(new DOMParser).parseFromString(t,this.mimeType));case"json":return e.json();default:return e.text()}}).then(e=>{Ih.add(t,e);const n=Gh[t];delete Gh[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}this.manager.itemEnd(t)}).catch(e=>{const n=Gh[t];delete Gh[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t),this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Uh extends Oh{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ih.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=Bn("img");function a(){c(),Ih.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class Fh extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=new ls,s=new Uh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){r.images[n]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(let e=0;e<t.length;++e)a(e);return r}}class Bh extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=new jn,s=new Uh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}class zh extends $i{constructor(t,e=1){super(),this.type="Light",this.color=new _r(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}zh.prototype.isLight=!0;class Vh extends zh{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy($i.DefaultUp),this.updateMatrix(),this.groundColor=new _r(e)}copy(t){return zh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}Vh.prototype.isHemisphereLight=!0;const Hh=new Ai,Wh=new Kn,jh=new Kn;class qh{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new kn(512,512),this.map=null,this.mapPass=null,this.matrix=new Ai,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new gs,this._frameExtents=new kn(1,1),this._viewportCount=1,this._viewports=[new Xn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Wh.setFromMatrixPosition(t.matrixWorld),e.position.copy(Wh),jh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(jh),e.updateMatrixWorld(),Hh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Hh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Xh extends qh{constructor(){super(new os(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*Pn*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Xh.prototype.isSpotLightShadow=!0;class Yh extends zh{constructor(t,e,n=0,i=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy($i.DefaultUp),this.updateMatrix(),this.target=new $i,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new Xh}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Yh.prototype.isSpotLight=!0;const Jh=new Ai,Zh=new Kn,Kh=new Kn;class Qh extends qh{constructor(){super(new os(90,1,.5,500)),this._frameExtents=new kn(4,2),this._viewportCount=6,this._viewports=[new Xn(2,1,1,1),new Xn(0,1,1,1),new Xn(3,1,1,1),new Xn(1,1,1,1),new Xn(3,0,1,1),new Xn(1,0,1,1)],this._cubeDirections=[new Kn(1,0,0),new Kn(-1,0,0),new Kn(0,0,1),new Kn(0,0,-1),new Kn(0,1,0),new Kn(0,-1,0)],this._cubeUps=[new Kn(0,1,0),new Kn(0,1,0),new Kn(0,1,0),new Kn(0,1,0),new Kn(0,0,1),new Kn(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Zh.setFromMatrixPosition(t.matrixWorld),n.position.copy(Zh),Kh.copy(n.position),Kh.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Kh),n.updateMatrixWorld(),i.makeTranslation(-Zh.x,-Zh.y,-Zh.z),Jh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jh)}}Qh.prototype.isPointLightShadow=!0;class $h extends zh{constructor(t,e,n=0,i=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Qh}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}$h.prototype.isPointLight=!0;class tu extends qh{constructor(){super(new Cs(-5,5,5,-5,.5,500))}}tu.prototype.isDirectionalLightShadow=!0;class eu extends zh{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy($i.DefaultUp),this.updateMatrix(),this.target=new $i,this.shadow=new tu}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}eu.prototype.isDirectionalLight=!0;class nu extends zh{constructor(t,e){super(t,e),this.type="AmbientLight"}}nu.prototype.isAmbientLight=!0;class iu extends zh{constructor(t,e,n=10,i=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}iu.prototype.isRectAreaLight=!0;class ru{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Kn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}ru.prototype.isSphericalHarmonics3=!0;class su extends zh{constructor(t=new ru,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}su.prototype.isLightProbe=!0;class ou{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class au extends Dr{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}au.prototype.isInstancedBufferGeometry=!0;let lu;(class extends Oh{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ih.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){Ih.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}).prototype.isImageBitmapLoader=!0;const cu=function(){return void 0===lu&&(lu=new(window.AudioContext||window.webkitAudioContext)),lu};class hu extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new kh(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);cu().decodeAudioData(t,(function(t){e(t)}))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}}(class extends su{constructor(t,e,n=1){super(void 0,n);const i=(new _r).set(t),r=(new _r).set(e),s=new Kn(i.r,i.g,i.b),o=new Kn(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0;(class extends su{constructor(t,e=1){super(void 0,e);const n=(new _r).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;class uu extends $i{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}class du{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){o.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]}_slerp(t,e,n,i){Zn.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;Zn.multiplyQuaternionsFlat(t,s,t,e,t,n),Zn.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[n+o]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const pu=new RegExp("[\\[\\]\\.:\\/]","g"),fu="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",mu=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),gu=/(WCOD+)?/.source.replace("WCOD",fu),vu=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),yu=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),_u=new RegExp("^"+mu+gu+vu+yu+"$"),xu=["material","materials","bones"];class bu{constructor(t,e,n){this.path=e,this.parsedPath=n||bu.parseTrackName(e),this.node=bu.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new bu.Composite(t,e,n):new bu(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(pu,"")}static parseTrackName(t){const e=_u.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==xu.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=bu.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}bu.Composite=class{constructor(t,e,n){const i=n||bu.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},bu.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},bu.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},bu.prototype.GetterByBindingType=[bu.prototype._getValue_direct,bu.prototype._getValue_array,bu.prototype._getValue_arrayElement,bu.prototype._getValue_toArray],bu.prototype.SetterByBindingTypeAndVersioning=[[bu.prototype._setValue_direct,bu.prototype._setValue_direct_setNeedsUpdate,bu.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bu.prototype._setValue_array,bu.prototype._setValue_array_setNeedsUpdate,bu.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bu.prototype._setValue_arrayElement,bu.prototype._setValue_arrayElement_setNeedsUpdate,bu.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bu.prototype._setValue_fromArray,bu.prototype._setValue_fromArray_setNeedsUpdate,bu.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];(class{constructor(){this.uuid=Ln(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let o=void 0,a=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=a++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new bu(h,n[t],i[t]))}else if(d<l){o=t[d];const a=--l,c=t[a];e[c.uuid]=d,t[d]=c,e[u]=a,t[a]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new bu(h,n[t],i[t])),e[a]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=r){const s=r++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[s],r=e[l];e[l]=i,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<r){const o=--r,a=t[o],c=--s,h=t[c];e[a.uuid]=l,t[l]=a,e[h.uuid]=o,t[o]=h,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[o],r=e[c];e[l]=i,e[o]=r,e.pop()}}else{const r=--s,o=t[r];r>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);i=r.length,n[t]=i,s.push(t),o.push(e),r.push(h);for(let n=c,i=a.length;n!==i;++n){const i=a[n];h[n]=new bu(i,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=n,s[n]=a,s.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}).prototype.isAnimationObjectGroup=!0;class Mu{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:2400,endingEnd:2400};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case 2501:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);break;case 2500:default:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,o)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r?i:s&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=n,this}}(class extends Rn{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==r;++t){const r=i[t],l=r.name;let h=c[l];if(void 0!==h)s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;h=new du(bu.create(n,l,i),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[t]=h}o[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new xh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?Ph.findByName(i,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:2500),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Mu(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?Ph.findByName(n,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==n;++o){e[o]._update(i,t,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class wu{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new wu(void 0===this.value.clone?this.value:this.value.clone())}}(class extends ul{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;(class{constructor(t,e,n,i,r){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}).prototype.isGLBufferAttribute=!0;const Eu=new kn;class Su{constructor(t=new kn(1/0,1/0),e=new kn(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Eu.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Eu.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Su.prototype.isBox2=!0;const Tu=new Kn,Ru=new Kn;const Au=new Kn,Cu=new Ai,Pu=new Ai;const Lu=new Float32Array(1);new Int32Array(Lu.buffer);cc.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(cc.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Cc.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends $l{constructor(t=10,e=10,n=4473924,i=8947848){n=new _r(n),i=new _r(i);const r=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,h=-o;t<=e;t++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=t===r?n:i;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new Dr;c.setAttribute("position",new Tr(a,3)),c.setAttribute("color",new Tr(l,3));super(c,new Wl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends $l{constructor(t){const e=function t(e){const n=[];e&&e.isBone&&n.push(e);for(let i=0;i<e.children.length;i++)n.push.apply(n,t(e.children[i]));return n}(t),n=new Dr,i=[],r=[],s=new _r(0,0,1),o=new _r(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new Tr(i,3)),n.setAttribute("color",new Tr(r,3));super(n,new Wl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");Pu.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Cu.multiplyMatrices(Pu,r.matrixWorld),Au.setFromMatrixPosition(Cu),i.setXYZ(n,Au.x,Au.y,Au.z),Cu.multiplyMatrices(Pu,r.parent.matrixWorld),Au.setFromMatrixPosition(Cu),i.setXYZ(n+1,Au.x,Au.y,Au.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Oh.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ou.extractUrlBase(t)},Oh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Su.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Su.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Su.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Su.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},ti.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},ti.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ti.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},ti.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},ti.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},_i.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},gs.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},class{constructor(t=new Kn,e=new Kn){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Tu.subVectors(t,this.start),Ru.subVectors(this.end,this.start);const n=Ru.dot(Ru);let i=Ru.dot(Tu)/n;return e&&(i=In(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Un.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Un.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Un.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Un.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Un.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Un.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Ai.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},Ai.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Ai.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Kn).setFromMatrixColumn(this,3)},Ai.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},Ai.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Ai.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ai.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ai.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Ai.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},Ai.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ai.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Ai.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Ai.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Ai.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Ai.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Ai.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Ai.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Ai.prototype.makeFrustum=function(t,e,n,i,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,s)},Ai.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},ps.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Zn.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Zn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ri.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ri.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Ri.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},hr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},hr.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},hr.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},hr.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},hr.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},hr.barycoordFromPoint=function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),hr.getBarycoord(t,e,n,i,r)},hr.normal=function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),hr.getNormal(t,e,n,i)},Pc.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Pc.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new sh(this,t)},Pc.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ah(this,t)},kn.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},kn.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},kn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Kn.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Kn.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Kn.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Kn.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Kn.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Kn.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Kn.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Kn.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Kn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Xn.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Xn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},$i.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},$i.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},$i.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},$i.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},$i.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties($i.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Qr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Qr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Ol.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},os.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(zh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(wr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),wr.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},wr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},wr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Dr.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Dr.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new wr(arguments[1],arguments[2])))},Dr.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Dr.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Dr.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Dr.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Dr.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Dr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ul.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},ul.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},sh.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},sh.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},sh.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},hl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},wu.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(dr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new _r}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(rs.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),al.prototype.clearTarget=function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},al.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},al.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},al.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},al.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},al.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},al.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},al.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},al.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},al.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},al.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},al.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},al.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},al.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},al.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},al.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},al.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},al.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},al.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},al.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},al.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},al.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},al.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},al.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},al.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(al.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Za.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Yn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),uu.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new hu).load(t,(function(t){e.setBuffer(t)})),this},class{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},as.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},as.prototype.clear=function(t,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,i)},Hn.crossOrigin=void 0,Hn.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Bh;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Hn.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Fh;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Hn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Hn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"135"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="135");var Iu=o.a.getLogger("Widget");function Nu(t){this._name=void 0!==t.name?t.name:null,this._element=void 0!==t.element?t.element:null,this._position=void 0!==t.position?t.position:null,this._target=null,this._globe=null,t.target&&this.setTarget(t.target,this._position)}Nu.prototype=Object.create(Rn.prototype,{}),Nu.prototype.constructor=Nu,Nu.prototype.getElement=function(){return this._element},Nu.prototype.setTarget=function(t,e){this._target="string"==typeof t?document.getElementById(t):t,this._element?(this._element.style.position=e||"relative",this._target.appendChild(this._element)):Iu.error("Widget:setTarget - widget element not created")},Nu.prototype.getTarget=function(){return this._target},Nu.prototype.getPosition=function(){return this._position},Nu.prototype.getGlobe=function(){return this._globe},Nu.prototype.setGlobe=function(t){this._globe=t};var Du=Nu,Ou={NORTH:"N",SOUTH:"S",EAST:"E",WEST:"W",digitSecond:2,digitDecimal:5,digitRadian:8,roundToDecimal:function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},decimalToRadian:function(t){return this.roundToDecimal(.017453292519943295*t,this.digitRadian)},decimalToGrade:function(t){return this.roundToDecimal(1.1111111111111112*t,this.digitRadian)},decimalToDMS:function(t,e){t<0&&(t*=-1);var n=Math.floor(t),i=60*(t-n),r=Math.floor(i),s=60*(i-r),o=n+"° "+r+"' "+this.roundToDecimal(s,this.digitSecond)+'" ';return e&&(o+=e),o},decimalLatToDMS:function(t){var e=t<0?this.SOUTH:this.NORTH;return this.decimalToDMS(t,e)},decimalLongToDMS:function(t){var e=t<0?this.WEST:this.EAST;return this.decimalToDMS(t,e)},DMSToDecimal:function(t,e,n,i){var r=t+e/60+n/3600;return r=i===this.SOUTH||i===this.WEST?-1*r:r,this.roundToDecimal(r,this.digitDecimal)}},Gu={"EPSG:4326":"+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +units=degrees","EPSG:3857":"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs","EPSG:2154":"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs","EPSG:27572":"+proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs","EPSG:32620":"+proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 +units=m +no_defs","EPSG:4467":"+proj=utm +zone=21 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs","EPSG:2972":"+proj=utm +zone=22 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs","EPSG:32630":"+proj=utm +zone=30 +datum=WGS84 +units=m +no_defs","EPSG:32631":"+proj=utm +zone=31 +datum=WGS84 +units=m +no_defs","EPSG:32632":"+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs","EPSG:4471":"+proj=utm +zone=38 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs","EPSG:2975":"+proj=utm +zone=40 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs","EPSG:3296":"+proj=utm +zone=5 +south +ellps=GRS80 +towgs84=0.072,-0.507,-0.245,-0.0183,0.0003,-0.007,-0.0093 +units=m +no_defs","EPSG:3297":"+proj=utm +zone=6 +south +ellps=GRS80 +towgs84=0.072,-0.507,-0.245,-0.0183,0.0003,-0.007,-0.0093 +units=m +no_defs","EPSG:32707":"+proj=utm +zone=7 +south +datum=WGS84 +units=m +no_defs","EPSG:32708":"+proj=utm +zone=8 +south +datum=WGS84 +units=m +no_defs","EPSG:26912":"+proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs","EPSG:32742":"+proj=utm +zone=42 +south +datum=WGS84 +units=m +no_defs","EPSG:32739":"+proj=utm +zone=39 +south +datum=WGS84 +units=m +no_defs","EPSG:32743":"+proj=utm +zone=43 +south +datum=WGS84 +units=m +no_defs","EPSG:2986":"","EPSG:32737":"+proj=utm +zone=37 +south +datum=WGS84 +units=m +no_defs","EPSG:32738":"+proj=utm +zone=38 +south +datum=WGS84 +units=m +no_defs","EPSG:2988":"+proj=utm +zone=1 +south +ellps=intl +towgs84=253,-132,-127,0,0,0,0 +units=m +no_defs","EPSG:3163":"+proj=lcc +lat_1=-20.66666666666667 +lat_2=-22.33333333333333 +lat_0=-21.5 +lon_0=166 +x_0=400000 +y_0=300000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"};function ku(t){return(ku="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Uu=o.a.getLogger("MousePosition");function Fu(t){if(t=t||{},!(this instanceof Fu))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if("object"!==ku(t))throw new Error("ERROR WRONG_TYPE : options should be an object");this._initialize(t),this._callbacks={};var e=this._initContainer(t);Du.call(this,{name:"MousePosition",element:e,target:t.target,position:t.position})}Fu.prototype=Object.create(Du.prototype,{}),bn.assign(Fu.prototype,Tn),Fu.prototype.constructor=Fu,Fu.prototype.setGlobe=function(t){if(t)this._centerElement=this._createMapCenter(),t.getTargetElement().appendChild(this._centerElement),this._callbacks.mouseMove=this.onMouseMove.bind(this),this.collapsed||(this._isDesktop?t.listen(yn.EVENTS.MOUSE_MOVE,this._callbacks.mouseMove):t.listen(yn.EVENTS.CENTER_CHANGED,this.onGlobeMove));else if(null==t){for(this._globe.forget(yn.EVENTS.MOUSE_MOVE,this._callbacks.mouseMove);this.getElement().hasChildNodes();)this.getElement().removeChild(this.getElement().lastChild);this.getElement().parentNode.removeChild(this.getElement()),this._globe.getTargetElement().removeChild(this._centerElement)}Du.prototype.setGlobe.call(this,t)},Fu.prototype.addSystem=function(t){if("object"===ku(t))if(t.crs){t.label||(Uu.warn("crs label not defined, use crs code by default."),t.label=t.crs),t.type||(Uu.warn("type srs not defined, use 'Metric' by default."),t.type="Metric");for(var e=0;e<this._projectionSystems.length;e++){var n=this._projectionSystems[e];t.crs===n.crs&&Uu.warn("crs '{}' already configured",n.crs)}t.code=this._projectionSystems.length,this._projectionSystems.push(t);var i=document.getElementById(this._addUID("GPmousePositionProjectionSystem"));if(i){var r=document.createElement("option");r.value=t.code,r.text=t.label,i.appendChild(r)}}else Uu.error("crs not defined !");else Uu.error("MousePosition:addSystem - system parameter should be an object")},Fu.prototype.addSystems=function(t){if(t)if(Array.isArray(t))for(var e=0;e<t.length;e++)this.addSystem(t[e]);else Uu.error("MousePosition:addSystems - systems parameter should be an array")},Fu.prototype.removeSystem=function(t){if(t&&"string"==typeof t){for(var e=null,n=0;n<this._projectionSystems.length;n++){var i=this._projectionSystems[n];if(t===i.crs){e=i.code,this._projectionSystems.splice(n,1);break}}if(null!=e){for(var r=[],s=0;s<this._projectionSystems.length;s++)r[Number(this._projectionSystems[s].code)]=s,this._projectionSystems[s].code=s;for(var o=null,a=document.getElementById(this._addUID("GPmousePositionProjectionSystem")),l=0;l<a.childNodes.length;l++)e!==a.childNodes[l].value?a.childNodes[l].value=r[Number(a.childNodes[l].value)]:o=l;null!=o&&a.removeChild(a.childNodes[o]),this._currentProjectionSystems.code===e&&(a.childNodes[0].setAttribute("selected","selected"),this._setCurrentSystem(a.childNodes[0].value))}else Uu.warn("MousePosition:removeSystem - system not found")}else Uu.error("MousePosition:removeSystem - systemCode parameter should be a string")},Fu.prototype.setUnits=function(t){t&&Array.isArray(t)&&(this.options.units=t,this._projectionUnits={},this._initProjectionUnits(),this._currentProjectionType&&this._setTypeUnitsPanel(this._currentProjectionType))},Fu.prototype.setAltitudeOptions=function(t){if(t&&"object"===ku(t)&&(this.options.altitude.triggerDelay=t.triggerDelay,this.options.altitude.responseDelay=t.responseDelay,t.serviceOptions))for(var e in t.serviceOptions)t.serviceOptions.hasOwnProperty(e)&&(this.options.altitude.serviceOptions[e]=t.serviceOptions[e])},Fu.prototype.displayAltitude=function(t){void 0!==t&&(void 0===this._noRightManagement&&this._checkRightsManagement(),this.options.displayAltitude=t,this._setElevationPanel(t))},Fu.prototype.displayCoordinates=function(t){void 0!==t&&(this.options.displayCoordinates=t,this._setCoordinatesPanel(t),this._setSettingsPanel(t))},Fu.prototype.setCollapsed=function(t){void 0!==t?t&&this.collapsed||!t&&!this.collapsed||(this._isDesktop||(document.getElementById(this._addUID("GPmapCenter")).className=t?"":"GPmapCenterVisible"),this.onShowMousePositionClick(),this._showMousePositionContainer.checked=!t):Uu.error("MousePosition:setCollapsed - missing collapsed parameter")},Fu.prototype._initialize=function(t){if(this.options=t||{},this.options.collapsed=void 0===t.collapsed||t.collapsed,this.collapsed=this.options.collapsed,this.options.units=t.units||[],this.options.displayAltitude=void 0===t.displayAltitude||t.displayAltitude,this.options.displayCoordinates=void 0===t.displayCoordinates||t.displayCoordinates,this.options.systems=t.systems||[],t.altitude){var e=t.altitude;this.options.altitude={triggerDelay:void 0!==e.triggerDelay?e.triggerDelay:200,responseDelay:void 0!==e.responseDelay?e.responseDelay:500,serviceOptions:e.serviceOptions||{},noDataValue:void 0!==e.noDataValue?e.noDataValue:-99999,noDataValueTolerance:void 0!==e.noDataValueTolerance?e.noDataValueTolerance:9e4}}else this.options.altitude={triggerDelay:200,responseDelay:500,serviceOptions:{}};this._uid=En.generate(),this._projectionSystems=[],this._initProjectionSystems(),this._projectionUnits={},this._initProjectionUnits(),this._isDesktop=bn.detectSupport(),this.options.altitude.triggerDelay<100&&(this.options.altitude.triggerDelay=100),this._timer=this.options.altitude.triggerDelay,this._currentProjectionSystems=this._projectionSystems[0],this._currentProjectionType=this._projectionSystems[0].type,this._currentProjectionUnits=this._projectionUnits[this._currentProjectionType][0].code,this._projectionUnitsContainer=null,this._showMousePositionContainer=null,this.options.displayAltitude||this.options.displayCoordinates||(this.options.displayCoordinates=!0),this.options.displayAltitude&&this._checkRightsManagement()},Fu.prototype._initProjectionSystems=function(){for(var t=[{label:"Géographique",crs:"EPSG:4326",type:"Geographical"},{label:"Mercator",crs:"EPSG:3857",type:"Metric"},{label:"Lambert 93",crs:"EPSG:2154",type:"Metric",geoBBox:{left:-9.86,bottom:41.15,right:10.38,top:51.56}},{label:"Lambert II étendu",crs:"EPSG:27572",type:"Metric",geoBBox:{left:-4.87,bottom:42.33,right:8.23,top:51.14}}],e=this.options.systems,n=0;n<e.length;n++){var i=e[n];this.addSystem(i)}if(0===this._projectionSystems.length)for(var r=0;r<t.length;r++)this.addSystem(t[r])},Fu.prototype._initProjectionUnits=function(){var t={Geographical:[{code:"DEC",label:"degrés décimaux",convert:this._displayDEC},{code:"DMS",label:"degrés sexagésimaux",convert:this._displayDMS},{code:"RAD",label:"radians",convert:this._displayRAD},{code:"GON",label:"grades",convert:this._displayGON}],Metric:[{code:"M",label:"mètres",convert:this._displayMeter},{code:"KM",label:"kilomètres",convert:this._displayKMeter}]},e=this.options.units;for(var n in t)if(t.hasOwnProperty(n)){for(var i=!1,r=0;r<t[n].length;r++)for(var s=t[n][r],o=0;o<e.length;o++){var a=e[o];s.code===a&&(i=!0,this._projectionUnits[n]||(this._projectionUnits[n]=[]),this._projectionUnits[n].push(s))}i||(this._projectionUnits[n]=t[n])}"object"===ku(this._projectionUnits)&&0===Object.keys(this._projectionUnits).length&&(this._projectionUnits=t)},Fu.prototype._checkRightsManagement=function(){var t=wn({key:this.options.apiKey,resources:["SERVICE_CALCUL_ALTIMETRIQUE_RSC"],services:["Elevation"]});this._noRightManagement=!t,this.options.apiKey||(this.options.apiKey=t.key)},Fu.prototype._initContainer=function(t){var e=this._createMainContainerElement(),n=this._showMousePositionContainer=this._createShowMousePositionElement();t.collapsed||(n.checked="checked"),e.appendChild(n);var i=this._createShowMousePositionPictoElement(this._isDesktop);e.appendChild(i);var r=this._createMousePositionPanelElement(),s=this._createMousePositionPanelHeaderElement();r.appendChild(s);var o=this._createMousePositionPanelBasicElement(t.displayAltitude,t.displayCoordinates);r.appendChild(o);for(var a=this._createShowMousePositionSettingsElement(t.displayCoordinates),l=0;l<a.length;l++)r.appendChild(a[l]);var c=this._createMousePositionSettingsElement(t.displayCoordinates),h=this._projectionSystemsContainer=this._createMousePositionSettingsSystemsElement(this._projectionSystems),u=this._projectionUnitsContainer=this._createMousePositionSettingsUnitsElement(this._projectionUnits[this._currentProjectionType]);return c.appendChild(h),c.appendChild(u),r.appendChild(c),e.appendChild(r),e},Fu.prototype._setElevationPanel=function(t){t?this._noRightManagement?document.getElementById("GPmousePositionAlt-"+this._uid).innerHTML="No rights!":document.getElementById("GPmousePositionAltitude-"+this._uid).style.display="":document.getElementById("GPmousePositionAltitude-"+this._uid).style.display="none"},Fu.prototype._setCoordinatesPanel=function(t){var e=document.getElementById("GPmousePositionCoordinate-"+this._uid);e.style.display=t?"":"none"},Fu.prototype._setSettingsPanel=function(t){var e=document.getElementById("GPshowMousePositionSettingsPicto-"+this._uid),n=document.getElementById("GPmousePositionSettings-"+this._uid);t?(e.style.display="",n.style.display=""):(e.style.display="none",n.style.display="none")},Fu.prototype._setTypeUnitsPanel=function(t){for(var e=this._projectionUnitsContainer;e.firstChild;)e.removeChild(e.firstChild);for(var n=this._projectionUnits[t],i=0;i<n.length;i++){var r=n[i],s=document.createElement("option");s.value=r.code?r.code:i,s.text=r.label||i,e.appendChild(s)}this._currentProjectionType=t,this._currentProjectionUnits=this._projectionUnits[t][0].code},Fu.prototype._displayDEC=function(t){var e={};return e.lat=Ou.roundToDecimal(t.lat,6),e.lng=Ou.roundToDecimal(t.lon,6),e},Fu.prototype._displayDMS=function(t){var e={};return e.lat=Ou.decimalLatToDMS(t.lat),e.lng=Ou.decimalLongToDMS(t.lon),e},Fu.prototype._displayRAD=function(t){var e={};return e.lat=Ou.decimalToRadian(t.lat),e.lng=Ou.decimalToRadian(t.lon),e},Fu.prototype._displayGON=function(t){var e={};return e.lat=Ou.decimalToGrade(t.lat),e.lng=Ou.decimalToGrade(t.lon),e},Fu.prototype._displayMeter=function(t){var e={};return e.x=t.lon.toFixed(2),e.y=t.lat.toFixed(2),e.unit="m",e},Fu.prototype._displayKMeter=function(t){var e={};return e.x=(t.lon/1e3).toFixed(2),e.y=(t.lat/1e3).toFixed(2),e.unit="km",e},Fu.prototype._setCoordinate=function(t){var e=[],n={},i=this._currentProjectionSystems,r=i?i.crs:null;if(r){"EPSG:4326"!==r?(e=s()(Gu[r],[t.lon,t.lat]),n.lon=e[0],n.lat=e[1]):n=t;for(var o=this._currentProjectionSystems.type,a=null,l=this._projectionUnits[o],c=0;c<l.length;c++)if(l[c].code===this._currentProjectionUnits){a=l[c].convert;break}a&&"function"==typeof a?(e=a(n))&&0!==Object.keys(e).length&&this.GPdisplayCoords(e):Uu.warn("coordinates format function not found")}else Uu.error("system crs not found")},Fu.prototype._setElevation=function(t){var e=this.options.altitude.responseDelay;this.GPdisplayElevation(t,e)},Fu.prototype.onMoveStopped=function(t){this._setElevation(t)},Fu.prototype.onMouseMove=function(t){var e=this,n=this.getGlobe().getCoordinateFromMouseEvent(t);if(!n)return this.GPdisplayCoords({lon:"---",lat:"---"}),void this.GPresetElevation();var i={lon:n.x,lat:n.y};this._setCoordinate(i),this.options.displayAltitude&&(clearTimeout(this._timer),this._timer=setTimeout((function(){e.onMoveStopped(i)}),this.options.altitude.triggerDelay))},Fu.prototype.onGlobeMove=function(){},Fu.prototype.onRequestAltitude=function(t,e){if(t&&0!==Object.keys(t).length&&this.options.displayAltitude){if(this._noRightManagement)return Uu.warn("contract key configuration has no rights to load geoportal elevation "),void(document.getElementById(this._addUID("GPmousePositionAlt")).innerHTML="No rights!");var n=this.options.altitude.serviceOptions||{};n.zonly=!0,n.positions=[{lon:t.lon,lat:t.lat}],n.scope=this,n.rawResponse?n.onSuccess=function(t){Uu.info("alti service raw response : ",t)}:n.onSuccess=function(t){t&&Object.keys(t).length&&e.call(this,t.elevations[0].z)},n.onFailure=function(t){Uu.error("[getAltitude] "+t.message)},n.apiKey=n.apiKey||this.options.apiKey,"boolean"==typeof this.options.ssl&&(n.ssl=this.options.ssl),fn.Services.getAltitude(n)}},Fu.prototype.onShowMousePositionClick=function(){var t=this.getGlobe();this.collapsed=this._showMousePositionContainer.checked,this._showMousePositionContainer.checked?this._isDesktop?t.forget(yn.EVENTS.MOUSE_MOVE,this._callbacks.mouseMove):t.forget(yn.EVENTS.CENTER_CHANGED,this.onGlobeMove):this._isDesktop?t.listen(yn.EVENTS.MOUSE_MOVE,this._callbacks.mouseMove):t.listen(yn.EVENTS.CENTER_CHANGED,this.onGlobeMove),this._setElevationPanel(this.options.displayAltitude),this._setCoordinatesPanel(this.options.displayCoordinates),this.options.displayCoordinates||this._setSettingsPanel(!1)},Fu.prototype.onMousePositionProjectionSystemChange=function(t){var e=t.target.selectedIndex,n=t.target.options[e].value;this._setCurrentSystem(n)},Fu.prototype._setCurrentSystem=function(t){for(var e=null,n=0;n<this._projectionSystems.length;++n)if(this._projectionSystems[n].code===Number(t)){e=this._projectionSystems[n].type;break}e?(e!==this._currentProjectionType&&this._setTypeUnitsPanel(e),this._currentProjectionSystems=this._projectionSystems[Number(t)],this._isDesktop||this.onGlobeMove()):Uu.log("system not found in projection systems container")},Fu.prototype.onMousePositionProjectionSystemMouseOver=function(){var t=this.getGlobe();if(t){var e,n=t.getExtent(),i=document.getElementById(this._addUID("GPmousePositionProjectionSystem"));i.innerHTML="";for(var r=0;r<this._projectionSystems.length;r++){var s=this._projectionSystems[r];s.geoBBox&&(n.west>s.geoBBox.right||n.south>s.geoBBox.top||n.east<s.geoBBox.left||n.north<s.geoBBox.bottom)?s===this._currentProjectionSystems&&((e=document.createElement("option")).value=s.code,e.text=s.label||r,e.setAttribute("selected","selected"),e.setAttribute("disabled","disabled"),i.appendChild(e)):((e=document.createElement("option")).value=s.code,e.text=s.label||r,s===this._currentProjectionSystems&&e.setAttribute("selected","selected"),i.appendChild(e))}}},Fu.prototype.onMousePositionProjectionUnitsChange=function(t){var e=t.target.selectedIndex,n=t.target.options[e].value;this._currentProjectionUnits=n,this._isDesktop||this.onGlobeMove()};var Bu=Fu;
/**!
 * Sortable 1.14.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function zu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Vu(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zu(Object(n),!0).forEach((function(e){Wu(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zu(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Hu(t){return(Hu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wu(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ju(){return(ju=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function qu(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},s=Object.keys(t);for(i=0;i<s.length;i++)n=s[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)n=s[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Xu(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var Yu=Xu(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ju=Xu(/Edge/i),Zu=Xu(/firefox/i),Ku=Xu(/safari/i)&&!Xu(/chrome/i)&&!Xu(/android/i),Qu=Xu(/iP(ad|od|hone)/i),$u=Xu(/chrome/i)&&Xu(/android/i),td={capture:!1,passive:!1};function ed(t,e,n){t.addEventListener(e,n,!Yu&&td)}function nd(t,e,n){t.removeEventListener(e,n,!Yu&&td)}function id(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function rd(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function sd(t,e,n,i){if(t){n=n||document;do{if(null!=e&&(">"===e[0]?t.parentNode===n&&id(t,e):id(t,e))||i&&t===n)return t;if(t===n)break}while(t=rd(t))}return null}var od,ad=/\s+/g;function ld(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(ad," ").replace(" "+e+" "," ");t.className=(i+(n?" "+e:"")).replace(ad," ")}}function cd(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in i||-1!==e.indexOf("webkit")||(e="-webkit-"+e),i[e]=n+("string"==typeof n?"":"px")}}function hd(t,e){var n="";if("string"==typeof t)n=t;else do{var i=cd(t,"transform");i&&"none"!==i&&(n=i+" "+n)}while(!e&&(t=t.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(n)}function ud(t,e,n){if(t){var i=t.getElementsByTagName(e),r=0,s=i.length;if(n)for(;r<s;r++)n(i[r],r);return i}return[]}function dd(){var t=document.scrollingElement;return t||document.documentElement}function pd(t,e,n,i,r){if(t.getBoundingClientRect||t===window){var s,o,a,l,c,h,u;if(t!==window&&t.parentNode&&t!==dd()?(o=(s=t.getBoundingClientRect()).top,a=s.left,l=s.bottom,c=s.right,h=s.height,u=s.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,h=window.innerHeight,u=window.innerWidth),(e||n)&&t!==window&&(r=r||t.parentNode,!Yu))do{if(r&&r.getBoundingClientRect&&("none"!==cd(r,"transform")||n&&"static"!==cd(r,"position"))){var d=r.getBoundingClientRect();o-=d.top+parseInt(cd(r,"border-top-width")),a-=d.left+parseInt(cd(r,"border-left-width")),l=o+s.height,c=a+s.width;break}}while(r=r.parentNode);if(i&&t!==window){var p=hd(r||t),f=p&&p.a,m=p&&p.d;p&&(l=(o/=m)+(h/=m),c=(a/=f)+(u/=f))}return{top:o,left:a,bottom:l,right:c,width:u,height:h}}}function fd(t,e,n){for(var i=_d(t,!0),r=pd(t)[e];i;){var s=pd(i)[n];if(!("top"===n||"left"===n?r>=s:r<=s))return i;if(i===dd())break;i=_d(i,!1)}return!1}function md(t,e,n,i){for(var r=0,s=0,o=t.children;s<o.length;){if("none"!==o[s].style.display&&o[s]!==wp.ghost&&(i||o[s]!==wp.dragged)&&sd(o[s],n.draggable,t,!1)){if(r===e)return o[s];r++}s++}return null}function gd(t,e){for(var n=t.lastElementChild;n&&(n===wp.ghost||"none"===cd(n,"display")||e&&!id(n,e));)n=n.previousElementSibling;return n||null}function vd(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===wp.clone||e&&!id(t,e)||n++;return n}function yd(t){var e=0,n=0,i=dd();if(t)do{var r=hd(t),s=r.a,o=r.d;e+=t.scrollLeft*s,n+=t.scrollTop*o}while(t!==i&&(t=t.parentNode));return[e,n]}function _d(t,e){if(!t||!t.getBoundingClientRect)return dd();var n=t,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var r=cd(n);if(n.clientWidth<n.scrollWidth&&("auto"==r.overflowX||"scroll"==r.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==r.overflowY||"scroll"==r.overflowY)){if(!n.getBoundingClientRect||n===document.body)return dd();if(i||e)return n;i=!0}}}while(n=n.parentNode);return dd()}function xd(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function bd(t,e){return function(){if(!od){var n=arguments,i=this;1===n.length?t.call(i,n[0]):t.apply(i,n),od=setTimeout((function(){od=void 0}),e)}}}function Md(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function wd(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}var Ed="Sortable"+(new Date).getTime();function Sd(){var t,e=[];return{captureAnimationState:function(){(e=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(t){if("none"!==cd(t,"display")&&t!==wp.ghost){e.push({target:t,rect:pd(t)});var n=Vu({},e[e.length-1].rect);if(t.thisAnimationDuration){var i=hd(t,!0);i&&(n.top-=i.f,n.left-=i.e)}t.fromRect=n}}))},addAnimationState:function(t){e.push(t)},removeAnimationState:function(t){e.splice(function(t,e){for(var n in t)if(t.hasOwnProperty(n))for(var i in e)if(e.hasOwnProperty(i)&&e[i]===t[n][i])return Number(n);return-1}(e,{target:t}),1)},animateAll:function(n){var i=this;if(!this.options.animation)return clearTimeout(t),void("function"==typeof n&&n());var r=!1,s=0;e.forEach((function(t){var e=0,n=t.target,o=n.fromRect,a=pd(n),l=n.prevFromRect,c=n.prevToRect,h=t.rect,u=hd(n,!0);u&&(a.top-=u.f,a.left-=u.e),n.toRect=a,n.thisAnimationDuration&&xd(l,a)&&!xd(o,a)&&(h.top-a.top)/(h.left-a.left)==(o.top-a.top)/(o.left-a.left)&&(e=function(t,e,n,i){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*i.animation}(h,l,c,i.options)),xd(a,o)||(n.prevFromRect=o,n.prevToRect=a,e||(e=i.options.animation),i.animate(n,h,a,e)),e&&(r=!0,s=Math.max(s,e),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout((function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null}),e),n.thisAnimationDuration=e)})),clearTimeout(t),r?t=setTimeout((function(){"function"==typeof n&&n()}),s):"function"==typeof n&&n(),e=[]},animate:function(t,e,n,i){if(i){cd(t,"transition",""),cd(t,"transform","");var r=hd(this.el),s=r&&r.a,o=r&&r.d,a=(e.left-n.left)/(s||1),l=(e.top-n.top)/(o||1);t.animatingX=!!a,t.animatingY=!!l,cd(t,"transform","translate3d("+a+"px,"+l+"px,0)"),this.forRepaintDummy=function(t){return t.offsetWidth}(t),cd(t,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),cd(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout((function(){cd(t,"transition",""),cd(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1}),i)}}}}var Td=[],Rd={initializeByDefault:!0},Ad={mount:function(t){for(var e in Rd)Rd.hasOwnProperty(e)&&!(e in t)&&(t[e]=Rd[e]);Td.forEach((function(e){if(e.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")})),Td.push(t)},pluginEvent:function(t,e,n){var i=this;this.eventCanceled=!1,n.cancel=function(){i.eventCanceled=!0};var r=t+"Global";Td.forEach((function(i){e[i.pluginName]&&(e[i.pluginName][r]&&e[i.pluginName][r](Vu({sortable:e},n)),e.options[i.pluginName]&&e[i.pluginName][t]&&e[i.pluginName][t](Vu({sortable:e},n)))}))},initializePlugins:function(t,e,n,i){for(var r in Td.forEach((function(i){var r=i.pluginName;if(t.options[r]||i.initializeByDefault){var s=new i(t,e,t.options);s.sortable=t,s.options=t.options,t[r]=s,ju(n,s.defaults)}})),t.options)if(t.options.hasOwnProperty(r)){var s=this.modifyOption(t,r,t.options[r]);void 0!==s&&(t.options[r]=s)}},getEventProperties:function(t,e){var n={};return Td.forEach((function(i){"function"==typeof i.eventProperties&&ju(n,i.eventProperties.call(e[i.pluginName],t))})),n},modifyOption:function(t,e,n){var i;return Td.forEach((function(r){t[r.pluginName]&&r.optionListeners&&"function"==typeof r.optionListeners[e]&&(i=r.optionListeners[e].call(t[r.pluginName],n))})),i}};function Cd(t){var e=t.sortable,n=t.rootEl,i=t.name,r=t.targetEl,s=t.cloneEl,o=t.toEl,a=t.fromEl,l=t.oldIndex,c=t.newIndex,h=t.oldDraggableIndex,u=t.newDraggableIndex,d=t.originalEvent,p=t.putSortable,f=t.extraEventProperties;if(e=e||n&&n[Ed]){var m,g=e.options,v="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||Yu||Ju?(m=document.createEvent("Event")).initEvent(i,!0,!0):m=new CustomEvent(i,{bubbles:!0,cancelable:!0}),m.to=o||n,m.from=a||n,m.item=r||n,m.clone=s,m.oldIndex=l,m.newIndex=c,m.oldDraggableIndex=h,m.newDraggableIndex=u,m.originalEvent=d,m.pullMode=p?p.lastPutMode:void 0;var y=Vu(Vu({},f),Ad.getEventProperties(i,e));for(var _ in y)m[_]=y[_];n&&n.dispatchEvent(m),g[v]&&g[v].call(e,m)}}var Pd=["evt"],Ld=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.evt,r=qu(n,Pd);Ad.pluginEvent.bind(wp)(t,e,Vu({dragEl:Nd,parentEl:Dd,ghostEl:Od,rootEl:Gd,nextEl:kd,lastDownEl:Ud,cloneEl:Fd,cloneHidden:Bd,dragStarted:$d,putSortable:qd,activeSortable:wp.active,originalEvent:i,oldIndex:zd,oldDraggableIndex:Hd,newIndex:Vd,newDraggableIndex:Wd,hideGhostForTarget:_p,unhideGhostForTarget:xp,cloneNowHidden:function(){Bd=!0},cloneNowShown:function(){Bd=!1},dispatchSortableEvent:function(t){Id({sortable:e,name:t,originalEvent:i})}},r))};function Id(t){Cd(Vu({putSortable:qd,cloneEl:Fd,targetEl:Nd,rootEl:Gd,oldIndex:zd,oldDraggableIndex:Hd,newIndex:Vd,newDraggableIndex:Wd},t))}var Nd,Dd,Od,Gd,kd,Ud,Fd,Bd,zd,Vd,Hd,Wd,jd,qd,Xd,Yd,Jd,Zd,Kd,Qd,$d,tp,ep,np,ip,rp=!1,sp=!1,op=[],ap=!1,lp=!1,cp=[],hp=!1,up=[],dp="undefined"!=typeof document,pp=Qu,fp=Ju||Yu?"cssFloat":"float",mp=dp&&!$u&&!Qu&&"draggable"in document.createElement("div"),gp=function(){if(dp){if(Yu)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),vp=function(t,e){var n=cd(t),i=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),r=md(t,0,e),s=md(t,1,e),o=r&&cd(r),a=s&&cd(s),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+pd(r).width,c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+pd(s).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&o.float&&"none"!==o.float){var h="left"===o.float?"left":"right";return!s||"both"!==a.clear&&a.clear!==h?"horizontal":"vertical"}return r&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=i&&"none"===n[fp]||s&&"none"===n[fp]&&l+c>i)?"vertical":"horizontal"},yp=function(t){function e(t,n){return function(i,r,s,o){var a=i.options.group.name&&r.options.group.name&&i.options.group.name===r.options.group.name;if(null==t&&(n||a))return!0;if(null==t||!1===t)return!1;if(n&&"clone"===t)return t;if("function"==typeof t)return e(t(i,r,s,o),n)(i,r,s,o);var l=(n?i:r).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&t.indexOf(l)>-1}}var n={},i=t.group;i&&"object"==Hu(i)||(i={name:i}),n.name=i.name,n.checkPull=e(i.pull,!0),n.checkPut=e(i.put),n.revertClone=i.revertClone,t.group=n},_p=function(){!gp&&Od&&cd(Od,"display","none")},xp=function(){!gp&&Od&&cd(Od,"display","")};dp&&document.addEventListener("click",(function(t){if(sp)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),sp=!1,!1}),!0);var bp=function(t){if(Nd){t=t.touches?t.touches[0]:t;var e=(r=t.clientX,s=t.clientY,op.some((function(t){var e=t[Ed].options.emptyInsertThreshold;if(e&&!gd(t)){var n=pd(t),i=r>=n.left-e&&r<=n.right+e,a=s>=n.top-e&&s<=n.bottom+e;return i&&a?o=t:void 0}})),o);if(e){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.target=n.rootEl=e,n.preventDefault=void 0,n.stopPropagation=void 0,e[Ed]._onDragOver(n)}}var r,s,o},Mp=function(t){Nd&&Nd.parentNode[Ed]._isOutsideThisEl(t.target)};function wp(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=ju({},e),t[Ed]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return vp(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==wp.supportPointer&&"PointerEvent"in window&&!Ku,emptyInsertThreshold:5};for(var i in Ad.initializePlugins(this,t,n),n)!(i in e)&&(e[i]=n[i]);for(var r in yp(e),this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));this.nativeDraggable=!e.forceFallback&&mp,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?ed(t,"pointerdown",this._onTapStart):(ed(t,"mousedown",this._onTapStart),ed(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(ed(t,"dragover",this),ed(t,"dragenter",this)),op.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ju(this,Sd())}function Ep(t,e,n,i,r,s,o,a){var l,c,h=t[Ed],u=h.options.onMove;return!window.CustomEvent||Yu||Ju?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=n,l.draggedRect=i,l.related=r||e,l.relatedRect=s||pd(e),l.willInsertAfter=a,l.originalEvent=o,t.dispatchEvent(l),u&&(c=u.call(h,l,o)),c}function Sp(t){t.draggable=!1}function Tp(){hp=!1}function Rp(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,i=0;n--;)i+=e.charCodeAt(n);return i.toString(36)}function Ap(t){return setTimeout(t,0)}function Cp(t){return clearTimeout(t)}wp.prototype={constructor:wp,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(tp=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,Nd):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,n=this.el,i=this.options,r=i.preventOnFilter,s=t.type,o=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,a=(o||t).target,l=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||a,c=i.filter;if(function(t){up.length=0;var e=t.getElementsByTagName("input"),n=e.length;for(;n--;){var i=e[n];i.checked&&up.push(i)}}(n),!Nd&&!(/mousedown|pointerdown/.test(s)&&0!==t.button||i.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!Ku||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=sd(a,i.draggable,n,!1))&&a.animated||Ud===a)){if(zd=vd(a),Hd=vd(a,i.draggable),"function"==typeof c){if(c.call(this,t,a,this))return Id({sortable:e,rootEl:l,name:"filter",targetEl:a,toEl:n,fromEl:n}),Ld("filter",e,{evt:t}),void(r&&t.cancelable&&t.preventDefault())}else if(c&&(c=c.split(",").some((function(i){if(i=sd(l,i.trim(),n,!1))return Id({sortable:e,rootEl:i,name:"filter",targetEl:a,fromEl:n,toEl:n}),Ld("filter",e,{evt:t}),!0}))))return void(r&&t.cancelable&&t.preventDefault());i.handle&&!sd(l,i.handle,n,!1)||this._prepareDragStart(t,o,a)}}},_prepareDragStart:function(t,e,n){var i,r=this,s=r.el,o=r.options,a=s.ownerDocument;if(n&&!Nd&&n.parentNode===s){var l=pd(n);if(Gd=s,Dd=(Nd=n).parentNode,kd=Nd.nextSibling,Ud=n,jd=o.group,wp.dragged=Nd,Xd={target:Nd,clientX:(e||t).clientX,clientY:(e||t).clientY},Kd=Xd.clientX-l.left,Qd=Xd.clientY-l.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,Nd.style["will-change"]="all",i=function(){Ld("delayEnded",r,{evt:t}),wp.eventCanceled?r._onDrop():(r._disableDelayedDragEvents(),!Zu&&r.nativeDraggable&&(Nd.draggable=!0),r._triggerDragStart(t,e),Id({sortable:r,name:"choose",originalEvent:t}),ld(Nd,o.chosenClass,!0))},o.ignore.split(",").forEach((function(t){ud(Nd,t.trim(),Sp)})),ed(a,"dragover",bp),ed(a,"mousemove",bp),ed(a,"touchmove",bp),ed(a,"mouseup",r._onDrop),ed(a,"touchend",r._onDrop),ed(a,"touchcancel",r._onDrop),Zu&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Nd.draggable=!0),Ld("delayStart",this,{evt:t}),!o.delay||o.delayOnTouchOnly&&!e||this.nativeDraggable&&(Ju||Yu))i();else{if(wp.eventCanceled)return void this._onDrop();ed(a,"mouseup",r._disableDelayedDrag),ed(a,"touchend",r._disableDelayedDrag),ed(a,"touchcancel",r._disableDelayedDrag),ed(a,"mousemove",r._delayedDragTouchMoveHandler),ed(a,"touchmove",r._delayedDragTouchMoveHandler),o.supportPointer&&ed(a,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(i,o.delay)}}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Nd&&Sp(Nd),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;nd(t,"mouseup",this._disableDelayedDrag),nd(t,"touchend",this._disableDelayedDrag),nd(t,"touchcancel",this._disableDelayedDrag),nd(t,"mousemove",this._delayedDragTouchMoveHandler),nd(t,"touchmove",this._delayedDragTouchMoveHandler),nd(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?ed(document,"pointermove",this._onTouchMove):ed(document,e?"touchmove":"mousemove",this._onTouchMove):(ed(Nd,"dragend",this),ed(Gd,"dragstart",this._onDragStart));try{document.selection?Ap((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){if(rp=!1,Gd&&Nd){Ld("dragStarted",this,{evt:e}),this.nativeDraggable&&ed(document,"dragover",Mp);var n=this.options;!t&&ld(Nd,n.dragClass,!1),ld(Nd,n.ghostClass,!0),wp.active=this,t&&this._appendGhost(),Id({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(Yd){this._lastX=Yd.clientX,this._lastY=Yd.clientY,_p();for(var t=document.elementFromPoint(Yd.clientX,Yd.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(Yd.clientX,Yd.clientY))!==e;)e=t;if(Nd.parentNode[Ed]._isOutsideThisEl(t),e)do{if(e[Ed]){if(e[Ed]._onDragOver({clientX:Yd.clientX,clientY:Yd.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);xp()}},_onTouchMove:function(t){if(Xd){var e=this.options,n=e.fallbackTolerance,i=e.fallbackOffset,r=t.touches?t.touches[0]:t,s=Od&&hd(Od,!0),o=Od&&s&&s.a,a=Od&&s&&s.d,l=pp&&ip&&yd(ip),c=(r.clientX-Xd.clientX+i.x)/(o||1)+(l?l[0]-cp[0]:0)/(o||1),h=(r.clientY-Xd.clientY+i.y)/(a||1)+(l?l[1]-cp[1]:0)/(a||1);if(!wp.active&&!rp){if(n&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<n)return;this._onDragStart(t,!0)}if(Od){s?(s.e+=c-(Jd||0),s.f+=h-(Zd||0)):s={a:1,b:0,c:0,d:1,e:c,f:h};var u="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");cd(Od,"webkitTransform",u),cd(Od,"mozTransform",u),cd(Od,"msTransform",u),cd(Od,"transform",u),Jd=c,Zd=h,Yd=r}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!Od){var t=this.options.fallbackOnBody?document.body:Gd,e=pd(Nd,!0,pp,!0,t),n=this.options;if(pp){for(ip=t;"static"===cd(ip,"position")&&"none"===cd(ip,"transform")&&ip!==document;)ip=ip.parentNode;ip!==document.body&&ip!==document.documentElement?(ip===document&&(ip=dd()),e.top+=ip.scrollTop,e.left+=ip.scrollLeft):ip=dd(),cp=yd(ip)}ld(Od=Nd.cloneNode(!0),n.ghostClass,!1),ld(Od,n.fallbackClass,!0),ld(Od,n.dragClass,!0),cd(Od,"transition",""),cd(Od,"transform",""),cd(Od,"box-sizing","border-box"),cd(Od,"margin",0),cd(Od,"top",e.top),cd(Od,"left",e.left),cd(Od,"width",e.width),cd(Od,"height",e.height),cd(Od,"opacity","0.8"),cd(Od,"position",pp?"absolute":"fixed"),cd(Od,"zIndex","100000"),cd(Od,"pointerEvents","none"),wp.ghost=Od,t.appendChild(Od),cd(Od,"transform-origin",Kd/parseInt(Od.style.width)*100+"% "+Qd/parseInt(Od.style.height)*100+"%")}},_onDragStart:function(t,e){var n=this,i=t.dataTransfer,r=n.options;Ld("dragStart",this,{evt:t}),wp.eventCanceled?this._onDrop():(Ld("setupClone",this),wp.eventCanceled||((Fd=wd(Nd)).draggable=!1,Fd.style["will-change"]="",this._hideClone(),ld(Fd,this.options.chosenClass,!1),wp.clone=Fd),n.cloneId=Ap((function(){Ld("clone",n),wp.eventCanceled||(n.options.removeCloneOnHide||Gd.insertBefore(Fd,Nd),n._hideClone(),Id({sortable:n,name:"clone"}))})),!e&&ld(Nd,r.dragClass,!0),e?(sp=!0,n._loopId=setInterval(n._emulateDragOver,50)):(nd(document,"mouseup",n._onDrop),nd(document,"touchend",n._onDrop),nd(document,"touchcancel",n._onDrop),i&&(i.effectAllowed="move",r.setData&&r.setData.call(n,i,Nd)),ed(document,"drop",n),cd(Nd,"transform","translateZ(0)")),rp=!0,n._dragStartId=Ap(n._dragStarted.bind(n,e,t)),ed(document,"selectstart",n),$d=!0,Ku&&cd(document.body,"user-select","none"))},_onDragOver:function(t){var e,n,i,r,s=this.el,o=t.target,a=this.options,l=a.group,c=wp.active,h=jd===l,u=a.sort,d=qd||c,p=this,f=!1;if(!hp){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),o=sd(o,a.draggable,s,!0),C("dragOver"),wp.eventCanceled)return f;if(Nd.contains(t.target)||o.animated&&o.animatingX&&o.animatingY||p._ignoreWhileAnimating===o)return L(!1);if(sp=!1,c&&!a.disabled&&(h?u||(i=Dd!==Gd):qd===this||(this.lastPutMode=jd.checkPull(this,c,Nd,t))&&l.checkPut(this,c,Nd,t))){if(r="vertical"===this._getDirection(t,o),e=pd(Nd),C("dragOverValid"),wp.eventCanceled)return f;if(i)return Dd=Gd,P(),this._hideClone(),C("revert"),wp.eventCanceled||(kd?Gd.insertBefore(Nd,kd):Gd.appendChild(Nd)),L(!0);var m=gd(s,a.draggable);if(!m||function(t,e,n){var i=pd(gd(n.el,n.options.draggable));return e?t.clientX>i.right+10||t.clientX<=i.right&&t.clientY>i.bottom&&t.clientX>=i.left:t.clientX>i.right&&t.clientY>i.top||t.clientX<=i.right&&t.clientY>i.bottom+10}(t,r,this)&&!m.animated){if(m===Nd)return L(!1);if(m&&s===t.target&&(o=m),o&&(n=pd(o)),!1!==Ep(Gd,s,Nd,e,o,n,t,!!o))return P(),s.appendChild(Nd),Dd=s,I(),L(!0)}else if(m&&function(t,e,n){var i=pd(md(n.el,0,n.options,!0));return e?t.clientX<i.left-10||t.clientY<i.top&&t.clientX<i.right:t.clientY<i.top-10||t.clientY<i.bottom&&t.clientX<i.left}(t,r,this)){var g=md(s,0,a,!0);if(g===Nd)return L(!1);if(n=pd(o=g),!1!==Ep(Gd,s,Nd,e,o,n,t,!1))return P(),s.insertBefore(Nd,g),Dd=s,I(),L(!0)}else if(o.parentNode===s){n=pd(o);var v,y,_,x=Nd.parentNode!==s,b=!function(t,e,n){var i=n?t.left:t.top,r=n?t.right:t.bottom,s=n?t.width:t.height,o=n?e.left:e.top,a=n?e.right:e.bottom,l=n?e.width:e.height;return i===o||r===a||i+s/2===o+l/2}(Nd.animated&&Nd.toRect||e,o.animated&&o.toRect||n,r),M=r?"top":"left",w=fd(o,"top","top")||fd(Nd,"top","top"),E=w?w.scrollTop:void 0;if(tp!==o&&(y=n[M],ap=!1,lp=!b&&a.invertSwap||x),0!==(v=function(t,e,n,i,r,s,o,a){var l=i?t.clientY:t.clientX,c=i?n.height:n.width,h=i?n.top:n.left,u=i?n.bottom:n.right,d=!1;if(!o)if(a&&np<c*r){if(!ap&&(1===ep?l>h+c*s/2:l<u-c*s/2)&&(ap=!0),ap)d=!0;else if(1===ep?l<h+np:l>u-np)return-ep}else if(l>h+c*(1-r)/2&&l<u-c*(1-r)/2)return function(t){return vd(Nd)<vd(t)?1:-1}(e);if((d=d||o)&&(l<h+c*s/2||l>u-c*s/2))return l>h+c/2?1:-1;return 0}(t,o,n,r,b?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,lp,tp===o))){var S=vd(Nd);do{S-=v,_=Dd.children[S]}while(_&&("none"===cd(_,"display")||_===Od))}if(0===v||_===o)return L(!1);tp=o,ep=v;var T=o.nextElementSibling,R=!1,A=Ep(Gd,s,Nd,e,o,n,t,R=1===v);if(!1!==A)return 1!==A&&-1!==A||(R=1===A),hp=!0,setTimeout(Tp,30),P(),R&&!T?s.appendChild(Nd):o.parentNode.insertBefore(Nd,R?T:o),w&&Md(w,0,E-w.scrollTop),Dd=Nd.parentNode,void 0===y||lp||(np=Math.abs(y-pd(o)[M])),I(),L(!0)}if(s.contains(Nd))return L(!1)}return!1}function C(a,l){Ld(a,p,Vu({evt:t,isOwner:h,axis:r?"vertical":"horizontal",revert:i,dragRect:e,targetRect:n,canSort:u,fromSortable:d,target:o,completed:L,onMove:function(n,i){return Ep(Gd,s,Nd,e,n,pd(n),t,i)},changed:I},l))}function P(){C("dragOverAnimationCapture"),p.captureAnimationState(),p!==d&&d.captureAnimationState()}function L(e){return C("dragOverCompleted",{insertion:e}),e&&(h?c._hideClone():c._showClone(p),p!==d&&(ld(Nd,qd?qd.options.ghostClass:c.options.ghostClass,!1),ld(Nd,a.ghostClass,!0)),qd!==p&&p!==wp.active?qd=p:p===wp.active&&qd&&(qd=null),d===p&&(p._ignoreWhileAnimating=o),p.animateAll((function(){C("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==d&&(d.animateAll(),d._ignoreWhileAnimating=null)),(o===Nd&&!Nd.animated||o===s&&!o.animated)&&(tp=null),a.dragoverBubble||t.rootEl||o===document||(Nd.parentNode[Ed]._isOutsideThisEl(t.target),!e&&bp(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),f=!0}function I(){Vd=vd(Nd),Wd=vd(Nd,a.draggable),Id({sortable:p,name:"change",toEl:s,newIndex:Vd,newDraggableIndex:Wd,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){nd(document,"mousemove",this._onTouchMove),nd(document,"touchmove",this._onTouchMove),nd(document,"pointermove",this._onTouchMove),nd(document,"dragover",bp),nd(document,"mousemove",bp),nd(document,"touchmove",bp)},_offUpEvents:function(){var t=this.el.ownerDocument;nd(t,"mouseup",this._onDrop),nd(t,"touchend",this._onDrop),nd(t,"pointerup",this._onDrop),nd(t,"touchcancel",this._onDrop),nd(document,"selectstart",this)},_onDrop:function(t){var e=this.el,n=this.options;Vd=vd(Nd),Wd=vd(Nd,n.draggable),Ld("drop",this,{evt:t}),Dd=Nd&&Nd.parentNode,Vd=vd(Nd),Wd=vd(Nd,n.draggable),wp.eventCanceled||(rp=!1,lp=!1,ap=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Cp(this.cloneId),Cp(this._dragStartId),this.nativeDraggable&&(nd(document,"drop",this),nd(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ku&&cd(document.body,"user-select",""),cd(Nd,"transform",""),t&&($d&&(t.cancelable&&t.preventDefault(),!n.dropBubble&&t.stopPropagation()),Od&&Od.parentNode&&Od.parentNode.removeChild(Od),(Gd===Dd||qd&&"clone"!==qd.lastPutMode)&&Fd&&Fd.parentNode&&Fd.parentNode.removeChild(Fd),Nd&&(this.nativeDraggable&&nd(Nd,"dragend",this),Sp(Nd),Nd.style["will-change"]="",$d&&!rp&&ld(Nd,qd?qd.options.ghostClass:this.options.ghostClass,!1),ld(Nd,this.options.chosenClass,!1),Id({sortable:this,name:"unchoose",toEl:Dd,newIndex:null,newDraggableIndex:null,originalEvent:t}),Gd!==Dd?(Vd>=0&&(Id({rootEl:Dd,name:"add",toEl:Dd,fromEl:Gd,originalEvent:t}),Id({sortable:this,name:"remove",toEl:Dd,originalEvent:t}),Id({rootEl:Dd,name:"sort",toEl:Dd,fromEl:Gd,originalEvent:t}),Id({sortable:this,name:"sort",toEl:Dd,originalEvent:t})),qd&&qd.save()):Vd!==zd&&Vd>=0&&(Id({sortable:this,name:"update",toEl:Dd,originalEvent:t}),Id({sortable:this,name:"sort",toEl:Dd,originalEvent:t})),wp.active&&(null!=Vd&&-1!==Vd||(Vd=zd,Wd=Hd),Id({sortable:this,name:"end",toEl:Dd,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){Ld("nulling",this),Gd=Nd=Dd=Od=kd=Fd=Ud=Bd=Xd=Yd=$d=Vd=Wd=zd=Hd=tp=ep=qd=jd=wp.dragged=wp.ghost=wp.clone=wp.active=null,up.forEach((function(t){t.checked=!0})),up.length=Jd=Zd=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":Nd&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],n=this.el.children,i=0,r=n.length,s=this.options;i<r;i++)sd(t=n[i],s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Rp(t));return e},sort:function(t,e){var n={},i=this.el;this.toArray().forEach((function(t,e){var r=i.children[e];sd(r,this.options.draggable,i,!1)&&(n[t]=r)}),this),e&&this.captureAnimationState(),t.forEach((function(t){n[t]&&(i.removeChild(n[t]),i.appendChild(n[t]))})),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return sd(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];var i=Ad.modifyOption(this,t,e);n[t]=void 0!==i?i:e,"group"===t&&yp(n)},destroy:function(){Ld("destroy",this);var t=this.el;t[Ed]=null,nd(t,"mousedown",this._onTapStart),nd(t,"touchstart",this._onTapStart),nd(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(nd(t,"dragover",this),nd(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),op.splice(op.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!Bd){if(Ld("hideClone",this),wp.eventCanceled)return;cd(Fd,"display","none"),this.options.removeCloneOnHide&&Fd.parentNode&&Fd.parentNode.removeChild(Fd),Bd=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if(Bd){if(Ld("showClone",this),wp.eventCanceled)return;Nd.parentNode!=Gd||this.options.group.revertClone?kd?Gd.insertBefore(Fd,kd):Gd.appendChild(Fd):Gd.insertBefore(Fd,Nd),this.options.group.revertClone&&this.animate(Nd,Fd),cd(Fd,"display",""),Bd=!1}}else this._hideClone()}},dp&&ed(document,"touchmove",(function(t){(wp.active||rp)&&t.cancelable&&t.preventDefault()})),wp.utils={on:ed,off:nd,css:cd,find:ud,is:function(t,e){return!!sd(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},throttle:bd,closest:sd,toggleClass:ld,clone:wd,index:vd,nextTick:Ap,cancelNextTick:Cp,detectDirection:vp,getChild:md},wp.get=function(t){return t[Ed]},wp.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach((function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(wp.utils=Vu(Vu({},wp.utils),t.utils)),Ad.mount(t)}))},wp.create=function(t,e){return new wp(t,e)},wp.version="1.14.0";var Pp,Lp,Ip,Np,Dp,Op,Gp=[],kp=!1;function Up(){Gp.forEach((function(t){clearInterval(t.pid)})),Gp=[]}function Fp(){clearInterval(Op)}var Bp=bd((function(t,e,n,i){if(e.scroll){var r,s=(t.touches?t.touches[0]:t).clientX,o=(t.touches?t.touches[0]:t).clientY,a=e.scrollSensitivity,l=e.scrollSpeed,c=dd(),h=!1;Lp!==n&&(Lp=n,Up(),Pp=e.scroll,r=e.scrollFn,!0===Pp&&(Pp=_d(n,!0)));var u=0,d=Pp;do{var p=d,f=pd(p),m=f.top,g=f.bottom,v=f.left,y=f.right,_=f.width,x=f.height,b=void 0,M=void 0,w=p.scrollWidth,E=p.scrollHeight,S=cd(p),T=p.scrollLeft,R=p.scrollTop;p===c?(b=_<w&&("auto"===S.overflowX||"scroll"===S.overflowX||"visible"===S.overflowX),M=x<E&&("auto"===S.overflowY||"scroll"===S.overflowY||"visible"===S.overflowY)):(b=_<w&&("auto"===S.overflowX||"scroll"===S.overflowX),M=x<E&&("auto"===S.overflowY||"scroll"===S.overflowY));var A=b&&(Math.abs(y-s)<=a&&T+_<w)-(Math.abs(v-s)<=a&&!!T),C=M&&(Math.abs(g-o)<=a&&R+x<E)-(Math.abs(m-o)<=a&&!!R);if(!Gp[u])for(var P=0;P<=u;P++)Gp[P]||(Gp[P]={});Gp[u].vx==A&&Gp[u].vy==C&&Gp[u].el===p||(Gp[u].el=p,Gp[u].vx=A,Gp[u].vy=C,clearInterval(Gp[u].pid),0==A&&0==C||(h=!0,Gp[u].pid=setInterval(function(){i&&0===this.layer&&wp.active._onTouchMove(Dp);var e=Gp[this.layer].vy?Gp[this.layer].vy*l:0,n=Gp[this.layer].vx?Gp[this.layer].vx*l:0;"function"==typeof r&&"continue"!==r.call(wp.dragged.parentNode[Ed],n,e,t,Dp,Gp[this.layer].el)||Md(Gp[this.layer].el,n,e)}.bind({layer:u}),24))),u++}while(e.bubbleScroll&&d!==c&&(d=_d(d,!1)));kp=h}}),30),zp=function(t){var e=t.originalEvent,n=t.putSortable,i=t.dragEl,r=t.activeSortable,s=t.dispatchSortableEvent,o=t.hideGhostForTarget,a=t.unhideGhostForTarget;if(e){var l=n||r;o();var c=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,h=document.elementFromPoint(c.clientX,c.clientY);a(),l&&!l.el.contains(h)&&(s("spill"),this.onSpill({dragEl:i,putSortable:n}))}};function Vp(){}function Hp(){}Vp.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,n=t.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var i=md(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(e,i):this.sortable.el.appendChild(e),this.sortable.animateAll(),n&&n.animateAll()},drop:zp},ju(Vp,{pluginName:"revertOnSpill"}),Hp.prototype={onSpill:function(t){var e=t.dragEl,n=t.putSortable||this.sortable;n.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),n.animateAll()},drop:zp},ju(Hp,{pluginName:"removeOnSpill"});wp.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?ed(document,"dragover",this._handleAutoScroll):this.options.supportPointer?ed(document,"pointermove",this._handleFallbackAutoScroll):e.touches?ed(document,"touchmove",this._handleFallbackAutoScroll):ed(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;this.options.dragOverBubble||e.rootEl||this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?nd(document,"dragover",this._handleAutoScroll):(nd(document,"pointermove",this._handleFallbackAutoScroll),nd(document,"touchmove",this._handleFallbackAutoScroll),nd(document,"mousemove",this._handleFallbackAutoScroll)),Fp(),Up(),clearTimeout(od),od=void 0},nulling:function(){Dp=Lp=Pp=kp=Op=Ip=Np=null,Gp.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var n=this,i=(t.touches?t.touches[0]:t).clientX,r=(t.touches?t.touches[0]:t).clientY,s=document.elementFromPoint(i,r);if(Dp=t,e||this.options.forceAutoScrollFallback||Ju||Yu||Ku){Bp(t,this.options,s,e);var o=_d(s,!0);!kp||Op&&i===Ip&&r===Np||(Op&&Fp(),Op=setInterval((function(){var s=_d(document.elementFromPoint(i,r),!0);s!==o&&(o=s,Up()),Bp(t,n.options,s,e)}),10),Ip=i,Np=r)}else{if(!this.options.bubbleScroll||_d(s,!0)===dd())return void Up();Bp(t,this.options,_d(s,!1),!1)}}},ju(t,{pluginName:"scroll",initializeByDefault:!0})}),wp.mount(Hp,Vp);var Wp=wp,jp={_createDraggableElement:function(t,e){navigator.userAgent.match(/chrome|chromium|crios/i)?Wp.create(t,{handle:".GPlayerName",draggable:".draggable-layer",ghostClass:"GPghostLayer",animation:200,forceFallback:!0,onEnd:function(t){e._onDragAndDropLayerClick(t)}}):Wp.create(t,{handle:".GPlayerName",draggable:".draggable-layer",ghostClass:"GPghostLayer",animation:200,onEnd:function(t){e._onDragAndDropLayerClick(t)}})},_addUID:function(t){return this._uid?t+"-"+this._uid:t},_createMainContainerElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPlayerSwitcher"),t.className="GPwidget",t},_createMainLayersShowElement:function(){var t=document.createElement("input");return t.id=this._addUID("GPshowLayersList"),t.type="checkbox",t},_createMainLayersElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPlayersList"),t.className="GPpanel",t},_createMainPictoElement:function(){var t=this,e=document.createElement("label");e.id=this._addUID("GPshowLayersListPicto"),e.className="GPshowAdvancedToolPicto",e.htmlFor=this._addUID("GPshowLayersList"),e.title="Afficher/masquer le gestionnaire de couches";var n=document.createElement("span");n.id=this._addUID("GPshowLayersListOpen"),n.className="GPshowAdvancedToolOpen",n.addEventListener("click",(function(){if(document.getElementById(t._addUID("GPshowLayersList")).checked){for(var e=document.getElementsByClassName("GPlayerInfoOpened"),n=0;n<e.length;n++)e[n].className="GPlayerInfo";document.getElementById(t._addUID("GPlayerInfoPanel")).className="GPlayerInfoPanelClosed"}})),e.appendChild(n);var i=document.createElement("span");return i.addEventListener("click",(function(){if(document.getElementById(t._addUID("GPshowLayersList")).checked){for(var e=document.getElementsByClassName("GPlayerInfoOpened"),n=0;n<e.length;n++)e[n].className="GPlayerInfo";document.getElementById(t._addUID("GPlayerInfoPanel")).className="GPlayerInfoPanelClosed"}})),i.id=t._addUID("GPshowLayersListClose"),e.appendChild(i),e},_createMainInfoElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPlayerInfoPanel"),t.className="GPpanel GPlayerInfoPanelClosed",t},_createContainerLayerElement:function(t){var e=document.createElement("div");e.id=this._addUID("GPlayerSwitcher_ID_"+t.id),e.className="GPlayerSwitcher_layer draggable-layer",e.appendChild(this._createBasicToolElement(t));for(var n=this._createAdvancedToolShowElement(t),i=0;i<n.length;i++)e.appendChild(n[i]);return e.appendChild(this._createAdvancedToolElement(t)),e},_createBasicToolElement:function(t){var e=document.createElement("div");e.id=this._addUID("GPbasicTools_ID_"+t.id),e.className="GPlayerBasicTools",e.appendChild(this._createBasicToolNameElement(t));for(var n=this._createBasicToolVisibilityElement(t),i=0;i<n.length;i++)e.appendChild(n[i]);return e},_createBasicToolNameElement:function(t){var e=document.createElement("span");return e.id=this._addUID("GPname_ID_"+t.id),e.className="GPlayerName",e.title=t.description||t.title,e.innerHTML=t.title,e},_createBasicToolVisibilityElement:function(t){var e=[],n=void 0===t.visibility||t.visibility,i=this._addUID("GPvisibility_ID_"+t.id),r=document.createElement("input");r.id=i,r.type="checkbox",r.checked=n;var s=document.createElement("label");s.htmlFor=i,s.id=this._addUID("GPvisibilityPicto_ID_"+t.id),s.className="GPlayerVisibility",s.title="Afficher/masquer la couche";var o=this;return r.addEventListener?r.addEventListener("click",(function(t){o._onVisibilityLayerClick(t)})):r.attachEvent&&r.attachEvent("onclick",(function(t){o._onVisibilityLayerClick(t)})),e.push(r),e.push(s),e},_createAdvancedToolShowElement:function(t){var e=[],n=document.createElement("label");n.id=this._addUID("GPshowAdvancedToolsPicto_ID_"+t.id),n.htmlFor=this._addUID("GPshowAdvancedTools_ID_"+t.id),n.title="Plus d'outils",n.className="GPshowMoreOptions GPshowLayerAdvancedTools";var i=document.createElement("input");return i.type="checkbox",i.id=this._addUID("GPshowAdvancedTools_ID_"+t.id),e.push(i),e.push(n),e},_createAdvancedToolElement:function(t){var e=document.createElement("div");if(e.id=this._addUID("GPadvancedTools_ID_"+t.id),e.className="GPlayerAdvancedTools",e.appendChild(this._createAdvancedToolDeleteElement(t)),t.title&&t.description&&e.appendChild(this._createAdvancedToolInformationElement(t)),"feature"!==t.type)for(var n=this._createAdvancedToolOpacityElement(t),i=0;i<n.length;i++)e.appendChild(n[i]);return e},_createAdvancedToolDeleteElement:function(t){var e=document.createElement("div");e.id=this._addUID("GPremove_ID_"+t.id),e.className="GPlayerRemove",e.title="Supprimer la couche",e.layerId=t.id;var n=this;return e.addEventListener?e.addEventListener("click",(function(t){n._onDropLayerClick(t)})):e.attachEvent&&e.attachEvent("onclick",(function(t){n._onDropLayerClick(t)})),e},_createAdvancedToolInformationElement:function(t){var e=document.createElement("div");e.id=this._addUID("GPinfo_ID_"+t.id),e.className="GPlayerInfo",e.title="Informations/légende",e.layerId=t.id;var n=this;return e.addEventListener?e.addEventListener("click",(function(t){n._onOpenLayerInfoClick(t)})):e.attachEvent&&e.attachEvent("onclick",(function(t){n._onOpenLayerInfoClick(t)})),e},_createAdvancedToolOpacityElement:function(t){var e=[],n=document.createElement("div");n.id=this._addUID("GPopacity_ID_"+t.id),n.className="GPlayerOpacity",n.title="Opacité";var i=void 0!==t.opacity?t.opacity:1;i=Math.round(100*i);var r=document.createElement("input");r.id=this._addUID("GPopacityValueDiv_ID_"+t.id),r.type="range",r.value=i;var s=this;r.addEventListener?r.addEventListener("change",(function(t){s._onChangeLayerOpacity(t)})):r.attachEvent&&r.attachEvent("onchange",(function(t){s._onChangeLayerOpacity(t)})),r.addEventListener?r.addEventListener("input",(function(t){s._onChangeLayerOpacity(t)})):r.attachEvent&&r.attachEvent("oninput",(function(t){s._onChangeLayerOpacity(t)})),n.appendChild(r);var o=document.createElement("div");o.id=this._addUID("GPopacityValueDiv_ID_"+t.id),o.className="GPlayerOpacityValue";var a=document.createElement("span");return a.id=this._addUID("GPopacityValue_ID_"+t.id),a.innerHTML=i+"%",o.appendChild(a),e.push(n),e.push(o),e},_createContainerLayerInfoElement:function(t){var e=document.createElement("div");e.id=this._addUID("GPlayerInfoContent");var n=document.createElement("div");if(n.id=this._addUID("GPlayerInfoTitle"),n.innerHTML=t.title,e.appendChild(n),t.quicklookUrl){var i=document.createElement("div");i.id=this._addUID("GPlayerInfoQuicklook"),i.title="Afficher un aperçu de la couche";var r=document.createElement("a");r.href=t.quicklookUrl,r.appendChild(i),e.appendChild(r)}var s=document.createElement("div");s.id=this._addUID("GPlayerInfoClose"),s.title="Fermer la fenêtre";var o=this,a=function(){document.getElementById(o._addUID("GPlayerInfoPanel")).className="GPlayerInfoPanelClosed";for(var t=document.getElementsByClassName("GPlayerInfoOpened"),e=0;e<t.length;e++)t[e].className="GPlayerInfo"};s.addEventListener?s.addEventListener("click",a):s.attachEvent&&s.attachEvent("onclick",a),e.appendChild(s);var l=document.createElement("div");if(l.id=this._addUID("GPlayerInfoDescription"),l.innerHTML=t.description,e.appendChild(l),t.metadata){var c=document.createElement("div");c.id=this._addUID("GPlayerInfoMetadata");var h=document.createElement("div");h.className="GPlayerInfoSubtitle",h.innerHTML="Métadonnées",c.appendChild(h);for(var u=0;u<t.metadata.length;u++){var d=t.metadata[u].url,p=document.createElement("div");p.className="GPlayerInfoLink";var f=document.createElement("a");f.href=d,f.innerHTML=d,p.appendChild(f),c.appendChild(p)}0!==t.metadata.length&&e.appendChild(c)}if(t.legends){var m=document.createElement("div");m.id=this._addUID("GPlayerInfoLegend");var g=document.createElement("div");g.className="GPlayerInfoSubtitle",g.innerHTML="Légende",m.appendChild(g);for(var v={},y=t.maxScaleDenominator||56e7,_=0;_<t.legends.length;_++){var x=t.legends[_].minScaleDenominator;if(x){var b=x.toString();x=Math.round(parseInt(b.substring(0,3),10)/10)*Math.pow(10,b.length-2)}else x=270;v[x]=t.legends[_]}for(var M in v)if(v.hasOwnProperty(M)){var w=v[M].url;if("string"==typeof w&&-1===w.toLowerCase().indexOf("nolegend.jpg")){var E=document.createElement("div");E.className="GPlayerInfoLink",y=v[M].maxScaleDenominator||y;var S=document.createElement("a");S.href=w,S.innerHTML="Du 1/"+M+" au 1/"+y,E.appendChild(S),m.appendChild(E)}else delete v[M]}0!==Object.keys(v).length&&e.appendChild(m)}return e}};function qp(t){return(qp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Xp=o.a.getLogger("LayerSwitcher");function Yp(t){var e=(t=t||{}).options||{},n=t.layers||[];if(!(this instanceof Yp))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(!Array.isArray(n))throw new Error("ERROR WRONG_TYPE : layers should be an array");if("object"!==qp(e))throw new Error("ERROR WRONG_TYPE : options should be an object");this._initialize(e,n);var i=this._initContainer(e);this._addedLayerConf={},Du.call(this,{name:"LayerSwitcher",element:i,target:e.target,position:e.position})}Yp.prototype=Object.create(Du.prototype,{}),bn.assign(Yp.prototype,jp),Yp.prototype.constructor=Yp,Yp.prototype.setGlobe=function(t){var e;if(t){for(var n=this,i=0;i<this._initLayers.length;i++){var r=null;if(this._initLayers[i].id&&(r=t.getLayerById(this._initLayers[i].id)),r&&this._initLayers[i].displayed){var s=this._initLayers[i].config||{},o={title:s.title||r.title||this._initLayers[i].id,description:s.description||null,legends:s.legends||[],metadata:s.metadata||[],quicklookUrl:s.quicklookUrl||null};void 0!==s.ipr&&(o.ipr=s.ipr),void 0!==s.opacity&&(o.opacity=s.opacity),void 0!==s.visibility&&(o.visibility=s.visibility),this._layers[r.id]=o}}this._addGlobeLayers(t),this._callbacks.onOpacityLayerCallBack=function(t){n._updateLayerOpacity(t.target.id,t.new.opacity)},this._callbacks.onVisibilityLayerCallBack=function(t){n._updateLayerVisibility(t.target.id,t.new.visible)},this._callbacks.onChangedViewCallBack=function(t){n._inRangeUpdate(t.colorLayersId)},t.listen(yn.EVENTS.PRE_RENDER,this._callbacks.onChangedViewCallBack),t.preRenderEventFetchColorLayersDisplayed(),this._callbacks.onAddedLayerCallBack=function(t){var e=t.layerId;if(n){if(!n._layerDisplayedInLayerSwitcher(e))return;var i=n.getGlobe().getLayerById(e);if("elevation"===i.type)return;var r=n._getLayerConf(e)||n._addedLayerConf[e];r?n.addLayer(i,r):n.addLayer(i)}},t.listen(yn.EVENTS.LAYER_ADDED,this._callbacks.onAddedLayerCallBack),this._callbacks.onRemovedLayerCallBack=function(t){var e=t.layerId;n&&n.removeLayer(e)},t.listen(yn.EVENTS.LAYER_REMOVED,this._callbacks.onRemovedLayerCallBack),this._callbacks.onIndexLayerCallBack=function(t){(function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(t.new.sequence,t.previous.sequence)||n._updateLayerListContainer()},t.listen(yn.EVENTS.LAYERS_ORDER_CHANGED,this._callbacks.onIndexLayerCallBack),e=t.getColorLayers();for(var a=0;a<e.length;++a)t.addLayerListener(e[a],yn.EVENTS.OPACITY_PROPERTY_CHANGED,this._callbacks.onOpacityLayerCallBack),t.addLayerListener(e[a],yn.EVENTS.VISIBLE_PROPERTY_CHANGED,this._callbacks.onVisibilityLayerCallBack),n._updateLayerVisibility(e[a].id,e[a].visible),n._updateLayerOpacity(e[a].id,e[a].opacity)}else{this._globe.forget(yn.EVENTS.PRE_RENDER,this._callbacks.onChangedViewCallBack),this._globe.forget(yn.EVENTS.LAYER_ADDED,this._callbacks.onAddedLayerCallBack),this._globe.forget(yn.EVENTS.LAYER_REMOVED,this._callbacks.onRemovedLayerCallBack),this._globe.forget(yn.EVENTS.LAYERS_ORDER_CHANGED,this._callbacks.onIndexLayerCallBack),e=this._globe.getColorLayers();for(var l=0;l<e.length;++l)this._globe.removeLayerListener(e[l],yn.EVENTS.OPACITY_PROPERTY_CHANGED,this._callbacks.onOpacityLayerCallBack),this._globe.removeLayerListener(e[l],yn.EVENTS.VISIBLE_PROPERTY_CHANGED,this._callbacks.onVisibilityLayerCallBack);for(;this._element.hasChildNodes();)this._element.removeChild(this._element.lastChild);this._element.parentNode.removeChild(this._element)}Du.prototype.setGlobe.call(this,t)},Yp.prototype.addLayer=function(t,e){e=e||{};var n=this.getGlobe();if(t){var i=t.id;if("undefined"!==i)if(n.addLayerListener(t,yn.EVENTS.OPACITY_PROPERTY_CHANGED,this._callbacks.onOpacityLayerCallBack),n.addLayerListener(t,yn.EVENTS.VISIBLE_PROPERTY_CHANGED,this._callbacks.onVisibilityLayerCallBack),n.getLayerById(i))if(this._layers[i]){for(var r in e)e.hasOwnProperty(r)&&(this._layers[i][r]=e[r]);if(void 0!==e.ipr&&(t.attribution=e.ipr),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.visibility&&(t.visible=e.visibility),e.title){var s=document.getElementById(this._addUID("GPname_ID_"+i));s&&(s.innerHTML=e.title)}var o=document.getElementById(this._addUID("GPinfo_ID_"+i));if(!document.getElementById(this._addUID("GPinfo_ID_"+i))&&e.description&&(e.legends||e.metadata||e.quicklookUrl)){var a=document.getElementById(this._addUID("GPadvancedTools_ID_"+i));a&&a.appendChild(this._createAdvancedToolInformationElement({id:i}))}o&&"GPlayerInfoOpened"===o.className&&(document.getElementById(this._addUID("GPlayerInfoPanel")).className="GPlayerInfoPanelClosed",o.className="GPlayerInfo")}else{var l=this._getLayerInfo(t)||{},c={title:e.title||l._title||i,description:e.description||l._description||null,legends:e.legends||l._legends||[],metadata:e.metadata||l._metadata||[],quicklookUrl:e.quicklookUrl||l._quicklookUrl||null};void 0!==e.ipr&&(c.ipr=e.ipr,t.attribution=c.ipr),void 0!==e.opacity&&(c.opacity=e.opacity,t.opacity=c.opacity),void 0!==e.visibility&&(c.visibility=e.visibility,t.visible=c.visibility),this._layers[i]=c,this._layers[i].div=this._createLayerDiv(i),this._updateLayerListContainer()}else Xp.error("LayerSwitcher:addLayer - configuration cannot be set for ",t," layer (layer is not in globe layers )");else Xp.error("LayerSwitcher:addLayer - configuration cannot be set for "+t+" layer (layer id not found)")}else Xp.error("LayerSwitcher:addLayer - missing layer parameter")},Yp.prototype.removeLayer=function(t){var e=document.getElementById(this._addUID("GPlayersList")),n=document.getElementById(this._addUID("GPinfo_ID_"+t));n&&"GPlayerInfoOpened"===n.className&&(document.getElementById(this._addUID("GPlayerInfoPanel")).className="GPlayerInfoPanelClosed",n.className="GPlayerInfo");var i=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+t));i&&e.removeChild(i),delete this._layers[t]},Yp.prototype.setCollapsed=function(t){if(void 0!==t){var e=this.getCollapsed();if(!(t&&e||!t&&!e)){if(!e){for(var n=document.getElementsByClassName("GPlayerInfoOpened"),i=0;i<n.length;i++)n[i].className="GPlayerInfo";document.getElementById(this._addUID("GPlayerInfoPanel")).className="GPlayerInfoPanelClosed"}document.getElementById(this._addUID("GPshowLayersList")).checked=!t}}else Xp.error("LayerSwitcher:setCollapsed - missing collapsed parameter")},Yp.prototype.getCollapsed=function(){return!document.getElementById(this._addUID("GPshowLayersList")).checked},Yp.prototype._initialize=function(t,e){this._uid=En.generate(),this._layers={},this._layerListContainer=null,this._callbacks={},this._options=t,this._initLayers=e},Yp.prototype._getLayerConf=function(t){for(var e=0;e<this._initLayers.length;++e)if(this._initLayers[e].id===t)return this._initLayers[e].config;return null},Yp.prototype._layerDisplayedInLayerSwitcher=function(t){for(var e=0;e<this._initLayers.length;++e)if(this._initLayers[e].id===t)return void 0===this._initLayers[e].displayed||this._initLayers[e].displayed;return!0},Yp.prototype._initContainer=function(t){var e=this._createMainContainerElement(),n=this._createMainLayersShowElement();e.appendChild(n),t.collapsed||(n.checked="checked");var i=this._layerListContainer=this._createMainLayersElement();e.appendChild(i),this._createDraggableElement(i,this);var r=this._createMainPictoElement();e.appendChild(r);var s=this._createMainInfoElement();return e.appendChild(s),e},Yp.prototype._addGlobeLayers=function(t){for(var e,n=this.getElement().childNodes,i=0;i<n.length;i++)if(n[i].id===this._addUID("GPlayersList")){e=n[i];break}t.getColorLayers().sort((function(t,e){return e.sequence-t.sequence})).forEach((function(t){var n;if(n=t.id,this._layerDisplayedInLayerSwitcher(n)){var i=this._getLayerConf(n)||this._addedLayerConf[n]||{},r=this._getLayerInfo(t)||{};if(this._layers[n]){var s=this._layers[n];void 0!==s.ipr&&(t.options.attribution=s.ipr),void 0!==s.opacity&&(t.opacity=s.opacity),void 0!==s.visibility&&(t.visible=s.visibility)}else{var o={title:i.title||r._title||n,description:i.description||r._description||null,legends:i.legends||r._legends||[],metadata:i.metadata||r._metadata||[],quicklookUrl:i.quicklookUrl||r._quicklookUrl||null};this._layers[n]=o}var a=this._createLayerDiv(n);this._layers[n].div=a,e.appendChild(a)}}),this)},Yp.prototype._createLayerDiv=function(t){var e=this._layers[t],n=e.legends&&0!==e.legends.length,i=e.metadata&&0!==e.metadata.length,r=e.quicklookUrl;(n||i||r)&&(e.displayInformationElement=!0),e.id=t;var s=this._createContainerLayerElement(e);return e.inRange||s.classList.add("outOfRange"),s},Yp.prototype._onChangeLayerOpacity=function(t){var e=this.getGlobe(),n=this._resolveLayerId(t.target.id),i=t.target.value;document.getElementById(this._addUID("GPopacityValue_ID_"+n)).innerHTML=i+"%",e.setLayerOpacity(n,i/100)},Yp.prototype._updateLayerOpacity=function(t,e){e>1&&(e=1),e<0&&(e=0);var n=document.getElementById(this._addUID("GPopacityValueDiv_ID_"+t));n&&(n.value=Math.round(100*e));var i=document.getElementById(this._addUID("GPopacityValue_ID_"+t));i&&(i.innerHTML=Math.round(100*e)+"%")},Yp.prototype._onVisibilityLayerClick=function(t){var e=this.getGlobe(),n=this._resolveLayerId(t.target.id);e.setLayerVisibility(n,t.target.checked)},Yp.prototype._updateLayerVisibility=function(t,e){var n=document.getElementById(this._addUID("GPvisibility_ID_"+t));n&&(n.checked=e)},Yp.prototype._onOpenLayerInfoClick=function(t){var e,n,i=this._resolveLayerId(t.target.id),r=this._layers[i],s=document.getElementById(t.target.id);if("GPlayerInfoOpened"===s.className)return void 0!==s.classList&&(s.classList.remove("GPlayerInfoOpened"),s.classList.add("GPlayerInfo")),void 0!==(e=document.getElementById(this._addUID("GPlayerInfoPanel"))).classList&&(e.classList.remove("GPpanel"),e.classList.remove("GPlayerInfoPanelOpened"),e.classList.add("GPlayerInfoPanelClosed")),n=document.getElementById(this._addUID("GPlayerInfoContent")),void e.removeChild(n);for(var o=document.getElementsByClassName("GPlayerInfoOpened"),a=0;a<o.length;a++)o[a].className="GPlayerInfo";void 0!==s.classList&&(s.classList.remove("GPlayerInfo"),s.classList.add("GPlayerInfoOpened")),void 0!==(e=document.getElementById(this._addUID("GPlayerInfoPanel"))).classList&&(e.classList.add("GPpanel"),e.classList.remove("GPlayerInfoPanelClosed"),e.classList.add("GPlayerInfoPanelOpened")),(n=document.getElementById(this._addUID("GPlayerInfoContent")))&&e.removeChild(n);var l={title:r.title,description:r.description,quicklookUrl:r.quicklookUrl,metadata:r.metadata,legends:r.legends},c=this._createContainerLayerInfoElement(l);e.appendChild(c)},Yp.prototype._onDropLayerClick=function(t){var e=this.getGlobe(),n=this._resolveLayerId(t.target.id);e.removeLayer(n),this._updateLayerListContainer()},Yp.prototype._onDragAndDropLayerClick=function(t){var e=this.getGlobe();if(t.newIndex-t.oldIndex!=0){var n=null;if(t.newIndex){var i=this._resolveLayerId(t.from.childNodes[t.newIndex+(t.newIndex-t.oldIndex<0?1:-1)].id);n=e.getLayerById(i).sequence}else n=e.getColorLayers().length-1;var r=this._resolveLayerId(t.item.id);e.moveLayerToIndex(r,n)}},Yp.prototype._inRangeUpdate=function(t){for(var e in this._layers){var n=this._layers[e];if(n){var i=t.indexOf(n.id)>=0;i&&!n.inRange?(n.inRange=!0,document.getElementById(this._addUID("GPlayerSwitcher_ID_"+n.id)).classList.remove("outOfRange")):!i&&n.inRange&&(n.inRange=!1,document.getElementById(this._addUID("GPlayerSwitcher_ID_"+n.id)).classList.add("outOfRange"))}}},Yp.prototype._updateLayerListContainer=function(){if(this._layerListContainer){for(var t=this.getGlobe();this._layerListContainer.firstChild;)this._layerListContainer.removeChild(this._layerListContainer.firstChild);for(var e=t.getColorLayers().sort((function(t,e){return e.sequence-t.sequence})),n=0;n<e.length;n++)if(this._layers[e[n].id]){var i=this._layers[e[n].id].div;this._layerListContainer.appendChild(i)}}else Xp.error("[Itowns.control.LayerSwitcher] _updateLayerListContainer : layer list container not found to update layers order ?!")},Yp.prototype._getLayerInfo=function(t){var e={};return t&&(e._title=t.title||null,e._description=t.description||null,e._quicklookUrl=t.quicklookUrl||null,e._metadata=t.metadata||null,e._legends=t.legends||null),e},Yp.prototype._resolveLayerId=function(t){var e=En.name(t);return e.substring(e.indexOf("_ID_")+4)};var Jp=Yp,Zp={_addUID:function(t){return this._uid?t+"-"+this._uid:t},_createMainContainerElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPboostRelief"),t.className="GPwidget",t},_createMainBoostReliefShowElement:function(t){var e=document.createElement("input");return e.id=this._addUID("GPshowBoostReliefList"),e.type="checkbox",t&&(e.checked=!0),e},_createAdvancedToolElement:function(t){var e=document.createElement("div");e.className="GPlayerAdvancedToolsRelief";for(var n=this._createAdvancedToolReliefElement(t.scale,t.defaultBoost),i=0;i<n.length;i++)e.appendChild(n[i]);return e},_createAdvancedToolReliefElement:function(t,e){var n=[],i=document.createElement("div");i.className="GPlayerRelief",i.title="Relief";var r=document.createElement("input");r.id=this._addUID("GPreliefValueDiv"),r.type="range",t||(t={min:1,max:50,step:1}),r.min=t.min||1,r.max=t.max||50,r.step=t.step||1;var s=1;e&&(s=e),s>r.max&&(s=r.max),s<r.min&&(s=r.min),r.value=s;var o=this;r.addEventListener?r.addEventListener("change",(function(t){o._onChangeLayerRelief(t)})):r.attachEvent&&r.attachEvent("onchange",(function(t){o._onChangeLayerRelief(t)})),r.addEventListener?r.addEventListener("input",(function(t){o._onChangeLayerRelief(t)})):r.attachEvent&&r.attachEvent("oninput",(function(t){o._onChangeLayerRelief(t)})),i.appendChild(r);var a=document.createElement("div");a.id=this._addUID("GPreliefValueDiv"),a.className="GPlayerReliefValue";var l=document.createElement("span");return l.id=this._addUID("GPreliefValue"),l.innerHTML="x1",a.appendChild(l),n.push(i),n.push(a),n},_createMainBoostReliefListContainer:function(){var t=document.createElement("div");return t.id=this._addUID("GPBoostReliefListContainer"),t.className="GPpanel",t},_createMainPictoElement:function(){var t=this,e=document.createElement("label");e.id=this._addUID("GPshowBoostReliefListPicto"),e.className="GPshowAdvancedToolPicto",e.htmlFor=this._addUID("GPshowBoostReliefList"),e.title="Afficher/Masquer le control d'exageration du relief";var n=document.createElement("span");return n.id=this._addUID("GPshowBoostReliefOpenClose"),n.className="GPshowAdvancedToolOpen",e.addEventListener("click",(function(){document.getElementById(t._addUID("GPshowBoostReliefList")).checked?document.getElementById(t._addUID("GPBoostReliefListContainer")).style.display="none":document.getElementById(t._addUID("GPBoostReliefListContainer")).style.display="block"})),e.appendChild(n),e}};function Kp(t){return(Kp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Qp=o.a.getLogger("BoostRelief");function $p(t){var e=(t=t||{}).options||{};if(!(this instanceof $p))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if("object"!==Kp(e))throw new Error("ERROR WRONG_TYPE : options should be an object");this._initialize();var n=this._initContainer(t),i=document.getElementById(e.target)||null;Du.call(this,{name:"BoostRelief",element:n,target:i})}$p.prototype=Object.create(Du.prototype,{}),bn.assign($p.prototype,Zp),$p.prototype.constructor=$p,$p.prototype.setGlobe=function(t){if(!t){for(;this._element.hasChildNodes();)this._element.removeChild(this._element.lastChild);this._element.parentNode.removeChild(this._element)}Du.prototype.setGlobe.call(this,t)},$p.prototype.setCollapsed=function(t){if(void 0!==t)if("boolean"==typeof t){var e=this.getCollapsed();if(!(t&&e||!t&&!e)){var n=document.getElementById(this._addUID("GPBoostReliefListContainer"));t?(n.style.display="block",document.getElementById(this._addUID("GPshowBoostReliefList")).checked=!0):(n.style.display="none",document.getElementById(this._addUID("GPshowBoostReliefList")).checked=!1)}}else Qp.error("BoostRelief:setCollapsed - collapsed parameter is not a boolean");else Qp.error("BoostRelief:setCollapsed - missing collapsed parameter")},$p.prototype.getCollapsed=function(){return document.getElementById(this._addUID("GPshowBoostReliefList")).checked},$p.prototype._initialize=function(){this._uid=En.generate(),this._layers={},this._callbacks={}},$p.prototype._initContainer=function(t){var e=this._createMainContainerElement(),n=this._createMainBoostReliefShowElement(t.collapsed);e.appendChild(n);var i=this._boostReliefListContainer=this._createMainBoostReliefListContainer(),r=this._createAdvancedToolElement(t);i.appendChild(r),e.appendChild(i);var s=this._createMainPictoElement();return e.appendChild(s),t.collapsed?i.style.display="block":i.style.display="none",e},$p.prototype._onChangeLayerRelief=function(t){var e=parseInt(t.target.value);document.getElementById(this._addUID("GPreliefValue")).innerHTML="x"+e,this._updateLayersRelief(e)},$p.prototype._updateLayersRelief=function(t){var e=this.getGlobe();for(var n,i,r=e.getElevationLayers(),s=0;s<r.length;s++)n=r[s],i=t,n.scale=i,e.notifyChange(n)},$p.prototype.changeBoost=function(t){var e=document.getElementById(this._addUID("GPreliefValueDiv"));if(e){t>e.max&&(t=e.max),t<e.min&&(t=e.min),this._updateLayersRelief(t),e.value=t;var n=document.getElementById(this._addUID("GPreliefValue"));n&&(n.innerHTML="x"+t)}else Qp.error("BoostRelief:changeBoost - boostRelief slider not loaded")},$p.prototype._resolveLayerId=function(t){var e=En.name(t);return e.substring(e.indexOf("_ID_")+4)};var tf=$p,ef={getZoomLevelFromScaleDenominator:function(t,e){var n={};switch(e){case"EPSG:2154":n={0:104579.224549894,1:52277.5323537905,2:26135.4870785954,3:13066.8913818,4:6533.2286041135,5:3266.5595244627,6:1633.2660045974,7:816.629554986,8:408.3139146768,9:204.1567415109,10:102.0783167832,11:51.0391448966,12:25.5195690743,13:12.7597836936,14:6.379891636,15:3.1899457653,16:1.5949728695,17:.7974864315,18:.3987432149,19:.1993716073,20:.0996858037,21:.0498429018};break;default:n={0:156543.033928041,1:78271.51696402048,2:39135.758482010235,3:19567.87924100512,4:9783.93962050256,5:4891.96981025128,6:2445.98490512564,7:1222.99245256282,8:611.49622628141,9:305.7481131407048,10:152.8740565703525,11:76.43702828517624,12:38.21851414258813,13:19.10925707129406,14:9.554628535647032,15:4.777314267823516,16:2.388657133911758,17:1.194328566955879,18:.5971642834779395,19:.2985821417389697,20:.1492910708694849,21:.0746455354347424}}var i=28e-5*t;for(var r in n)if(n.hasOwnProperty(r)&&n[r]<=i)return r=parseInt(r,10);return 0},getAttributions:function(t){var e=t.zoom,n=[];if(null!=t.originators&&t.visibility)for(var i,r=0,s=t.originators.length;r<s;r++){i=!0;for(var o=t.originators[r],a=t.originators[r].constraints||[],l=0,c=a.length;l<c;l++){var h=a[l];i=!0;var u=this.getZoomLevelFromScaleDenominator(h.maxScaleDenominator,t.crs),d=this.getZoomLevelFromScaleDenominator(h.minScaleDenominator,t.crs)||21;u&&u>e&&(i=!1),i&&d&&d<e&&(i=!1);var p=h.bbox;if(i&&p){i=!1;var f=t.extent;if(f){var m=[p.top,p.left,p.bottom,p.right];if(this.intersects(f,m)){i=!0;break}}}}if(i){var g=o.logo,v=o.url,y=o.name?o.name:"",_=o.attribution,x=document.createElement("div");x.className="gp-control-attribution";var b=null;(b=document.createElement("a")).className="gp-control-attribution-link",b.target="_blank",x.appendChild(b),v&&(b.href=v);var M=null;!!g?(M=document.createElement("img"),b?(M.className="gp-control-attribution-image",b.appendChild(M)):(M.className="",x.appendChild(M)),M.src=g,M.title=_||y,M.style.height="30px",M.style.width="30px"):b.textContent=y||(_||(v||"")),n.push(x.innerHTML+" ")}}return n},intersects:function(t,e){var n=t[1]<=e[3]&&e[1]<=t[3],i=t[2]<=e[0]&&e[2]<=t[0];return n&&i}},nf={_addUID:function(t){return this._uid?t+"-"+this._uid:t},_createMainContainerElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPAttribution"),t.className="GPwidget",t},_createMainAttributionsShowElement:function(){var t=document.createElement("input");return t.id=this._addUID("GPshowAttributionsList"),t.type="checkbox",t},_createAttributionsList:function(){var t=document.createElement("ul");return t.id=this._addUID("GPAttributionsList"),t},_createMainAttributionsListContainer:function(){var t=document.createElement("div");return t.id=this._addUID("GPAttributionsListContainer"),t},_createMainPictoElement:function(t){var e=this,n=document.createElement("label");n.id=this._addUID("GPshowAttributionsListPicto"),n.className="GPshowAdvancedToolPicto",n.htmlFor=this._addUID("GPshowAttributionsList"),n.title="Afficher/masquer les attributions";var i=document.createElement("span");return i.id=this._addUID("GPshowAttributionsListOpenClose"),i.className="GPshowAdvancedToolOpen",i.innerHTML=t?"i":"»",i.addEventListener("click",(function(){i.innerHTML=document.getElementById(e._addUID("GPshowAttributionsList")).checked?"i":"»"})),n.appendChild(i),n}};function rf(t){return(rf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var sf=o.a.getLogger("Attributions");function of(t){var e=(t=t||{}).options||{};if(!(this instanceof of))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if("object"!==rf(e))throw new Error("ERROR WRONG_TYPE : options should be an object");this._initialize(e);var n=this._initContainer(e);Du.call(this,{name:"Attributions",element:n,target:e.target,position:e.position})}of.prototype=Object.create(Du.prototype,{}),bn.assign(of.prototype,nf),of.prototype.constructor=of,of.prototype.setGlobe=function(t){if(t){var e=this;this._callbacks.onPreRenderCallBack=function(t){var n=t.colorLayersId.concat(t.elevationLayersId);e._inRangeUpdate(n,t.extent)},t.listen(yn.EVENTS.PRE_RENDER,this._callbacks.onPreRenderCallBack),t.preRenderEventFetchViewExtent(),t.preRenderEventFetchLayersDisplayed()}else{for(this._globe.forget(yn.EVENTS.PRE_RENDER,this._callbacks.onPreRenderCallBack);this._element.hasChildNodes();)this._element.removeChild(this._element.lastChild);this._element.parentNode.removeChild(this._element)}Du.prototype.setGlobe.call(this,t)},of.prototype.setCollapsed=function(t){if(void 0!==t){var e=this.getCollapsed();t&&e||!t&&!e||(document.getElementById(this._addUID("GPshowAttributionsList")).checked=!t)}else sf.error("Attributions:setCollapsed - missing collapsed parameter")},of.prototype.getCollapsed=function(){return!document.getElementById(this._addUID("GPshowAttributionsList")).checked},of.prototype._initialize=function(t){this._uid=En.generate(),this._AttributionContainer=null,this._callbacks={},this._options=t},of.prototype._initContainer=function(t){var e=this._createMainContainerElement(),n=this._createMainAttributionsShowElement();e.appendChild(n),t.collapsed||(n.checked="checked");var i=this._attributionListContainer=this._createMainAttributionsListContainer(),r=this._createAttributionsList();i.appendChild(r),e.appendChild(i);var s=this._createMainPictoElement(t.collapsed);return e.appendChild(s),e},of.prototype._inRangeUpdate=function(t,e){for(var n=this.getGlobe(),i=1/n.getScale(),r=new Map,s=0;s<t.length;s++){var o=n.getLayerById(t[s]).source.attribution;if(o)for(var a=0;a<o.length;a++)if(!r.has(o[a].name))if(o[a].constraints&&o[a].constraints[0]){if(o[a].constraints[0].minScaleDenominator)if(o[a].constraints[0].minScaleDenominator===o[a].constraints[0].maxScaleDenominator){var l=ef.getZoomLevelFromScaleDenominator(o[a].constraints[0].minScaleDenominator),c=(this._resolutionsWGS84[l]+this._resolutionsWGS84[l-1])/56e-5,h=(this._resolutionsWGS84[l]+this._resolutionsWGS84[l+1])/56e-5;if(!(c>i&&i>h))continue}else if(!(o[a].constraints[0].minScaleDenominator<i&&i<o[a].constraints[0].maxScaleDenominator))continue;if(o[a].constraints[0].bbox){var u=o[a].constraints[0].bbox.left<=e.east&&e.west<=o[a].constraints[0].bbox.right,d=o[a].constraints[0].bbox.bottom<=e.north&&e.south<=o[a].constraints[0].bbox.top;u&&d&&r.set(o[a].name,o[a])}else o[a].constraints[0].bbox||r.set(o[a].name,o[a])}else r.set(o[a].name,o[a])}r.size&&(this._updateAttributionListContainer(r),this.dispatchEvent({type:"attributions:update",attributions:r}))},of.prototype._updateAttributionListContainer=function(t){var e=document.getElementById(this._addUID("GPAttributionsList"));document.getElementById(this._addUID("GPAttributionsList")).parentNode.removeChild(e);var n=this._createAttributionsList();t.forEach((function(t){var e=document.createElement("li"),i=document.createElement("a");i.href=t.url,i.innerHTML=t.name+"&nbsp",i.target="_blank",e.id=t.name.replace(/\s/g,""),e.appendChild(i),n.appendChild(e)})),this._attributionListContainer.appendChild(n)},of.prototype._resolutionsWGS84={0:156543.033928041,1:78271.51696402048,2:39135.758482010235,3:19567.87924100512,4:9783.93962050256,5:4891.96981025128,6:2445.98490512564,7:1222.99245256282,8:611.49622628141,9:305.7481131407048,10:152.8740565703525,11:76.43702828517624,12:38.21851414258813,13:19.10925707129406,14:9.554628535647032,15:4.777314267823516,16:2.388657133911758,17:1.194328566955879,18:.5971642834779395,19:.2985821417389697,20:.1492910708694849,21:.0746455354347424};var af=of,lf={_addUID:function(t){return this._uid?t+"-"+this._uid:t},_createMainContainerElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPscaleContainer"),t.className="GPwidget",t}};function cf(t){return(cf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hf(t){if(!(this instanceof hf))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if("object"!==cf(t))throw new Error("ERROR WRONG_TYPE : options should be an object");this._initialize();var e=this._initContainer();Du.call(this,{name:"GraphicScale",element:e,target:t.target,position:t.position})}hf.prototype=Object.create(Du.prototype,{}),bn.assign(hf.prototype,lf),hf.prototype.constructor=hf,hf.prototype.setGlobe=function(t){if(t){var e=this;this._callbacks.onChangedViewCallback=function(){var n=t.pixelsToMeters(200);n=Math.floor(n);var i=Math.pow(10,n.toString().length-1);n=Math.round(n/i)*i;var r=t.metersToPixels(n),s="m";n>=1e3&&(n/=1e3,s="km"),e.getElement().innerHTML=n+" "+s,e.getElement().style.width=r+"px"},t.isInitialized()?this._callbacks.onChangedViewCallback():t.listen(yn.EVENTS.GLOBE_INITIALIZED,this._callbacks.onChangedViewCallback),t.listen(yn.EVENTS.RANGE_CHANGED,this._callbacks.onChangedViewCallback)}else if(null==t){for(this._globe.forget(yn.EVENTS.GLOBE_INITIALIZED,this._callbacks.onChangedViewCallback),this._globe.forget(yn.EVENTS.RANGE_CHANGED,this._callbacks.onChangedViewCallback);this.getElement().hasChildNodes();)this.getElement().removeChild(this.getElement().lastChild);this.getElement().parentNode.removeChild(this.getElement())}Du.prototype.setGlobe.call(this,t)},hf.prototype._initialize=function(){this._uid=En.generate(),this._ScaleContainer=null,this._callbacks={}},hf.prototype._initContainer=function(){return this._createMainContainerElement()};var uf=hf,df={_addUID:function(t){return this._uid?t+"-"+this._uid:t},_createMainContainerElement:function(){var t=document.createElement("div");return t.id=this._addUID("GPminiglobeContainer"),t.className="GPwidget",t.style.width="100px",t.style.height="100px",t}};function pf(t){return(pf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ff(t){if(t=t||{},!(this instanceof ff))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if("object"!==pf(t))throw new Error("ERROR WRONG_TYPE : options should be an object");this._initialize();var e=this._initContainer();this._options=t,Du.call(this,{name:"Overview",element:e,target:t.target,position:t.position})}ff.prototype=Object.create(Du.prototype,{}),bn.assign(ff.prototype,df),ff.prototype.constructor=ff,ff.prototype.setGlobe=function(t){if(t){var e=t.getCenter(),n=new yn(this._element,e,{maxSubdivisionLevel:6,sseSubdivisionThreshold:3,noControls:!0});n.setBackground();var i=function(){var e=t.getGlobeView().camera.camera3D.position.length(),i=Math.min(Math.max(e,665e4),3e7),r=n.getGlobeView().camera.camera3D,s=t.getGlobeView().controls.getCameraTargetPosition();r.position.copy(s).setLength(i),r.lookAt(s),n.notifyChange(r)};t.listen(yn.EVENTS.AFTER_RENDER,i),t.isInitialized()?i():t.listen(yn.EVENTS.GLOBE_INITIALIZED,i);var r=this._options.layer;n.addLayer(r),this._globeObj=n}else if(null==t){for(;this.getElement().hasChildNodes();)this.getElement().removeChild(this.getElement().lastChild);this.getElement().parentNode.removeChild(this.getElement())}Du.prototype.setGlobe.call(this,t)},ff.prototype._initialize=function(){this._uid=En.generate(),this._MiniGlobeContainer=null,this._callbacks={}},ff.prototype._initContainer=function(){return this._createMainContainerElement()};var mf=ff,gf=o.a.getLogger("wmtsLayer");function vf(t){if(!(this instanceof vf))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(!t.layer)throw new Error("ERROR PARAM_MISSING : layer");if("string"!=typeof t.layer)throw new Error("ERROR WRONG TYPE : layer");if(void 0===t.ssl&&(t.ssl=!0),!Mn.a.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html");var e=Mn.a.getLayerId(t.layer,"WMTS");if(e&&Mn.a.configuration.getLayerConf(e)){var n={},r=Mn.a.getLayerParams(t.layer,"WMTS",t.apiKey);"EPSG:3857"===r.projection?r.extent=new mn.Extent("EPSG:4326",r.extent.left,r.extent.right,r.extent.bottom,r.extent.top).as("EPSG:3857"):(r.projection="EPSG:4326",r.extent=new mn.Extent("EPSG:4326",r.extent.left,r.extent.right,r.extent.bottom,r.extent.top)),0===Object.entries(r.tileMatrixSetLimits).length&&r.tileMatrixSetLimits.constructor===Object&&(r.tileMatrixSetLimits=void 0);var s=!1===t.ssl?"http://":"https://";return n.id=e,n.source=new mn.WMTSSource({protocol:"wmts",url:r.url.replace(/(http|https):\/\//,s),networkOptions:{crossOrigin:"omit"},updateStrategy:{type:0,options:{}},projection:r.projection,attribution:r.originators,name:t.layer,format:r.format,tileMatrixSet:r.TMSLink,tileMatrixSetLimits:r.tileMatrixSetLimits,extent:{west:r.extent.west,east:r.extent.east,south:r.extent.south,north:r.extent.north}}),n.source.url=fn.Helper.normalyzeUrl(n.source.url,{"gp-itowns-ext":i.itownsExtVersion||i.version},!1),bn.mergeParams(n,t.itownsParams),n.legends=r.legends,n.metadata=r.metadata,n.description=r.description,n.title=r.title,n.quicklookUrl=r.quicklookUrl,new mn.ColorLayer(n.id,n)}gf.error("ERROR layer id (layer name: "+t.layer+" / service: WMTS ) was not found !?")}vf.prototype.constructor=vf;var yf=vf,_f=o.a.getLogger("wmsLayer");function xf(t){if(!(this instanceof xf))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(!t.layer)throw new Error("ERROR PARAM_MISSING : layer");if("string"!=typeof t.layer)throw new Error("ERROR WRONG TYPE : layer");if(void 0===t.ssl&&(t.ssl=!0),!Mn.a.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html");var e=Mn.a.getLayerId(t.layer,"WMS");if(e&&Mn.a.configuration.getLayerConf(e)){var n={},r=Mn.a.getLayerParams(t.layer,"WMS",t.apiKey);"EPSG:3857"===r.projection?r.extent=new mn.Extent("EPSG:4326",r.extent.left,r.extent.right,r.extent.bottom,r.extent.top).as("EPSG:3857"):r.extent=new mn.Extent("EPSG:4326",r.extent.left,r.extent.right,r.extent.bottom,r.extent.top);var s=!1===t.ssl?"http://":"https://";return n.id=e,n.source=new mn.WMSSource({protocol:"wms",version:r.version,attribution:r.originators,url:r.url.replace(/(http|https):\/\//,s),name:t.layer,projection:r.projection,style:"",heightMapWidth:256,waterMask:!1,networkOptions:{crossOrigin:"omit"},updateStrategy:{type:0,options:{}},format:r.format,extent:{west:r.extent.west,east:r.extent.east,south:r.extent.south,north:r.extent.north}}),n.source.url=fn.Helper.normalyzeUrl(n.source.url,{"gp-itowns-ext":i.itownsExtVersion||i.version},!1),bn.mergeParams(n,t.itownsParams),n.legends=r.legends,n.metadata=r.metadata,n.description=r.description,n.title=r.title,n.quicklookUrl=r.quicklookUrl,new mn.ColorLayer(n.id,n)}_f.error("ERROR layer id (layer name: "+t.layer+" / service: WMS ) was not found !?")}xf.prototype.constructor=xf;var bf=xf,Mf=o.a.getLogger("elevationLayer");function wf(t){if(!(this instanceof wf))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(!t.layer)throw new Error("ERROR PARAM_MISSING : layer");if("string"!=typeof t.layer)throw new Error("ERROR WRONG TYPE : layer");if(void 0===t.ssl&&(t.ssl=!1),!Mn.a.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html");var e=Mn.a.getLayerId(t.layer,"WMTS");if(e&&Mn.a.configuration.getLayerConf(e)){var n={},r=Mn.a.getLayerParams(t.layer,"WMTS",t.apiKey);"EPSG:3857"===r.projection?r.extent=new mn.Extent("EPSG:4326",r.extent.left,r.extent.right,r.extent.bottom,r.extent.top).as("EPSG:3857"):(r.projection="EPSG:4326",r.extent=new mn.Extent("EPSG:4326",r.extent.left,r.extent.right,r.extent.bottom,r.extent.top));var s="undefined"!=typeof window?window:"undefined"!=typeof self?self:null,o=s?s.location&&s.location.protocol&&0===s.location.protocol.indexOf("https:")?"https://":"http://":t.ssl?"https://":"http://";return n.id=e,n.noDataValue=-99999,n.updateStrategy={type:0,options:{groups:[11,14]}},n.source=new mn.WMTSSource({protocol:"wmts",url:r.url.replace(/(http|https):\/\//,o),networkOptions:{crossOrigin:"omit"},attribution:r.originators,projection:r.projection,name:t.layer,format:"image/x-bil;bits=32",tileMatrixSet:r.TMSLink,tileMatrixSetLimits:r.tileMatrixSetLimits,extent:{west:r.extent.west,east:r.extent.east,south:r.extent.south,north:r.extent.north}}),n.source.url=fn.Helper.normalyzeUrl(n.source.url,{"gp-itowns-ext":i.itownsExtVersion||i.version},!1),bn.mergeParams(n,t.itownsParams),n.legends=r.legends,n.metadata=r.metadata,n.description=r.description,n.title=r.title,n.quicklookUrl=r.quicklookUrl,new mn.ElevationLayer(n.id,n)}Mf.log("[source WMTS] ERROR : "+t.layer+" cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.")}wf.prototype.constructor=wf;var Ef=wf,Sf=o.a.getLogger("vectorTileLayer");function Tf(t){if(!(this instanceof Tf))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(!t.layer)throw new Error("ERROR PARAM_MISSING : layer");if("string"!=typeof t.layer)throw new Error("ERROR WRONG TYPE : layer");if(!Mn.a.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html");var e=Mn.a.getLayerId(t.layer,"TMS");if(e&&Mn.a.configuration.getLayerConf(e)){var n={},i=Mn.a.getLayerParams(t.layer,"TMS",t.apiKey),r=!1===t.ssl?"http://":"https://";return n.id=e,n.source=new mn.VectorTilesSource({style:i.url.replace(/(http|https):\/\//,r),url:t.urlService,attribution:t.attributions,filter:t.filter,zoom:t.zoom}),n.isValidData=function(){return!1},new mn.ColorLayer(n.id,n)}Sf.error("ERROR layer id (layer name: "+t.layer+" / service: TMS ) was not found !?")}Tf.prototype.constructor=Tf;var Rf=Tf;!function(){var t=document.getElementsByTagName("script"),e=t[t.length-1].getAttribute("data-key");if(e){var n=e.split(/;|,|\|/);if(n.length>1){for(var i=[],r=0;r<n.length;r++)i.push(n[r]);e=i}}var s=t[t.length-1].getAttribute("data-url"),o=t[t.length-1].getAttribute("data-timeout");if(e||s){var a={apiKey:e,onSuccess:function(){},onFailure:function(t){throw new Error("Configuration load failed : "+t.message)}};s&&(a.serverUrl=s,a.callbackSuffix=""),o&&(a.timeOut=o),fn.Config||fn.Services.getConfig(a)}}();var Af={proxifyUrl:function(t,e){var n=o.a.getLogger("proxifyUrl");if(!e||!e.hasOwnProperty("proxyUrl")||null===e.proxyUrl||0===e.proxyUrl.trim().length)return t;if(e.noProxyDomains&&Array.isArray(e.noProxyDomains)&&e.noProxyDomains.length>0)for(var i in e.noProxyDomains)if(n.trace("[ProxyUtils] proxifyUrl : analyzing "+e.noProxyDomains[i]),-1!==t.indexOf(e.noProxyDomains[i]))return n.info("[ProxyUtils] proxifyUrl : "+t+" found in noProxyDomains list ("+e.noProxyDomains[i]+")."),t;return e.proxyUrl+encodeURIComponent(t)}},Cf={rgbaToHex:function(t){function e(t){if(t>255)throw new Error("'"+t+"'' is greater than 255(0xff);");return("0"+Number(t).toString(16)).slice(-2)}var n=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(0?.?\d+)\s*)?\)/.exec(t);if(!n)throw new Error("Invalid format: "+t);var i=n[1],r=n[2],s=n[3],o=n[4],a=[e(i),e(r),e(s)],l={};return l.hex="#"+a.join(""),o&&(l.opacity=parseFloat(o)),l},hexToRgba:function(t,e){if(!t)throw new Error("Invalid format");t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,n,i){return e+e+n+n+i+i}));var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return(n=n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null)?"rgba("+n.r+", "+n.g+", "+n.b+", "+e+")":null},isHex:function(t){if(!t)return!1;if("#"!==t.charAt(0))return!1;return!!/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t)},isRGB:function(t){if(!t)return!1;return!!/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(0?.?\d+)\s*)?\)/.exec(t)}},Pf={modulo:function(t,e){var n=t%e;return n*e<0?n+e:n},decimalToDMS:function(t,e,n){var i=this.modulo(t+180,360)-180,r=Math.abs(3600*i),s=n||0,o=Math.pow(10,s),a=Math.floor(r/3600),l=Math.floor((r-3600*a)/60),c=r-3600*a-60*l;return(c=Math.ceil(c*o)/o)>=60&&(c=0,l+=1),l>=60&&(l=0,a+=1),{d:a,m:l,s:c,direction:e.charAt(i<0?1:0)}},toInteger:function(t,e){var n=parseInt(t,e||10);return!isNaN(n)&&isFinite(n)?n:null},isInteger:function(t){if(isNaN(t))return!1;var e=parseFloat(t);return(0|e)===e},toFloat:function(t){var e=parseFloat(t);return!isNaN(e)&&isFinite(e)?e:null}};function Lf(t){return(Lf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var If=fn.Services,Nf=fn.Error,Df=fn.Helper,Of=fn.Protocols,Gf=fn.servicesDate,kf=fn.servicesVersion;function Uf(t,e){return function t(e,n){for(var i in e)e.hasOwnProperty(i)&&(n.hasOwnProperty(i)?"object"===Lf(e[i])&&t(e[i],n[i]):n[i]=e[i])}(t,e)}var Ff=i.itownsExtVersion||i.version,Bf=i.date,zf={control:{}};zf.control.MousePosition=Bu,zf.control.LayerSwitcher=Jp,zf.control.BoostRelief=tf,zf.control.Attributions=af,zf.control.Scale=uf,zf.control.MiniGlobe=mf,zf.layer={},zf.layer.GeoportalWMTS=yf,zf.layer.GeoportalWMS=bf,zf.layer.GeoportalElevation=Ef,zf.layer.VectorTileLayer=Rf,zf.CRS=Gu,zf.GlobeViewExtended=yn,window.itowns&&(Uf(zf,window.itowns),Uf(window.itowns,zf))}])}));