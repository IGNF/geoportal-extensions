{{#extend "ol-sample-bundle-multikeys-layout"}}

{{#content "head"}}
<title>Sample OpenLayers Route GPF WXS</title>
{{/content}}

{{#content "style"}}
<style>
    div#map1 {
        width: 50%;
        height: 500px;
        background-position: center center;
        background-repeat: no-repeat;
        display: none;
        float: left;
    }

    div#map2 {
        width: 50%;
        height: 500px;
        background-position: center center;
        background-repeat: no-repeat;
        display: none;
        float: left;
    }

    div#iti1 {
        width: 50%;
        height: 300px;
        float: left;
    }

    div#iti2 {
        width: 50%;
        height: 300px;
        float: right;
    }

    div#results {
        display: none;
        position: center;
        width: 100%;
        height: 300px;
    }

    div.titles {
        left: 8px;
        position: relative;
    }

    div.rawResponse {
        float: right;
        position: relative;
        width: 60%;
        height: 300px;
        background-color: black;
        color: white;
        overflow: scroll;
        overflow-x: hidden;
    }

    div[id^="GProute-"] {
        top: 0px;
        left: 0px;
        position: relative;
    }
</style>
{{/content}}

{{#content "body"}}
<h2>Comparaison des services d'itinéraires avec le control d'itinéraire</h2>
<div id="form">
    <label for="resource">Resource à utiliser côté itinéraire GPF :</label>
    <input type="text" id="resource" name="resource" value="osrm77">

    <br />
    <input type="button" id="createMap" value="Valider" />
</div>
<div id="map1">
</div>
<div id="map2">
</div>

<div id="results">

    <div id="iti1">
        <div class="titles">WXS</div>
        <div class="rawResponse" id="rawResponse1"></div>
    </div>

    <div id="iti2">
        <div class="titles">GPF</div>
        <div class="rawResponse" id="rawResponse2"></div>
    </div>
</div>

{{/content}}

{{#content "js"}}
<script type="text/javascript">
    Array.prototype.equals = function (getArray) {
        if (this.length != getArray.length) return false;

        for (var i = 0; i < getArray.length; i++) {
            if (this[i] instanceof Array && getArray[i] instanceof Array) {
                if (!this[i].equals(getArray[i])) return false;
            } else if (this[i] != getArray[i]) {
                return false;
            }
        }
        return true;
    };

    /** Affichage de la reponse dans la balise (+ console) */
    function print(response, divId) {
        var el = document.getElementById(divId);
        el.innerHTML = "<pre>" + JSON.stringify(response, null, 2) + "</pre>";
        console.log(response);
    };
    var map;
    var iti1 = document.getElementById("iti1");
    var iti2 = document.getElementById("iti2");

    document.getElementById("createMap").onclick = function () {

        // Affichage de la carte
        document.getElementById('form').style.display = 'none';
        document.getElementById('map1').style.display = 'block';
        document.getElementById('map2').style.display = 'block';
        document.getElementById('results').style.display = 'block';

        // récupération des valeurs du formulaire
        let resource = document.getElementById('resource').value;

        var osm1 = new ol.layer.Tile({
            source: new ol.source.OSM({
                attributions: [
                    "OSM"
                ]
            })
        });
        var osm2 = new ol.layer.Tile({
            source: new ol.source.OSM({
                attributions: [
                    "OSM"
                ]
            })
        });
        // Création de la map
        var map1 = new ol.Map({
            target: "map1",
            layers: [osm1],
            view: new ol.View({
                center: [309646.401583, 6252625.350756],
                zoom: 14
            })
        });

        // Création de la map
        var map2 = new ol.Map({
            target: "map2",
            layers: [osm2],
            view: new ol.View({
                center: [309646.401583, 6252625.350756],
                zoom: 14
            })
        });

        var route2 = new ol.control.Route({
            collapsed: false,
            target: iti2,
            routeOptions: {
                resource: resource,
                onSuccess: function (response) {
                    print(response, "rawResponse2");
                    var requestOptions = this.getData();
                    if (requestOptions.points.equals(route1.getData().points)) {
                        return;
                    }
                    route1.setData(requestOptions);
                    route1.onRouteComputationSubmit(route1.getData());
                }
            }
        });

        var route1 = new ol.control.Route({
            collapsed: false,
            target: iti1,
            routeOptions: {
                oldRouteService: true,
                resource: "bdtopo-osrm",
                onSuccess: function (response) {
                    print(response, "rawResponse1");
                    var requestOptions = this.getData();
                    if (requestOptions.points.equals(route2.getData().points)) {
                        return;
                    }
                    route2.setData(requestOptions);
                    route2.onRouteComputationSubmit(route2.getData());
                }
            }
        });
        var layerSwitcher1 = new ol.control.LayerSwitcher({});
        map1.addControl(layerSwitcher1);

        var layerSwitcher2 = new ol.control.LayerSwitcher({});
        map2.addControl(layerSwitcher2);

        map1.addControl(route1);
        map2.addControl(route2);
    };

</script>
{{/content}}

{{/extend}}