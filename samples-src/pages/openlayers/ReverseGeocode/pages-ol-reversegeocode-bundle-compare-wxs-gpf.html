{{#extend "ol-sample-bundle-multikeys-layout"}}

{{#content "head"}}
<title>Sample openlayers ReverseGeocode</title>
{{/content}}

{{#content "style"}}
<style>
    div#map1 {
        width: 50%;
        height: 500px;
        float: left;
    }

    div#map2 {
        width: 50%;
        height: 500px;
        float: right;
    }

    div#rg1 {
        width: 50%;
        height: 300px;
        float: left;
    }

    div#rg2 {
        width: 50%;
        height: 300px;
        float: right;
    }

    div[id^="GPreverseGeocoding-"] {
        position: relative;
        top: 0px;
    }
</style>
{{/content}}

{{#content "body"}}
<h2>Ajout du controle de géocodage inverse avec les options par défaut pour comparer les services de geocodage inverse
    WXS/GPF</h2>
<!-- map -->
<div id="map1">
</div>
<div id="map2">
</div>
<div id="searchEngines">

    <div id="rg1">
        <div class="titles">WXS</div>
    </div>

    <div id="rg2">
        <div class="titles">GPF</div>
    </div>
</div>
{{/content}}

{{#content "js"}}
<script type="text/javascript">
    var map;
    window.onload = function () {
        var rg1 = document.getElementById("rg1");
        var rg2 = document.getElementById("rg2");
        // on cache l'image de chargement du Géoportail.
        document.getElementById('map1').style.backgroundImage = 'none';
        document.getElementById('map2').style.backgroundImage = 'none';

        var osm1 = new ol.layer.Tile({
            source: new ol.source.OSM({
                attributions: [
                    "OSM"
                ]
            })
        });

        var osm2 = new ol.layer.Tile({
            source: new ol.source.OSM({
                attributions: [
                    "OSM"
                ]
            })
        });

        // 1. Création de la map
        map1 = new ol.Map({
            target: "map1",
            view: new ol.View({
                center: [288074.8449901076, 6247982.515792289],
                zoom: 6
            }),
            layers: [osm1]
        });
        map2 = new ol.Map({
            target: "map2",
            view: new ol.View({
                center: [288074.8449901076, 6247982.515792289],
                zoom: 6
            }),
            layers: [osm2]
        });

        // 2. Appel du SearchEngine
        var reverseWXS = new ol.control.ReverseGeocode({
            target: rg1,
            collapsed: false,
            geocodeOptions: {
                serviceOptions: {
                    maximumResponses: 15,
                    oldGeocodeService: true
                }
            },
            autocompleteOptions: {
                serviceOptions: {
                    maximumResponses: 15,
                    oldAutocompleteService: true
                }
            },
            reverseGeocodeOptions: {
                oldReverseService: true,
                onSuccess: function (response) {
                    if (reverseGPF._requestPosition !== reverseWXS._requestPosition) {
                        reverseGPF._currentGeocodingType = reverseWXS._currentGeocodingType;
                        reverseGPF._requestGeom = reverseWXS._requestGeom;  
                        reverseGPF._reverseGeocodingRequest();
                    }
                }
            }
        });

        var reverseGPF = new ol.control.ReverseGeocode({
            target: rg2,
            collapsed: false,
            geocodeOptions: {
                serviceOptions: {
                    maximumResponses: 15
                }
            },
            autocompleteOptions: {
                serviceOptions: {
                    maximumResponses: 15
                },
            },
            reverseGeocodeOptions: {
                onSuccess: function (response) {
                    if (reverseWXS._requestPosition !== reverseGPF._requestPosition) {
                        reverseWXS._requestPosition = reverseGPF._requestPosition;
                        reverseWXS._currentGeocodingType = reverseGPF._currentGeocodingType;
                        reverseWXS._requestGeom = reverseGPF._requestGeom;
                        reverseWXS._reverseGeocodingRequest();
                    }
                }
            }
        });

        // 3. Ajout du ReverseGeocode à la carte
        map1.addControl(reverseWXS);
        map2.addControl(reverseGPF);

    };
</script>
{{/content}}

{{/extend}}