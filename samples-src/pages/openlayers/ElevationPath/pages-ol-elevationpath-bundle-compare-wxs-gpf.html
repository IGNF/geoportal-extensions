{{#extend "ol-sample-bundle-multikeys-layout"}}

{{#content "head"}}
<title>Sample OpenLayers ElevationPath GPF WXS</title>
{{/content}}

{{#content "style"}}
<style>
    div#map {
        width: 100%;
        height: 500px;
        background-position: center center;
        background-repeat: no-repeat;
        display: none;
    }

    div#alti1 {
        width: 50%;
        height: 300px;
        float: left;
    }

    div#alti2 {
        width: 50%;
        height: 300px;
        float: right;
    }

    div#results {
        display: none;
        position: center;
        width: 100%;
        height: 300px;
    }

    div.titles {
        left: 8px;
        position: relative;
    }

    div.rawResponse {
        float: right;
        position: relative;
        width: 60%;
        height: 300px;
        background-color: black;
        color: white;
        overflow: scroll;
        overflow-x: hidden;
    }

    div[id^="GPtoolbox-measure-main"] {
        display: none;
    }
</style>
{{/content}}

{{#content "body"}}
<h2>Comparaison des profils altimetriques avec toutes les options</h2>
<div id="form">
    <label for="sampling">Sampling (200 par défaut):</label>
    <input type="number" id="sampling" name="sampling" value="200">
<br/>
    <label for="resource">Resource à utiliser côté alti GPF :</label>
    <input type="text" id="resource" name="resource" value="rge_alti_corse2a_float32_zip_lamb93">

    <br/>

    <label for="display_type">Type d'affichage :</label>
    <select id="display_type" name="display_type">
        <option selected="selected" value="DISPLAY_PROFILE_BY_DEFAULT">Profil altimétrique</option>
        <option value="DISPLAY_PROFILE_RAW">Donnée brute</option>
    </select>

    <br/>

    <label for="measures">Réponse détaillée (measures) :</label>
    <select id="measures" name="measures">
        <option selected="selected" value="true">OUI</option>
        <option value="false">NON</option>
    </select>
    <br/>
    <br/>
    <input type="button" id="createMap" value="Valider" />
</div>
<div id="map">
</div>

<div id="results">

    <div id="alti1">
        <div class="titles">GPF</div>
        <div class="rawResponse" id="rawResponse1"></div>
    </div>

    <div id="alti2">
        <div class="titles">WXS</div>
        <div class="rawResponse" id="rawResponse2"></div>
    </div>
</div>

{{/content}}

{{#content "js"}}
<script type="text/javascript">
    /** Affichage de la reponse dans la balise (+ console) */
    function print(response, divId) {
        var el = document.getElementById(divId);
        el.innerHTML = "<pre>" + JSON.stringify(response, null, 2) + "</pre>";
        console.log(response);
    };
    var map;
    var alti1 = document.getElementById("alti1");
    var alti2 = document.getElementById("alti2");

    document.getElementById("createMap").onclick = function () {
        // Affichage de la carte
        document.getElementById('form').style.display = 'none';
        document.getElementById('map').style.display = 'block';
        document.getElementById('results').style.display = 'block';

        // récupération des valeurs du formulaire
        let sampling = parseInt(document.getElementById('sampling').value);
        let resource = document.getElementById('resource').value;
        let display = ol.control.ElevationPath[document.getElementById('display_type').value];
        let measuresParam = document.getElementById('measures').value;

        var osm = new ol.layer.Tile({
            source: new ol.source.OSM({
                attributions: [
                    "OSM"
                ]
            })
        });
        //Création de la map
        map = new ol.Map({
            target: "map",
            layers: [osm],
            view: new ol.View({
                center: [1015083.735627, 5098655.534734],
                zoom: 10
            })
        });


        var elevation_gpf_options = {
            active: true,
            elevationOptions: {
                sampling: sampling,
                resource: resource,
                measures: measuresParam,
                onSuccess: function (response) {
                    print(response, "rawResponse1");
                }
            },
            displayProfileOptions: {
                apply: display,
                target: alti1
            }
        };

        var elevation_wxs_options = {
            active: true,
            elevationOptions: {
                sampling: sampling,
                oldAltiService: true,
                resource: "none",
                onSuccess: function (response) {
                    print(response, "rawResponse2");
                }
            },
            displayProfileOptions: {
                apply: display,
                target: alti2
            }
        };

        var mouse_position = new ol.control.MousePosition(mouse_position);

        var elevation_gpf = new ol.control.ElevationPath(elevation_gpf_options);

        var elevation_wxs = new ol.control.ElevationPath(elevation_wxs_options);

        map.addControl(mouse_position);
        map.addControl(elevation_gpf);
        map.addControl(elevation_wxs);
    };
</script>
{{/content}}

{{/extend}}